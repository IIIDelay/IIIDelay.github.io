<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/en/distributed/cache/redis.html"><meta property="og:site_name" content="IIIDelayçš„ Blog"><meta property="og:title" content="Redisé¢è¯•é¢˜"><meta property="og:description" content="Redisé¢è¯•é¢˜ rediså¸¸è§é¢è¯•é¢˜ï¼šåƒé€è¿™ä»½Rediså­¦ä¹ ç¬”è®°ï¼Œç›´æ¥æŠŠé˜¿é‡Œé¢è¯•å®˜æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï¼ 1. ä»€ä¹ˆæ˜¯redisï¼Ÿ Redis (Remote Dictionary Server)å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚"><meta property="og:type" content="article"><meta property="og:image" content="https://mister-hope.github.io/"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Redisé¢è¯•é¢˜"><meta property="article:author" content="Mr.IIIDelay"><meta property="article:tag" content="yellow"><meta property="article:tag" content="curly"><meta property="article:tag" content="long"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redisé¢è¯•é¢˜","image":["https://mister-hope.github.io/"],"dateModified":null,"author":[{"@type":"Person","name":"Mr.IIIDelay","url":"https://mrhope.site"}]}</script><title>Redisé¢è¯•é¢˜ | IIIDelayçš„ Blog</title><meta name="description" content="Redisé¢è¯•é¢˜ rediså¸¸è§é¢è¯•é¢˜ï¼šåƒé€è¿™ä»½Rediså­¦ä¹ ç¬”è®°ï¼Œç›´æ¥æŠŠé˜¿é‡Œé¢è¯•å®˜æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï¼ 1. ä»€ä¹ˆæ˜¯redisï¼Ÿ Redis (Remote Dictionary Server)å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-6a04a3cc.css" as="style"><link rel="stylesheet" href="/assets/style-6a04a3cc.css">
    <link rel="modulepreload" href="/assets/app-50a824e8.js"><link rel="modulepreload" href="/assets/framework-b5ea9e64.js"><link rel="modulepreload" href="/assets/redis.html-cd83f8a8.js"><link rel="modulepreload" href="/assets/redis.html-c1b5bdc0.js"><link rel="prefetch" href="/assets/intro.html-3cd3e86c.js" as="script"><link rel="prefetch" href="/assets/index.html-25ccf11e.js" as="script"><link rel="prefetch" href="/assets/slides.html-9b79b21a.js" as="script"><link rel="prefetch" href="/assets/disable.html-5833c3eb.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-5511ae0f.js" as="script"><link rel="prefetch" href="/assets/markdown.html-e4562c5e.js" as="script"><link rel="prefetch" href="/assets/page.html-5677046a.js" as="script"><link rel="prefetch" href="/assets/index.html-046ad4b0.js" as="script"><link rel="prefetch" href="/assets/intro.html-7d3ea627.js" as="script"><link rel="prefetch" href="/assets/index.html-fb2a0ee3.js" as="script"><link rel="prefetch" href="/assets/slides.html-9a7b8de6.js" as="script"><link rel="prefetch" href="/assets/disable.html-cf2277db.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-5219ca3b.js" as="script"><link rel="prefetch" href="/assets/markdown.html-3b8712bd.js" as="script"><link rel="prefetch" href="/assets/page.html-9f106f64.js" as="script"><link rel="prefetch" href="/assets/index.html-c3796375.js" as="script"><link rel="prefetch" href="/assets/disable.html-19217888.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-f9f4cdf1.js" as="script"><link rel="prefetch" href="/assets/markdown.html-890091b1.js" as="script"><link rel="prefetch" href="/assets/page.html-bf9b0ca5.js" as="script"><link rel="prefetch" href="/assets/index.html-28d85643.js" as="script"><link rel="prefetch" href="/assets/index.html-423a4e50.js" as="script"><link rel="prefetch" href="/assets/mysql.html-5a0be5f6.js" as="script"><link rel="prefetch" href="/assets/postgresql.html-65cc7a0e.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-90acf583.js" as="script"><link rel="prefetch" href="/assets/idwork.html-d4ae77b6.js" as="script"><link rel="prefetch" href="/assets/css.html-4f40a97b.js" as="script"><link rel="prefetch" href="/assets/html.html-a3b9acb3.js" as="script"><link rel="prefetch" href="/assets/js.html-ce916738.js" as="script"><link rel="prefetch" href="/assets/nginx.html-de1349d5.js" as="script"><link rel="prefetch" href="/assets/elaticsearch.html-0843c52d.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-976cd0a4.js" as="script"><link rel="prefetch" href="/assets/vue.html-de7169f8.js" as="script"><link rel="prefetch" href="/assets/jvm.html-8f089829.js" as="script"><link rel="prefetch" href="/assets/list.html-7ad4f4ef.js" as="script"><link rel="prefetch" href="/assets/map.html-74dc8f5e.js" as="script"><link rel="prefetch" href="/assets/set.html-8f466ae8.js" as="script"><link rel="prefetch" href="/assets/juc.html-647653ba.js" as="script"><link rel="prefetch" href="/assets/thread.html-bc15370b.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-448b0268.js" as="script"><link rel="prefetch" href="/assets/spring.html-88b31e3c.js" as="script"><link rel="prefetch" href="/assets/springboot.html-90d3e17d.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-91a46607.js" as="script"><link rel="prefetch" href="/assets/springcloud.html-f6fa6894.js" as="script"><link rel="prefetch" href="/assets/springcloudAlibaba.html-9d982f31.js" as="script"><link rel="prefetch" href="/assets/404.html-8d7ddf59.js" as="script"><link rel="prefetch" href="/assets/index.html-117f57c1.js" as="script"><link rel="prefetch" href="/assets/index.html-64c23b9f.js" as="script"><link rel="prefetch" href="/assets/index.html-f3603623.js" as="script"><link rel="prefetch" href="/assets/index.html-cdb1cd21.js" as="script"><link rel="prefetch" href="/assets/index.html-2daae4c3.js" as="script"><link rel="prefetch" href="/assets/index.html-4c9b9c86.js" as="script"><link rel="prefetch" href="/assets/index.html-f1134fa2.js" as="script"><link rel="prefetch" href="/assets/index.html-d8f510ea.js" as="script"><link rel="prefetch" href="/assets/index.html-5b0d539d.js" as="script"><link rel="prefetch" href="/assets/index.html-cbc6836f.js" as="script"><link rel="prefetch" href="/assets/index.html-78bed988.js" as="script"><link rel="prefetch" href="/assets/index.html-567289df.js" as="script"><link rel="prefetch" href="/assets/index.html-9dd75139.js" as="script"><link rel="prefetch" href="/assets/index.html-8bd5f926.js" as="script"><link rel="prefetch" href="/assets/index.html-1986a589.js" as="script"><link rel="prefetch" href="/assets/index.html-311ca7c9.js" as="script"><link rel="prefetch" href="/assets/index.html-9a1933f9.js" as="script"><link rel="prefetch" href="/assets/index.html-0b7262b3.js" as="script"><link rel="prefetch" href="/assets/index.html-273e9410.js" as="script"><link rel="prefetch" href="/assets/index.html-6daa24b2.js" as="script"><link rel="prefetch" href="/assets/index.html-e64a306a.js" as="script"><link rel="prefetch" href="/assets/index.html-cbcea2f3.js" as="script"><link rel="prefetch" href="/assets/index.html-8b43dfd1.js" as="script"><link rel="prefetch" href="/assets/index.html-b9502ddb.js" as="script"><link rel="prefetch" href="/assets/index.html-860a114f.js" as="script"><link rel="prefetch" href="/assets/index.html-782963b7.js" as="script"><link rel="prefetch" href="/assets/index.html-fb4b5ad1.js" as="script"><link rel="prefetch" href="/assets/index.html-fd7d15c8.js" as="script"><link rel="prefetch" href="/assets/index.html-2c51a30d.js" as="script"><link rel="prefetch" href="/assets/index.html-a0864148.js" as="script"><link rel="prefetch" href="/assets/index.html-5fc0e626.js" as="script"><link rel="prefetch" href="/assets/index.html-263613fb.js" as="script"><link rel="prefetch" href="/assets/index.html-cce1ce08.js" as="script"><link rel="prefetch" href="/assets/index.html-6851c096.js" as="script"><link rel="prefetch" href="/assets/index.html-4ff8c7b7.js" as="script"><link rel="prefetch" href="/assets/index.html-3ac086ff.js" as="script"><link rel="prefetch" href="/assets/index.html-d1d41465.js" as="script"><link rel="prefetch" href="/assets/index.html-3b736981.js" as="script"><link rel="prefetch" href="/assets/index.html-2adeca1e.js" as="script"><link rel="prefetch" href="/assets/index.html-7f81a989.js" as="script"><link rel="prefetch" href="/assets/index.html-329bd63b.js" as="script"><link rel="prefetch" href="/assets/index.html-379e8d35.js" as="script"><link rel="prefetch" href="/assets/index.html-4d158d84.js" as="script"><link rel="prefetch" href="/assets/index.html-4b5c4258.js" as="script"><link rel="prefetch" href="/assets/index.html-c954921e.js" as="script"><link rel="prefetch" href="/assets/index.html-c5d3e9ea.js" as="script"><link rel="prefetch" href="/assets/index.html-50403a74.js" as="script"><link rel="prefetch" href="/assets/index.html-4fa66a8d.js" as="script"><link rel="prefetch" href="/assets/index.html-68cb03c4.js" as="script"><link rel="prefetch" href="/assets/index.html-72a13ac8.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2f0e41.js" as="script"><link rel="prefetch" href="/assets/index.html-b882d86f.js" as="script"><link rel="prefetch" href="/assets/index.html-e497066a.js" as="script"><link rel="prefetch" href="/assets/index.html-0a302d00.js" as="script"><link rel="prefetch" href="/assets/index.html-6b6a187d.js" as="script"><link rel="prefetch" href="/assets/index.html-b9a16419.js" as="script"><link rel="prefetch" href="/assets/index.html-8eaf66f1.js" as="script"><link rel="prefetch" href="/assets/index.html-b4337409.js" as="script"><link rel="prefetch" href="/assets/index.html-5aac597d.js" as="script"><link rel="prefetch" href="/assets/index.html-76d6ea93.js" as="script"><link rel="prefetch" href="/assets/index.html-e18f4f65.js" as="script"><link rel="prefetch" href="/assets/index.html-644eebf5.js" as="script"><link rel="prefetch" href="/assets/index.html-1d6c1649.js" as="script"><link rel="prefetch" href="/assets/index.html-9951b9f6.js" as="script"><link rel="prefetch" href="/assets/index.html-72a61392.js" as="script"><link rel="prefetch" href="/assets/index.html-5866170e.js" as="script"><link rel="prefetch" href="/assets/index.html-e9a7e2c1.js" as="script"><link rel="prefetch" href="/assets/index.html-d53bd539.js" as="script"><link rel="prefetch" href="/assets/index.html-a1ad137c.js" as="script"><link rel="prefetch" href="/assets/index.html-9820ca5c.js" as="script"><link rel="prefetch" href="/assets/index.html-5fbb46f5.js" as="script"><link rel="prefetch" href="/assets/index.html-ee8320a3.js" as="script"><link rel="prefetch" href="/assets/index.html-72c728d5.js" as="script"><link rel="prefetch" href="/assets/index.html-b9068540.js" as="script"><link rel="prefetch" href="/assets/index.html-0b3ed243.js" as="script"><link rel="prefetch" href="/assets/index.html-d34fcedf.js" as="script"><link rel="prefetch" href="/assets/index.html-bc23c6fe.js" as="script"><link rel="prefetch" href="/assets/index.html-4f6ef9fe.js" as="script"><link rel="prefetch" href="/assets/index.html-0ca60537.js" as="script"><link rel="prefetch" href="/assets/index.html-57a98e87.js" as="script"><link rel="prefetch" href="/assets/index.html-a25d2e5c.js" as="script"><link rel="prefetch" href="/assets/index.html-8fb62574.js" as="script"><link rel="prefetch" href="/assets/index.html-653530f0.js" as="script"><link rel="prefetch" href="/assets/index.html-c7ccd5a2.js" as="script"><link rel="prefetch" href="/assets/index.html-e6bad382.js" as="script"><link rel="prefetch" href="/assets/index.html-92d775ea.js" as="script"><link rel="prefetch" href="/assets/index.html-b3374bc9.js" as="script"><link rel="prefetch" href="/assets/index.html-04f02cbe.js" as="script"><link rel="prefetch" href="/assets/index.html-f0912e82.js" as="script"><link rel="prefetch" href="/assets/index.html-82c102ea.js" as="script"><link rel="prefetch" href="/assets/index.html-b83f8df8.js" as="script"><link rel="prefetch" href="/assets/index.html-467ea473.js" as="script"><link rel="prefetch" href="/assets/index.html-94c1a7a1.js" as="script"><link rel="prefetch" href="/assets/index.html-8dd82581.js" as="script"><link rel="prefetch" href="/assets/intro.html-88bbbba3.js" as="script"><link rel="prefetch" href="/assets/index.html-f6fd53c8.js" as="script"><link rel="prefetch" href="/assets/slides.html-b6ffd39e.js" as="script"><link rel="prefetch" href="/assets/disable.html-66a5c74b.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-3033137a.js" as="script"><link rel="prefetch" href="/assets/markdown.html-cb727f4d.js" as="script"><link rel="prefetch" href="/assets/page.html-8678032e.js" as="script"><link rel="prefetch" href="/assets/index.html-3499a5f6.js" as="script"><link rel="prefetch" href="/assets/intro.html-63d51bdd.js" as="script"><link rel="prefetch" href="/assets/index.html-5d64d0b2.js" as="script"><link rel="prefetch" href="/assets/slides.html-af8ef7ce.js" as="script"><link rel="prefetch" href="/assets/disable.html-5dcf458d.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-1aabfd29.js" as="script"><link rel="prefetch" href="/assets/markdown.html-b9914991.js" as="script"><link rel="prefetch" href="/assets/page.html-8e83bdc7.js" as="script"><link rel="prefetch" href="/assets/index.html-b594eaa5.js" as="script"><link rel="prefetch" href="/assets/disable.html-2277927a.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-0f82cb4a.js" as="script"><link rel="prefetch" href="/assets/markdown.html-5245eceb.js" as="script"><link rel="prefetch" href="/assets/page.html-1004e52f.js" as="script"><link rel="prefetch" href="/assets/index.html-b3c715af.js" as="script"><link rel="prefetch" href="/assets/index.html-dbf81064.js" as="script"><link rel="prefetch" href="/assets/mysql.html-c6a831a9.js" as="script"><link rel="prefetch" href="/assets/postgresql.html-ae4c86e1.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-c8cedc56.js" as="script"><link rel="prefetch" href="/assets/idwork.html-7d2f83b3.js" as="script"><link rel="prefetch" href="/assets/css.html-006c799c.js" as="script"><link rel="prefetch" href="/assets/html.html-1323cb24.js" as="script"><link rel="prefetch" href="/assets/js.html-aafa85cf.js" as="script"><link rel="prefetch" href="/assets/nginx.html-96968426.js" as="script"><link rel="prefetch" href="/assets/elaticsearch.html-67956eb2.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-8c8bc6fa.js" as="script"><link rel="prefetch" href="/assets/vue.html-a28e63e0.js" as="script"><link rel="prefetch" href="/assets/jvm.html-50e5372d.js" as="script"><link rel="prefetch" href="/assets/list.html-ae9043b4.js" as="script"><link rel="prefetch" href="/assets/map.html-3d18fdea.js" as="script"><link rel="prefetch" href="/assets/set.html-92d35319.js" as="script"><link rel="prefetch" href="/assets/juc.html-3033f723.js" as="script"><link rel="prefetch" href="/assets/thread.html-ca30083f.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-067666aa.js" as="script"><link rel="prefetch" href="/assets/spring.html-d835cc1f.js" as="script"><link rel="prefetch" href="/assets/springboot.html-c5be012c.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-59b25145.js" as="script"><link rel="prefetch" href="/assets/springcloud.html-8e6e289f.js" as="script"><link rel="prefetch" href="/assets/springcloudAlibaba.html-fe047c42.js" as="script"><link rel="prefetch" href="/assets/404.html-efcbdfb8.js" as="script"><link rel="prefetch" href="/assets/index.html-b9049faa.js" as="script"><link rel="prefetch" href="/assets/index.html-c3c2c32b.js" as="script"><link rel="prefetch" href="/assets/index.html-afb5bce3.js" as="script"><link rel="prefetch" href="/assets/index.html-5ec2fddd.js" as="script"><link rel="prefetch" href="/assets/index.html-da1eec3f.js" as="script"><link rel="prefetch" href="/assets/index.html-7b822086.js" as="script"><link rel="prefetch" href="/assets/index.html-ebf9fe5f.js" as="script"><link rel="prefetch" href="/assets/index.html-4f9a4b5f.js" as="script"><link rel="prefetch" href="/assets/index.html-9df0f0b3.js" as="script"><link rel="prefetch" href="/assets/index.html-c167fb4a.js" as="script"><link rel="prefetch" href="/assets/index.html-d7c67c90.js" as="script"><link rel="prefetch" href="/assets/index.html-178f0ee6.js" as="script"><link rel="prefetch" href="/assets/index.html-48e2a336.js" as="script"><link rel="prefetch" href="/assets/index.html-17eeb5a1.js" as="script"><link rel="prefetch" href="/assets/index.html-fbdff309.js" as="script"><link rel="prefetch" href="/assets/index.html-58b4f273.js" as="script"><link rel="prefetch" href="/assets/index.html-91822548.js" as="script"><link rel="prefetch" href="/assets/index.html-4d0f7e32.js" as="script"><link rel="prefetch" href="/assets/index.html-11b87b78.js" as="script"><link rel="prefetch" href="/assets/index.html-565f97fc.js" as="script"><link rel="prefetch" href="/assets/index.html-db9428bf.js" as="script"><link rel="prefetch" href="/assets/index.html-990bfc25.js" as="script"><link rel="prefetch" href="/assets/index.html-9de5fbad.js" as="script"><link rel="prefetch" href="/assets/index.html-7a26a869.js" as="script"><link rel="prefetch" href="/assets/index.html-b93c98f4.js" as="script"><link rel="prefetch" href="/assets/index.html-da90ef68.js" as="script"><link rel="prefetch" href="/assets/index.html-a3cf3b28.js" as="script"><link rel="prefetch" href="/assets/index.html-e82c4191.js" as="script"><link rel="prefetch" href="/assets/index.html-41c6d8bb.js" as="script"><link rel="prefetch" href="/assets/index.html-78efc0d0.js" as="script"><link rel="prefetch" href="/assets/index.html-074d1cea.js" as="script"><link rel="prefetch" href="/assets/index.html-298c38c9.js" as="script"><link rel="prefetch" href="/assets/index.html-f52000ab.js" as="script"><link rel="prefetch" href="/assets/index.html-ca4faf6e.js" as="script"><link rel="prefetch" href="/assets/index.html-065ae608.js" as="script"><link rel="prefetch" href="/assets/index.html-409f1932.js" as="script"><link rel="prefetch" href="/assets/index.html-616a6c28.js" as="script"><link rel="prefetch" href="/assets/index.html-7a0739b7.js" as="script"><link rel="prefetch" href="/assets/index.html-980af55e.js" as="script"><link rel="prefetch" href="/assets/index.html-c8e4cb15.js" as="script"><link rel="prefetch" href="/assets/index.html-c0990ba7.js" as="script"><link rel="prefetch" href="/assets/index.html-48db118f.js" as="script"><link rel="prefetch" href="/assets/index.html-85615883.js" as="script"><link rel="prefetch" href="/assets/index.html-edee18a6.js" as="script"><link rel="prefetch" href="/assets/index.html-b7547097.js" as="script"><link rel="prefetch" href="/assets/index.html-eefe09e4.js" as="script"><link rel="prefetch" href="/assets/index.html-166d26e5.js" as="script"><link rel="prefetch" href="/assets/index.html-177d03c9.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2ab13e.js" as="script"><link rel="prefetch" href="/assets/index.html-b87283e0.js" as="script"><link rel="prefetch" href="/assets/index.html-6ee8b06d.js" as="script"><link rel="prefetch" href="/assets/index.html-7702533e.js" as="script"><link rel="prefetch" href="/assets/index.html-d65d8d73.js" as="script"><link rel="prefetch" href="/assets/index.html-a8902bc2.js" as="script"><link rel="prefetch" href="/assets/index.html-64389379.js" as="script"><link rel="prefetch" href="/assets/index.html-144bdc4f.js" as="script"><link rel="prefetch" href="/assets/index.html-28893f80.js" as="script"><link rel="prefetch" href="/assets/index.html-5d3e9263.js" as="script"><link rel="prefetch" href="/assets/index.html-4c6d8a73.js" as="script"><link rel="prefetch" href="/assets/index.html-28bf1937.js" as="script"><link rel="prefetch" href="/assets/index.html-737b3cec.js" as="script"><link rel="prefetch" href="/assets/index.html-87fc4efd.js" as="script"><link rel="prefetch" href="/assets/index.html-e3aa9d99.js" as="script"><link rel="prefetch" href="/assets/index.html-fec46570.js" as="script"><link rel="prefetch" href="/assets/index.html-9f82e955.js" as="script"><link rel="prefetch" href="/assets/index.html-69f2b437.js" as="script"><link rel="prefetch" href="/assets/index.html-f69eb88c.js" as="script"><link rel="prefetch" href="/assets/index.html-9a262995.js" as="script"><link rel="prefetch" href="/assets/index.html-1ee7a748.js" as="script"><link rel="prefetch" href="/assets/index.html-c20b48b5.js" as="script"><link rel="prefetch" href="/assets/index.html-5551fcaa.js" as="script"><link rel="prefetch" href="/assets/index.html-74822ef3.js" as="script"><link rel="prefetch" href="/assets/index.html-068b0923.js" as="script"><link rel="prefetch" href="/assets/index.html-fba460db.js" as="script"><link rel="prefetch" href="/assets/index.html-e12d1d6e.js" as="script"><link rel="prefetch" href="/assets/index.html-51ef4f9f.js" as="script"><link rel="prefetch" href="/assets/index.html-27aa4c3a.js" as="script"><link rel="prefetch" href="/assets/index.html-7c752282.js" as="script"><link rel="prefetch" href="/assets/index.html-6ff47688.js" as="script"><link rel="prefetch" href="/assets/index.html-a36273be.js" as="script"><link rel="prefetch" href="/assets/index.html-b2a58a8d.js" as="script"><link rel="prefetch" href="/assets/index.html-2cfeeffe.js" as="script"><link rel="prefetch" href="/assets/index.html-e3b7b7c5.js" as="script"><link rel="prefetch" href="/assets/index.html-8447273f.js" as="script"><link rel="prefetch" href="/assets/index.html-025251c7.js" as="script"><link rel="prefetch" href="/assets/index.html-890a76e8.js" as="script"><link rel="prefetch" href="/assets/index.html-8128a73c.js" as="script"><link rel="prefetch" href="/assets/index.html-d80f1d2d.js" as="script"><link rel="prefetch" href="/assets/index.html-cd3cd59c.js" as="script"><link rel="prefetch" href="/assets/index.html-2ad7ffac.js" as="script"><link rel="prefetch" href="/assets/index.html-07adeb48.js" as="script"><link rel="prefetch" href="/assets/index.html-8c0771f4.js" as="script"><link rel="prefetch" href="/assets/index.html-89bfd3d4.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0d7594.js" as="script"><link rel="prefetch" href="/assets/giscus-16d370b8.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-8764208e.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-e2c044c8.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-a7c60b9a.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-6e6cbe40.js" as="script"><link rel="prefetch" href="/assets/SearchResult-29fc22a9.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="IIIDelayçš„ Blog"><!----><span class="site-name hide-in-pad">IIIDelayçš„ Blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Blog Home"><span class="font-icon icon iconfont icon-home" style=""></span>Blog Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="Demo"><span class="font-icon icon iconfont icon-discover" style=""></span>Demo<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="JavaBase"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaBase</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é›†åˆ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javabase/collection/list.html" class="nav-link" aria-label="List"><span class="font-icon icon iconfont icon-edit" style=""></span>List<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/collection/set.html" class="nav-link" aria-label="Set"><span class="font-icon icon iconfont icon-edit" style=""></span>Set<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/collection/map.html" class="nav-link" aria-label="Map"><span class="font-icon icon iconfont icon-edit" style=""></span>Map<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¹¶å‘ç¼–ç¨‹</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javabase/juc/thread.html" class="nav-link" aria-label="Thread"><span class="font-icon icon iconfont icon-edit" style=""></span>Thread<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/juc/juc.html" class="nav-link" aria-label="JUC"><span class="font-icon icon iconfont icon-edit" style=""></span>JUC<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>è¿›é˜¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javabase/advance/jvm.html" class="nav-link" aria-label="JVM"><span class="font-icon icon iconfont icon-edit" style=""></span>JVM<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>dbms</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/database/dbms/mysql.html" class="nav-link" aria-label="Mysql"><span class="font-icon icon iconfont icon-edit" style=""></span>Mysql<!----></a></li><li class="dropdown-subitem"><a href="/en/database/dbms/postgresql.html" class="nav-link" aria-label="Postgresql"><span class="font-icon icon iconfont icon-edit" style=""></span>Postgresql<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSql</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/database/nosql/mongodb.html" class="nav-link" aria-label="MongoDB"><span class="font-icon icon iconfont icon-edit" style=""></span>MongoDB<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Cache</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-current="page" href="/en/distributed/cache/redis.html" class="router-link-active router-link-exact-active nav-link active" aria-label="Redis"><span class="font-icon icon iconfont icon-edit" style=""></span>Redis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Load-Balance</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/loadbalance/nginx.html" class="nav-link" aria-label="Nginx"><span class="font-icon icon iconfont icon-edit" style=""></span>Nginx<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>MQS</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/mqs/rocketmq.html" class="nav-link" aria-label="RocketMQ"><span class="font-icon icon iconfont icon-edit" style=""></span>RocketMQ<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Common</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/common/idwork.html" class="nav-link" aria-label="åˆ†å¸ƒå¼ID"><span class="font-icon icon iconfont icon-edit" style=""></span>åˆ†å¸ƒå¼ID<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="JavaEE"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaEE</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring-Framework</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javaee/spring_framework/spring.html" class="nav-link" aria-label="Spring"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring<!----></a></li><li class="dropdown-subitem"><a href="/en/javaee/spring_framework/springmvc.html" class="nav-link" aria-label="SpringMVC"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringMVC<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javaee/orm/mybatis.html" class="nav-link" aria-label="Mybatis"><span class="font-icon icon iconfont icon-edit" style=""></span>Mybatis<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¾®æœåŠ¡"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>å¾®æœåŠ¡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springå¾®æœåŠ¡ä½“ç³»</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/mricoservices/springio/springcloud.html" class="nav-link" aria-label="Spring-Cloud"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring-Cloud<!----></a></li><li class="dropdown-subitem"><a href="/en/mricoservices/springio/springcloudAlibaba.html" class="nav-link" aria-label="Spring-Cloud Alibaba"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring-Cloud Alibaba<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¤§å‰ç«¯"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>å¤§å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Base</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/h5/base/html.html" class="nav-link" aria-label="HTML"><span class="font-icon icon iconfont icon-edit" style=""></span>HTML<!----></a></li><li class="dropdown-subitem"><a href="/en/h5/base/css.html" class="nav-link" aria-label="CSS"><span class="font-icon icon iconfont icon-edit" style=""></span>CSS<!----></a></li><li class="dropdown-subitem"><a href="/en/h5/base/js.html" class="nav-link" aria-label="JavaScript"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaScript<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Framework</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/h5/framework/vue.html" class="nav-link" aria-label="VUE"><span class="font-icon icon iconfont icon-edit" style=""></span>VUE<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://github.com/" rel="noopener noreferrer" target="_blank" aria-label="å®˜ç½‘" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button class="dropdown-title" type="button" aria-label="Select language"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-current="page" href="/en/distributed/cache/redis.html" class="router-link-active router-link-exact-active nav-link active" aria-label="English"><!---->English<!----></a></li><li class="dropdown-item"><a href="/zh/" class="nav-link" aria-label="ç®€ä½“ä¸­æ–‡"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li></ul></button></div></div><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">Search</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="Blog Home"><span class="font-icon icon iconfont icon-home" style=""></span>Blog Home<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-discover" style=""></span><a href="/demo/" class="title">Demo</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/demo/page.html" class="nav-link sidebar-link sidebar-page" aria-label="Page Config"><span class="font-icon icon iconfont icon-page" style=""></span>Page Config<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/markdown.html" class="nav-link sidebar-link sidebar-page" aria-label="Markdown Enhance"><span class="font-icon icon iconfont icon-markdown" style=""></span>Markdown Enhance<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/disable.html" class="nav-link sidebar-link sidebar-page" aria-label="Disabling layout and features"><span class="font-icon icon iconfont icon-config" style=""></span>Disabling layout and features<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/encrypt.html" class="nav-link sidebar-link sidebar-page" aria-label="Encryption Article"><span class="font-icon icon iconfont icon-lock" style=""></span>Encryption Article<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Articles</span><!----></p><ul class="sidebar-links"></ul></section></li><li><!--[--><a href="/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="Intro Page"><span class="font-icon icon iconfont icon-info" style=""></span>Intro Page<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/slides.html" class="nav-link sidebar-link sidebar-page" aria-label="Slide page"><span class="font-icon icon iconfont icon-slides" style=""></span>Slide page<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon iconfont icon-edit" style=""></span>Redisé¢è¯•é¢˜</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mrhope.site" target="_blank" rel="noopener noreferrer">Mr.IIIDelay</a></span><span property="author" content="Mr.IIIDelay"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 99 min</span><meta property="timeRequired" content="PT99M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category5 clickable" role="navigation">Cache</span><span class="page-category-item category7 clickable" role="navigation">NoSQL</span><meta property="articleSection" content="Cache,NoSQL"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag8 clickable" role="navigation">yellow</span><span class="page-tag-item tag8 clickable" role="navigation">curly</span><span class="page-tag-item tag4 clickable" role="navigation">long</span><meta property="keywords" content="yellow,curly,long"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<button class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_1-ä»€ä¹ˆæ˜¯redis" class="router-link-active router-link-exact-active toc-link level2">1. ä»€ä¹ˆæ˜¯redisï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_2-åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹" class="router-link-active router-link-exact-active toc-link level2">2. åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_2-1-ç¼“å­˜ç±»å‹" class="router-link-active router-link-exact-active toc-link level3">2.1 ç¼“å­˜ç±»å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_2-1-redis-å’Œ-memcached-çš„åŒºåˆ«å’Œå…±åŒç‚¹" class="router-link-active router-link-exact-active toc-link level3">2.1 Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_3-redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" class="router-link-active router-link-exact-active toc-link level2">3. Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_4-ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" class="router-link-active router-link-exact-active toc-link level2">4. ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_5-å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§" class="router-link-active router-link-exact-active toc-link level2">5. å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ–¹æ¡ˆä¸€-å»¶æ—¶åŒåˆ " class="router-link-active router-link-exact-active toc-link level3">æ–¹æ¡ˆä¸€ï¼šå»¶æ—¶åŒåˆ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ–¹æ¡ˆäºŒ-å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level3">æ–¹æ¡ˆäºŒï¼šå¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_6-redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯" class="router-link-active router-link-exact-active toc-link level2">6.Redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#string" class="router-link-active router-link-exact-active toc-link level3">String</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#list" class="router-link-active router-link-exact-active toc-link level3">List</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#hash" class="router-link-active router-link-exact-active toc-link level3">Hash</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#set" class="router-link-active router-link-exact-active toc-link level3">Set</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#sorted-set" class="router-link-active router-link-exact-active toc-link level3">Sorted Set</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#bitmap" class="router-link-active router-link-exact-active toc-link level3">bitmap</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-redisæŒä¹…åŒ–æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level2">7. RedisæŒä¹…åŒ–æœºåˆ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-1-ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–" class="router-link-active router-link-exact-active toc-link level3">7.1 ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-2-å¿«ç…§æŒä¹…åŒ–-snapshotting-rdb" class="router-link-active router-link-exact-active toc-link level3">7.2 å¿«ç…§æŒä¹…åŒ–(snapshottingï¼ŒRDB)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-3-åªè¿½åŠ æ–‡ä»¶æŒä¹…åŒ–-append-only-file-aof" class="router-link-active router-link-exact-active toc-link level3">7.3 åªè¿½åŠ æ–‡ä»¶æŒä¹…åŒ–(append-only file, AOF)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-4-rdbæŒä¹…åŒ–ã€aofæŒä¹…åŒ–çš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">7.4 RDBæŒä¹…åŒ–ã€AOFæŒä¹…åŒ–çš„åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-5-redisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹" class="router-link-active router-link-exact-active toc-link level3">7.5 RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-6-rdbå’Œaofå¦‚ä½•é€‰æ‹©" class="router-link-active router-link-exact-active toc-link level3">7.6 RDBå’ŒAOFå¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_8-redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level2">8. Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_9-redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" class="router-link-active router-link-exact-active toc-link level2">9. Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_10-redis-keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®" class="router-link-active router-link-exact-active toc-link level2">10. Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_11-å¦‚ä½•è¿›è¡Œrediså†…å­˜ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level2">11. å¦‚ä½•è¿›è¡ŒRediså†…å­˜ä¼˜åŒ–ï¼Ÿ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_1-keyä¸valueçš„ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">(1)keyä¸valueçš„ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_2-å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">(2)å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_3-ç¼–ç ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">(3)ç¼–ç ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_4-ä½¿ç”¨-lazy-free-ç‰¹æ€§" class="router-link-active router-link-exact-active toc-link level3">(4)ä½¿ç”¨ lazy free ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_5-è®¾ç½®åˆç†çš„é”®å€¼è¿‡æœŸæ—¶é—´" class="router-link-active router-link-exact-active toc-link level3">(5)è®¾ç½®åˆç†çš„é”®å€¼è¿‡æœŸæ—¶é—´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_6-ç¦ç”¨é•¿è€—æ—¶çš„æŸ¥è¯¢å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">(6)ç¦ç”¨é•¿è€—æ—¶çš„æŸ¥è¯¢å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_7-ä½¿ç”¨-slowlog-ä¼˜åŒ–è€—æ—¶å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">(7)ä½¿ç”¨ slowlog ä¼˜åŒ–è€—æ—¶å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_8-ä½¿ç”¨-pipeline-æ‰¹é‡æ“ä½œæ•°æ®" class="router-link-active router-link-exact-active toc-link level3">(8)ä½¿ç”¨ Pipeline æ‰¹é‡æ“ä½œæ•°æ®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_9-é¿å…å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ" class="router-link-active router-link-exact-active toc-link level3">(9)é¿å…å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_10-redis-è¿æ¥æ± " class="router-link-active router-link-exact-active toc-link level3">(10)Redis è¿æ¥æ± </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_11-é™åˆ¶-redis-å†…å­˜å¤§å°-ä½¿ç”¨åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">(11)é™åˆ¶ Redis å†…å­˜å¤§å°ï¼Œä½¿ç”¨åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-ä½¿ç”¨ç‰©ç†æœºè€Œéè™šæ‹Ÿæœº" class="router-link-active router-link-exact-active toc-link level3">(12)ä½¿ç”¨ç‰©ç†æœºè€Œéè™šæ‹Ÿæœº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_13-ä½¿ç”¨åˆç†çš„æŒä¹…åŒ–ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">(13)ä½¿ç”¨åˆç†çš„æŒä¹…åŒ–ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_14-ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„æ¥å¢åŠ è¯»å†™é€Ÿåº¦" class="router-link-active router-link-exact-active toc-link level3">(14)ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„æ¥å¢åŠ è¯»å†™é€Ÿåº¦</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-redisçº¿ç¨‹æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level2">12. Redisçº¿ç¨‹æ¨¡å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-1-çº¿ç¨‹æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level3">12.1 çº¿ç¨‹æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-2-redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="router-link-active router-link-exact-active toc-link level3">12.2 Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-3-redisçš„éé˜»å¡ioå¤šè·¯å¤ç”¨æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level3">12.3 Redisçš„éé˜»å¡IOå¤šè·¯å¤ç”¨æ¨¡å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-4-redis6-0-ä¹‹å‰-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹" class="router-link-active router-link-exact-active toc-link level3">12.4 Redis6.0 ä¹‹å‰ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_12-5-redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" class="router-link-active router-link-exact-active toc-link level3">12.5 Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_13-redisäº‹åŠ¡" class="router-link-active router-link-exact-active toc-link level2">13. Redisäº‹åŠ¡</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_13-1-å®ç°åŸç†" class="router-link-active router-link-exact-active toc-link level3">13.1 å®ç°åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_13-2-äº‹åŠ¡çš„å››å¤§ç‰¹æ€§" class="router-link-active router-link-exact-active toc-link level3">13.2 äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_14-3-redis-æ˜¯ä¸æ”¯æŒ-roll-back-çš„åŸå› " class="router-link-active router-link-exact-active toc-link level3">14.3 Redis æ˜¯ä¸æ”¯æŒ roll back çš„åŸå› </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_14-4-äº‹åŠ¡å¤±è´¥å¤„ç†-æ˜¯å¦ä¿è¯åŸå­æ€§" class="router-link-active router-link-exact-active toc-link level3">14.4 äº‹åŠ¡å¤±è´¥å¤„ç†(æ˜¯å¦ä¿è¯åŸå­æ€§)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-redisç¼“å­˜å¼‚å¸¸" class="router-link-active router-link-exact-active toc-link level2">15. Redisç¼“å­˜å¼‚å¸¸</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-1-ç¼“å­˜çƒ­ç‚¹key" class="router-link-active router-link-exact-active toc-link level3">15.1 ç¼“å­˜çƒ­ç‚¹key</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-2-ç¼“å­˜é›ªå´©" class="router-link-active router-link-exact-active toc-link level3">15.2 ç¼“å­˜é›ªå´©</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-3-ç¼“å­˜ç©¿é€" class="router-link-active router-link-exact-active toc-link level3">15.3 ç¼“å­˜ç©¿é€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-4-ç¼“å­˜å‡»ç©¿" class="router-link-active router-link-exact-active toc-link level3">15.4 ç¼“å­˜å‡»ç©¿</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-5-ç¼“å­˜é¢„çƒ­" class="router-link-active router-link-exact-active toc-link level3">15.5 ç¼“å­˜é¢„çƒ­</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_15-6-ç¼“å­˜é™çº§" class="router-link-active router-link-exact-active toc-link level3">15.6 ç¼“å­˜é™çº§</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_16-åˆ†å¸ƒå¼é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">16 åˆ†å¸ƒå¼é—®é¢˜</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_16-1-rediså®ç°åˆ†å¸ƒå¼é”" class="router-link-active router-link-exact-active toc-link level3">16.1 Rediså®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_16-2-å¦‚ä½•è§£å†³-redis-çš„å¹¶å‘ç«äº‰-key-é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">16.2 å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_16-3-åˆ†å¸ƒå¼redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½-ä¸ºä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">16.3 åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_16-4-ä»€ä¹ˆæ˜¯-redlock" class="router-link-active router-link-exact-active toc-link level3">16.4 ä»€ä¹ˆæ˜¯ RedLockï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_17-é›†ç¾¤æ–¹æ¡ˆ" class="router-link-active router-link-exact-active toc-link level2">17 é›†ç¾¤æ–¹æ¡ˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_17-1-redisä¸»ä»å¤åˆ¶" class="router-link-active router-link-exact-active toc-link level3">17.1 Redisä¸»ä»å¤åˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_17-2-å“¨å…µ-sentinal-æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level3">17.2 å“¨å…µ(sentinal)æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#_17-3-redis-cluster-æ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">17.3 Redis cluster æ¨¡å¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#å‚è€ƒ" class="router-link-active router-link-exact-active toc-link level2">å‚è€ƒï¼š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#string-1" class="router-link-active router-link-exact-active toc-link level2">String</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ•°æ®ç»“æ„" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#ç¼–ç æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">ç¼–ç æ–¹å¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#list-1" class="router-link-active router-link-exact-active toc-link level2">List</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-1" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ•°æ®ç»“æ„-1" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#hash-1" class="router-link-active router-link-exact-active toc-link level2">Hash</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-2" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ•°æ®ç»“æ„-2" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#dict" class="router-link-active router-link-exact-active toc-link level3">Dict</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#set-1" class="router-link-active router-link-exact-active toc-link level2">Set</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-3" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ•°æ®ç»“æ„-3" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®ç»“æ„</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#zset" class="router-link-active router-link-exact-active toc-link level2">ZSet</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-4" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#æ•°æ®ç»“æ„-4" class="router-link-active router-link-exact-active toc-link level3">æ•°æ®ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#è·³è·ƒè¡¨" class="router-link-active router-link-exact-active toc-link level3">è·³è·ƒè¡¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#bitmaps" class="router-link-active router-link-exact-active toc-link level2">Bitmaps</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-5" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#ç›¸å…³å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">ç›¸å…³å‘½ä»¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#bitmapsä¸setå¯¹æ¯”" class="router-link-active router-link-exact-active toc-link level3">Bitmapsä¸setå¯¹æ¯”</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#hyperloglog" class="router-link-active router-link-exact-active toc-link level2">HyperLogLog</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-6" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#ç›¸å…³å‘½ä»¤-1" class="router-link-active router-link-exact-active toc-link level3">ç›¸å…³å‘½ä»¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#geospatial" class="router-link-active router-link-exact-active toc-link level2">Geospatial</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#åŸºæœ¬ä»‹ç»-7" class="router-link-active router-link-exact-active toc-link level3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#ç›¸å…³å‘½ä»¤-2" class="router-link-active router-link-exact-active toc-link level3">ç›¸å…³å‘½ä»¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/distributed/cache/redis.html#å‚çœ‹" class="router-link-active router-link-exact-active toc-link level2">å‚çœ‹ï¼š</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="redisé¢è¯•é¢˜" tabindex="-1"><a class="header-anchor" href="#redisé¢è¯•é¢˜" aria-hidden="true">#</a> Redisé¢è¯•é¢˜</h1><p>rediså¸¸è§é¢è¯•é¢˜ï¼š<a href="https://zhuanlan.zhihu.com/p/354314607" target="_blank" rel="noopener noreferrer">åƒé€è¿™ä»½Rediså­¦ä¹ ç¬”è®°ï¼Œç›´æ¥æŠŠé˜¿é‡Œé¢è¯•å®˜æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_1-ä»€ä¹ˆæ˜¯redis" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯redis" aria-hidden="true">#</a> 1. ä»€ä¹ˆæ˜¯redisï¼Ÿ</h2><p><strong>Redis (Remote Dictionary Server)å°±æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å¼€å‘çš„æ•°æ®åº“</strong>ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“ä¸åŒçš„æ˜¯ <strong>Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„</strong> ï¼Œä¹Ÿå°±æ˜¯å®ƒæ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤ Redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜æ–¹å‘ã€‚</p><p><strong>Redis é™¤äº†åšç¼“å­˜ä¹‹å¤–ï¼ŒRedis ä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ï¼Œç”šè‡³æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚</strong></p><p><strong>Redis æä¾›äº†å¤šç§æ•°æ®ç±»å‹æ¥æ”¯æŒä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚Redis è¿˜æ”¯æŒäº‹åŠ¡ ã€æŒä¹…åŒ–ã€Lua è„šæœ¬ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</strong></p><h2 id="_2-åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹" tabindex="-1"><a class="header-anchor" href="#_2-åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹" aria-hidden="true">#</a> 2. åˆ†å¸ƒå¼ç¼“å­˜å¸¸è§çš„æŠ€æœ¯é€‰å‹</h2><h3 id="_2-1-ç¼“å­˜ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_2-1-ç¼“å­˜ç±»å‹" aria-hidden="true">#</a> 2.1 ç¼“å­˜ç±»å‹</h3><p>æœ¬åœ°ç¼“å­˜æ˜¯å†…å­˜è®¿é—®ï¼Œæ²¡æœ‰è¿œç¨‹äº¤äº’å¼€é”€ï¼Œæ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯å—é™äºå•æœºå®¹é‡ï¼Œä¸€èˆ¬ç¼“å­˜è¾ƒå°ä¸”æ— æ³•æ‰©å±•ã€‚</p><p>åˆ†å¸ƒå¼ç¼“å­˜ä¸€èˆ¬éƒ½å…·æœ‰è‰¯å¥½çš„æ°´å¹³æ‰©å±•èƒ½åŠ›ï¼Œå¯¹è¾ƒå¤§æ•°æ®é‡çš„åœºæ™¯ä¹Ÿèƒ½åº”ä»˜è‡ªå¦‚ã€‚ç¼ºç‚¹å°±æ˜¯éœ€è¦è¿›è¡Œè¿œç¨‹è¯·æ±‚ï¼Œæ€§èƒ½ä¸å¦‚æœ¬åœ°ç¼“å­˜ã€‚</p><p>åˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦è§£å†³çš„æ˜¯å•æœºç¼“å­˜çš„å®¹é‡å—æœåŠ¡å™¨é™åˆ¶å¹¶ä¸”æ— æ³•ä¿å­˜é€šç”¨çš„ä¿¡æ¯ã€‚å› ä¸ºï¼Œæœ¬åœ°ç¼“å­˜åªåœ¨å½“å‰æœåŠ¡é‡Œæœ‰æ•ˆï¼Œæ¯”å¦‚å¦‚æœä½ éƒ¨ç½²äº†ä¸¤ä¸ªç›¸åŒçš„æœåŠ¡ï¼Œä»–ä»¬ä¸¤è€…ä¹‹é—´çš„ç¼“å­˜æ•°æ®æ˜¯æ— æ³•å…±åŒçš„ã€‚</p><p>Memcached æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æœ€å¼€å§‹å…´èµ·çš„é‚£ä¼šï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ã€‚åæ¥ï¼Œéšç€ Redis çš„å‘å±•ï¼Œå¤§å®¶æ…¢æ…¢éƒ½è½¬è€Œä½¿ç”¨æ›´åŠ å¼ºå¤§çš„ Redis äº†ã€‚</p><p>ä¸ºäº†å¹³è¡¡è¿™ç§æƒ…å†µï¼Œå®é™…ä¸šåŠ¡ä¸­ä¸€èˆ¬é‡‡ç”¨<strong>å¤šçº§ç¼“å­˜</strong>ï¼Œæœ¬åœ°ç¼“å­˜åªä¿å­˜è®¿é—®é¢‘ç‡æœ€é«˜çš„éƒ¨åˆ†çƒ­ç‚¹æ•°æ®ï¼Œå…¶ä»–çš„çƒ­ç‚¹æ•°æ®æ”¾åœ¨åˆ†å¸ƒå¼ç¼“å­˜ä¸­ã€‚</p><h3 id="_2-1-redis-å’Œ-memcached-çš„åŒºåˆ«å’Œå…±åŒç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-redis-å’Œ-memcached-çš„åŒºåˆ«å’Œå…±åŒç‚¹" aria-hidden="true">#</a> 2.1 Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹</h3><p><strong>å…±åŒç‚¹</strong> ï¼š</p><ol><li>éƒ½æ˜¯åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½ç”¨æ¥å½“åšç¼“å­˜ä½¿ç”¨ã€‚</li><li>éƒ½æœ‰è¿‡æœŸç­–ç•¥ã€‚</li><li>ä¸¤è€…çš„æ€§èƒ½éƒ½éå¸¸é«˜ã€‚</li></ol><p><strong>åŒºåˆ«</strong> ï¼š</p><ol><li><strong>Redis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹(æ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯)</strong>ã€‚Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ k/v ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚Memcached åªæ”¯æŒæœ€ç®€å•çš„ k/v æ•°æ®ç±»å‹ã€‚</li><li><strong>Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€Œ Memecache æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚</strong></li><li><strong>Redis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ã€‚</strong> å› ä¸ºå¯ä»¥æŠŠç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</li><li><strong>Redis åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå¯ä»¥å°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯ï¼ŒMemcached åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°±ä¼šç›´æ¥æŠ¥å¼‚å¸¸ã€‚</strong></li><li><strong>Memcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯ Redis ç›®å‰æ˜¯åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼çš„.</strong></li><li><strong>Memcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redis ä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚</strong> (Redis 6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ IO )</li><li><strong>Redis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼ŒRedis æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚</strong></li><li><strong>Memcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ï¼Œè€Œ Redis åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ã€‚</strong></li></ol><p>ç›¸ä¿¡çœ‹äº†ä¸Šé¢çš„å¯¹æ¯”ä¹‹åï¼Œæˆ‘ä»¬å·²ç»æ²¡æœ‰ä»€ä¹ˆç†ç”±å¯ä»¥é€‰æ‹©ä½¿ç”¨ Memcached æ¥ä½œä¸ºè‡ªå·±é¡¹ç›®çš„åˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚</p><h2 id="_3-redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_3-redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> 3. Redisæœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ</h2><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ€§èƒ½æé«˜ â€“ Redis èƒ½è¯»çš„é€Ÿåº¦æ˜¯ 110000 æ¬¡/s,å†™çš„é€Ÿåº¦æ˜¯ 81000 æ¬¡/s ã€‚</li><li>ä¸°å¯Œçš„æ•°æ®ç±»å‹</li><li>åŸå­ â€“ Redis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸæ‰§è¡Œè¦ä¹ˆå¤±è´¥å®Œå…¨ä¸æ‰§è¡Œã€‚(å¤šæ“ä½œä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§)</li><li>ä¸°å¯Œçš„ç‰¹æ€§ â€“ Redis è¿˜æ”¯æŒ publish/subscribe, é€šçŸ¥, key è¿‡æœŸç­‰ç­‰ç‰¹æ€§ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶,ä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ã€‚å› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</li></ul><h2 id="_4-ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_4-ä¸ºä»€ä¹ˆè¦ç”¨-redis-ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜" aria-hidden="true">#</a> 4. ä¸ºä»€ä¹ˆè¦ç”¨ Redis /ä¸ºä»€ä¹ˆè¦ç”¨ç¼“å­˜ï¼Ÿ</h2><p>ä»é«˜æ€§èƒ½å’Œé«˜å¹¶å‘çš„è§’åº¦å»æ€è€ƒã€‚</p><p><strong>é«˜æ€§èƒ½</strong>ï¼š</p><p>ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“ä¸­çš„é«˜é¢‘æ•°æ®æ¯”è¾ƒæ…¢(ç¡¬ç›˜è¯»å–)ï¼Œå¦‚æœå°†<strong>ç”¨æˆ·é«˜é¢‘è®¿é—®è€Œä¸”ä¸ç»å¸¸æ”¹å˜çš„æ•°æ®</strong>æ”¾åˆ°redisï¼Œç”¨æˆ·ä¸‹æ¬¡è®¿é—®ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–(è¯»å–å†…å­˜)ï¼Œå¤§å¤§æé«˜è®¿é—®é€Ÿåº¦ã€‚</p><p>æ³¨ï¼šä½†æ˜¯è¦æ³¨æ„æ•°æ®åº“ä¸ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p><strong>é«˜å¹¶å‘</strong>ï¼š</p><p>ä¸€èˆ¬åƒ MySQL è¿™ç±»çš„æ•°æ®åº“çš„ QPS å¤§æ¦‚éƒ½åœ¨ 1w å·¦å³(4 æ ¸ 8g) ï¼Œä½†æ˜¯ä½¿ç”¨ Redis ç¼“å­˜ä¹‹åå¾ˆå®¹æ˜“è¾¾åˆ° 10w+ï¼Œç”šè‡³æœ€é«˜èƒ½è¾¾åˆ° 30w+(å°±å•æœº redis çš„æƒ…å†µï¼Œredis é›†ç¾¤çš„è¯ä¼šæ›´é«˜)</p><blockquote><p>QPS(Query Per Second)ï¼šæœåŠ¡å™¨æ¯ç§’å¯ä»¥æ‰§è¡Œçš„æŸ¥è¯¢æ¬¡æ•°</p></blockquote><p>é«˜é¢‘è®¿é—®æ•°æ®è½¬ç§»åˆ°ç¼“å­˜å¯ä»¥å¤§å¤§æå‡ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚</p><h2 id="_5-å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#_5-å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§" aria-hidden="true">#</a> 5. å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</h2><figure><img src="/assets/202112021507099-d8b95cb2.jpg" alt="mysqlå’Œredisçš„æ•°æ®ä¸€è‡´æ€§" tabindex="0" loading="lazy"><figcaption>mysqlå’Œredisçš„æ•°æ®ä¸€è‡´æ€§</figcaption></figure><p><strong>ç¼“å­˜ä¸æ•°æ®åº“åŒå†™æ—¶æ•°æ®ä¸ä¸€è‡´</strong>çš„é—®é¢˜ã€‚ä¸ç®¡æ˜¯å…ˆå†™æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼›è¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å†™åº“ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœåˆ é™¤äº†ç¼“å­˜Redisï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠå†™åº“MySQLï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±æ¥è¯»å–ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼Œåˆ™å»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†™å…¥ç¼“å­˜ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­ä¸ºè„æ•°æ®ã€‚</li><li>å¦‚æœå…ˆå†™äº†åº“ï¼Œåœ¨åˆ é™¤ç¼“å­˜å‰ï¼Œå†™åº“çš„çº¿ç¨‹å®•æœºäº†ï¼Œæ²¡æœ‰åˆ é™¤æ‰ç¼“å­˜ï¼Œåˆ™ä¹Ÿä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</li></ol><p>å› ä¸ºå†™å’Œè¯»æ˜¯å¹¶å‘çš„ï¼Œæ²¡æ³•ä¿è¯é¡ºåº,å°±ä¼šå‡ºç°ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å¦‚ä½•è§£å†³ï¼Ÿ</p><h3 id="æ–¹æ¡ˆä¸€-å»¶æ—¶åŒåˆ " tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆä¸€-å»¶æ—¶åŒåˆ " aria-hidden="true">#</a> æ–¹æ¡ˆä¸€ï¼šå»¶æ—¶åŒåˆ </h3><p>åœ¨å†™åº“å‰åéƒ½è¿›è¡Œ<code>redis.del(key)</code>æ“ä½œï¼Œå¹¶ä¸”è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚</p><ul><li>ä¼ªä»£ç å¦‚ä¸‹ï¼š</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    redis<span class="token punctuation">.</span><span class="token function">delKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">updateData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    redis<span class="token punctuation">.</span><span class="token function">delKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å…·ä½“çš„æ­¥éª¤å°±æ˜¯ï¼š</strong></p><p>1)å…ˆåˆ é™¤ç¼“å­˜</p><p>2)å†å†™æ•°æ®åº“</p><p>3)ä¼‘çœ 500æ¯«ç§’</p><p>4)å†æ¬¡åˆ é™¤ç¼“å­˜ <strong>é‚£ä¹ˆï¼Œè¿™ä¸ª500æ¯«ç§’æ€ä¹ˆç¡®å®šçš„ï¼Œå…·ä½“è¯¥ä¼‘çœ å¤šä¹…å‘¢ï¼Ÿ</strong></p><p>éœ€è¦è¯„ä¼°è‡ªå·±çš„é¡¹ç›®çš„è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶ã€‚è¿™ä¹ˆåšçš„ç›®çš„ï¼Œå°±æ˜¯ç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ã€‚</p><p>å½“ç„¶è¿™ç§ç­–ç•¥è¿˜è¦è€ƒè™‘rediså’Œæ•°æ®åº“ä¸»ä»åŒæ­¥çš„è€—æ—¶ã€‚æœ€åçš„çš„å†™æ•°æ®çš„ä¼‘çœ æ—¶é—´ï¼šåˆ™åœ¨è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶åŸºç¡€ä¸Šï¼ŒåŠ å‡ ç™¾mså³å¯ã€‚æ¯”å¦‚ï¼šä¼‘çœ 1ç§’ã€‚</p><p><strong>è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´</strong></p><p>ä»ç†è®ºä¸Šæ¥è¯´ï¼Œç»™ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚æ‰€æœ‰çš„å†™æ“ä½œä»¥æ•°æ®åº“ä¸ºå‡†ï¼Œåªè¦åˆ°è¾¾ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œåˆ™åé¢çš„è¯»è¯·æ±‚è‡ªç„¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æ–°å€¼ç„¶åå›å¡«ç¼“å­˜ã€‚</p><p><strong>è¯¥æ–¹æ¡ˆçš„å¼Šç«¯</strong></p><p>ç»“åˆåŒåˆ ç­–ç•¥+ç¼“å­˜è¶…æ—¶è®¾ç½®ï¼Œè¿™æ ·æœ€å·®çš„æƒ…å†µå°±æ˜¯åœ¨è¶…æ—¶æ—¶é—´å†…æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ï¼Œè€Œä¸”åˆå¢åŠ äº†å†™è¯·æ±‚çš„è€—æ—¶ã€‚</p><h3 id="æ–¹æ¡ˆäºŒ-å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆäºŒ-å¼‚æ­¥æ›´æ–°ç¼“å­˜-åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶" aria-hidden="true">#</a> æ–¹æ¡ˆäºŒï¼š<strong>å¼‚æ­¥æ›´æ–°ç¼“å­˜(åŸºäºè®¢é˜…binlogçš„åŒæ­¥æœºåˆ¶)</strong></h3><p><strong>æ•´ä½“æ€è·¯ï¼š</strong></p><p>MySQL binlogå¢é‡è®¢é˜…æ¶ˆè´¹+æ¶ˆæ¯é˜Ÿåˆ—+å¢é‡æ•°æ®æ›´æ–°åˆ°redis</p><p><strong>1)è¯»Redis</strong>ï¼šçƒ­æ•°æ®åŸºæœ¬éƒ½åœ¨Redis</p><p><strong>2)å†™MySQL</strong>:å¢åˆ æ”¹éƒ½æ˜¯æ“ä½œMySQL</p><p><strong>3)æ›´æ–°Redisæ•°æ®</strong>ï¼šMySQçš„æ•°æ®æ“ä½œbinlogï¼Œæ¥æ›´æ–°åˆ°Redis</p><p><strong>Redisæ›´æ–°</strong></p><p><strong>1)æ•°æ®æ“ä½œä¸»è¦åˆ†ä¸ºä¸¤å¤§å—ï¼š</strong></p><ul><li>ä¸€ä¸ªæ˜¯å…¨é‡(å°†å…¨éƒ¨æ•°æ®ä¸€æ¬¡å†™å…¥åˆ°redis)</li><li>ä¸€ä¸ªæ˜¯å¢é‡(å®æ—¶æ›´æ–°)</li></ul><p>è¿™é‡Œè¯´çš„æ˜¯å¢é‡,æŒ‡çš„æ˜¯mysqlçš„updateã€insertã€delateå˜æ›´æ•°æ®ã€‚</p><p><strong>2)è¯»å–binlogååˆ†æ ï¼Œåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—,æ¨é€æ›´æ–°å„å°çš„redisç¼“å­˜æ•°æ®ã€‚</strong></p><p>è¿™æ ·ä¸€æ—¦MySQLä¸­äº§ç”Ÿäº†æ–°çš„å†™å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œå°±å¯ä»¥æŠŠbinlogç›¸å…³çš„æ¶ˆæ¯æ¨é€è‡³Redisï¼ŒRediså†æ ¹æ®binlogä¸­çš„è®°å½•ï¼Œå¯¹Redisè¿›è¡Œæ›´æ–°ã€‚</p><p>å…¶å®è¿™ç§æœºåˆ¶ï¼Œå¾ˆç±»ä¼¼MySQLçš„ä¸»ä»å¤‡ä»½æœºåˆ¶ï¼Œå› ä¸ºMySQLçš„ä¸»å¤‡ä¹Ÿæ˜¯é€šè¿‡binlogæ¥å®ç°çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>è¿™é‡Œå¯ä»¥ç»“åˆä½¿ç”¨canal(é˜¿é‡Œçš„ä¸€æ¬¾å¼€æºæ¡†æ¶)ï¼Œé€šè¿‡è¯¥æ¡†æ¶å¯ä»¥å¯¹MySQLçš„binlogè¿›è¡Œè®¢é˜…ï¼Œè€Œcanalæ­£æ˜¯æ¨¡ä»¿äº†mysqlçš„slaveæ•°æ®åº“çš„å¤‡ä»½è¯·æ±‚ï¼Œä½¿å¾—Redisçš„æ•°æ®æ›´æ–°è¾¾åˆ°äº†ç›¸åŒçš„æ•ˆæœã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œçš„æ¶ˆæ¯æ¨é€å·¥å…·ä½ ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ«çš„ç¬¬ä¸‰æ–¹ï¼škafkaã€rabbitMQç­‰æ¥å®ç°æ¨é€æ›´æ–°Redisã€‚</p><p>å‚çœ‹ï¼š<a href="https://my.oschina.net/jiagouzhan/blog/2990423" target="_blank" rel="noopener noreferrer">é«˜å¹¶å‘æ¶æ„ç³»åˆ—ï¼šRedisç¼“å­˜å’ŒMySQLæ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆè¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="_6-redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_6-redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯" aria-hidden="true">#</a> 6.Redisæœ‰å“ªäº›æ•°æ®ç±»å‹åŠä½¿ç”¨åœºæ™¯</h2><h3 id="string" tabindex="-1"><a class="header-anchor" href="#string" aria-hidden="true">#</a> String</h3><p>K-Vç»“æ„</p><p>valueå¦‚æœæ˜¯æ•°å­—ï¼Œå¯ä»¥è¿›è¡Œè®¡æ•°æ“ä½œ</p><p>å¸¸ç”¨æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦</span>
strlen key 
<span class="token comment"># æ‰¹é‡è®¾ç½® key-value ç±»å‹çš„å€¼</span>
mset key1 value1 key2 value2
<span class="token comment"># æ‰¹é‡è·å–å¤šä¸ª key å¯¹åº”çš„ value</span>
mget key1 key2 
 <span class="token comment"># å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€</span>
incr number
 <span class="token comment"># å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€</span>
decr number
<span class="token comment"># æ•°æ®åœ¨ 60s åè¿‡æœŸ</span>
expire key  <span class="token number">60</span> 
<span class="token comment"># æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:[set] + [ex]pire)</span>
setex key <span class="token number">60</span> value 
<span class="token comment"># æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ</span>
ttl key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨åœºæ™¯ï¼šå¸¸ç”¨åœ¨éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ç­‰ã€‚</p><h3 id="list" tabindex="-1"><a class="header-anchor" href="#list" aria-hidden="true">#</a> List</h3><p>Redis çš„ list çš„å®ç°ä¸ºä¸€ä¸ª <strong>åŒå‘é“¾è¡¨</strong>ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ã€‚ç‰¹ç‚¹æ˜¯æ˜“äºæ•°æ®å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸”ä¸”å¯ä»¥çµæ´»è°ƒæ•´é“¾è¡¨é•¿åº¦ï¼Œä½†æ˜¯é“¾è¡¨çš„éšæœºè®¿é—®å›°éš¾ã€‚</p><p><strong>åº”ç”¨åœºæ™¯:</strong> å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚</p><p>å¸¸ç”¨æ“ä½œï¼š</p><p><strong>å®ç°é˜Ÿåˆ—å’Œæ ˆ</strong></p><figure><img src="/assets/20210628214025-c8a4be70.png" alt="rediså®ç°æ ˆå’Œé˜Ÿåˆ—" tabindex="0" loading="lazy"><figcaption>rediså®ç°æ ˆå’Œé˜Ÿåˆ—</figcaption></figure><p><strong>æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡èŒƒå›´çš„åˆ—è¡¨å…ƒç´ (å®ç°åˆ†é¡µ)</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡çš„liståˆ—è¡¨ï¼Œ 0 ä¸º start,1ä¸º end</span>
lrange myList <span class="token number">0</span> <span class="token number">1</span> 
<span class="token comment"># æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€</span>
lrange myList <span class="token number">0</span> <span class="token parameter variable">-1</span> 
æŸ¥çœ‹é“¾è¡¨é•¿åº¦
llen myList
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hash" tabindex="-1"><a class="header-anchor" href="#hash" aria-hidden="true">#</a> Hash</h3><p>hash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚</p><p>hash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ<strong>ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡</strong>ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»…ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ hash æ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚</p><p><strong>åº”ç”¨åœºæ™¯:</strong> ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ã€‚</p><p>å¸¸ç”¨æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å­˜å‚¨</span>
hmset userInfoKey name <span class="token string">&quot;guide&quot;</span> description <span class="token string">&quot;dev&quot;</span> age <span class="token string">&quot;24&quot;</span>
<span class="token comment"># æŸ¥çœ‹ key å¯¹åº”çš„ valueä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨</span>
hexists userInfoKey name 
<span class="token comment"># è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼</span>
hget userInfoKey name 
<span class="token comment"># è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼</span>
hgetall userInfoKey 
 <span class="token comment"># è·å– key åˆ—è¡¨</span>
hkeys userInfoKey
<span class="token comment"># è·å– value åˆ—è¡¨</span>
hvals userInfoKey 
<span class="token comment"># ä¿®æ”¹æŸä¸ªå­—æ®µå¯¹åº”çš„å€¼</span>
hset userInfoKey name <span class="token string">&quot;GuideGeGe&quot;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="set" tabindex="-1"><a class="header-anchor" href="#set" aria-hidden="true">#</a> Set</h3><p>set ç±»ä¼¼äº Java ä¸­çš„ <code>HashSet</code> ã€‚Redis ä¸­çš„ set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” <strong>set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£</strong>ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚</p><p>å¯ä»¥åŸºäº set è½»æ˜“å®ç°<strong>äº¤é›†ã€å¹¶é›†ã€å·®é›†</strong>çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚</p><p>å¸¸ç”¨æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ·»åŠ å…ƒç´ è¿›å»</span>
sadd mySet value1 value2 
<span class="token comment"># æŸ¥çœ‹ set ä¸­æ‰€æœ‰çš„å…ƒç´ </span>
smembers mySet 
<span class="token comment"># æŸ¥çœ‹ set çš„é•¿åº¦</span>
scard mySet
<span class="token comment"># æ£€æŸ¥æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨set ä¸­ï¼Œåªèƒ½æ¥æ”¶å•ä¸ªå…ƒç´ </span>
sismember mySet value1 
<span class="token comment"># è·å– mySet å’Œ mySet2 çš„äº¤é›†å¹¶å­˜æ”¾åœ¨ mySet3 ä¸­</span>
sinterstore mySet3 mySet mySet2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sorted-set" tabindex="-1"><a class="header-anchor" href="#sorted-set" aria-hidden="true">#</a> Sorted Set</h3><p>å’Œ set ç›¸æ¯”ï¼Œsorted set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚æ¯”å¦‚åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯(å¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œ)ç­‰ä¿¡æ¯ã€‚</p><p>å¸¸ç”¨æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ·»åŠ å…ƒç´ åˆ° sorted set ä¸­ 3.0 ä¸ºæƒé‡</span>
zadd myZset <span class="token number">3.0</span> value1 
 <span class="token comment"># ä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´ </span>
zadd myZset <span class="token number">2.0</span> value2 <span class="token number">1.0</span> value3
<span class="token comment"># æŸ¥çœ‹ sorted set ä¸­çš„å…ƒç´ æ•°é‡</span>
zcard myZset 
<span class="token comment"># æŸ¥çœ‹æŸä¸ª value çš„æƒé‡</span>
zscore myZset value1 
<span class="token comment"># é¡ºåºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 -1 è¡¨ç¤ºè¾“å‡ºæ‰€æœ‰å…ƒç´ </span>
zrange  myZset <span class="token number">0</span> <span class="token parameter variable">-1</span> 
<span class="token comment"># é€†åºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 ä¸º start  1 ä¸º stop</span>
zrevrange  myZset <span class="token number">0</span> <span class="token number">1</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bitmap" tabindex="-1"><a class="header-anchor" href="#bitmap" aria-hidden="true">#</a> bitmap</h3><p>bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—(0 å’Œ 1)ï¼Œé€šè¿‡ bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚</p><p><strong>åº”ç”¨åœºæ™¯:</strong> é€‚åˆéœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯(æ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦ç™»å½•...)å¹¶éœ€è¦è¿›ä¸€æ­¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æçš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡(æ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘)ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># SETBIT ä¼šè¿”å›ä¹‹å‰ä½çš„å€¼(é»˜è®¤æ˜¯ 0)è¿™é‡Œä¼šç”Ÿæˆ 7 ä¸ªä½
127.0.0.1:6379&gt; setbit mykey 7 1
(integer) 0
127.0.0.1:6379&gt; setbit mykey 7 0
(integer) 1
127.0.0.1:6379&gt; getbit mykey 7
(integer) 0
127.0.0.1:6379&gt; setbit mykey 6 1
(integer) 0
127.0.0.1:6379&gt; setbit mykey 8 1
(integer) 0
# é€šè¿‡ bitcount ç»Ÿè®¡è¢«è¢«è®¾ç½®ä¸º 1 çš„ä½çš„æ•°é‡ã€‚
127.0.0.1:6379&gt; bitcount mykey
(integer) 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é’ˆå¯¹ä¸Šé¢æåˆ°çš„ä¸€äº›åœºæ™¯ï¼Œè¿™é‡Œè¿›è¡Œè¿›ä¸€æ­¥è¯´æ˜ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ä¸€ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æ</strong> å¾ˆå¤šç½‘ç«™ä¸ºäº†åˆ†æä½ çš„å–œå¥½ï¼Œéœ€è¦ç ”ç©¶ä½ ç‚¹èµè¿‡çš„å†…å®¹ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è®°å½•ä½ å–œæ¬¢è¿‡ 001 å·å°å§å§</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit beauty_girl_001 uid 1Copy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨åœºæ™¯äºŒï¼šç»Ÿè®¡æ´»è·ƒç”¨æˆ·</strong></p><p>ä½¿ç”¨æ—¶é—´ä½œä¸º keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœå½“æ—¥æ´»è·ƒè¿‡å°±è®¾ç½®ä¸º 1</p><p>é‚£ä¹ˆæˆ‘è¯¥å¦‚æœè®¡ç®—æŸå‡ å¤©/æœˆ/å¹´çš„æ´»è·ƒç”¨æˆ·å‘¢(æš‚ä¸”çº¦å®šï¼Œç»Ÿè®¡æ—¶é—´å†…åªæœ‰æœ‰ä¸€å¤©åœ¨çº¿å°±ç§°ä¸ºæ´»è·ƒ)ï¼Œæœ‰è¯·ä¸‹ä¸€ä¸ª redis çš„å‘½ä»¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸² key è¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey ä¸Šã€‚</span>
<span class="token comment"># BITOP å‘½ä»¤æ”¯æŒ AND ã€ OR ã€ NOT ã€ XOR è¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§å‚æ•°</span>
BITOP operation destkey key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span>Copy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆå§‹åŒ–æ•°æ®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210308</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210308</span> <span class="token number">2</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setbit <span class="token number">20210309</span> <span class="token number">1</span> <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0Copy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»Ÿè®¡ 20210308~20210309 æ€»æ´»è·ƒç”¨æˆ·æ•°: 1</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitop and desk1 <span class="token number">20210308</span> <span class="token number">20210309</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount desk1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1Copy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»Ÿè®¡ 20210308~20210309 åœ¨çº¿æ´»è·ƒç”¨æˆ·æ•°: 2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitop or desk2 <span class="token number">20210308</span> <span class="token number">20210309</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> bitcount desk2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2Copy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨åœºæ™¯ä¸‰ï¼šç”¨æˆ·åœ¨çº¿çŠ¶æ€</strong></p><p>å¯¹äºè·å–æˆ–è€…ç»Ÿè®¡ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼Œä½¿ç”¨ bitmap æ˜¯ä¸€ä¸ªèŠ‚çº¦ç©ºé—´æ•ˆç‡åˆé«˜çš„ä¸€ç§æ–¹æ³•ã€‚</p><p>åªéœ€è¦ä¸€ä¸ª keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœåœ¨çº¿å°±è®¾ç½®ä¸º 1ï¼Œä¸åœ¨çº¿å°±è®¾ç½®ä¸º 0ã€‚</p><h2 id="_7-redisæŒä¹…åŒ–æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_7-redisæŒä¹…åŒ–æœºåˆ¶" aria-hidden="true">#</a> 7. RedisæŒä¹…åŒ–æœºåˆ¶</h2><h3 id="_7-1-ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_7-1-ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–" aria-hidden="true">#</a> 7.1 ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–ï¼Ÿ</h3><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æ•°æ®ä¹Ÿå°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜é‡Œé¢ï¼Œå¤§éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†ä¹‹åé‡ç”¨æ•°æ®(æ¯”å¦‚é‡å¯æœºå™¨ã€æœºå™¨æ•…éšœä¹‹åæ¢å¤æ•°æ®)ï¼Œæˆ–è€…æ˜¯ä¸ºäº†é˜²æ­¢ç³»ç»Ÿæ•…éšœè€Œå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªè¿œç¨‹ä½ç½®ã€‚</p><h3 id="_7-2-å¿«ç…§æŒä¹…åŒ–-snapshotting-rdb" tabindex="-1"><a class="header-anchor" href="#_7-2-å¿«ç…§æŒä¹…åŒ–-snapshotting-rdb" aria-hidden="true">#</a> 7.2 å¿«ç…§æŒä¹…åŒ–(snapshottingï¼ŒRDB)</h3><p>Redis å¯ä»¥é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬/å¿«ç…§(<strong>RDBæ–‡ä»¶</strong>)ã€‚</p><p>Redis åˆ›å»ºå¿«ç…§ä¹‹åï¼Œå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬(Redis ä¸»ä»ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜ Redis æ€§èƒ½)ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚</p><p><strong>åˆ›å»ºå¿«ç…§(RDBæ–‡ä»¶)</strong>ï¼š</p><p>åœ¨redis.confä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º<strong>dump.rdb</strong></p><p>å¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨ Redis.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>save 900 1           #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚
save 300 10          #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚
save 60 10000        #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯é‡‡ç”¨æ‰‹åŠ¨å½¢å¼åˆ›å»ºå¿«ç…§ï¼š</p><ul><li><code>SAVE</code>å‘½ä»¤ï¼šé˜»å¡RedisæœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ï¼Œåœ¨æœåŠ¡å™¨è¿›ç¨‹é˜»å¡æœŸé—´ï¼ŒæœåŠ¡å™¨ä¸èƒ½å¤„ç†ä»»ä½•å‘½ä»¤è¯·æ±‚ã€‚</li><li><code>BGSAVE</code>å‘½ä»¤ï¼šæ´¾ç”Ÿå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åç”±å­è¿›ç¨‹è´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ï¼ŒæœåŠ¡å™¨è¿›ç¨‹(çˆ¶è¿›ç¨‹)ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</li></ul><p><strong>è½½å…¥å¿«ç…§(RDBæ–‡ä»¶)</strong>ï¼š</p><p>Redisè½½å…¥RDBæ–‡ä»¶å¹¶æ²¡æœ‰ä¸“é—¨çš„å‘½ä»¤ï¼Œè€Œæ˜¯åœ¨RedisæœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼ŒRedisæœåŠ¡å™¨å¯åŠ¨æ—¶æ˜¯å¦ä¼šè½½å…¥RDBæ–‡ä»¶è¿˜å–å†³äºæœåŠ¡å™¨æ˜¯å¦å¯ç”¨äº†AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œå…·ä½“åˆ¤æ–­é€»è¾‘ä¸ºï¼š</p><ul><li>åªæœ‰åœ¨AOFæŒä¹…åŒ–åŠŸèƒ½å¤„äºå…³é—­çŠ¶æ€æ—¶ï¼ŒæœåŠ¡å™¨æ‰ä¼šä½¿ç”¨RDBæ–‡ä»¶æ¥è¿˜åŸæ•°æ®ã€‚</li><li>å¦‚æœæœåŠ¡å™¨å¼€å¯äº†AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶æ¥è¿˜åŸæ•°æ®ã€‚</li></ul><figure><img src="/assets/20210628222057-6c7793c6.png" alt="rediså¯åŠ¨è½½å…¥å¿«ç…§æµç¨‹" tabindex="0" loading="lazy"><figcaption>rediså¯åŠ¨è½½å…¥å¿«ç…§æµç¨‹</figcaption></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisæœåŠ¡å™¨çš„AOFæŒä¹…åŒ–åŠŸèƒ½æ˜¯å…³é—­çš„ã€‚</p><p><strong>å¦‚ä½•è¿›è¡Œå¤‡ä»½ï¼Ÿ</strong></p><p>Redisä¼šå•ç‹¬åˆ›å»º(fork)ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚<strong>RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±</strong>ã€‚</p><h3 id="_7-3-åªè¿½åŠ æ–‡ä»¶æŒä¹…åŒ–-append-only-file-aof" tabindex="-1"><a class="header-anchor" href="#_7-3-åªè¿½åŠ æ–‡ä»¶æŒä¹…åŒ–-append-only-file-aof" aria-hidden="true">#</a> 7.3 åªè¿½åŠ æ–‡ä»¶æŒä¹…åŒ–(append-only file, AOF)</h3><p>ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ– çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOFæ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ <code>appendonly</code> å‚æ•°å¼€å¯ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>appendonly yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ appendonly.aofã€‚</p><p>åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>appendfsync always    #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦
appendfsync everysec  #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜
appendfsync no        #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>appendfsyncé€‰é¡¹çš„é»˜è®¤å€¼æ˜¯everysecï¼Œä¹Ÿæ¨èä½¿ç”¨è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ—¢ä¿è¯äº†æ•ˆç‡åˆä¿è¯äº†å®‰å…¨æ€§ã€‚</p><h4 id="redis-4-0-å¯¹äºæŒä¹…åŒ–æœºåˆ¶çš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#redis-4-0-å¯¹äºæŒä¹…åŒ–æœºåˆ¶çš„ä¼˜åŒ–" aria-hidden="true">#</a> <strong>Redis 4.0 å¯¹äºæŒä¹…åŒ–æœºåˆ¶çš„ä¼˜åŒ–</strong></h4><p>Redis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–(é»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>aof-use-rdb-preamble</code> å¼€å¯)ã€‚</p><p>å¦‚æœæŠŠæ··åˆæŒä¹…åŒ–æ‰“å¼€ï¼ŒAOF é‡å†™çš„æ—¶å€™å°±ç›´æ¥æŠŠ RDB çš„å†…å®¹å†™åˆ° AOF æ–‡ä»¶å¼€å¤´ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, å¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ã€‚å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼Œ AOF é‡Œé¢çš„ RDB éƒ¨åˆ†æ˜¯å‹ç¼©æ ¼å¼ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚</p><h4 id="aof-é‡å†™" tabindex="-1"><a class="header-anchor" href="#aof-é‡å†™" aria-hidden="true">#</a> <strong>AOF é‡å†™</strong></h4><p>å› ä¸ºAOFæŒä¹…åŒ–æ˜¯é€šè¿‡ä¿å­˜è¢«æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“æ•°æ®çš„ï¼Œæ‰€ä»¥éšç€RedisæœåŠ¡å™¨è¿è¡Œæ—¶é—´çš„å¢åŠ ï¼ŒAOFæ–‡ä»¶ä¸­çš„å†…å®¹ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ–‡ä»¶çš„ä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå¦‚æœä¸åšæ§åˆ¶ï¼Œä¼šæœ‰ä»¥ä¸‹2ç‚¹åå¤„ï¼š</p><ol><li>è¿‡å¤šçš„å ç”¨æœåŠ¡å™¨ç£ç›˜ç©ºé—´ï¼Œå¯èƒ½ä¼šå¯¹RedisæœåŠ¡å™¨ç”šè‡³æ•´ä¸ªå®¿ä¸»è®¡ç®—æœºé€ æˆå½±å“ã€‚</li><li>AOFæ–‡ä»¶çš„ä½“ç§¯è¶Šå¤§ï¼Œä½¿ç”¨AOFæ–‡ä»¶æ¥è¿›è¡Œæ•°æ®åº“è¿˜åŸæ‰€éœ€çš„æ—¶é—´å°±è¶Šå¤šã€‚</li></ol><p>ä¸ºäº†è§£å†³AOFæ–‡ä»¶ä½“ç§¯è¶Šæ¥è¶Šå¤§çš„é—®é¢˜ï¼ŒRedisæä¾›äº†AOFæ–‡ä»¶é‡å†™åŠŸèƒ½ï¼Œå³RedisæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ¥æ›¿ä»£ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“æ•°æ®ç›¸åŒï¼Œä½†æ–°AOFæ–‡ä»¶ä¸ä¼šåŒ…å«ä»»ä½•æµªè´¹ç©ºé—´çš„å†—ä½™å‘½ä»¤ï¼Œæ‰€ä»¥æ–°AOFæ–‡ä»¶çš„ä½“ç§¯é€šå¸¸ä¼šæ¯”æ—§AOFæ–‡ä»¶çš„ä½“ç§¯è¦å°å¾ˆå¤šã€‚</p><p><strong>åŸç†</strong>ï¼š</p><p>AOFæ–‡ä»¶é‡å†™å¹¶ä¸éœ€è¦å¯¹ç°æœ‰çš„AOFæ–‡ä»¶è¿›è¡Œä»»ä½•è¯»å–ã€åˆ†ææˆ–è€…å†™å…¥æ“ä½œï¼Œè€Œæ˜¯é€šè¿‡è¯»å–æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“æ•°æ®æ¥å®ç°çš„ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><figure><img src="/assets/20210628223434-d9980665.png" alt="AOF é‡å†™ä¸¾ä¾‹" tabindex="0" loading="lazy"><figcaption>AOF é‡å†™ä¸¾ä¾‹</figcaption></figure><p>ä¸ºäº†è®°å½•è¿™ä¸ªlisté”®çš„çŠ¶æ€ï¼ŒAOFæ–‡ä»¶éœ€è¦ä¿å­˜ä¸Šé¢æ‰§è¡Œçš„6æ¡å‘½ä»¤ã€‚</p><p>ä½†listé”®çš„ç»“æœæ˜¯â€œCâ€ &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot;è¿™æ ·çš„æ•°æ®ï¼Œæ‰€ä»¥AOFæ–‡ä»¶é‡å†™æ—¶ï¼Œå¯ä»¥ç”¨ä¸€æ¡<code>RPUSH list â€œCâ€ &quot;D&quot; &quot;E&quot; &quot;F&quot; &quot;G&quot;</code>å‘½ä»¤æ¥ä»£æ›¿ä¹‹å‰çš„å…­æ¡å‘½ä»¤ï¼Œè¿™æ ·å°±å¯ä»¥å°†ä¿å­˜listé”®æ‰€éœ€çš„å‘½ä»¤ä»å…­æ¡å‡å°‘ä¸ºä¸€æ¡äº†ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„åŸç†ï¼Œå¦‚æœRedisæœåŠ¡å™¨å­˜å‚¨çš„é”®å€¼å¯¹è¶³å¤Ÿå¤šï¼ŒAOFæ–‡ä»¶é‡å†™ç”Ÿæˆçš„æ–°AOFæ–‡ä»¶å°±ä¼šå‡å°‘å¾ˆå¤šå¾ˆå¤šçš„å†—ä½™å‘½ä»¤ï¼Œè¿›è€Œå¤§å¤§å‡å°äº†AOFæ–‡ä»¶çš„ä½“ç§¯ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<strong>AOFæ–‡ä»¶é‡å†™åŠŸèƒ½çš„å®ç°åŸç†ä¸ºï¼š</strong></p><p><strong>é¦–å…ˆä»æ•°æ®åº“ä¸­è¯»å–é”®ç°åœ¨çš„å€¼ï¼Œç„¶åç”¨ä¸€æ¡å‘½ä»¤å»è®°å½•é”®å€¼å¯¹ï¼Œä»£æ›¿ä¹‹å‰è®°å½•è¿™ä¸ªé”®å€¼å¯¹çš„å¤šæ¡å‘½ä»¤ã€‚</strong></p><h4 id="aofåå°é‡å†™" tabindex="-1"><a class="header-anchor" href="#aofåå°é‡å†™" aria-hidden="true">#</a> <strong>AOFåå°é‡å†™</strong></h4><p>å› ä¸ºAOFæ–‡ä»¶é‡å†™ä¼šè¿›è¡Œå¤§é‡çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œæ‰€ä»¥æ‰§è¡Œè¿™ä¸ªæ“ä½œçš„çº¿ç¨‹å°†è¢«é•¿æ—¶é—´é˜»å¡ã€‚</p><p>å› ä¸ºRedisæœåŠ¡å™¨ä½¿ç”¨å•ä¸ªçº¿ç¨‹æ¥å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œæ‰€ä»¥å¦‚æœç”±æœåŠ¡å™¨è¿›ç¨‹ç›´æ¥æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œé‚£ä¹ˆåœ¨é‡å†™AOFæ–‡ä»¶æœŸé—´ï¼ŒæœåŠ¡å™¨å°†æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å‘½ä»¤è¯·æ±‚ã€‚</p><p>ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜ï¼ŒRediså°†AOFæ–‡ä»¶é‡å†™åŠŸèƒ½æ”¾åˆ°å­è¿›ç¨‹é‡Œæ‰§è¡Œï¼Œè¿™æ ·åšæœ‰ä»¥ä¸‹2ä¸ªå¥½å¤„ï¼š</p><ol><li>å­è¿›ç¨‹è¿›è¡ŒAOFæ–‡ä»¶é‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹(çˆ¶è¿›ç¨‹)å¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚</li><li>å­è¿›ç¨‹å¸¦æœ‰æœåŠ¡å™¨è¿›ç¨‹çš„æ•°æ®å‰¯æœ¬ï¼Œä½¿ç”¨å­è¿›ç¨‹è€Œä¸æ˜¯çº¿ç¨‹ï¼Œå¯ä»¥åœ¨é¿å…ä½¿ç”¨é”çš„æƒ…å†µä¸‹ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</li></ol><p>AOFåå°é‡å†™çš„æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ol><li>æœåŠ¡å™¨è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å¼€å§‹AOFæ–‡ä»¶é‡å†™</li><li>ä»åˆ›å»ºå­è¿›ç¨‹å¼€å§‹ï¼ŒæœåŠ¡å™¨è¿›ç¨‹æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ä¸ä»…è¦å†™å…¥AOFç¼“å†²åŒºï¼Œè¿˜è¦å†™å…¥AOFé‡å†™ç¼“å†²åŒº <ol><li>å†™å…¥AOFç¼“å†²åŒºçš„ç›®çš„æ˜¯ä¸ºäº†åŒæ­¥åˆ°åŸæœ‰çš„AOFæ–‡ä»¶ã€‚</li><li>å†™å…¥AOFé‡å†™ç¼“å†²åŒºçš„ç›®çš„æ˜¯å› ä¸ºå­è¿›ç¨‹åœ¨è¿›è¡ŒAOFæ–‡ä»¶é‡å†™æœŸé—´ï¼ŒæœåŠ¡å™¨è¿›ç¨‹è¿˜åœ¨ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ï¼Œè€Œæ–°çš„å‘½ä»¤å¯èƒ½ä¼šå¯¹ç°æœ‰çš„æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œä½¿å¾—æœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“æ•°æ®å’Œé‡å†™åçš„AOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ã€‚</li></ol></li><li>å­è¿›ç¨‹å®ŒæˆAOFé‡å†™å·¥ä½œï¼Œå‘çˆ¶è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿› ç¨‹åœ¨æ¥æ”¶åˆ°è¯¥ä¿¡å·åï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1.å°†AOFé‡å†™ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å†…å®¹å†™å…¥åˆ°æ–°AOFæ–‡ä»¶ä¸­ï¼Œè¿™æ ·å°±ä¿è¯äº†æ–°AOFæ–‡ä»¶æ‰€ä¿å­˜çš„æ•°æ®åº“æ•°æ®å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®åº“æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ 2.å¯¹æ–°çš„AOFæ–‡ä»¶è¿›è¡Œæ”¹åï¼ŒåŸå­åœ°è¦†ç›–ç°æœ‰çš„AOFæ–‡ä»¶ï¼Œå®Œæˆæ–°æ—§ä¸¤ä¸ªAOFæ–‡ä»¶çš„æ›¿æ¢ã€‚</li></ol><p>Redisæä¾›äº†<code>BGREWRITEAOF</code>å‘½ä»¤æ¥æ‰§è¡Œä»¥ä¸Šæ­¥éª¤ã€‚</p><p>é™¤äº†æ‰‹åŠ¨æ‰§è¡Œ<code>BGREWRITEAOF</code>å‘½ä»¤å¤–ï¼ŒRedisè¿˜æä¾›äº†2ä¸ªé…ç½®é¡¹ç”¨æ¥è‡ªåŠ¨æ‰§è¡Œ<code>BGREWRITEAOF</code>å‘½ä»¤ï¼š</p><blockquote><p>auto-aof-rewrite-percentage 100 auto-aof-rewrite-min-size 64mb</p></blockquote><p>è¯¥é…ç½®è¡¨ç¤ºï¼Œå½“AOFæ–‡ä»¶çš„ä½“ç§¯å¤§äº64MBï¼Œå¹¶ä¸”AOFæ–‡ä»¶çš„ä½“ç§¯æ¯”ä¸Šä¸€æ¬¡é‡å†™ä¹‹åçš„ä½“ç§¯å¤§äº†è‡³å°‘ä¸€å€(100%)ï¼ŒRediså°†è‡ªåŠ¨æ‰§è¡Œ<code>BGREWRITEAOF</code>å‘½ä»¤ã€‚</p><h3 id="_7-4-rdbæŒä¹…åŒ–ã€aofæŒä¹…åŒ–çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_7-4-rdbæŒä¹…åŒ–ã€aofæŒä¹…åŒ–çš„åŒºåˆ«" aria-hidden="true">#</a> 7.4 RDBæŒä¹…åŒ–ã€AOFæŒä¹…åŒ–çš„åŒºåˆ«</h3><p><strong>å®ç°æ–¹å¼</strong></p><p>RDBæŒä¹…åŒ–æ˜¯é€šè¿‡å°†æŸä¸ªæ—¶é—´ç‚¹RedisæœåŠ¡å™¨å­˜å‚¨çš„æ•°æ®ä¿å­˜åˆ°RDBæ–‡ä»¶ä¸­æ¥å®ç°æŒä¹…åŒ–çš„ã€‚</p><p>AOFæŒä¹…åŒ–æ˜¯é€šè¿‡å°†RedisæœåŠ¡å™¨æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­æ¥å®ç°æŒä¹…åŒ–çš„ã€‚</p><p><strong>æ–‡ä»¶ä½“ç§¯</strong></p><p>ç”±ä¸Šè¿°å®ç°æ–¹å¼å¯çŸ¥ï¼ŒRDBæŒä¹…åŒ–è®°å½•çš„æ˜¯ç»“æœï¼ŒAOFæŒä¹…åŒ–è®°å½•çš„æ˜¯è¿‡ç¨‹ï¼Œæ‰€ä»¥<strong>AOFæŒä¹…åŒ–ç”Ÿæˆçš„AOFæ–‡ä»¶ä¼šæœ‰ä½“ç§¯è¶Šæ¥è¶Šå¤§çš„é—®é¢˜</strong>ï¼ŒRedisæä¾›äº†AOFé‡å†™åŠŸèƒ½æ¥å‡å°AOFæ–‡ä»¶ä½“ç§¯ã€‚</p><p><strong>å®‰å…¨æ€§</strong></p><p><strong>AOFæŒä¹…åŒ–çš„å®‰å…¨æ€§è¦æ¯”RDBæŒä¹…åŒ–çš„å®‰å…¨æ€§é«˜</strong>ï¼Œå³å¦‚æœå‘ç”Ÿæœºå™¨æ•…éšœï¼ŒAOFæŒä¹…åŒ–è¦æ¯”RDBæŒä¹…åŒ–ä¸¢å¤±çš„æ•°æ®è¦å°‘ã€‚</p><p>å› ä¸ºRDBæŒä¹…åŒ–ä¼šä¸¢å¤±ä¸Šæ¬¡RDBæŒä¹…åŒ–åå†™å…¥çš„æ•°æ®ï¼Œè€ŒAOFæŒä¹…åŒ–æœ€å¤šä¸¢å¤±1sä¹‹å†…å†™å…¥çš„æ•°æ®(ä½¿ç”¨é»˜è®¤everysecé…ç½®çš„è¯)ã€‚</p><p><strong>ä¼˜å…ˆçº§</strong></p><p>ç”±äºä¸Šè¿°çš„å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚æœRedisæœåŠ¡å™¨å¼€å¯äº†AOFæŒä¹…åŒ–åŠŸèƒ½ï¼ŒRedisæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ä¼šä½¿ç”¨AOFæ–‡ä»¶æ¥è¿˜åŸæ•°æ®ï¼Œå¦‚æœRedisæœåŠ¡å™¨æ²¡æœ‰å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½ï¼ŒRedisæœåŠ¡å™¨åœ¨å¯åŠ¨æ—¶ä¼šä½¿ç”¨RDBæ–‡ä»¶æ¥è¿˜åŸæ•°æ®ï¼Œæ‰€ä»¥AOFæ–‡ä»¶çš„ä¼˜å…ˆçº§æ¯”RDBæ–‡ä»¶çš„ä¼˜å…ˆçº§é«˜ã€‚</p><h3 id="_7-5-redisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹" tabindex="-1"><a class="header-anchor" href="#_7-5-redisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹" aria-hidden="true">#</a> 7.5 RedisæŒä¹…åŒ–æ•°æ®å’Œç¼“å­˜æ€ä¹ˆåšæ‰©å®¹ï¼Ÿ</h3><p>1ã€å¦‚æœRedisè¢«å½“åšç¼“å­˜ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚</p><p>2ã€å¦‚æœRedisè¢«å½“åšä¸€ä¸ªæŒä¹…åŒ–å­˜å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„keys-to-nodesæ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³RedisèŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µ)ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰Redisé›†ç¾¤å¯ä»¥åšåˆ°è¿™æ ·ã€‚</p><h3 id="_7-6-rdbå’Œaofå¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_7-6-rdbå’Œaofå¦‚ä½•é€‰æ‹©" aria-hidden="true">#</a> 7.6 RDBå’ŒAOFå¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><ul><li><p>RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨</p></li><li><p>AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾. Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ã€‚</p></li><li><p>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼.</p></li><li><p>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼</p><ul><li>åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®, å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´.</li><li>RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</li></ul></li><li><p>æ€§èƒ½å»ºè®®</p><ul><li><p>å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚</p></li><li><p>å¦‚æœä½¿ç”¨AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><p>ä»£ä»·ï¼Œä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚</p></li><li><p>åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚</p></li><li><p>AOFé»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</p></li></ul></li></ul><h2 id="_8-redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_8-redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥" aria-hidden="true">#</a> 8. Redisè¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</h2><p>å¦‚æœå‡è®¾ä½ è®¾ç½®äº†ä¸€æ‰¹ key åªèƒ½å­˜æ´» 1 åˆ†é’Ÿï¼Œé‚£ä¹ˆ 1 åˆ†é’Ÿåï¼ŒRedis æ˜¯æ€ä¹ˆå¯¹è¿™æ‰¹ key è¿›è¡Œåˆ é™¤çš„å‘¢ï¼Ÿ</p><p>å¸¸ç”¨çš„è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥å°±ä¸¤ä¸ª(é‡è¦ï¼è‡ªå·±é€ ç¼“å­˜è½®å­çš„æ—¶å€™éœ€è¦æ ¼å¤–è€ƒè™‘çš„ä¸œè¥¿)ï¼š</p><ol><li><strong>æƒ°æ€§åˆ é™¤</strong> ï¼šåªä¼šåœ¨å–å‡º key çš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚è¿™æ ·å¯¹ CPU æœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆå¤ªå¤šè¿‡æœŸ key æ²¡æœ‰è¢«åˆ é™¤ã€‚</li><li><strong>å®šæœŸåˆ é™¤</strong> ï¼š æ¯éš”ä¸€æ®µæ—¶é—´æŠ½å–ä¸€æ‰¹ key æ‰§è¡Œåˆ é™¤è¿‡æœŸ key æ“ä½œã€‚å¹¶ä¸”ï¼ŒRedis åº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹ CPU æ—¶é—´çš„å½±å“ã€‚</li></ol><p>å®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´åŠ å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹ CPU æ›´åŠ å‹å¥½ã€‚ä¸¤è€…å„æœ‰åƒç§‹ï¼Œæ‰€ä»¥ Redis é‡‡ç”¨çš„æ˜¯ <strong>å®šæœŸåˆ é™¤+æƒ°æ€§/æ‡’æ±‰å¼åˆ é™¤</strong> ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸å•ç‹¬ç”¨å®šæ—¶åˆ é™¤ç­–ç•¥ï¼Ÿ</strong></p><p>å®šæ—¶åˆ é™¤ï¼šç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥è´Ÿè´£ç›‘è§†keyï¼Œè¿‡æœŸåˆ™è‡ªåŠ¨åˆ é™¤ï¼Œååˆ†æ¶ˆè€—CPUèµ„æºã€‚åœ¨å¤§é‡å¹¶å‘è¯·æ±‚ä¸‹ï¼ŒCPUè¦å°†æ—¶é—´åº”ç”¨åœ¨å¤„ç†è¯·æ±‚ï¼Œè€Œä¸æ˜¯åˆ é™¤keyã€‚</p><p><strong>å®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢</strong>?</p><p>å®šæœŸåˆ é™¤ï¼Œredisé»˜è®¤æ¯ä¸ª100msæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰è¿‡æœŸçš„key,æœ‰è¿‡æœŸkeyåˆ™åˆ é™¤ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œredisä¸æ˜¯æ¯ä¸ª100mså°†æ‰€æœ‰çš„keyæ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œæ˜¯éšæœºæŠ½å–è¿›è¡Œæ£€æŸ¥(å¦‚æœæ¯éš”100ms,å…¨éƒ¨keyè¿›è¡Œæ£€æŸ¥ï¼Œrediså²‚ä¸æ˜¯å¡æ­»)ã€‚å› æ­¤ï¼Œå¦‚æœåªé‡‡ç”¨å®šæœŸåˆ é™¤ç­–ç•¥ï¼Œä¼šå¯¼è‡´å¾ˆå¤škeyåˆ°æ—¶é—´æ²¡æœ‰åˆ é™¤ã€‚äºæ˜¯ï¼Œæƒ°æ€§åˆ é™¤æ´¾ä¸Šç”¨åœºã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä½ è·å–æŸä¸ªkeyçš„æ—¶å€™ï¼Œredisä¼šæ£€æŸ¥ä¸€ä¸‹ï¼Œè¿™ä¸ªkeyå¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸäº†ï¼Ÿå¦‚æœè¿‡æœŸäº†æ­¤æ—¶å°±ä¼šåˆ é™¤ã€‚</p><p>ä½†æ˜¯ï¼Œä»…ä»…é€šè¿‡ç»™ key è®¾ç½®è¿‡æœŸæ—¶é—´è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚å› ä¸ºè¿˜æ˜¯å¯èƒ½å­˜åœ¨å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤æ¼æ‰äº†å¾ˆå¤šè¿‡æœŸ key çš„æƒ…å†µã€‚è¿™æ ·å°±å¯¼è‡´å¤§é‡è¿‡æœŸ key å †ç§¯åœ¨å†…å­˜é‡Œï¼Œç„¶åå°± Out of memory äº†ã€‚</p><p>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼š <strong>Redis å†…å­˜æ·˜æ±°æœºåˆ¶ã€‚</strong></p><h2 id="_9-redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_9-redis-å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆ" aria-hidden="true">#</a> 9. Redis å†…å­˜æ·˜æ±°æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h2><p>æŸ¥çœ‹è®¾ç½®ï¼šåœ¨redis.confä¸­æœ‰ä¸€è¡Œé…ç½®<code>maxmemory-policy volatile-lru</code></p><p>å¦‚ä½•è®¾ç½®ï¼š<code>config set maxmemory-policy allkeys-lru</code></p><p>Redis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</p><ol><li><strong>volatile-lru(least recently used)</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li><strong>volatile-ttl</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li><li><strong>volatile-random</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li><strong>allkeys-lru(least recently used)</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key(è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„)</li><li><strong>allkeys-random</strong>ï¼šä»æ•°æ®é›†(server.db[i].dict)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li><strong>no-eviction</strong>ï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªåº”è¯¥æ²¡äººä½¿ç”¨å§ï¼</li></ol><p>4.0 ç‰ˆæœ¬åå¢åŠ ä»¥ä¸‹ä¸¤ç§ï¼š</p><ol><li><strong>volatile-lfu(least frequently used)</strong>ï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li><strong>allkeys-lfu(least frequently used)</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ key</li></ol><p>ç›¸å…³é—®é¢˜ï¼š<strong>MySQL é‡Œæœ‰ 2000w æ•°æ®ï¼ŒRedis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®</strong>?</p><p>Redis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><p><strong>å†…å­˜ç›¸å…³</strong>ï¼š</p><p>æŸ¥çœ‹rediså ç”¨æœ€å¤§å†…å­˜ï¼š<code>maxmemory &lt;bytes&gt;</code></p><p>å¦‚ä½•ä¿®æ”¹rediså†…å­˜å¤§å°ï¼š<code>config set maxmemory</code></p><p>redisé»˜è®¤å†…å­˜å¤§å°ï¼šå¦‚æœä¸è®¾ç½®æœ€å¤§å†…å­˜å¤§å°æˆ–è€…è®¾ç½®æœ€å¤§å†…å­˜å¤§å°ä¸º0ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸‹ä¸é™åˆ¶å†…å­˜å¤§å°ï¼Œåœ¨32ä½æ“ä½œç³»ç»Ÿä¸‹æœ€å¤šä½¿ç”¨3GBå†…å­˜ã€‚</p><p>ç”Ÿäº§ä¸Šrediså†…å­˜å¦‚ä½•é…ç½®ï¼Ÿä¸€èˆ¬æ¨èè®¾ç½®ä¸ºæœ€å¤§ç‰©ç†å†…å­˜çš„3/4</p><p>rediså†…å­˜ä½¿ç”¨æƒ…å†µå‘½ä»¤ï¼š<code>info memory</code></p><h2 id="_10-redis-keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®" tabindex="-1"><a class="header-anchor" href="#_10-redis-keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®" aria-hidden="true">#</a> 10. Redis keyçš„è¿‡æœŸæ—¶é—´å’Œæ°¸ä¹…æœ‰æ•ˆåˆ†åˆ«æ€ä¹ˆè®¾ç½®ï¼Ÿ</h2><p><code>EXPIRE</code> å’Œ <code>PERSIST</code> å‘½ä»¤</p><h2 id="_11-å¦‚ä½•è¿›è¡Œrediså†…å­˜ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_11-å¦‚ä½•è¿›è¡Œrediså†…å­˜ä¼˜åŒ–" aria-hidden="true">#</a> 11. å¦‚ä½•è¿›è¡ŒRediså†…å­˜ä¼˜åŒ–ï¼Ÿ</h2><p>å¯¹äºRedisä¸­çš„æ‰€æœ‰å¯¹è±¡åœ¨å†…éƒ¨éƒ½æ˜¯ç”±ä¸€ä¸ªç§å«RedisObjectçš„æ•°æ®ç»“æ„æ¥å®ç°ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span><span class="token punctuation">{</span>
    <span class="token comment">//ç±»å‹</span>
	<span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
	
	<span class="token comment">//ç¼–ç </span>
	<span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span>
	
	<span class="token comment">//æŒ‡å‘åº•å±‚å®ç°çš„æ•°æ®ç»“æ„çš„æŒ‡é’ˆ</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä»RedisObjectçš„ç»“æ„å¾—çŸ¥Rediså­˜å‚¨ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜æˆæœ¬æ˜¯ï¼štype + encoding + *ptræŒ‡å‘çš„æ•°æ®(æ•°æ®æœ¬èº«)ã€‚</strong></p><h3 id="_1-keyä¸valueçš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-keyä¸valueçš„ä¼˜åŒ–" aria-hidden="true">#</a> (1)keyä¸valueçš„ä¼˜åŒ–</h3><ul><li><strong>è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬ç¼“å­˜ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯,æˆ‘ä»¬é€šå¸¸åªè¦ç¼“å­˜åŸºæœ¬ä¿¡æ¯æ¯”å¦‚ï¼šå‘¢ç§°ï¼Œæ€§åˆ«ï¼Œè§’è‰²ç±»å‹ï¼Œç”Ÿæ—¥å³å¯ã€‚å…¶å®ƒçš„ä¸€äº›ä¸å¿…è¦ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤æ‰ã€‚</li><li><strong>ç²¾ç®€æ•°æ®</strong>ã€‚æ¯”å¦‚è§’è‰²ç±»å‹ï¼š&quot;VIP&quot;ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®š1ä»£è¡¨&quot;VIP&quot;ï¼Œä¸ç›´æ¥å­˜å‚¨VIPå­—ç¬¦ä¸²ã€‚</li><li><strong>æ•°æ®å‹ç¼©</strong>ã€‚å­˜è¿›redisä¹‹å‰æˆ‘ä»¬è¿˜å¯ä»¥å¯¹å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œå¸¸ç”¨çš„å·¥å…·æœ‰GZIPã€Snappyã€‚</li><li><strong>ç¼©çŸ­é”®å€¼å¯¹çš„å­˜å‚¨é•¿åº¦</strong><ul><li>åœ¨ key ä¸å˜çš„æƒ…å†µä¸‹ï¼Œvalue å€¼è¶Šå¤§æ“ä½œæ•ˆç‡è¶Šæ…¢ï¼Œå› ä¸º Redis å¯¹äºåŒä¸€ç§æ•°æ®ç±»å‹ä¼šä½¿ç”¨ä¸åŒçš„å†…éƒ¨ç¼–ç è¿›è¡Œå­˜å‚¨ï¼Œç„¶è€Œæ•°æ®é‡è¶Šå¤§ä½¿ç”¨çš„å†…éƒ¨ç¼–ç å°±è¶Šå¤æ‚ï¼Œè€Œè¶Šæ˜¯å¤æ‚çš„å†…éƒ¨ç¼–ç å­˜å‚¨çš„æ€§èƒ½å°±è¶Šä½ã€‚</li><li>å› æ­¤åœ¨ä¿è¯å®Œæ•´è¯­ä¹‰çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¦å°½é‡çš„ç¼©çŸ­é”®å€¼å¯¹çš„å­˜å‚¨é•¿åº¦ï¼Œå¿…è¦æ—¶è¦å¯¹æ•°æ®è¿›è¡Œåºåˆ—åŒ–å’Œå‹ç¼©å†å­˜å‚¨ã€‚</li></ul></li></ul><h3 id="_2-å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¼˜åŒ–" aria-hidden="true">#</a> (2)å­—ç¬¦ä¸²æ‹¼æ¥çš„ä¼˜åŒ–</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>set redis &quot;hello&quot; 
append redis &quot; redis&quot;
-----------------------
set redis &quot;hello redis&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ†å‰²çº¿ä¸Šä¸‹çš„å‘½ä»¤æ•ˆæœæ˜¯ç­‰ä»·çš„ï¼Œæœ€ç»ˆget redis å¾—åˆ°çš„ç»“æœéƒ½æ˜¯&quot;hello redis&quot;ã€‚ä½†è¿™ä¸¤è€…å ç”¨çš„å†…å­˜å¤§å°å´æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå› ä¸ºRedisçš„å­—ç¬¦ä¸²æœ‰ä¸€ä¸ªé¢„åˆ†é…çš„è®¾å®šã€‚å½“æ‰§è¡Œset redis &quot;hello&quot;å‘½ä»¤æ—¶ï¼Œæ­¤æ—¶å†…å­˜ä¸­å­˜å‚¨çš„æ˜¯&quot;hello\0&quot;ï¼Œé»˜è®¤åŠ ä¸€ä¸ª&#39;\0&#39;è¡¨ç¤ºç»“æŸç¬¦ã€‚<strong>å½“æ‰§è¡Œappend redis &quot; redis&quot;å‘½ä»¤ä¹‹åå†…å­˜é‡Œçš„å­˜å‚¨å°±å˜æˆäº†&quot;hello redis\0&quot;ï¼Œé¢å¤–è¿˜å¤šç”³è¯·ä¸€å€çš„ç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´çš„ä¸Šé™æ˜¯1Mï¼Œæ‰€ä»¥å­—æ®µä¸²çš„appendæ“ä½œæ˜¯ä¼šé¢å¤–ç”³è¯·ä¸€ä»½å†…å­˜ç©ºé—´ï¼è¿™æ ·åšçš„åŸå› æ˜¯Redisä½œè€…è®¤ä¸ºå¦‚æœå­—ç¬¦ä¸²ç»å¸¸appendï¼Œä¸å…¶æ¯ä¸€æ¬¡appendé‡æ–°åˆ†é…ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œä¸å¦‚é¢„å…ˆåˆ†é…å¥½ï¼Œä¸‹æ¬¡appendæ—¶å¦‚æœç©ºé—´å¤Ÿç›´æ¥å­˜å‚¨å°±è¡Œäº†ã€‚æ‰€ä»¥å¦‚æœæœ‰å¤§é‡çš„appendå­—ç¬¦ä¸²æ“ä½œï¼Œå¹¶ä¸”å­—ç¬¦ä¸²çš„é•¿åº¦ä¸å¤§çš„è¯ï¼Œè¿˜ä¸å¦‚ç”¨set å‘½ä»¤é‡æ–°è¦†ç›– è¿™æ ·æ¯” appendè¿½åŠ ä¼šæ›´èŠ‚çº¦å†…å­˜ã€‚</strong></p><h3 id="_3-ç¼–ç ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-ç¼–ç ä¼˜åŒ–" aria-hidden="true">#</a> (3)ç¼–ç ä¼˜åŒ–</h3><p>å¯¹äºåŒä¸€ä¸ªæ•°æ®ç±»å‹æ¯”å¦‚hash mapï¼Œæ ¹æ®é”®çš„æ•°é‡å’Œå€¼çš„å¤§å°ä¹Ÿæœ‰ä¸åŒçš„åº•å±‚å®ç°æ–¹å¼ã€‚ä¸¾hash mapæ¥è¯´åº•å±‚çš„ç¼–ç æ–¹å¼æœ‰ä¸¤ç§ï¼šziplistã€hash tableã€‚ä»å†…å­˜å’Œæ•ˆç‡æ¥è¯´ziplisä¸hash tableçš„å…³ç³»æ˜¯</p><p>å†…å­˜ï¼šziplist &lt; hash table æ•ˆç‡ï¼šziplist &lt; hash tableã€‚</p><p>ziplistçš„æ•ˆç‡æ˜¯O(n),hash tableçš„æ•ˆç‡æ˜¯O(1) ä¹Ÿå°±æ˜¯è¯´Redisè¿™é‡Œé‡‡ç”¨çš„æ˜¯ä»¥æ—¶é—´æ¢ç©ºé—´çš„å¥—è·¯ã€‚</p><p><strong>æˆªè‡³redis 4.0 åªè¦hash mapçš„keyçš„æ•°é‡å°äºç­‰äº 512ï¼Œvalueçš„å¤§å°å°äºç­‰äº64å­—èŠ‚ï¼Œhash mapçš„åº•å±‚æ•°æ®ç»“æ„å°±æ˜¯ziplistï¼Œåä¹‹åˆ™æ˜¯hash table</strong>ã€‚</p><p>è¿™æ ·å½“hash mapé‡Œé¢çš„æ•°æ®ä¸æ˜¯å¾ˆå¤šæ—¶ï¼Œç”¨ziplistæ¥å®ç°å³èŠ‚çœäº†å†…å­˜ï¼Œæ•ˆç‡ä¹Ÿä¸ç”¨ä¸‹é™å¾ˆå¤šï¼Œå› ä¸ºæ•°æ®ä¸å¤šã€‚ä½†ç”Ÿäº§ä¸­å¦‚æœæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªhash mapï¼Œå®ƒçš„keyæœ‰512ä¸ªï¼Œvalueæœ‰åªæœ‰ä¸€ä¸ªçš„å¤§å°è¶…è¿‡äº†64å­—èŠ‚ï¼Œåˆšå¥½æ˜¯65ã€‚è¿™ä¸ªæ—¶å€™Redis å°±é»˜è®¤æŠŠziplistæ¢æˆäº†hash tableï¼Œè¿™æ˜¯ä¸æ˜¯å¾ˆå‘ï¼è¿™æ—¶å¯ä»¥è‡ªå·±ä¼˜åŒ–è½¬æ¢è§„åˆ™ï¼šconfig set hash-max-ziplist-entries 65ã€‚è¿™æ ·valueå¤§äº65å­—èŠ‚æ‰è½¬æ¢æˆhash tableã€‚</p><p>æ‰€ä»¥å¤§å®¶å¯ä»¥äº†è§£ä¸€ä¸‹Redisåº•å±‚çš„ç¼–ç å®ç°å’Œè½¬æ¢è§„åˆ™ï¼Œæ ¹æ®å®é™…ä¸šåŠ¡ç‰¹ç‚¹ä¿®æ”¹é…ç½®ã€‚</p><h3 id="_4-ä½¿ç”¨-lazy-free-ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_4-ä½¿ç”¨-lazy-free-ç‰¹æ€§" aria-hidden="true">#</a> (4)ä½¿ç”¨ lazy free ç‰¹æ€§</h3><p>lazy free ç‰¹æ€§æ˜¯ Redis 4.0 æ–°å¢çš„ä¸€ä¸ªéå¸¸ä½¿ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥ç†è§£ä¸ºæƒ°æ€§åˆ é™¤æˆ–å»¶è¿Ÿåˆ é™¤ã€‚æ„æ€æ˜¯åœ¨åˆ é™¤çš„æ—¶å€™æä¾›å¼‚æ­¥å»¶æ—¶é‡Šæ”¾é”®å€¼çš„åŠŸèƒ½ï¼ŒæŠŠé”®å€¼é‡Šæ”¾æ“ä½œæ”¾åœ¨ BIO(Background I/O) å•ç‹¬çš„å­çº¿ç¨‹å¤„ç†ä¸­ï¼Œä»¥å‡å°‘åˆ é™¤åˆ é™¤å¯¹ Redis ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…åˆ é™¤ big key æ—¶å¸¦æ¥çš„æ€§èƒ½å’Œå¯ç”¨æ€§é—®é¢˜ã€‚</p><p>lazy free å¯¹åº”äº† 4 ç§åœºæ™¯ï¼Œé»˜è®¤éƒ½æ˜¯å…³é—­çš„ï¼š</p><ul><li>lazyfree-lazy-evictionï¼šè¡¨ç¤ºå½“ Redis è¿è¡Œå†…å­˜è¶…è¿‡ maxmeory æ—¶ï¼Œæ˜¯å¦å¼€å¯ lazy free æœºåˆ¶åˆ é™¤ï¼›</li><li>lazyfree-lazy-expireï¼šè¡¨ç¤ºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ï¼Œå½“è¿‡æœŸä¹‹åæ˜¯å¦å¼€å¯ lazy free æœºåˆ¶åˆ é™¤ï¼›</li><li>lazyfree-lazy-server-delï¼šæœ‰äº›æŒ‡ä»¤åœ¨å¤„ç†å·²å­˜åœ¨çš„é”®æ—¶ï¼Œä¼šå¸¦æœ‰ä¸€ä¸ªéšå¼çš„ del é”®çš„æ“ä½œï¼Œæ¯”å¦‚ rename å‘½ä»¤ï¼Œå½“ç›®æ ‡é”®å·²å­˜åœ¨ï¼ŒRedis ä¼šå…ˆåˆ é™¤ç›®æ ‡é”®ï¼Œå¦‚æœè¿™äº›ç›®æ ‡é”®æ˜¯ä¸€ä¸ª big keyï¼Œå°±ä¼šé€ æˆé˜»å¡åˆ é™¤çš„é—®é¢˜ï¼Œæ­¤é…ç½®è¡¨ç¤ºåœ¨è¿™ç§åœºæ™¯ä¸­æ˜¯å¦å¼€å¯ lazy free æœºåˆ¶åˆ é™¤ï¼›</li><li>slave-lazy-flushï¼šé’ˆå¯¹ slave(ä»èŠ‚ç‚¹) è¿›è¡Œå…¨é‡æ•°æ®åŒæ­¥ï¼Œslave åœ¨åŠ è½½ master çš„ RDB æ–‡ä»¶å‰ï¼Œä¼šè¿è¡Œ flushall æ¥æ¸…ç†è‡ªå·±çš„æ•°æ®ï¼Œå®ƒè¡¨ç¤ºæ­¤æ—¶æ˜¯å¦å¼€å¯ lazy free æœºåˆ¶åˆ é™¤ã€‚</li></ul><h3 id="_5-è®¾ç½®åˆç†çš„é”®å€¼è¿‡æœŸæ—¶é—´" tabindex="-1"><a class="header-anchor" href="#_5-è®¾ç½®åˆç†çš„é”®å€¼è¿‡æœŸæ—¶é—´" aria-hidden="true">#</a> (5)è®¾ç½®åˆç†çš„é”®å€¼è¿‡æœŸæ—¶é—´</h3><p>æˆ‘ä»¬åº”è¯¥æ ¹æ®å®é™…çš„ä¸šåŠ¡æƒ…å†µï¼Œå¯¹é”®å€¼è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ · Redis ä¼šå¸®ä½ è‡ªåŠ¨æ¸…é™¤è¿‡æœŸçš„é”®å€¼å¯¹ï¼Œä»¥èŠ‚çº¦å¯¹å†…å­˜çš„å ç”¨ï¼Œä»¥é¿å…é”®å€¼è¿‡å¤šçš„å †ç§¯ï¼Œé¢‘ç¹çš„è§¦å‘å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚</p><h3 id="_6-ç¦ç”¨é•¿è€—æ—¶çš„æŸ¥è¯¢å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_6-ç¦ç”¨é•¿è€—æ—¶çš„æŸ¥è¯¢å‘½ä»¤" aria-hidden="true">#</a> (6)ç¦ç”¨é•¿è€—æ—¶çš„æŸ¥è¯¢å‘½ä»¤</h3><p>Redis ç»å¤§å¤šæ•°è¯»å†™å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦éƒ½åœ¨ O(1) åˆ° O(N) ä¹‹é—´ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£å¯¹æ¯å‘½ä»¤éƒ½æœ‰æ—¶é—´å¤æ‚åº¦è¯´æ˜ã€‚</p><p>å…¶ä¸­ O(1) è¡¨ç¤ºå¯ä»¥å®‰å…¨ä½¿ç”¨çš„ï¼Œè€Œ O(N) å°±åº”è¯¥å½“å¿ƒäº†ï¼ŒN è¡¨ç¤ºä¸ç¡®å®šï¼Œæ•°æ®è¶Šå¤§æŸ¥è¯¢çš„é€Ÿåº¦å¯èƒ½ä¼šè¶Šæ…¢ã€‚å› ä¸º Redis åªç”¨ä¸€ä¸ªçº¿ç¨‹æ¥åšæ•°æ®æŸ¥è¯¢ï¼Œå¦‚æœè¿™äº›æŒ‡ä»¤è€—æ—¶å¾ˆé•¿ï¼Œå°±ä¼šé˜»å¡ Redisï¼Œé€ æˆå¤§é‡å»¶æ—¶ã€‚</p><p>è¦é¿å… O(N) å‘½ä»¤å¯¹ Redis é€ æˆçš„å½±å“ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹æ”¹é€ ï¼š</p><ul><li>ç¦æ­¢ä½¿ç”¨ keys å‘½ä»¤ï¼›</li><li>é¿å…ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰çš„æˆå‘˜ï¼Œè¦ä½¿ç”¨ scan å‘½ä»¤è¿›è¡Œåˆ†æ‰¹çš„ï¼Œæ¸¸æ ‡å¼çš„éå†ï¼›</li><li>é€šè¿‡æœºåˆ¶ä¸¥æ ¼æ§åˆ¶ Hashã€Setã€Sorted Set ç­‰ç»“æ„çš„æ•°æ®å¤§å°ï¼›</li><li>å°†æ’åºã€å¹¶é›†ã€äº¤é›†ç­‰æ“ä½œæ”¾åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œä»¥å‡å°‘ Redis æœåŠ¡å™¨è¿è¡Œå‹åŠ›ï¼›</li><li>åˆ é™¤ (del) ä¸€ä¸ªå¤§æ•°æ®çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®ç”¨å¼‚æ­¥åˆ é™¤çš„æ–¹å¼ unlinkï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥åˆ é™¤ç›®æ ‡æ•°æ®ï¼Œè€Œä¸é˜»å¡ Redis çš„ä¸»çº¿ç¨‹ã€‚</li></ul><h3 id="_7-ä½¿ç”¨-slowlog-ä¼˜åŒ–è€—æ—¶å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_7-ä½¿ç”¨-slowlog-ä¼˜åŒ–è€—æ—¶å‘½ä»¤" aria-hidden="true">#</a> (7)ä½¿ç”¨ slowlog ä¼˜åŒ–è€—æ—¶å‘½ä»¤</h3><p>ä½¿ç”¨ slowlog åŠŸèƒ½æ‰¾å‡ºæœ€è€—æ—¶çš„ Redis å‘½ä»¤è¿›è¡Œç›¸å…³çš„ä¼˜åŒ–ï¼Œä»¥æå‡ Redis çš„è¿è¡Œé€Ÿåº¦ï¼Œæ…¢æŸ¥è¯¢æœ‰ä¸¤ä¸ªé‡è¦çš„é…ç½®é¡¹ï¼š</p><ul><li>slowlog-log-slower-than ï¼šç”¨äºè®¾ç½®æ…¢æŸ¥è¯¢çš„è¯„å®šæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´è¶…è¿‡æ­¤é…ç½®é¡¹çš„å‘½ä»¤ï¼Œå°†ä¼šè¢«å½“æˆæ…¢æ“ä½œè®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œå®ƒæ‰§è¡Œå•ä½æ˜¯å¾®ç§’ (1 ç§’ç­‰äº 1000000 å¾®ç§’)ï¼›</li><li>slowlog-max-len ï¼šç”¨æ¥é…ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æœ€å¤§è®°å½•æ•°ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡æƒ…å†µè¿›è¡Œç›¸åº”çš„é…ç½®ï¼Œå…¶ä¸­æ…¢æ—¥å¿—æ˜¯æŒ‰ç…§æ’å…¥çš„é¡ºåºå€’åºå­˜å…¥æ…¢æŸ¥ è¯¢æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ slowlog get n æ¥è·å–ç›¸å…³çš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå†æ‰¾åˆ°è¿™äº›æ…¢æŸ¥è¯¢å¯¹åº”çš„ä¸šåŠ¡è¿›è¡Œç›¸å…³çš„ä¼˜åŒ–ã€‚</p><h3 id="_8-ä½¿ç”¨-pipeline-æ‰¹é‡æ“ä½œæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_8-ä½¿ç”¨-pipeline-æ‰¹é‡æ“ä½œæ•°æ®" aria-hidden="true">#</a> (8)ä½¿ç”¨ Pipeline æ‰¹é‡æ“ä½œæ•°æ®</h3><p>Pipeline (ç®¡é“æŠ€æœ¯) æ˜¯å®¢æˆ·ç«¯æä¾›çš„ä¸€ç§æ‰¹å¤„ç†æŠ€æœ¯ï¼Œç”¨äºä¸€æ¬¡å¤„ç†å¤šä¸ª Redis å‘½ä»¤ï¼Œä»è€Œæé«˜æ•´ä¸ªäº¤äº’çš„æ€§èƒ½ã€‚</p><h3 id="_9-é¿å…å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#_9-é¿å…å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ" aria-hidden="true">#</a> (9)é¿å…å¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ</h3><p>Redis è¿‡æœŸé”®å€¼åˆ é™¤ä½¿ç”¨çš„æ˜¯è´ªå¿ƒç­–ç•¥ï¼Œå®ƒæ¯ç§’ä¼šè¿›è¡Œ 10 æ¬¡è¿‡æœŸæ‰«æï¼Œæ­¤é…ç½®å¯åœ¨ redis.conf è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å€¼æ˜¯ hz 10ï¼ŒRedis ä¼šéšæœºæŠ½å– 20 ä¸ªå€¼ï¼Œåˆ é™¤è¿™ 20 ä¸ªé”®ä¸­è¿‡æœŸçš„é”®ï¼Œå¦‚æœè¿‡æœŸ key çš„æ¯”ä¾‹è¶…è¿‡ 25% ï¼Œé‡å¤æ‰§è¡Œæ­¤æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/assets/20210629094825-93b9c7d8.png" alt="è¿‡æœŸåˆ é™¤é”®æµç¨‹" style="zoom:50%;"><p>å¦‚æœåœ¨å¤§å‹ç³»ç»Ÿä¸­æœ‰å¤§é‡ç¼“å­˜åœ¨åŒä¸€æ—¶é—´åŒæ—¶è¿‡æœŸï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ Redis å¾ªç¯å¤šæ¬¡æŒç»­æ‰«æåˆ é™¤è¿‡æœŸå­—å…¸ï¼Œç›´åˆ°è¿‡æœŸå­—å…¸ä¸­è¿‡æœŸé”®å€¼è¢«åˆ é™¤çš„æ¯”è¾ƒç¨€ç–ä¸ºæ­¢ï¼Œè€Œåœ¨æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¼šå¯¼è‡´ Redis çš„è¯»å†™å‡ºç°æ˜æ˜¾çš„å¡é¡¿ï¼Œå¡é¡¿çš„å¦ä¸€ç§åŸå› æ˜¯å†…å­˜ç®¡ç†å™¨éœ€è¦é¢‘ç¹å›æ”¶å†…å­˜é¡µï¼Œå› æ­¤ä¹Ÿä¼šæ¶ˆè€—ä¸€å®šçš„ CPUã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§å¡é¡¿ç°è±¡çš„äº§ç”Ÿï¼Œéœ€è¦é¢„é˜²å¤§é‡çš„ç¼“å­˜åœ¨åŒä¸€æ—¶åˆ»ä¸€èµ·è¿‡æœŸï¼Œå°±ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨è¿‡æœŸæ—¶é—´çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªæŒ‡å®šèŒƒå›´çš„éšæœºæ•°ã€‚</p><h3 id="_10-redis-è¿æ¥æ± " tabindex="-1"><a class="header-anchor" href="#_10-redis-è¿æ¥æ± " aria-hidden="true">#</a> (10)Redis è¿æ¥æ± </h3><p>åœ¨å®¢æˆ·ç«¯çš„ä½¿ç”¨ä¸Šæˆ‘ä»¬é™¤äº†è¦å°½é‡ä½¿ç”¨ Pipeline çš„æŠ€æœ¯å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„è¦å°½é‡ä½¿ç”¨ Redis è¿æ¥æ± ï¼Œè€Œä¸æ˜¯é¢‘ç¹åˆ›å»ºé”€æ¯ Redis è¿æ¥ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“æ¬¡æ•°å’Œå‡å°‘äº†éå¿…è¦è°ƒç”¨æŒ‡ä»¤ã€‚</p><h3 id="_11-é™åˆ¶-redis-å†…å­˜å¤§å°-ä½¿ç”¨åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_11-é™åˆ¶-redis-å†…å­˜å¤§å°-ä½¿ç”¨åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥" aria-hidden="true">#</a> (11)é™åˆ¶ Redis å†…å­˜å¤§å°ï¼Œä½¿ç”¨åˆç†çš„å†…å­˜æ·˜æ±°ç­–ç•¥</h3><p>å‚çœ‹å†…å­˜æ·˜æ±°ç­–ç•¥</p><h3 id="_12-ä½¿ç”¨ç‰©ç†æœºè€Œéè™šæ‹Ÿæœº" tabindex="-1"><a class="header-anchor" href="#_12-ä½¿ç”¨ç‰©ç†æœºè€Œéè™šæ‹Ÿæœº" aria-hidden="true">#</a> (12)ä½¿ç”¨ç‰©ç†æœºè€Œéè™šæ‹Ÿæœº</h3><p>å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜å¯è€ƒè™‘åœ¨ç‰©ç†æœºç›´æ¥éƒ¨ç½²Redisè€Œä¸æ˜¯ä½¿ç”¨è™šæ‹Ÿæœºã€‚</p><p>åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œ Redis æœåŠ¡å™¨ï¼Œå› ä¸ºå’Œç‰©ç†æœºå…±äº«ä¸€ä¸ªç‰©ç†ç½‘å£ï¼Œå¹¶ä¸”ä¸€å°ç‰©ç†æœºå¯èƒ½æœ‰å¤šä¸ªè™šæ‹Ÿæœºåœ¨è¿è¡Œï¼Œå› æ­¤åœ¨å†…å­˜å ç”¨ä¸Šå’Œç½‘ç»œå»¶è¿Ÿæ–¹é¢éƒ½ä¼šæœ‰å¾ˆç³Ÿç³•çš„è¡¨ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ./redis-cli --intrinsic-latency 100 å‘½ä»¤æŸ¥çœ‹å»¶è¿Ÿæ—¶é—´ï¼Œå¦‚æœå¯¹ Redis çš„æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚çš„è¯ï¼Œåº”å°½å¯èƒ½åœ¨ç‰©ç†æœºä¸Šç›´æ¥éƒ¨ç½² Redis æœåŠ¡å™¨ã€‚</p><h3 id="_13-ä½¿ç”¨åˆç†çš„æŒä¹…åŒ–ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_13-ä½¿ç”¨åˆç†çš„æŒä¹…åŒ–ç­–ç•¥" aria-hidden="true">#</a> (13)ä½¿ç”¨åˆç†çš„æŒä¹…åŒ–ç­–ç•¥</h3><p>å‚çœ‹æŒä¹…åŒ–ç­–ç•¥</p><h3 id="_14-ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„æ¥å¢åŠ è¯»å†™é€Ÿåº¦" tabindex="-1"><a class="header-anchor" href="#_14-ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„æ¥å¢åŠ è¯»å†™é€Ÿåº¦" aria-hidden="true">#</a> (14)ä½¿ç”¨åˆ†å¸ƒå¼æ¶æ„æ¥å¢åŠ è¯»å†™é€Ÿåº¦</h3><p>Redis åˆ†å¸ƒå¼æ¶æ„æœ‰ä¸‰ä¸ªé‡è¦çš„æ‰‹æ®µï¼š</p><ul><li>ä¸»ä»åŒæ­¥</li><li>å“¨å…µæ¨¡å¼</li><li>Redis Cluster é›†ç¾¤</li></ul><p>ä½¿ç”¨ä¸»ä»åŒæ­¥åŠŸèƒ½æˆ‘ä»¬å¯ä»¥æŠŠå†™å…¥æ”¾åˆ°ä¸»åº“ä¸Šæ‰§è¡Œï¼ŒæŠŠè¯»åŠŸèƒ½è½¬ç§»åˆ°ä»æœåŠ¡ä¸Šï¼Œå› æ­¤å°±å¯ä»¥åœ¨å•ä½æ—¶é—´å†…å¤„ç†æ›´å¤šçš„è¯·æ±‚ï¼Œä»è€Œæå‡çš„ Redis æ•´ä½“çš„è¿è¡Œé€Ÿåº¦ã€‚</p><p>è€Œå“¨å…µæ¨¡å¼æ˜¯å¯¹äºä¸»ä»åŠŸèƒ½çš„å‡çº§ï¼Œä½†å½“ä¸»èŠ‚ç‚¹å¥”æºƒä¹‹åï¼Œæ— éœ€äººå·¥å¹²é¢„å°±èƒ½è‡ªåŠ¨æ¢å¤ Redis çš„æ­£å¸¸ä½¿ç”¨ã€‚</p><p>Redis Cluster æ˜¯ Redis 3.0 æ­£å¼æ¨å‡ºçš„ï¼ŒRedis é›†ç¾¤æ˜¯é€šè¿‡å°†æ•°æ®åº“åˆ†æ•£å­˜å‚¨åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šæ¥å¹³è¡¡å„ä¸ªèŠ‚ç‚¹çš„è´Ÿè½½å‹åŠ›ã€‚</p><p>Redis Cluster é‡‡ç”¨è™šæ‹Ÿå“ˆå¸Œæ§½åˆ†åŒºï¼Œæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ° 0 ~ 16383 æ•´æ•°æ§½å†…ï¼Œè®¡ç®—å…¬å¼ï¼šslot = CRC16(key) &amp; 16383ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚è¿™æ · Redis å°±å¯ä»¥æŠŠè¯»å†™å‹åŠ›ä»ä¸€å°æœåŠ¡å™¨ï¼Œåˆ†æ•£ç»™å¤šå°æœåŠ¡å™¨äº†ï¼Œå› æ­¤æ€§èƒ½ä¼šæœ‰å¾ˆå¤§çš„æå‡ã€‚</p><p>åœ¨è¿™ä¸‰ä¸ªåŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªå°±è¡Œäº†ï¼Œæ¯«æ— ç–‘é—® Redis Cluster åº”è¯¥æ˜¯é¦–é€‰çš„å®ç°æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥æŠŠè¯»å†™å‹åŠ›è‡ªåŠ¨çš„åˆ†æ‹…ç»™æ›´å¤šçš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‹¥æœ‰è‡ªåŠ¨å®¹ç¾çš„èƒ½åŠ›ã€‚</p><h2 id="_12-redisçº¿ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_12-redisçº¿ç¨‹æ¨¡å‹" aria-hidden="true">#</a> 12. Redisçº¿ç¨‹æ¨¡å‹</h2><h3 id="_12-1-çº¿ç¨‹æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_12-1-çº¿ç¨‹æ¨¡å‹" aria-hidden="true">#</a> 12.1 çº¿ç¨‹æ¨¡å‹</h3><p><strong>Redis åŸºäº Reactor æ¨¡å¼æ¥è®¾è®¡å¼€å‘äº†è‡ªå·±çš„ä¸€å¥—é«˜æ•ˆçš„äº‹ä»¶å¤„ç†æ¨¡å‹</strong> (Netty çš„çº¿ç¨‹æ¨¡å‹ä¹ŸåŸºäº Reactor æ¨¡å¼ï¼ŒReactor æ¨¡å¼ä¸æ„§æ˜¯é«˜æ€§èƒ½ IO çš„åŸºçŸ³)ã€‚</p><p>Rediså†…éƒ¨ä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨file event handlerï¼Œè¿™ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„æ‰€ä»¥redisæ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡ç”¨IOå¤šè·¯å¤ç”¨æœºåˆ¶åŒæ—¶ç›‘å¬å¤šä¸ªsocketï¼Œå°†äº§ç”Ÿäº‹ä»¶çš„socketå‹å…¥åˆ°å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ ¹æ®socketä¸Šçš„äº‹ä»¶ç±»å‹æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨æ¥è¿›è¡Œå¤„ç†ã€‚</p><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨åŒ…å«4ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¤šä¸ªsocket</li><li>IOå¤šè·¯å¤ç”¨ç¨‹åº</li><li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨</li><li>äº‹ä»¶å¤„ç†å™¨(è¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨)</li></ul><p>Redis é€šè¿‡<strong>IO å¤šè·¯å¤ç”¨ç¨‹åº</strong> æ¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥(æˆ–è€…è¯´æ˜¯ç›‘å¬å¤šä¸ª socket)ï¼Œå®ƒä¼šå°†æ„Ÿå…´è¶£çš„äº‹ä»¶åŠç±»å‹(è¯»ã€å†™)æ³¨å†Œåˆ°å†…æ ¸ä¸­å¹¶ç›‘å¬æ¯ä¸ªäº‹ä»¶æ˜¯å¦å‘ç”Ÿã€‚</p><p>è¿™æ ·çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š <strong>I/O å¤šè·¯å¤ç”¨æŠ€æœ¯çš„ä½¿ç”¨è®© Redis ä¸éœ€è¦é¢å¤–åˆ›å»ºå¤šä½™çš„çº¿ç¨‹æ¥ç›‘å¬å®¢æˆ·ç«¯çš„å¤§é‡è¿æ¥ï¼Œé™ä½äº†èµ„æºçš„æ¶ˆè€—</strong>(å’Œ NIO ä¸­çš„ <code>Selector</code> ç»„ä»¶å¾ˆåƒ)ã€‚</p><p><strong>å®¢æˆ·ç«¯ä¸redisçš„ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ï¼š</strong></p><figure><img src="/assets/20210629104510-d1e6d3ed.png" alt="Redisçº¿ç¨‹æ¨¡å‹" tabindex="0" loading="lazy"><figcaption>Redisçº¿ç¨‹æ¨¡å‹</figcaption></figure><ol><li>å®¢æˆ·ç«¯å‘èµ·å»ºç«‹è¿æ¥çš„è¯·æ±‚ã€‚ <ol><li>æœåŠ¡ç«¯ä¼šäº§ç”Ÿä¸€ä¸ª<strong>AE_READABLE</strong>äº‹ä»¶ï¼Œ<strong>IOå¤šè·¯å¤ç”¨ç¨‹åº</strong>æ¥æ”¶åˆ°server socketäº‹ä»¶åï¼Œå°†è¯¥socketå‹å…¥é˜Ÿåˆ—ä¸­ã€‚</li><li><strong>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨</strong>ä»é˜Ÿåˆ—ä¸­è·å–socketï¼Œäº¤ç»™<strong>è¿æ¥åº”ç­”å¤„ç†å™¨</strong>ï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥å’Œå®¢æˆ·ç«¯äº¤æµçš„socket01ã€‚</li><li>å°†socket01çš„<strong>AE_READABLE</strong>äº‹ä»¶ä¸<strong>å‘½ä»¤è¯·æ±‚å¤„ç†å™¨</strong>å…³è”ã€‚</li></ol></li><li>å®¢æˆ·ç«¯å‘èµ·set key valueè¯·æ±‚ã€‚ <ol><li>socket01äº§ç”Ÿ<strong>AE_READABLE</strong>äº‹ä»¶ï¼Œsocket01å‹å…¥é˜Ÿåˆ—ã€‚</li><li>å°†è·å–åˆ°çš„socket01ä¸<strong>å‘½ä»¤è¯·æ±‚å¤„ç†å™¨</strong>å…³è”ã€‚</li><li><strong>å‘½ä»¤è¯·æ±‚å¤„ç†å™¨</strong>è¯»å–socket01ä¸­çš„key valueï¼Œå¹¶åœ¨å†…å­˜ä¸­å®Œæˆå¯¹åº”çš„è®¾ç½®ã€‚</li><li>å°†socket01çš„AE_WRITABLEäº‹ä»¶ä¸å‘½ä»¤å›å¤å¤„ç†å™¨å…³è”ã€‚</li></ol></li><li>æœåŠ¡ç«¯è¿”å›ç»“æœã€‚ <ol><li>redisä¸­çš„socket01ä¼šäº§ç”Ÿä¸€ä¸ª<strong>AE_WRITABLE</strong>äº‹ä»¶ï¼Œå‹å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</li><li>å°†è·å–åˆ°çš„socket01ä¸<strong>å‘½ä»¤å›å¤å¤„ç†å™¨</strong>å…³è”ã€‚</li><li><strong>å‘½ä»¤å›å¤å¤„ç†å™¨</strong>å¯¹socket01è¾“å…¥æ“ä½œç»“æœï¼Œæ¯”å¦‚okã€‚ä¹‹åè§£é™¤socket01çš„<strong>AE_WRITABLE</strong>äº‹ä»¶ä¸<strong>å‘½ä»¤å›å¤å¤„ç†å™¨</strong>çš„å…³è”ã€‚</li></ol></li></ol><h3 id="_12-2-redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" tabindex="-1"><a class="header-anchor" href="#_12-2-redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" aria-hidden="true">#</a> 12.2 Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ</h3><ol><li>çº¯å†…å­˜æ“ä½œï¼Œé¿å…å¤§é‡è®¿é—®æ•°æ®åº“ï¼Œå‡å°‘ç›´æ¥è¯»å–ç£ç›˜æ•°æ®ï¼Œrediså°†æ•°æ®å‚¨å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œè¯»å†™æ•°æ®çš„æ—¶å€™éƒ½ä¸ä¼šå—åˆ°ç¡¬ç›˜ I/O é€Ÿåº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«</li><li>å•çº¿ç¨‹æ“ä½œï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€—CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ã€‚(Redis6.0å¼•å…¥äº†å¤šçº¿ç¨‹)</li><li>é‡‡ç”¨äº†éé˜»å¡I/Oå¤šè·¯å¤ç”¨æœºåˆ¶</li><li>Cè¯­è¨€å®ç°ï¼Œè·ç¦»æ“ä½œç³»ç»Ÿæ›´è¿‘ï¼Œæ‰§è¡Œé€Ÿåº¦ä¼šæ›´å¿«ã€‚</li></ol><h3 id="_12-3-redisçš„éé˜»å¡ioå¤šè·¯å¤ç”¨æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_12-3-redisçš„éé˜»å¡ioå¤šè·¯å¤ç”¨æ¨¡å‹" aria-hidden="true">#</a> 12.3 Redisçš„éé˜»å¡IOå¤šè·¯å¤ç”¨æ¨¡å‹</h3><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ï¼šç»„æˆç»“æ„ï¼šå¤šä¸ªå¥—æ¥å­—ã€IOå¤šè·¯å¤ç”¨ç¨‹åºã€æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ã€äº‹ä»¶å¤„ç†å™¨</p><figure><img src="/assets/202111251639666-0d40d2f1.png" alt="è¯¦è§£Rediséé˜»å¡ioå¤šè·¯å¤ç”¨çº¿ç¨‹æ¨¡å‹" tabindex="0" loading="lazy"><figcaption>è¯¦è§£Rediséé˜»å¡ioå¤šè·¯å¤ç”¨çº¿ç¨‹æ¨¡å‹</figcaption></figure><p>Rediså®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯çš„è°ƒç”¨åˆ†ä¸ºå‘é€å‘½ä»¤ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›ç»“æœä¸‰ä¸ªè¿‡ç¨‹ã€‚</p><ol><li><p>I/Oå¤šè·¯å¤ç”¨(multiplexing)ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªå¥—æ¥å­—ï¼Œå¹¶å…³è”ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨ã€‚</p></li><li><p>å½“è¢«ç›‘å¬çš„å¥—æ¥å­—å‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”(accept)ã€è¯»å–(read)ã€å†™å…¥(write)ã€å…³é—­(close)ç­‰æ“ä½œæ—¶ï¼Œ äº§ç”Ÿäºæ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶ã€‚</p></li><li><p>å¤šä¸ªæ–‡ä»¶äº‹ä»¶å¯èƒ½ä¼šå¹¶å‘åœ°å‡ºç°ï¼Œå°†äº§ç”Ÿæ—¶é—´çš„å¥—æ¥å­—æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œæœ‰åºã€åŒæ­¥ã€æ¯æ¬¡ä¸€ä¸ªå¥—æ¥å­—çš„æ–¹å¼å°†æ–‡ä»¶äº‹ä»¶å‘é€ç»™æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ã€‚</p></li><li><p>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨å°†äº‹ä»¶åˆ†æ´¾ç»™å¯¹åº”å¤„ç†å™¨å¤„ç†ã€‚</p></li><li><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å®Œæ¯•åï¼Œé€šè¿‡å¥—æ¥å­—è¿”å›ã€‚</p></li></ol><p>Redisä¸ºæ–‡ä»¶äº‹ä»¶ç¼–å†™äº†å¤šä¸ªå¤„ç†å™¨ï¼Œåˆ†åˆ«ä¸ºsocketå…³è”è¿æ¥ã€å‘½ä»¤è¯·æ±‚ã€å‘½ä»¤å›å¤å¤„ç†å™¨ç­‰ã€‚</p><h3 id="_12-4-redis6-0-ä¹‹å‰-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_12-4-redis6-0-ä¹‹å‰-ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹" aria-hidden="true">#</a> 12.4 Redis6.0 ä¹‹å‰ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</h3><p><strong>Redisä¸­åªæœ‰ç½‘ç»œè¯·æ±‚æ¨¡å—å’Œæ•°æ®æ“ä½œæ¨¡å—æ˜¯å•çº¿ç¨‹çš„ã€‚è€Œå…¶ä»–çš„å¦‚æŒä¹…åŒ–å­˜å‚¨æ¨¡å—ã€é›†ç¾¤æ”¯æ’‘æ¨¡å—ç­‰æ˜¯å¤šçº¿ç¨‹çš„ã€‚</strong></p><p>Redisä¸­å¹¶ä¸æ˜¯æ²¡æœ‰å¤šçº¿ç¨‹æ¨¡å‹çš„ï¼Œæ—©åœ¨Redis 4.0çš„æ—¶å€™å°±å·²ç»é’ˆå¯¹éƒ¨åˆ†å‘½ä»¤åšäº†å¤šçº¿ç¨‹åŒ–ã€‚</p><ol><li>å•çº¿ç¨‹ç¼–ç¨‹å®¹æ˜“å¹¶ä¸”æ›´å®¹æ˜“ç»´æŠ¤ï¼›</li><li>Redis çš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ï¼Œä¸»è¦åœ¨å†…å­˜å’Œç½‘ç»œï¼›</li><li>å¤šçº¿ç¨‹å°±ä¼šå­˜åœ¨æ­»é”ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰é—®é¢˜ï¼Œç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚</li></ol><p>å‚çœ‹ï¼š<a href="https://draveness.me/whys-the-design-redis-single-thread/" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆ Redis é€‰æ‹©å•çº¿ç¨‹æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_12-5-redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_12-5-redis6-0-ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹" aria-hidden="true">#</a> 12.5 Redis6.0 ä¹‹åä¸ºä½•å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Ÿ</h3><p><strong>Redis6.0 å¼•å…¥å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ç½‘ç»œ IO è¯»å†™æ€§èƒ½</strong>ï¼Œå› ä¸ºè¿™ä¸ªç®—æ˜¯ Redis ä¸­çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆ(Redis çš„ç“¶é¢ˆä¸»è¦å—é™äºå†…å­˜å’Œç½‘ç»œ)ã€‚</p><p>è™½ç„¶ï¼ŒRedis6.0 å¼•å…¥äº†å¤šçº¿ç¨‹ï¼Œä½†æ˜¯ Redis çš„å¤šçº¿ç¨‹åªæ˜¯åœ¨ç½‘ç»œæ•°æ®çš„è¯»å†™è¿™ç±»è€—æ—¶æ“ä½œä¸Šä½¿ç”¨äº†ï¼Œ æ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚å› æ­¤ï¼Œä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>Redis6.0 çš„å¤šçº¿ç¨‹é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œåªä½¿ç”¨ä¸»çº¿ç¨‹ã€‚å¦‚éœ€å¼€å¯éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ <code>redis.conf</code> ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>io-threads-do-reads yesCopy to clipboardErrorCopied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¼€å¯å¤šçº¿ç¨‹åï¼Œè¿˜éœ€è¦è®¾ç½®çº¿ç¨‹æ•°ï¼Œå¦åˆ™æ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚åŒæ ·éœ€è¦ä¿®æ”¹ redis é…ç½®æ–‡ä»¶ <code>redis.conf</code> :</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>io-threads <span class="token number">4</span> <span class="token comment">#å®˜ç½‘å»ºè®®4æ ¸çš„æœºå™¨å»ºè®®è®¾ç½®ä¸º2æˆ–3ä¸ªçº¿ç¨‹ï¼Œ8æ ¸çš„å»ºè®®è®¾ç½®ä¸º6ä¸ªçº¿ç¨‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‚çœ‹ï¼š</p><ul><li><a href="https://mp.weixin.qq.com/s/FZu3acwK6zrCBZQ_3HoUgw" target="_blank" rel="noopener noreferrer">Redis 6.0 æ–°ç‰¹æ€§-å¤šçº¿ç¨‹è¿ç¯13é—®ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/357343339" target="_blank" rel="noopener noreferrer">Redisä¸æ˜¯ä¸€ç›´å·ç§°å•çº¿ç¨‹æ•ˆç‡ä¹Ÿå¾ˆé«˜å—ï¼Œä¸ºä»€ä¹ˆåˆé‡‡ç”¨å¤šçº¿ç¨‹äº†ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="_13-redisäº‹åŠ¡" tabindex="-1"><a class="header-anchor" href="#_13-redisäº‹åŠ¡" aria-hidden="true">#</a> 13. Redisäº‹åŠ¡</h2><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œ:äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­,ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p><p>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ:äº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆå…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚</p><h3 id="_13-1-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_13-1-å®ç°åŸç†" aria-hidden="true">#</a> 13.1 å®ç°åŸç†</h3><p>Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p><p>Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ <strong>ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿ</strong>ã€‚</p><p>Redis çš„é€šè¿‡ <code>MULTI</code>ï¼Œ<code>EXEC</code>ï¼Œ<code>DISCARD</code> å’Œ <code>WATCH</code> è¿™å››ä¸ªå‘½ä»¤æ¥å®ç°äº‹åŠ¡çš„ï¼ŒRedis çš„å•ä¸ªå‘½ä»¤éƒ½æ˜¯<strong>åŸå­æ€§</strong>çš„ã€‚</p><p><strong>ä¸‰ä¸ªé˜¶æ®µ(äº‹åŠ¡å¼€å§‹ã€å‘½ä»¤å…¥é˜Ÿã€äº‹åŠ¡æ‰§è¡Œ)</strong>ï¼š</p><ol><li><p>ä½¿ç”¨ <code>MULTI</code>å‘½ä»¤åå¯ä»¥è¾“å…¥å¤šä¸ªå‘½ä»¤ã€‚Redis ä¸ä¼šç«‹å³æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬æ”¾åˆ°é˜Ÿåˆ—ï¼Œå½“è°ƒç”¨äº†<a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å‘½ä»¤å°†æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å¼€å§‹äº‹åŠ¡(<code>MULTI</code>)ã€‚</li><li>å‘½ä»¤å…¥é˜Ÿ(æ‰¹é‡æ“ä½œ Redis çš„å‘½ä»¤ï¼Œå…ˆè¿›å…ˆå‡º(FIFO)çš„é¡ºåºæ‰§è¡Œ)ã€‚</li><li>æ‰§è¡Œäº‹åŠ¡(<code>EXEC</code>)ã€‚</li></ol></li><li><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>DISCARD</code>å‘½ä»¤å–æ¶ˆä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä¼šæ¸…ç©ºäº‹åŠ¡é˜Ÿåˆ—ä¸­ä¿å­˜çš„æ‰€æœ‰å‘½ä»¤ã€‚</p></li><li><p><code>WATCH</code> å‘½ä»¤ç”¨äºç›‘å¬æŒ‡å®šçš„é”®ï¼Œå½“è°ƒç”¨ <code>EXEC</code> å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ—¶ï¼Œå¦‚æœä¸€ä¸ªè¢« <code>WATCH</code> å‘½ä»¤ç›‘è§†çš„é”®è¢«ä¿®æ”¹çš„è¯ï¼Œæ•´ä¸ªäº‹åŠ¡éƒ½ä¸ä¼šæ‰§è¡Œï¼Œç›´æ¥è¿”å›å¤±è´¥ã€‚</p></li><li><p>è°ƒç”¨äº†<a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å‘½ä»¤å°†æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ã€‚</p></li></ol><p>å¯ä»¥å°† Redis ä¸­çš„äº‹åŠ¡å°±ç†è§£ä¸º ï¼š<strong>Redis äº‹åŠ¡æä¾›äº†ä¸€ç§å°†å¤šä¸ªå‘½ä»¤è¯·æ±‚æ‰“åŒ…çš„åŠŸèƒ½ã€‚ç„¶åï¼Œå†æŒ‰é¡ºåºæ‰§è¡Œæ‰“åŒ…çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶ä¸”ä¸ä¼šè¢«ä¸­é€”æ‰“æ–­ã€‚</strong></p><p>åŸç†åˆ†æå¯å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/144268090" target="_blank" rel="noopener noreferrer">é«˜é¢‘Redisé¢è¯•é¢˜è§£æï¼šRedis äº‹åŠ¡æ˜¯å¦å…·å¤‡åŸå­æ€§ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_13-2-äº‹åŠ¡çš„å››å¤§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#_13-2-äº‹åŠ¡çš„å››å¤§ç‰¹æ€§" aria-hidden="true">#</a> 13.2 äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</h3><ol><li><strong>åŸå­æ€§(Atomicity)ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</li><li><strong>éš”ç¦»æ€§(Isolation)ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹åŠ¡ä¸è¢«å…¶ä»–äº‹åŠ¡æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</li><li><strong>æŒä¹…æ€§(Durability)ï¼š</strong> ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</li><li><strong>ä¸€è‡´æ€§(Consistency)ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®è¯»å–çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼›</li></ol><h3 id="_14-3-redis-æ˜¯ä¸æ”¯æŒ-roll-back-çš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_14-3-redis-æ˜¯ä¸æ”¯æŒ-roll-back-çš„åŸå› " aria-hidden="true">#</a> 14.3 Redis æ˜¯ä¸æ”¯æŒ roll back çš„åŸå› </h3><ol><li>å¤§å¤šæ•°äº‹åŠ¡å¤±è´¥æ˜¯å› ä¸º<strong>è¯­æ³•é”™è¯¯æˆ–è€…ç±»å‹é”™è¯¯</strong>ï¼Œè¿™ä¸¤ç§é”™è¯¯ï¼Œåœ¨å¼€å‘é˜¶æ®µéƒ½æ˜¯å¯ä»¥é¢„è§çš„ã€‚</li><li>Redis ä¸ºäº†<strong>æ€§èƒ½æ–¹é¢</strong>å°±å¿½ç•¥äº†äº‹åŠ¡å›æ»šã€‚</li></ol><h3 id="_14-4-äº‹åŠ¡å¤±è´¥å¤„ç†-æ˜¯å¦ä¿è¯åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#_14-4-äº‹åŠ¡å¤±è´¥å¤„ç†-æ˜¯å¦ä¿è¯åŸå­æ€§" aria-hidden="true">#</a> 14.4 äº‹åŠ¡å¤±è´¥å¤„ç†(æ˜¯å¦ä¿è¯åŸå­æ€§)</h3><ol><li>Redis è¯­æ³•é”™è¯¯(å¯ä»¥ç†è§£ä¸º<strong>ç¼–è¯‘æœŸé”™è¯¯</strong>)</li></ol><p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå½“å‘½ä»¤å‡ºç°é”™è¯¯æ—¶ï¼Œåç»­å‘½ä»¤æ­£ç¡®ä¾æ—§æ˜¯å¯ä»¥æ·»åŠ åˆ°å‘½ä»¤é˜Ÿåˆ—ä¸­å»å¾—ï¼Œä½†æ˜¯ä½¿ç”¨ EXEC å‘½ä»¤æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”<strong>é˜Ÿåˆ—ä¸­æ­£ç¡®çš„å‘½ä»¤ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œ</strong>(æ”¯æŒåŸå­æ€§)ã€‚</p><ol start="2"><li>Redis ç±»å‹é”™è¯¯(å¯ä»¥ç†è§£ä¸º<strong>è¿è¡ŒæœŸé”™è¯¯</strong>)</li></ol><p>è¿™ç§é”™è¯¯ä¸æ˜¯å‘½ä»¤é”™è¯¯ï¼Œè€Œæ˜¯å› ä¸ºå¯¹å‘½ä»¤ç†è§£ä¸é€å½»å‡ºç°çš„ä½¿ç”¨é”™è¯¯ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šæŠ¥é”™ã€‚ä½†<strong>é˜Ÿåˆ—ä¸­æ­£ç¡®çš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œ</strong>(ä¸æ”¯æŒåŸå­æ€§)ã€‚</p><p><strong>Redisä¸ä¿è¯åŸå­æ€§ï¼Œä¹Ÿæ²¡æœ‰éš”ç¦»çº§åˆ«ã€‚</strong></p><h2 id="_15-redisç¼“å­˜å¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#_15-redisç¼“å­˜å¼‚å¸¸" aria-hidden="true">#</a> 15. Redisç¼“å­˜å¼‚å¸¸</h2><h3 id="_15-1-ç¼“å­˜çƒ­ç‚¹key" tabindex="-1"><a class="header-anchor" href="#_15-1-ç¼“å­˜çƒ­ç‚¹key" aria-hidden="true">#</a> 15.1 ç¼“å­˜çƒ­ç‚¹key</h3><p>çªç„¶æœ‰å‡ åä¸‡çš„è¯·æ±‚å»è®¿é—®redisä¸Šçš„æŸä¸ªç‰¹å®škeyï¼Œé‚£ä¹ˆè¿™æ ·ä¼šé€ æˆæµé‡è¿‡äºé›†ä¸­ï¼Œè¾¾åˆ°ç‰©ç†ç½‘å¡ä¸Šé™ï¼Œä»è€Œå¯¼è‡´è¿™å°redisçš„æœåŠ¡å™¨å®•æœºå¼•å‘é›ªå´©ã€‚</p><figure><img src="/assets/20210629175313-3e751b0f.png" alt="ç¼“å­˜çƒ­ç‚¹keyé—®é¢˜" tabindex="0" loading="lazy"><figcaption>ç¼“å­˜çƒ­ç‚¹keyé—®é¢˜</figcaption></figure><p>é’ˆå¯¹çƒ­keyçš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æå‰æŠŠçƒ­keyæ‰“æ•£åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œé™ä½å‹åŠ›</li><li>åŠ å…¥äºŒçº§ç¼“å­˜ï¼Œæå‰åŠ è½½çƒ­keyæ•°æ®åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœrediså®•æœºï¼Œèµ°å†…å­˜æŸ¥è¯¢</li></ol><h3 id="_15-2-ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#_15-2-ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> 15.2 ç¼“å­˜é›ªå´©</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©ï¼Ÿ</h4><blockquote><p>ç¼“å­˜é›ªå´©ï¼š<strong>ç¼“å­˜åœ¨åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œåé¢çš„è¯·æ±‚éƒ½ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚ã€‚</strong> è¿™å°±å¥½æ¯”é›ªå´©ä¸€æ ·ï¼Œæ‘§æ¯æ‹‰æœ½ä¹‹åŠ¿ï¼Œæ•°æ®åº“çš„å‹åŠ›å¯æƒ³è€ŒçŸ¥ï¼Œå¯èƒ½ç›´æ¥å°±è¢«è¿™ä¹ˆå¤šè¯·æ±‚å¼„å®•æœºäº†ã€‚</p></blockquote><p><strong>æœ‰ä¸€äº›è¢«å¤§é‡è®¿é—®æ•°æ®(çƒ­ç‚¹ç¼“å­˜)åœ¨æŸä¸€æ—¶åˆ»å¤§é¢ç§¯å¤±æ•ˆæˆ–è€…ç³»ç»Ÿçš„ç¼“å­˜æ¨¡å—å‡ºäº†é—®é¢˜æ¯”å¦‚å®•æœºå¯¼è‡´ä¸å¯ç”¨ï¼Œå¯¼è‡´å¯¹åº”çš„è¯·æ±‚ç›´æ¥è½åˆ°äº†æ•°æ®åº“ä¸Šã€‚</strong></p><p>ä¾‹å­ï¼šç§’æ€å¼€å§‹ 12 ä¸ªå°æ—¶ä¹‹å‰ï¼Œç»Ÿä¸€å­˜æ”¾äº†ä¸€æ‰¹å•†å“åˆ° Redis ä¸­ï¼Œè®¾ç½®çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¯ 12 ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆç§’æ€å¼€å§‹çš„æ—¶å€™ï¼Œè¿™äº›ç§’æ€çš„å•†å“çš„è®¿é—®ç›´æ¥å°±å¤±æ•ˆäº†ã€‚å¯¼è‡´çš„æƒ…å†µå°±æ˜¯ï¼Œç›¸åº”çš„è¯·æ±‚ç›´æ¥å°±è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå°±åƒé›ªå´©ä¸€æ ·å¯æ€•ã€‚</p><figure><img src="/assets/20210629180514-d4c93379.png" alt="ç¼“å­˜é›ªå´©" tabindex="0" loading="lazy"><figcaption>ç¼“å­˜é›ªå´©</figcaption></figure><h4 id="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©" aria-hidden="true">#</a> <strong>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©</strong>ï¼Ÿ</h4><p><strong>é’ˆå¯¹ Redis æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µï¼š</strong></p><ol><li>é‡‡ç”¨ Redis é›†ç¾¤ï¼Œé¿å…å•æœºå‡ºç°é—®é¢˜æ•´ä¸ªç¼“å­˜æœåŠ¡éƒ½æ²¡åŠæ³•ä½¿ç”¨ã€‚</li><li>é™æµï¼Œé¿å…åŒæ—¶å¤„ç†å¤§é‡çš„è¯·æ±‚ã€‚</li></ol><p><strong>é’ˆå¯¹çƒ­ç‚¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</strong></p><ol><li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´æ¯”å¦‚éšæœºè®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ã€‚</li><li>ç¼“å­˜æ°¸ä¸å¤±æ•ˆã€‚</li><li>æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼šnginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜(ehcacheç­‰)</li><li>**è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š**è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸ(è®¾ç½®æå‰é‡)ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚Redisæœ‰ä¸€ä¸ªè¿‡æœŸåˆ é™¤é”®çš„ç›‘å¬äº‹ä»¶ã€‚</li></ol><h3 id="_15-3-ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#_15-3-ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> 15.3 ç¼“å­˜ç©¿é€</h3><h4 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€ï¼Ÿ</h4><blockquote><p>ç¼“å­˜ç©¿é€ï¼šå¤§é‡è¯·æ±‚çš„ key æ ¹æœ¬ä¸å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°äº†æ•°æ®åº“ä¸Šï¼Œæ ¹æœ¬æ²¡æœ‰ç»è¿‡ç¼“å­˜è¿™ä¸€å±‚ã€‚</p></blockquote><p>ä¾‹å­ï¼šæŸä¸ªé»‘å®¢æ•…æ„åˆ¶é€ æˆ‘ä»¬ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„ key å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚è½åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§ï¼Œä¸¥é‡ä¼šå‡»å®æ•°æ®åº“ã€‚</p><figure><img src="/assets/20210629180428-34e83371.png" alt="ç¼“å­˜ç©¿é€" tabindex="0" loading="lazy"><figcaption>ç¼“å­˜ç©¿é€</figcaption></figure><h4 id="å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€" aria-hidden="true">#</a> å¦‚ä½•è§£å†³ç¼“å­˜ç©¿é€ï¼Ÿ</h4><p><strong>1)ç¼“å­˜æ— æ•ˆ key</strong>(å¯¹ç©ºå€¼ç¼“å­˜)</p><p>å¦‚æœç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æŸä¸ª key çš„æ•°æ®å°±å†™ä¸€ä¸ªåˆ° Redis ä¸­å»å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š <code>SET key value EX 10086</code> ã€‚</p><p>è¿™ç§æ–¹å¼å¯ä»¥è§£å†³è¯·æ±‚çš„ key å˜åŒ–ä¸é¢‘ç¹çš„æƒ…å†µï¼Œå¦‚æœé»‘å®¢æ¶æ„æ”»å‡»ï¼Œæ¯æ¬¡æ„å»ºä¸åŒçš„è¯·æ±‚ keyï¼Œä¼šå¯¼è‡´ Redis ä¸­ç¼“å­˜å¤§é‡æ— æ•ˆçš„ key ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ–¹æ¡ˆå¹¶ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³æ­¤é—®é¢˜ã€‚å¦‚æœéè¦ç”¨è¿™ç§æ–¹å¼æ¥è§£å†³ç©¿é€é—®é¢˜çš„è¯ï¼Œå°½é‡å°†æ— æ•ˆçš„ key çš„è¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹æ¯”å¦‚ 1 åˆ†é’Ÿï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚</p><p>å¦å¤–ï¼Œè¿™é‡Œå¤šè¯´ä¸€å˜´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯è¿™æ ·è®¾è®¡ key çš„ï¼š <code>è¡¨å:åˆ—å:ä¸»é”®å:ä¸»é”®å€¼</code> ã€‚</p><p><strong>2)è®¾ç½®å¯è®¿é—®çš„åå•(ç™½åå•)</strong></p><p>ä½¿ç”¨bitmapsç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå•idä½œä¸ºbitmapsçš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œbitmapé‡Œé¢çš„idè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—®idä¸åœ¨bitmapsé‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚</p><p><strong>3)å¸ƒéš†è¿‡æ»¤å™¨</strong></p><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½å›¾)å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°(å“ˆå¸Œå‡½æ•°)</p><p>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚</p></blockquote><p>å…·ä½“æ˜¯è¿™æ ·åšçš„ï¼šæŠŠæ‰€æœ‰å¯èƒ½å­˜åœ¨çš„è¯·æ±‚çš„å€¼éƒ½å­˜æ”¾åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå½“ç”¨æˆ·è¯·æ±‚è¿‡æ¥ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·å‘æ¥çš„è¯·æ±‚çš„å€¼æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥è¿”å›è¯·æ±‚å‚æ•°é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œå­˜åœ¨çš„è¯æ‰ä¼šèµ°ä¸‹é¢çš„æµç¨‹ã€‚</p><img src="/assets/20210629173643-057e249e.png" alt="å¸ƒéš†è¿‡æ»¤å™¨æµç¨‹" style="zoom:67%;"><p>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š <strong>å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ å­˜åœ¨ï¼Œå°æ¦‚ç‡ä¼šè¯¯åˆ¤ã€‚å¸ƒéš†è¿‡æ»¤å™¨è¯´æŸä¸ªå…ƒç´ ä¸åœ¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ ä¸€å®šä¸åœ¨ã€‚</strong></p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å½“ä¸€ä¸ªå…ƒç´ åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š</strong></p><ol><li>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„å“ˆå¸Œå‡½æ•°å¯¹å…ƒç´ å€¼è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼(æœ‰å‡ ä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°å‡ ä¸ªå“ˆå¸Œå€¼)ã€‚</li><li>æ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼ï¼Œåœ¨ä½æ•°ç»„ä¸­æŠŠå¯¹åº”ä¸‹æ ‡çš„å€¼ç½®ä¸º 1ã€‚</li></ol><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œå“ªäº›æ“ä½œï¼š</strong></p><ol><li>å¯¹ç»™å®šå…ƒç´ å†æ¬¡è¿›è¡Œç›¸åŒçš„å“ˆå¸Œè®¡ç®—ï¼›</li><li>å¾—åˆ°å€¼ä¹‹ååˆ¤æ–­ä½æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦éƒ½ä¸º 1ï¼Œå¦‚æœå€¼éƒ½ä¸º 1ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå€¼åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå€¼ä¸ä¸º 1ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</li></ol><p>ç„¶åï¼Œä¸€å®šä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼š<strong>ä¸åŒçš„å­—ç¬¦ä¸²å¯èƒ½å“ˆå¸Œå‡ºæ¥çš„ä½ç½®ç›¸åŒã€‚</strong> (å¯ä»¥é€‚å½“å¢åŠ ä½æ•°ç»„å¤§å°æˆ–è€…è°ƒæ•´æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°æ¥é™ä½æ¦‚ç‡)</p><p>å¸ƒéš†è¿‡æ»¤å™¨å¯å‚çœ‹ï¼š<a href="https://zhuanlan.zhihu.com/p/43263751" target="_blank" rel="noopener noreferrer">è¯¦è§£å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†ï¼Œä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>4)è¿›è¡Œå®æ—¶ç›‘æ§</strong></p><p>å½“å‘ç°Redisçš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡</p><h3 id="_15-4-ç¼“å­˜å‡»ç©¿" tabindex="-1"><a class="header-anchor" href="#_15-4-ç¼“å­˜å‡»ç©¿" aria-hidden="true">#</a> 15.4 ç¼“å­˜å‡»ç©¿</h3><blockquote><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡ä¸€ä¸ªKeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªKeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå®Œå¥½æ— æŸçš„æ¡¶ä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´.</p></blockquote><ol><li>**é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼š**åœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿ã€‚</li><li>**å®æ—¶è°ƒæ•´ï¼š**ç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´keyçš„è¿‡æœŸæ—¶é•¿</li><li>åŠ é”æ›´æ–°ï¼Œæ¯”å¦‚è¯·æ±‚æŸ¥è¯¢Aï¼Œå‘ç°ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå¯¹Aè¿™ä¸ªkeyåŠ é”ï¼ŒåŒæ—¶å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå†™å…¥ç¼“å­˜ï¼Œå†è¿”å›ç»™ç”¨æˆ·ï¼Œè¿™æ ·åé¢çš„è¯·æ±‚å°±å¯ä»¥ä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</li><li>å°†è¿‡æœŸæ—¶é—´ç»„åˆå†™åœ¨valueä¸­ï¼Œé€šè¿‡å¼‚æ­¥çš„æ–¹å¼ä¸æ–­çš„åˆ·æ–°è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­¤ç±»ç°è±¡ã€‚å½“å¹¶å‘é‡é™ä½æ—¶ï¼Œå¯ä»¥åœæ­¢è¿›è¡Œåˆ·æ–°ã€‚</li></ol><figure><img src="/assets/20210629180343-3d8a1540.png" alt="ç¼“å­˜å‡»ç©¿" tabindex="0" loading="lazy"><figcaption>ç¼“å­˜å‡»ç©¿</figcaption></figure><h3 id="_15-5-ç¼“å­˜é¢„çƒ­" tabindex="-1"><a class="header-anchor" href="#_15-5-ç¼“å­˜é¢„çƒ­" aria-hidden="true">#</a> 15.5 ç¼“å­˜é¢„çƒ­</h3><blockquote><p>ç¼“å­˜é¢„çƒ­ï¼šç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚</p></blockquote><p>é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ã€‚ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ã€‚</p><p>æ€è·¯ï¼š</p><ul><li>æ•°æ®é‡ä¸å¤§æ—¶ï¼Œå¯åŠ¨æ—¶ç›´æ¥åŠ è½½</li><li>å®šæ—¶åˆ·æ–°ç¼“å­˜</li><li>æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜</li></ul><h3 id="_15-6-ç¼“å­˜é™çº§" tabindex="-1"><a class="header-anchor" href="#_15-6-ç¼“å­˜é™çº§" aria-hidden="true">#</a> 15.6 ç¼“å­˜é™çº§</h3><p>å½“è®¿é—®é‡å‰§å¢ã€æœåŠ¡å‡ºç°é—®é¢˜(å¦‚å“åº”æ—¶é—´æ…¢æˆ–ä¸å“åº”)æˆ–éæ ¸å¿ƒæœåŠ¡å½±å“åˆ°æ ¸å¿ƒæµç¨‹çš„æ€§èƒ½æ—¶ï¼Œä»ç„¶éœ€è¦ä¿è¯æœåŠ¡è¿˜æ˜¯å¯ç”¨çš„ï¼Œå³ä½¿æ˜¯æœ‰ æŸæœåŠ¡ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®ä¸€äº›å…³é”®æ•°æ®è¿›è¡Œè‡ªåŠ¨é™çº§ï¼Œä¹Ÿå¯ä»¥é…ç½®å¼€å…³å®ç°äººå·¥é™çº§ã€‚ é™çº§çš„æœ€ç»ˆç›®çš„æ˜¯ä¿è¯æ ¸å¿ƒæœåŠ¡å¯ç”¨ï¼Œå³ä½¿æ˜¯æœ‰æŸçš„ã€‚è€Œä¸”æœ‰äº›æœåŠ¡æ˜¯æ— æ³•é™çº§çš„(å¦‚åŠ å…¥è´­ç‰©è½¦ã€ç»“ç®—)ã€‚<br> ä»¥å‚è€ƒæ—¥å¿—çº§åˆ«è®¾ç½®é¢„æ¡ˆï¼š (1)ä¸€èˆ¬ï¼šæ¯”å¦‚æœ‰äº›æœåŠ¡å¶å°”å› ä¸ºç½‘ç»œæŠ–åŠ¨æˆ–è€…æœåŠ¡æ­£åœ¨ä¸Šçº¿è€Œè¶…æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é™çº§ï¼› (2)è­¦å‘Šï¼šæœ‰äº›æœåŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…æˆåŠŸç‡æœ‰æ³¢åŠ¨(å¦‚åœ¨95~100%ä¹‹é—´)ï¼Œå¯ä»¥è‡ªåŠ¨é™çº§æˆ–äººå·¥é™çº§ï¼Œå¹¶å‘é€å‘Šè­¦ï¼› (3)é”™è¯¯ï¼šæ¯”å¦‚å¯ç”¨ç‡ä½äº90%ï¼Œæˆ–è€…æ•°æ®åº“è¿æ¥æ± è¢«æ‰“çˆ†äº†ï¼Œæˆ–è€…è®¿é—®é‡çªç„¶çŒ›å¢åˆ°ç³»ç»Ÿèƒ½æ‰¿å—çš„æœ€å¤§é˜€å€¼ï¼Œæ­¤æ—¶å¯ä»¥æ ¹æ®æƒ…å†µè‡ªåŠ¨é™ çº§æˆ–è€…äººå·¥é™çº§ï¼› (4)ä¸¥é‡é”™è¯¯ï¼šæ¯”å¦‚å› ä¸ºç‰¹æ®ŠåŸå› æ•°æ®é”™è¯¯äº†ï¼Œæ­¤æ—¶éœ€è¦ç´§æ€¥äººå·¥é™çº§ã€‚æœåŠ¡é™çº§çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢RedisæœåŠ¡æ•…éšœï¼Œå¯¼è‡´æ•°æ®åº“è·Ÿç€ä¸€ èµ·å‘ç”Ÿé›ªå´©é—®é¢˜ã€‚å› æ­¤ï¼Œå¯¹äºä¸é‡è¦çš„ç¼“å­˜æ•°æ®ï¼Œå¯ä»¥é‡‡å–æœåŠ¡é™çº§ç­–ç•¥ï¼Œä¾‹å¦‚ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšæ³•å°±æ˜¯ï¼ŒRediså‡ºç°é—®é¢˜ï¼Œä¸å»æ•°æ®åº“æŸ¥ è¯¢ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é»˜è®¤å€¼ç»™ç”¨æˆ·</p><h2 id="_16-åˆ†å¸ƒå¼é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_16-åˆ†å¸ƒå¼é—®é¢˜" aria-hidden="true">#</a> 16 åˆ†å¸ƒå¼é—®é¢˜</h2><h3 id="_16-1-rediså®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#_16-1-rediså®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> 16.1 Rediså®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</h3><h4 id="ä¸ºä»€ä¹ˆå¼•å…¥åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆå¼•å…¥åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆå¼•å…¥åˆ†å¸ƒå¼é”ï¼Ÿ</h4><p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ä»æ•°æ®åº“ä¸­è¯»å–ä¸€ä¸ªæ•°æ®ï¼Œç„¶åä¿®æ”¹ä¿å­˜ï¼Œè¿™ç§æƒ…å†µå¾ˆå®¹æ˜“é‡åˆ°å¹¶å‘é—®é¢˜ã€‚å› ä¸ºè¯»å–å’Œæ›´æ–°ä¿å­˜ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œåœ¨å¹¶å‘æ—¶å°±ä¼šå¯¼è‡´æ•°æ®çš„ä¸æ­£ç¡®ã€‚</p><p>è¿™ç§åœºæ™¯å…¶å®å¹¶ä¸å°‘è§ï¼Œæ¯”å¦‚ç”µå•†ç§’æ€æ´»åŠ¨ï¼Œåº“å­˜æ•°é‡çš„æ›´æ–°å°±ä¼šé‡åˆ°ã€‚</p><p>å¦‚æœæ˜¯å•æœºåº”ç”¨ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°é”å°±å¯ä»¥é¿å…ã€‚å¦‚æœæ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œæœ¬åœ°é”æ´¾ä¸ä¸Šç”¨åœºï¼Œè¿™æ—¶å°±éœ€è¦å¼•å…¥åˆ†å¸ƒå¼é”æ¥è§£å†³ã€‚</p><p>ç”±æ­¤å¯è§åˆ†å¸ƒå¼é”çš„ç›®çš„å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯<strong>ä¸ºäº†ä¿è¯å¤šå°æœåŠ¡å™¨åœ¨æ‰§è¡ŒæŸä¸€æ®µä»£ç æ—¶ä¿è¯åªæœ‰ä¸€å°æœåŠ¡å™¨æ‰§è¡Œ</strong>ã€‚</p><h4 id="åˆ†å¸ƒå¼é”çš„å®ç°åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#åˆ†å¸ƒå¼é”çš„å®ç°åŸåˆ™" aria-hidden="true">#</a> åˆ†å¸ƒå¼é”çš„å®ç°åŸåˆ™</h4><ul><li><strong>äº’æ–¥æ€§</strong>ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”ã€‚</li><li><strong>ä¸èƒ½å‡ºç°æ­»é”</strong>ã€‚å¦‚æœåœ¨ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”çš„æœŸé—´ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯å´©æºƒäº†ï¼Œä¹Ÿè¦ä¿è¯åç»­çš„å…¶ä»–å®¢æˆ·ç«¯å¯ä»¥ä¸Šé”ã€‚</li><li><strong>ä¿è¯ä¸Šé”å’Œè§£é”éƒ½æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯</strong>ã€‚</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œå®ç°åˆ†å¸ƒå¼é”çš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>ä½¿ç”¨MySQLï¼ŒåŸºäºå”¯ä¸€ç´¢å¼•ã€‚</li><li>ä½¿ç”¨ZooKeeperï¼ŒåŸºäºä¸´æ—¶æœ‰åºèŠ‚ç‚¹ã€‚</li><li><strong>ä½¿ç”¨Redisï¼ŒåŸºäºsetnxå‘½ä»¤</strong>ã€‚</li></ul><h4 id="rediså®ç°åˆ†å¸ƒå¼é”" tabindex="-1"><a class="header-anchor" href="#rediså®ç°åˆ†å¸ƒå¼é”" aria-hidden="true">#</a> Rediså®ç°åˆ†å¸ƒå¼é”</h4><p>Rediså®ç°åˆ†å¸ƒå¼é”ä¸»è¦åˆ©ç”¨Redisçš„<code>setnx</code>å‘½ä»¤ã€‚<code>setnx</code>æ˜¯<code>SET if not exists</code>(å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ SET)çš„ç®€å†™ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx lock value1 <span class="token comment">#åœ¨é”®lockä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œå°†é”®keyçš„å€¼è®¾ç½®ä¸ºvalue1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx lock value2 <span class="token comment">#è¯•å›¾è¦†ç›–lockçš„å€¼ï¼Œè¿”å›0è¡¨ç¤ºå¤±è´¥</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get lock <span class="token comment">#è·å–lockçš„å€¼ï¼ŒéªŒè¯æ²¡æœ‰è¢«è¦†ç›–</span>
<span class="token string">&quot;value1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> del lock <span class="token comment">#åˆ é™¤lockçš„å€¼ï¼Œåˆ é™¤æˆåŠŸ</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> setnx lock value2 <span class="token comment">#å†ä½¿ç”¨setnxå‘½ä»¤è®¾ç½®ï¼Œè¿”å›0è¡¨ç¤ºæˆåŠŸ</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get lock <span class="token comment">#è·å–lockçš„å€¼ï¼ŒéªŒè¯è®¾ç½®æˆåŠŸ</span>
<span class="token string">&quot;value2&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢è¿™å‡ ä¸ªå‘½ä»¤å°±æ˜¯æœ€åŸºæœ¬çš„ç”¨æ¥å®Œæˆåˆ†å¸ƒå¼é”çš„å‘½ä»¤ã€‚</p><p>åŠ é”ï¼šä½¿ç”¨<code>setnx key value</code>å‘½ä»¤ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œè®¾ç½®value(åŠ é”æˆåŠŸ)ã€‚å¦‚æœå·²ç»å­˜åœ¨lock(ä¹Ÿå°±æ˜¯æœ‰å®¢æˆ·ç«¯æŒæœ‰é”äº†)ï¼Œåˆ™è®¾ç½®å¤±è´¥(åŠ é”å¤±è´¥)ã€‚</p><p>è§£é”ï¼šä½¿ç”¨<code>del</code>å‘½ä»¤ï¼Œé€šè¿‡åˆ é™¤é”®å€¼é‡Šæ”¾é”ã€‚é‡Šæ”¾é”ä¹‹åï¼Œå…¶ä»–å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>setnx</code>å‘½ä»¤è¿›è¡ŒåŠ é”ã€‚</p><p>keyçš„å€¼å¯ä»¥æ ¹æ®ä¸šåŠ¡è®¾ç½®ï¼Œæ¯”å¦‚æ˜¯ç”¨æˆ·ä¸­å¿ƒä½¿ç”¨çš„ï¼Œå¯ä»¥å‘½ä»¤ä¸º<code>USER_REDIS_LOCK</code>ï¼Œvalueå¯ä»¥ä½¿ç”¨uuidä¿è¯å”¯ä¸€ï¼Œç”¨äºæ ‡è¯†åŠ é”çš„å®¢æˆ·ç«¯ã€‚ä¿è¯åŠ é”å’Œè§£é”éƒ½æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p><p>ç®€å•çš„ä»£ç å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Long</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
  * åŠ é”
  */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> requestId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ä½¿ç”¨setnxå‘½ä»¤ã€‚</span>
    <span class="token comment">//ä¸å­˜åœ¨åˆ™ä¿å­˜è¿”å›1ï¼ŒåŠ é”æˆåŠŸã€‚å¦‚æœå·²ç»å­˜åœ¨åˆ™è¿”å›0ï¼ŒåŠ é”å¤±è´¥ã€‚</span>
    <span class="token keyword">return</span> <span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> requestId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆ é™¤keyçš„luaè„šæœ¬ï¼Œå…ˆæ¯”è¾ƒrequestIdæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™åˆ é™¤</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEL_SCRIPT</span> <span class="token operator">=</span> <span class="token string">&quot;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return 0 end&quot;</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
  * è§£é”
  */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">unLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> requestId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//åˆ é™¤æˆåŠŸè¡¨ç¤ºè§£é”æˆåŠŸ</span>
    <span class="token class-name">Long</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> jedis<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token constant">DEL_SCRIPT</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">SUCCESS</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµç¨‹ï¼š</p><figure><img src="/assets/20210629204433-50d4a775.png" alt="Rediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹" tabindex="0" loading="lazy"><figcaption>Rediså®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹</figcaption></figure><h5 id="é—®é¢˜ä¸€-æŒæœ‰é”çš„å®¢æˆ·ç«¯ä¸èƒ½é‡Šæ”¾é”-å¼•å‘æ­»é”" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜ä¸€-æŒæœ‰é”çš„å®¢æˆ·ç«¯ä¸èƒ½é‡Šæ”¾é”-å¼•å‘æ­»é”" aria-hidden="true">#</a> é—®é¢˜ä¸€ï¼šæŒæœ‰é”çš„å®¢æˆ·ç«¯ä¸èƒ½é‡Šæ”¾é”ï¼Œå¼•å‘æ­»é”</h5><p>è¿™æ ·åªèƒ½ä¿è¯äº’æ–¥æ€§å’ŒåŠ é”è§£é”éƒ½æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¹Ÿä¿è¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”ï¼Œä½†<strong>å¯èƒ½ä¼šå‡ºç°æ­»é”é—®é¢˜</strong>ï¼Œå³å¦‚æœä¸€ä¸ªæŒæœ‰é”çš„å®¢æˆ·ç«¯çªç„¶å´©æºƒï¼Œå¯¼è‡´æ— æ³•è§£é”ã€‚</p><p>è§£å†³â€”â€”è¶…æ—¶æœºåˆ¶ï¼š</p><p>è®¾ç½®è¶…æ—¶æœºåˆ¶ï¼Œåœ¨è®¾ç½®keyçš„æ—¶å€™ï¼ŒåŠ ä¸Šæœ‰æ•ˆæ—¶é—´ï¼Œå¦‚æœè¿‡æœŸï¼Œè‡ªåŠ¨å¤±æ•ˆï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚</p><p>ä»£ç ä¿®æ”¹ï¼š</p><div class="language-Java line-numbers-mode" data-ext="Java"><pre class="language-Java"><code>public boolean tryLock(String key, String requestId, int expireTime) {
    //ä½¿ç”¨jedisçš„apiï¼Œä¿è¯åŸå­æ€§
    //NX ä¸å­˜åœ¨åˆ™æ“ä½œ EX è®¾ç½®æœ‰æ•ˆæœŸï¼Œå•ä½æ˜¯ç§’
    String result = jedis.set(key, requestId, &quot;NX&quot;, &quot;EX&quot;, expireTime);
    //è¿”å›OKåˆ™è¡¨ç¤ºåŠ é”æˆåŠŸ
    return &quot;OK&quot;.equals(result);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/20210629205045-8eca29f8.png" alt="è§£å†³æ­»é”é—®é¢˜åçš„æµç¨‹" tabindex="0" loading="lazy"><figcaption>è§£å†³æ­»é”é—®é¢˜åçš„æµç¨‹</figcaption></figure><p>è™½ç„¶ï¼Œè¿™æ ·ä¸ä¼šå¼•å‘æ­»é”é—®é¢˜ï¼Œä½†æ˜¯<strong>æœ‰æ•ˆæ—¶é—´è®¾ç½®å¤šé•¿æ˜¯ä¸€ä¸ªé—®é¢˜</strong>ã€‚<strong>å¦‚æœä¸šåŠ¡æ“ä½œæ¯”æœ‰æ•ˆæ—¶é—´é•¿ï¼Œä¸šåŠ¡ä»£ç è¿˜æ²¡æ‰§è¡Œå®Œå°±è§£é”äº†ï¼Œä¸èƒ½ä¿è¯æ•°æ®ä¸€è‡´æ€§</strong>ã€‚</p><p>è¿™ä¸ªé—®é¢˜å°±æœ‰ç‚¹æ£˜æ‰‹äº†ï¼Œåœ¨ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šè®¨è®ºï¼Œç¬¬ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯é ç¨‹åºå‘˜è‡ªå·±å»æŠŠæ¡ï¼Œé¢„ä¼°ä¸€ä¸‹ä¸šåŠ¡ä»£ç éœ€è¦æ‰§è¡Œçš„æ—¶é—´ï¼Œç„¶åè®¾ç½®æœ‰æ•ˆæœŸæ—¶é—´æ¯”æ‰§è¡Œæ—¶é—´é•¿ä¸€äº›ï¼Œä¿è¯ä¸ä¼šå› ä¸ºè‡ªåŠ¨è§£é”å½±å“åˆ°å®¢æˆ·ç«¯ä¸šåŠ¡ä»£ç çš„æ‰§è¡Œã€‚</p><p>ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸‡å…¨ä¹‹ç­–ï¼Œæ¯”å¦‚ç½‘ç»œæŠ–åŠ¨è¿™ç§æƒ…å†µæ˜¯æ— æ³•é¢„æµ‹çš„ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´ä¸šåŠ¡ä»£ç æ‰§è¡Œçš„æ—¶é—´å˜é•¿ï¼Œæ‰€ä»¥å¹¶ä¸å®‰å…¨ã€‚</p><p>æœ‰ä¸€ç§æ–¹æ³•æ¯”è¾ƒé è°±ä¸€ç‚¹ï¼Œå°±æ˜¯<strong>ç»™é”ç»­æœŸ</strong>ã€‚æ€è·¯ï¼š<strong>å½“åŠ é”æˆåŠŸåï¼ŒåŒæ—¶å¼€å¯å®ˆæŠ¤çº¿ç¨‹ï¼Œé»˜è®¤æœ‰æ•ˆæœŸæ˜¯30ç§’ï¼Œæ¯éš”10ç§’å°±ä¼šç»™é”ç»­æœŸåˆ°30ç§’ï¼Œåªè¦æŒæœ‰é”çš„å®¢æˆ·ç«¯æ²¡æœ‰å®•æœºï¼Œå°±èƒ½ä¿è¯ä¸€ç›´æŒæœ‰é”ï¼Œç›´åˆ°ä¸šåŠ¡ä»£ç æ‰§è¡Œå®Œæ¯•ç”±å®¢æˆ·ç«¯è‡ªå·±è§£é”ï¼Œå¦‚æœå®•æœºäº†è‡ªç„¶å°±åœ¨æœ‰æ•ˆæœŸå¤±æ•ˆåè‡ªåŠ¨è§£é”</strong>ã€‚</p><figure><img src="/assets/20210629205514-8e2f267d.png" alt="é¿å…æ­»é”+é”ç»­æœŸæµç¨‹" tabindex="0" loading="lazy"><figcaption>é¿å…æ­»é”+é”ç»­æœŸæµç¨‹</figcaption></figure><h5 id="é—®é¢˜äºŒ-ä¸å¯é‡å…¥é”" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜äºŒ-ä¸å¯é‡å…¥é”" aria-hidden="true">#</a> é—®é¢˜äºŒï¼šä¸å¯é‡å…¥é”</h5><p>ä¸Šè¿°åŠ çš„é”åªèƒ½åŠ ä¸€æ¬¡ï¼Œä¸å¯é‡å…¥ã€‚å¯é‡å…¥é”æ„æ€æ˜¯åœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œå†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆå¯é‡å…¥é”çš„å®ç°æ€è·¯åˆæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p><strong>ä½¿ç”¨Redisçš„å“ˆå¸Œè¡¨å­˜å‚¨å¯é‡å…¥æ¬¡æ•°ï¼Œå½“åŠ é”æˆåŠŸåï¼Œä½¿ç”¨<code>hset</code>å‘½ä»¤ï¼Œvalue(é‡å…¥æ¬¡æ•°)åˆ™æ˜¯1</strong>ã€‚</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token string">&quot;if (redis.call(&#39;exists&#39;, KEYS[1]) == 0) then &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;hset&#39;, KEYS[1], ARGV[2], 1); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;pexpire&#39;, KEYS[1], ARGV[1]); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return nil; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;end; &quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœåŒä¸€ä¸ªå®¢æˆ·ç«¯å†æ¬¡åŠ é”æˆåŠŸï¼Œåˆ™ä½¿ç”¨<code>hincrby</code>è‡ªå¢åŠ ä¸€ã€‚</p><div class="language-lua line-numbers-mode" data-ext="lua"><pre class="language-lua"><code><span class="token string">&quot;if (redis.call(&#39;hexists&#39;, KEYS[1], ARGV[2]) == 1) then &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;hincrby&#39;, KEYS[1], ARGV[2], 1); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;pexpire&#39;, KEYS[1], ARGV[1]); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return nil; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;end; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return redis.call(&#39;pttl&#39;, KEYS[1]);&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ é”æµç¨‹ï¼š</p><figure><img src="/assets/20210629210314-7526c690.png" alt="Redisåˆ†å¸ƒå¼å¯é‡å…¥é”åŠ é”æµç¨‹" tabindex="0" loading="lazy"><figcaption>Redisåˆ†å¸ƒå¼å¯é‡å…¥é”åŠ é”æµç¨‹</figcaption></figure><p>è§£é”æ—¶ï¼Œå…ˆåˆ¤æ–­å¯é‡å¤æ¬¡æ•°æ˜¯å¦å¤§äº0ï¼Œå¤§äº0åˆ™å‡ä¸€ï¼Œå¦åˆ™åˆ é™¤é”®å€¼ï¼Œé‡Šæ”¾é”èµ„æºã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">RFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">unlockInnerAsync</span><span class="token punctuation">(</span><span class="token keyword">long</span> threadId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> commandExecutor<span class="token punctuation">.</span><span class="token function">evalWriteAsync</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LongCodec</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">RedisCommands</span><span class="token punctuation">.</span><span class="token constant">EVAL_BOOLEAN</span><span class="token punctuation">,</span>
<span class="token string">&quot;if (redis.call(&#39;hexists&#39;, KEYS[1], ARGV[3]) == 0) then &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return nil;&quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;end; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;local counter = redis.call(&#39;hincrby&#39;, KEYS[1], ARGV[3], -1); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;if (counter &gt; 0) then &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;pexpire&#39;, KEYS[1], ARGV[2]); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return 0; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;else &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;del&#39;, KEYS[1]); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;redis.call(&#39;publish&#39;, KEYS[2], ARGV[1]); &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return 1; &quot;</span><span class="token operator">+</span>
<span class="token string">&quot;end; &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;return nil;&quot;</span><span class="token punctuation">,</span>
<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getChannelName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">LockPubSub</span><span class="token punctuation">.</span><span class="token constant">UNLOCK_MESSAGE</span><span class="token punctuation">,</span> internalLockLeaseTime<span class="token punctuation">,</span> <span class="token function">getLockName</span><span class="token punctuation">(</span>threadId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/20210629210532-4e4812e9.jpg" alt="Redisåˆ†å¸ƒå¼å¯é‡å…¥é”è§£é”æµç¨‹" tabindex="0" loading="lazy"><figcaption>Redisåˆ†å¸ƒå¼å¯é‡å…¥é”è§£é”æµç¨‹</figcaption></figure><p>ä¸ºäº†ä¿è¯æ“ä½œåŸå­æ€§ï¼ŒåŠ é”å’Œè§£é”æ“ä½œéƒ½æ˜¯ä½¿ç”¨luaè„šæœ¬æ‰§è¡Œã€‚</p><h5 id="é—®é¢˜ä¸‰-æ“ä½œæˆåŠŸåç«‹å³è¿”å›ç»“æœ-æ¶ˆè€—æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜ä¸‰-æ“ä½œæˆåŠŸåç«‹å³è¿”å›ç»“æœ-æ¶ˆè€—æ€§èƒ½" aria-hidden="true">#</a> é—®é¢˜ä¸‰ï¼šæ“ä½œæˆåŠŸåç«‹å³è¿”å›ç»“æœï¼Œæ¶ˆè€—æ€§èƒ½</h5><p>ä¸Šé¢çš„åŠ é”æ–¹æ³•æ˜¯åŠ é”åç«‹å³è¿”å›åŠ é”ç»“æœï¼Œå¦‚æœåŠ é”å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ€»ä¸å¯èƒ½ä¸€ç›´è½®è¯¢å°è¯•åŠ é”ï¼Œç›´åˆ°åŠ é”æˆåŠŸä¸ºæ­¢ï¼Œè¿™æ ·å¤ªè¿‡è€—è´¹æ€§èƒ½ã€‚æ‰€ä»¥éœ€è¦åˆ©ç”¨å‘å¸ƒè®¢é˜…çš„æœºåˆ¶è¿›è¡Œä¼˜åŒ–ã€‚</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å½“åŠ é”å¤±è´¥åï¼Œè®¢é˜…é”é‡Šæ”¾çš„æ¶ˆæ¯ï¼Œè‡ªèº«è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</li><li>å½“æŒæœ‰é”çš„å®¢æˆ·ç«¯é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå‘å¸ƒé”é‡Šæ”¾çš„æ¶ˆæ¯ã€‚</li><li>å½“è¿›å…¥é˜»å¡ç­‰å¾…çš„å…¶ä»–å®¢æˆ·ç«¯æ”¶åˆ°é”é‡Šæ”¾çš„æ¶ˆæ¯åï¼Œè§£é™¤é˜»å¡ç­‰å¾…çŠ¶æ€ï¼Œå†æ¬¡å°è¯•åŠ é”ã€‚</li></ol><figure><img src="/assets/20210629210758-60730d9b.png" alt="å¢åŠ å‘å¸ƒè®¢é˜…æµç¨‹" tabindex="0" loading="lazy"><figcaption>å¢åŠ å‘å¸ƒè®¢é˜…æµç¨‹</figcaption></figure><p>å‚è€ƒï¼š</p><ul><li><a href="https://blog.csdn.net/Muscleheng/article/details/82906617" target="_blank" rel="noopener noreferrer">Springboot+Rediså®ç°æ¶ˆæ¯é˜Ÿåˆ—(å‘å¸ƒè®¢é˜…æ¨¡å¼)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.jianshu.com/p/a37d455618f7" target="_blank" rel="noopener noreferrer">Springbooté›†æˆRediså®ç°æ¶ˆæ¯é˜Ÿåˆ—-ç”Ÿäº§æ¶ˆè´¹è€…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h4 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h4><p>ä»¥ä¸Šçš„å®ç°æ€è·¯ä»…ä»…è€ƒè™‘åœ¨å•æœºç‰ˆRedisä¸Šï¼Œå¦‚æœæ˜¯é›†ç¾¤ç‰ˆRediséœ€è¦è€ƒè™‘çš„é—®é¢˜è¿˜è¦å†å¤šä¸€ç‚¹ã€‚Redisç”±äºä»–çš„é«˜æ€§èƒ½è¯»å†™èƒ½åŠ›ï¼Œæ‰€ä»¥åœ¨å¹¶å‘é«˜çš„åœºæ™¯ä¸‹ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ä¼šå¤šä¸€ç‚¹ã€‚</p><h3 id="_16-2-å¦‚ä½•è§£å†³-redis-çš„å¹¶å‘ç«äº‰-key-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_16-2-å¦‚ä½•è§£å†³-redis-çš„å¹¶å‘ç«äº‰-key-é—®é¢˜" aria-hidden="true">#</a> 16.2 å¦‚ä½•è§£å†³ Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Ÿ</h3><h4 id="ä»€ä¹ˆæ˜¯redis-çš„å¹¶å‘ç«äº‰-key-é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯redis-çš„å¹¶å‘ç«äº‰-key-é—®é¢˜" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼Ÿ</h4><p>Redis çš„å¹¶å‘ç«äº‰ Key é—®é¢˜ï¼šå¤šä¸ªredisçš„clientåŒæ—¶set keyå¼•èµ·çš„å¹¶å‘é—®é¢˜ã€‚</p><p>ç”±äºå•çº¿ç¨‹æ‰€ä»¥Redisæœ¬èº«å¹¶æ²¡æœ‰é”çš„æ¦‚å¿µï¼Œå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰å…³ç³»ï¼Œä½†æ˜¯åˆ©ç”¨jedisç­‰å®¢æˆ·ç«¯å¯¹Redisè¿›è¡Œå¹¶å‘è®¿é—®æ—¶ä¼šå‡ºç°é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼šåŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»Ÿå»setä¸€ä¸ªkeyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿ</p><h4 id="åœºæ™¯ä¸€-åº“å­˜é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯ä¸€-åº“å­˜é—®é¢˜" aria-hidden="true">#</a> åœºæ™¯ä¸€ï¼šåº“å­˜é—®é¢˜</h4><p>ä¾‹å¦‚æœ‰å¤šä¸ªè¯·æ±‚ä¸€èµ·å»å¯¹æŸä¸ªå•†å“å‡åº“å­˜ï¼Œé€šå¸¸æ“ä½œæµç¨‹æ˜¯ï¼š</p><ul><li>å–å‡ºå½“å‰åº“å­˜å€¼</li><li>è®¡ç®—æ–°åº“å­˜å€¼</li><li>å†™å…¥æ–°åº“å­˜å€¼</li></ul><p>å‡è®¾å½“å‰åº“å­˜å€¼ä¸º 20ï¼Œç°åœ¨æœ‰2ä¸ªè¿æ¥éƒ½è¦å‡ 5ï¼Œç»“æœåº“å­˜å€¼åº”è¯¥æ˜¯ 10 æ‰å¯¹ï¼Œä½†å­˜åœ¨ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p><figure><img src="/assets/20210629212028-2c11423b.png" alt="åº“å­˜é—®é¢˜" tabindex="0" loading="lazy"><figcaption>åº“å­˜é—®é¢˜</figcaption></figure><h4 id="åœºæ™¯äºŒ-é¡ºåºé—®é¢˜" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯äºŒ-é¡ºåºé—®é¢˜" aria-hidden="true">#</a> åœºæ™¯äºŒï¼šé¡ºåºé—®é¢˜</h4><p>æ¯”å¦‚æœ‰3ä¸ªè¯·æ±‚æœ‰åºçš„ä¿®æ”¹æŸä¸ªkeyï¼ŒæŒ‰æ­£å¸¸é¡ºåºçš„è¯ï¼Œæ•°æ®ç‰ˆæœ¬åº”è¯¥æ˜¯ 1-&gt;2-&gt;3ï¼Œæœ€ååº”è¯¥æ˜¯ 3ã€‚</p><p>ä½†å¦‚æœç¬¬äºŒä¸ªè¯·æ±‚ç”±äºç½‘ç»œåŸå› è¿Ÿåˆ°äº†ï¼Œæ•°æ®ç‰ˆæœ¬å°±å˜ä¸ºäº† 1-&gt;3-&gt;2ï¼Œæœ€åå€¼ä¸º 2ï¼Œå‡ºé—®é¢˜äº†ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆä¸€-åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆä¸€-åˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h4><p>åœ¨å¹¶å‘é‡è¿‡å¤§çš„æƒ…å†µä¸‹,å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œå¤„ç†,æŠŠå¹¶è¡Œè¯»å†™è¿›è¡Œä¸²è¡ŒåŒ–ã€‚</p><p>æŠŠRedis.setæ“ä½œæ”¾åœ¨é˜Ÿåˆ—ä¸­ä½¿å…¶ä¸²è¡ŒåŒ–,å¿…é¡»çš„ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œã€‚</p><p>è¿™ç§æ–¹å¼åœ¨ä¸€äº›é«˜å¹¶å‘çš„åœºæ™¯ä¸­ç®—æ˜¯ä¸€ç§é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆäºŒ-åˆ†å¸ƒå¼é”-æ—¶é—´æˆ³" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆäºŒ-åˆ†å¸ƒå¼é”-æ—¶é—´æˆ³" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆäºŒï¼šåˆ†å¸ƒå¼é”+æ—¶é—´æˆ³</h4><p><strong>æ•´ä½“æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼š</p><p>å‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå¤§å®¶å»æŠ¢é”ï¼ŒæŠ¢åˆ°é”å°±åšsetæ“ä½œã€‚</p><p>åŠ é”çš„ç›®çš„å®é™…ä¸Šå°±æ˜¯æŠŠå¹¶è¡Œè¯»å†™æ”¹æˆä¸²è¡Œè¯»å†™çš„æ–¹å¼ï¼Œä»è€Œæ¥é¿å…èµ„æºç«äº‰ã€‚</p><p><strong>åˆ†å¸ƒå¼é”</strong>å‚çœ‹ä¸Šæ–‡</p><p><strong>æ—¶é—´æˆ³</strong>ï¼š</p><p>è¦æ±‚keyçš„æ“ä½œéœ€è¦é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³åˆ¤æ–­seté¡ºåºã€‚</p><blockquote ValueB:07:05=""><p>ç³»ç»ŸA key 1 {&#39;ValueA&#39;:&#39;07:00&#39;} ç³»ç»ŸB key 1</p></blockquote><p>å‡è®¾ç³»ç»ŸBå…ˆæŠ¢åˆ°é”ï¼Œå°†key1è®¾ç½®ä¸º{&quot;ValueB&quot;: &#39;07:05&#39;}ã€‚æ¥ä¸‹æ¥ç³»ç»ŸAæŠ¢åˆ°é”ï¼Œå‘ç°è‡ªå·±çš„key1çš„æ—¶é—´æˆ³æ—©äºç¼“å­˜ä¸­çš„æ—¶é—´æˆ³(&#39;07:00&#39;&lt;&#39;07:05&#39;)ï¼Œé‚£å°±ä¸åšsetæ“ä½œäº†ã€‚</p><h3 id="_16-3-åˆ†å¸ƒå¼redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½-ä¸ºä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_16-3-åˆ†å¸ƒå¼redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½-ä¸ºä»€ä¹ˆ" aria-hidden="true">#</a> 16.3 åˆ†å¸ƒå¼Redisæ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3><p>Redisæ˜¯è½»é‡çš„(å•å®ä¾‹åªä½¿ç”¨1Må†…å­˜)ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥å¼€è¯´ä¸ªå®ä¾‹ï¼Œå‰æœŸæ¯”è¾ƒéº»çƒ¦ï¼Œä½†éšç€æ•°æ®å¢é•¿ï¼Œç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚éœ€è¦æ›´å¤šçš„RedisæœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°†Rediså®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼Œè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ã€‚</p><h3 id="_16-4-ä»€ä¹ˆæ˜¯-redlock" tabindex="-1"><a class="header-anchor" href="#_16-4-ä»€ä¹ˆæ˜¯-redlock" aria-hidden="true">#</a> 16.4 ä»€ä¹ˆæ˜¯ RedLockï¼Ÿ</h3><p>å‚çœ‹ï¼š</p><ul><li><a href="https://zhuanlan.zhihu.com/p/59256821" target="_blank" rel="noopener noreferrer">Redlockï¼šRedisåˆ†å¸ƒå¼é”æœ€ç‰›é€¼çš„å®ç°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/111354065" target="_blank" rel="noopener noreferrer">ç»†è¯´Redisåˆ†å¸ƒå¼é”ï¼šsetnx/redisson/redlockï¼Ÿäº†è§£ä¸€æ³¢ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="_17-é›†ç¾¤æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_17-é›†ç¾¤æ–¹æ¡ˆ" aria-hidden="true">#</a> 17 é›†ç¾¤æ–¹æ¡ˆ</h2><h3 id="_17-1-redisä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#_17-1-redisä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> 17.1 Redisä¸»ä»å¤åˆ¶</h3><p>Redisä¸ºäº†è§£å†³å•ç‚¹æ•°æ®åº“é—®é¢˜ï¼Œä¼šæŠŠæ•°æ®å¤åˆ¶å¤šä¸ªå‰¯æœ¬éƒ¨ç½²åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡å¤åˆ¶ï¼Œå®ç°Redisçš„é«˜å¯ç”¨æ€§ï¼Œå®ç°å¯¹æ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œä¿è¯æ•°æ®å’ŒæœåŠ¡çš„é«˜åº¦å¯é æ€§ã€‚</p><p>ç®€ä»‹ï¼š</p><ul><li>ä¸»ä»æ¨¡å¼é‡Œä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœº(master)ï¼Œå…¶ä½™å¤šä¸ªå®ä¾‹ä½œä¸ºå¤‡ä»½æœº(slave)ï¼›</li><li>masterç”¨æ¥æ”¯æŒæ•°æ®çš„å†™å…¥å’Œè¯»å–æ“ä½œï¼Œè€Œslaveæ”¯æŒè¯»å–åŠmasterçš„æ•°æ®åŒæ­¥ï¼›</li><li>åœ¨æ•´ä¸ªæ¶æ„é‡Œï¼Œmasterå’Œslaveå®ä¾‹é‡Œçš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼›</li></ul><p>æµç¨‹ï¼š</p><p>â‘ ä»æ•°æ®åº“å‘ä¸»æ•°æ®åº“å‘é€sync(æ•°æ®åŒæ­¥)å‘½ä»¤ã€‚</p><p>â‘¡ä¸»æ•°æ®åº“æ¥æ”¶åŒæ­¥å‘½ä»¤åï¼Œä¼šä¿å­˜å¿«ç…§ï¼Œåˆ›å»ºä¸€ä¸ªRDBæ–‡ä»¶ã€‚</p><p>â‘¢å½“ä¸»æ•°æ®åº“æ‰§è¡Œå®Œä¿æŒå¿«ç…§åï¼Œä¼šå‘ä»æ•°æ®åº“å‘é€RDBæ–‡ä»¶ï¼Œè€Œä»æ•°æ®åº“ä¼šæ¥æ”¶å¹¶è½½å…¥è¯¥æ–‡ä»¶ã€‚</p><p>â‘£ä¸»æ•°æ®åº“å°†ç¼“å†²åŒºçš„æ‰€æœ‰å†™å‘½ä»¤å‘ç»™ä»æœåŠ¡å™¨æ‰§è¡Œã€‚</p><p>â‘¤ä»¥ä¸Šå¤„ç†å®Œä¹‹åï¼Œä¹‹åä¸»æ•°æ®åº“æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤ï¼Œéƒ½ä¼šå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æ•°æ®åº“ã€‚</p><p>æ³¨æ„ï¼šåœ¨Redis2.8ä¹‹åï¼Œä¸»ä»æ–­å¼€é‡è¿åä¼šæ ¹æ®æ–­å¼€ä¹‹å‰æœ€æ–°çš„å‘½ä»¤åç§»é‡è¿›è¡Œå¢é‡å¤åˆ¶ã€‚</p><figure><img src="/assets/20210629215906-ed384595.png" alt="Redisä¸»ä»å¤åˆ¶æµç¨‹" tabindex="0" loading="lazy"><figcaption>Redisä¸»ä»å¤åˆ¶æµç¨‹</figcaption></figure><figure><img src="/assets/20210629215936-77a5342d.png" alt="æ–­å¼€é‡è¿å¢é‡åŒæ­¥" tabindex="0" loading="lazy"><figcaption>æ–­å¼€é‡è¿å¢é‡åŒæ­¥</figcaption></figure><p><strong>ä¸»èŠ‚ç‚¹æ•…éšœå¤„ç†æ–¹å¼</strong></p><p>ä¸»ä»æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥rediså®ä¾‹æ—¶éƒ½æŒ‡å®šäº†ipå’Œç«¯å£å·ã€‚å¦‚æœæ‰€è¿æ¥çš„rediså®ä¾‹å› ä¸ºæ•…éšœä¸‹çº¿äº†ï¼Œåˆ™æ— æ³•é€šçŸ¥å®¢æˆ·ç«¯è¿æ¥å…¶ä»–å®¢æˆ·ç«¯åœ°å€ï¼Œå› æ­¤åªèƒ½è¿›è¡Œæ‰‹åŠ¨æ“ä½œã€‚</p><p><strong>ä¸æ”¯æŒé«˜å¯ç”¨</strong></p><p>æ˜¾è€Œæ˜“è§ï¼Œä¸»ä»æ¨¡å¼å¾ˆå¥½åœ°è§£ å†³äº†æ•°æ®å¤‡ä»½çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸»èŠ‚ç‚¹å› ä¸ºæ•…éšœä¸‹çº¿åï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ”¹å®¢æˆ·ç«¯é…ç½®é‡æ–°è¿æ¥ï¼Œè¿™ç§æ¨¡å¼å¹¶ä¸èƒ½ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚</p><p>äºæ˜¯redisé›†ç¾¤è¿æ¥äº†å“¨å…µæ¨¡å¼......</p><h3 id="_17-2-å“¨å…µ-sentinal-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_17-2-å“¨å…µ-sentinal-æœºåˆ¶" aria-hidden="true">#</a> 17.2 å“¨å…µ(sentinal)æœºåˆ¶</h3><p>å“¨å…µçš„å‡ºç°ä¸»è¦æ˜¯è§£å†³äº†ä¸»ä»å¤åˆ¶å‡ºç°æ•…éšœæ—¶ <strong>éœ€è¦äººä¸ºå¹²é¢„</strong> çš„é—®é¢˜ã€‚</p><p>ç®€ä»‹ï¼š</p><ul><li>å’Œä¸»ä»æ¨¡å¼ä¸ä¸€æ ·çš„æ˜¯ï¼Œå“¨å…µæ¨¡å¼ä¸­ <strong>å¢åŠ äº†ç‹¬ç«‹è¿›ç¨‹(å³å“¨å…µ)æ¥ç›‘æ§é›†ç¾¤ä¸­çš„ä¸€ä¸¾ä¸€åŠ¨</strong> ã€‚å®¢æˆ·ç«¯åœ¨è¿æ¥é›†ç¾¤æ—¶ï¼Œé¦–å…ˆè¿æ¥å“¨å…µï¼Œé€šè¿‡å“¨å…µæŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„åœ°å€ï¼Œç„¶åå†å»è¿æ¥ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤äº’ã€‚</li><li>å¦‚æœmasterå¼‚å¸¸ï¼Œåˆ™ä¼šè¿›è¡Œmaster-slaveåˆ‡æ¢ï¼Œå°†æœ€ä¼˜çš„ä¸€ä¸ªslaveåˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚</li><li>åŒæ—¶ï¼Œå“¨å…µæŒç»­ç›‘æ§æŒ‚æ‰çš„ä¸»èŠ‚ç‚¹ï¼Œå¾…å…¶æ¢å¤åï¼Œä½œä¸ºæ–°çš„ä»èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ä¸­ã€‚</li></ul><p><strong>Rediså“¨å…µä¸»è¦åŠŸèƒ½</strong></p><p><strong>(1)é›†ç¾¤ç›‘æ§</strong>ï¼šè´Ÿè´£ç›‘æ§Redis masterå’Œslaveè¿›ç¨‹æ˜¯å¦æ­£å¸¸å·¥ä½œ</p><p><strong>(2)æ¶ˆæ¯é€šçŸ¥</strong>ï¼šå¦‚æœæŸä¸ªRediså®ä¾‹æœ‰æ•…éšœï¼Œé‚£ä¹ˆå“¨å…µè´Ÿè´£å‘é€æ¶ˆæ¯ä½œä¸ºæŠ¥è­¦é€šçŸ¥ç»™ç®¡ç†å‘˜</p><p><strong>(3)æ•…éšœè½¬ç§»</strong>ï¼šå¦‚æœmaster nodeæŒ‚æ‰äº†ï¼Œä¼šè‡ªåŠ¨è½¬ç§»åˆ°slave nodeä¸Š</p><p><strong>(4)é…ç½®ä¸­å¿ƒ</strong>ï¼šå¦‚æœæ•…éšœè½¬ç§»å‘ç”Ÿäº†ï¼Œé€šçŸ¥clientå®¢æˆ·ç«¯æ–°çš„masteråœ°å€</p><p><strong>Rediså“¨å…µçš„é«˜å¯ç”¨</strong></p><p>åŸç†ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶ï¼Œç”±Redis Sentinelè‡ªåŠ¨å®Œæˆæ•…éšœå‘ç°å’Œè½¬ç§»ï¼Œå¹¶é€šçŸ¥åº”ç”¨æ–¹ï¼Œå®ç°é«˜å¯ç”¨æ€§ã€‚</p><figure><img src="/assets/20210629215356-915de8ac.png" alt="Rediså“¨å…µé«˜å¯ç”¨" tabindex="0" loading="lazy"><figcaption>Rediså“¨å…µé«˜å¯ç”¨</figcaption></figure><p><strong>ä¸»èŠ‚ç‚¹æ•…éšœå¤„ç†æ–¹å¼/å“¨å…µå·¥ä½œæ–¹å¼</strong>ï¼š</p><ol><li>å“¨å…µæœºåˆ¶å»ºç«‹äº†å¤šä¸ªå“¨å…µèŠ‚ç‚¹(è¿›ç¨‹)ï¼Œå…±åŒç›‘æ§æ•°æ®èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶å†µã€‚</li><li>åŒæ—¶å“¨å…µèŠ‚ç‚¹ä¹‹é—´ä¹Ÿäº’ç›¸é€šä¿¡ï¼Œäº¤æ¢å¯¹ä¸»ä»èŠ‚ç‚¹çš„ç›‘æ§çŠ¶å†µã€‚</li><li><strong>æ¯éš”1ç§’æ¯ä¸ªå“¨å…µä¼šå‘æ•´ä¸ªé›†ç¾¤</strong>ï¼šMasterä¸»æœåŠ¡å™¨+Slaveä»æœåŠ¡å™¨+å…¶ä»–Sentinel(å“¨å…µ)è¿›ç¨‹ï¼Œå‘é€ä¸€æ¬¡pingå‘½ä»¤åšä¸€æ¬¡å¿ƒè·³æ£€æµ‹ã€‚</li></ol><p><strong>ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿</strong></p><p>**ä¸»è§‚ä¸‹çº¿ï¼š**ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹åˆ¤å®šä¸»èŠ‚ç‚¹downæ‰æ˜¯ä¸»è§‚ä¸‹çº¿ã€‚</p><p>**å®¢è§‚ä¸‹çº¿ï¼š**åªæœ‰åŠæ•°å“¨å…µèŠ‚ç‚¹éƒ½ä¸»è§‚åˆ¤å®šä¸»èŠ‚ç‚¹downæ‰ï¼Œæ­¤æ—¶å¤šä¸ªå“¨å…µèŠ‚ç‚¹äº¤æ¢ä¸»è§‚åˆ¤å®šç»“æœï¼Œæ‰ä¼šåˆ¤å®šä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿ã€‚</p><p><strong>åŸç†</strong>ï¼š</p><p>åŸºæœ¬ä¸Šå“ªä¸ªå“¨å…µèŠ‚ç‚¹æœ€å…ˆåˆ¤æ–­å‡ºè¿™ä¸ªä¸»èŠ‚ç‚¹å®¢è§‚ä¸‹çº¿ï¼Œå°±ä¼šåœ¨å„ä¸ªå“¨å…µèŠ‚ç‚¹ä¸­å‘èµ·æŠ•ç¥¨æœºåˆ¶Raftç®—æ³•(é€‰ä¸¾ç®—æ³•)ï¼Œæœ€ç»ˆè¢«æŠ•ä¸ºé¢†å¯¼è€…çš„å“¨å…µèŠ‚ç‚¹å®Œæˆä¸»ä»è‡ªåŠ¨åŒ–åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œå®¢æˆ·ç«¯åœ¨masterèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ä¼šé‡å‘å“¨å…µè¦åœ°å€ï¼Œæ­¤æ—¶ä¼šè·å¾—æœ€æ–°çš„masterèŠ‚ç‚¹åœ°å€ã€‚ã€‚</p><p><strong>æ‰©å®¹é—®é¢˜</strong></p><p>å“¨å…µæ¨¡å¼çš„å‡ºç°è™½ç„¶è§£å†³äº†ä¸»ä»æ¨¡å¼ä¸­masterèŠ‚ç‚¹å®•æœºä¸èƒ½è‡ªä¸»åˆ‡æ¢(å³é«˜å¯ç”¨)çš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œéšç€ä¸šåŠ¡çš„é€æ¸å¢é•¿ï¼Œä¸å¯é¿å…éœ€è¦å¯¹å½“å‰ä¸šåŠ¡è¿›è¡Œæ‰©å®¹ã€‚</p><p>å¸¸è§çš„æ‰©å®¹æ–¹å¼æœ‰å‚ç›´å’Œæ°´å¹³æ‰©å®¹ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>å‚ç›´æ‰©å®¹</strong>ï¼šé€šè¿‡å¢åŠ masterå†…å­˜æ¥å¢åŠ å®¹é‡ï¼›</li><li><strong>æ°´å¹³æ‰©å®¹</strong>ï¼šé€šè¿‡å¢åŠ èŠ‚ç‚¹æ¥è¿›è¡Œæ‰©å®¹ï¼Œå³åœ¨å½“å‰åŸºç¡€ä¸Šå†å¢åŠ ä¸€ä¸ªmasterèŠ‚ç‚¹ã€‚</li></ul><p>è™½ç„¶å‚ç›´æ‰©å®¹æ–¹å¼å¾ˆä¾¿æ·ï¼Œä¸éœ€è¦æ·»åŠ å¤šä½™çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯æœºå™¨çš„å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦é€šè¿‡æ°´å¹³æ‰©å®¹æ–¹å¼æ¥è§£å†³ã€‚è€Œæ°´å¹³æ‰©å®¹æ¶‰åŠåˆ°æ•°æ®çš„è¿ç§»ï¼Œä¸”è¿ç§»è¿‡ç¨‹ä¸­åˆè¦ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚å› æ­¤ï¼Œæ•°æ®èƒ½ä¸è¿ç§»å°±å°½é‡ä¸è¦è¿ç§»ã€‚</p><p>æ˜¾ç„¶ï¼Œå“¨å…µæ¨¡å¼æ— æ³•æ»¡è¶³è¿™ç§æƒ…å½¢ã€‚å› æ­¤ï¼Œredis clusteråº”è¿è€Œç”Ÿã€‚</p><h3 id="_17-3-redis-cluster-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_17-3-redis-cluster-æ¨¡å¼" aria-hidden="true">#</a> 17.3 Redis cluster æ¨¡å¼</h3><p>ç®€ä»‹ï¼š</p><ol><li><p>redis clusteræ¨¡å¼é‡‡ç”¨äº† <strong>æ— ä¸­å¿ƒèŠ‚ç‚¹</strong> çš„æ–¹å¼æ¥å®ç°ï¼Œ<strong>æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½ä¼šä¸å…¶å®ƒä¸»èŠ‚ç‚¹ä¿æŒè¿æ¥</strong>ã€‚èŠ‚ç‚¹é—´é€šè¿‡gossipåè®®äº¤æ¢å½¼æ­¤çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ¯ä¸ªä¸»èŠ‚ç‚¹åˆæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼›</p></li><li><p>å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æ—¶ï¼Œç›´æ¥ä¸redisé›†ç¾¤çš„æ¯ä¸ªä¸»èŠ‚ç‚¹è¿æ¥ï¼Œæ ¹æ®hashç®—æ³•å–æ¨¡å°†keyå­˜å‚¨åœ¨ä¸åŒçš„å“ˆå¸Œæ§½ä¸Šï¼›</p></li><li><p>åœ¨é›†ç¾¤ä¸­é‡‡ç”¨æ•°æ®åˆ†ç‰‡çš„æ–¹å¼ï¼Œå°†redisé›†ç¾¤åˆ†ä¸º16384ä¸ªå“ˆå¸Œæ§½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™äº›å“ˆå¸Œæ§½åˆ†åˆ«å­˜å‚¨äºä¸‰ä¸ªä¸»èŠ‚ç‚¹ä¸­ï¼š</p></li></ol><ul><li>Master1è´Ÿè´£0~5460å·å“ˆå¸Œæ§½</li><li>Master2è´Ÿè´£5461~10922å·å“ˆå¸Œæ§½</li><li>Master3è´Ÿè´£10922~16383å·å“ˆå¸Œæ§½</li></ul><ol start="4"><li><p>æ¯ä¸ªèŠ‚ç‚¹ä¼šä¿å­˜ä¸€ä»½æ•°æ®åˆ†å¸ƒè¡¨ï¼ŒèŠ‚ç‚¹ä¼šå°†è‡ªå·±çš„slotä¿¡æ¯å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é—´ä¸åœçš„ä¼ é€’æ•°æ®åˆ†å¸ƒè¡¨ï¼›</p></li><li><p>å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤æ—¶ï¼Œé€šè¿‡é›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹åœ°å€è¿›è¡Œè¿æ¥ã€‚å®¢æˆ·ç«¯å°è¯•å‘è¿™ä¸ªèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œæ¯”å¦‚è·å–æŸä¸ªkeyå€¼ï¼Œå¦‚æœkeyæ‰€åœ¨çš„slotåˆšå¥½åœ¨è¯¥èŠ‚ç‚¹ä¸Šï¼Œåˆ™èƒ½å¤Ÿç›´æ¥æ‰§è¡ŒæˆåŠŸã€‚å¦‚æœslotä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œåˆ™èŠ‚ç‚¹ä¼šè¿”å›MOVEDé”™è¯¯ï¼ŒåŒæ—¶æŠŠè¯¥slotå¯¹åº”çš„èŠ‚ç‚¹å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥å»è¯¥èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ã€‚</p></li></ol><p><strong>ä¸»èŠ‚ç‚¹æ•…éšœå¤„ç†æ–¹å¼</strong>ï¼š</p><p>redis clusterä¸­ä¸»èŠ‚ç‚¹æ•…éšœå¤„ç†æ–¹å¼ä¸å“¨å…µæ¨¡å¼è¾ƒä¸ºç›¸åƒï¼Œå½“çº¦å®šæ—¶é—´å†…æŸèŠ‚ç‚¹æ— æ³•ä¸é›†ç¾¤ä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹é¡ºåˆ©å®Œæˆpingæ¶ˆæ¯é€šä¿¡æ—¶ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ŒåŒæ—¶å°†è¿™ä¸ªä¿¡æ¯å‘æ•´ä¸ªé›†ç¾¤å¹¿æ’­ã€‚</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹å¤±è”çš„æ•°é‡è¾¾åˆ°äº†é›†ç¾¤çš„å¤§å¤šæ•°æ—¶ï¼Œé‚£ä¹ˆå°†è¯¥èŠ‚ç‚¹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿çŠ¶æ€ï¼Œå¹¶å‘é›†ç¾¤å¹¿æ’­ä¸‹çº¿èŠ‚ç‚¹çš„failæ¶ˆæ¯ã€‚ç„¶åç«‹å³å¯¹è¯¥æ•…éšœèŠ‚ç‚¹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚ç­‰åˆ°åŸæ¥çš„ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¼šè‡ªåŠ¨æˆä¸ºæ–°ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ã€‚<strong>å¦‚æœä¸»èŠ‚ç‚¹æ²¡æœ‰ä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“å®ƒå‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤å°±å°†å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</strong></p><p><strong>æ‰©å®¹é—®é¢˜</strong></p><p>åœ¨å“¨å…µæ¨¡å¼ä¸­æˆ‘ä»¬åœ¨æ‰©å®¹çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜ï¼Œé‚£ä¹ˆclusterä¸­æˆ‘ä»¬å¦‚ä½•åŠ¨æ€ä¸Šçº¿æŸä¸ªèŠ‚ç‚¹å‘¢ã€‚å½“é›†ç¾¤ä¸­åŠ å…¥æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œå“ˆå¸Œæ§½åˆæ˜¯å¦‚ä½•æ¥è¿›è¡Œåˆ†é…çš„ï¼Ÿå½“é›†ç¾¤ä¸­åŠ å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œä¼šä¸é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹è¿›è¡Œæ¡æ‰‹ï¼Œè¯¥èŠ‚ç‚¹ä¼šæŠŠé›†ç¾¤å†…çš„å…¶å®ƒèŠ‚ç‚¹ä¿¡æ¯é€šè¿‡gossipåè®®å‘é€ç»™æ–°èŠ‚ç‚¹ï¼Œæ–°èŠ‚ç‚¹ä¸è¿™äº›èŠ‚ç‚¹å®Œæˆæ¡æ‰‹ååŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚</p><p>ç„¶åé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¼šå„å–ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½åˆ†é…ç»™æ–°èŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><ul><li>Master1è´Ÿè´£1365-5460</li><li>Master2è´Ÿè´£6827-10922</li><li>Master3è´Ÿè´£12288-16383</li><li>Master4è´Ÿè´£0-1364,5461-6826,10923-12287</li></ul><p>å½“é›†ç¾¤ä¸­è¦åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œåªéœ€è¦å°†èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰å“ˆå¸Œæ§½ç§»åŠ¨åˆ°å…¶å®ƒèŠ‚ç‚¹ï¼Œç„¶åå†ç§»é™¤ç©ºç™½(ä¸åŒ…å«ä»»ä½•å“ˆå¸Œæ§½)çš„èŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚</p><p>ä¸€è‡´æ€§hashè§£å†³æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è¿›è¡Œæ•°æ®å˜æ›´çš„é—®é¢˜ï¼š<a href="https://blog.csdn.net/wlccomeon/article/details/86553831" target="_blank" rel="noopener noreferrer">Redisåˆ†å¸ƒå¼ç®—æ³•åŸç†â€”Hashä¸€è‡´æ€§ç†è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ" aria-hidden="true">#</a> å‚è€ƒï¼š</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/354314607" target="_blank" rel="noopener noreferrer">åƒé€è¿™ä»½Rediså­¦ä¹ ç¬”è®°ï¼Œç›´æ¥æŠŠé˜¿é‡Œé¢è¯•å®˜æŒ‰åœ¨åœ°ä¸Šæ‘©æ“¦ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (Rediså¸¸è§é¢è¯•é¢˜ï¼Œå…¨é¢)</li><li><a href="https://snailclimb.gitee.io/javaguide/#/docs/database/Redis/redis-all" target="_blank" rel="noopener noreferrer">JavaGuild-Redisé¢è¯•æ€»ç»“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/368770382" target="_blank" rel="noopener noreferrer">é¢è¯•é¢˜ç³»åˆ—ï¼šRedis å¤ºå‘½è¿ç¯11é—®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/130923806" target="_blank" rel="noopener noreferrer">Redis 21é—®ï¼Œä½ æ¥å¾—ä½ä¸ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000019910205" target="_blank" rel="noopener noreferrer">ä¸ƒé“å¸¸è§çš„Redisé¢è¯•é¢˜åˆ†äº«<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (éƒ¨åˆ†é—®é¢˜å›ç­”æ¯”è¾ƒç»å…¸)</li><li><a href="https://zhuanlan.zhihu.com/p/118561398" target="_blank" rel="noopener noreferrer">æˆ‘å’Œé¢è¯•å®˜çš„åšå¼ˆï¼šRedis ç¯‡ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/106997927" target="_blank" rel="noopener noreferrer">é˜¿é‡ŒäºŒé¢ï¼šç†Ÿæ‚‰Redisï¼Ÿè®²è®²ä½ ç†è§£çš„Redisçš„æŒä¹…åŒ–æœºåˆ¶(RDBã€AOF)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (è¯¦ç»†ä»‹ç»RedisæŒä¹…åŒ–åŸç†)</li><li><a href="https://zhuanlan.zhihu.com/p/91770135" target="_blank" rel="noopener noreferrer">å¦‚ä½•ä¿éšœmysqlå’Œredisä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/134314240" target="_blank" rel="noopener noreferrer">åŠæ‰“é¢è¯•å®˜ç³»åˆ—ï¼šRedis æ€§èƒ½ä¼˜åŒ–çš„ 13 æ¡å†›è§„å¤§å…¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (å„ä¸ªè§’åº¦é˜è¿°Rediså†…å­˜ä¼˜åŒ–ï¼Œå¾ˆå…¨é¢)</li><li><a href="https://zhuanlan.zhihu.com/p/55068567" target="_blank" rel="noopener noreferrer">rediså†…å­˜ç¯‡ä¹‹å†…å­˜ä¼˜åŒ–<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (å¯¹æ¯”ä¸Šæ¡ï¼Œæœ‰é¢å¤–çš„å‡ ä¸ªç‚¹å€¼å¾—å‚è€ƒ)</li><li><a href="https://www.pianshen.com/article/2203950362/" target="_blank" rel="noopener noreferrer">Redisè¿›é˜¶-----Redisçº¿ç¨‹æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (å‚è€ƒå…¶çº¿ç¨‹æ¨¡å‹è¿‡ç¨‹)</li><li><a href="http://www.jackypeng.cn/archives/2019091116004462560" target="_blank" rel="noopener noreferrer">åˆ†å¸ƒå¼ç¼“å­˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (å‚è€ƒå…¶çº¿ç¨‹æ¨¡å‹å›¾ç‰‡ï¼Œå¦å¤–åˆ«çš„å…³äºåˆ†å¸ƒå¼ç¼“å­˜çš„æµç¨‹å›¾å¾ˆå€¼å¾—å‚è€ƒ)</li><li><a href="https://draveness.me/whys-the-design-redis-single-thread/" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆ Redis é€‰æ‹©å•çº¿ç¨‹æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s/FZu3acwK6zrCBZQ_3HoUgw" target="_blank" rel="noopener noreferrer">Redis 6.0 æ–°ç‰¹æ€§-å¤šçº¿ç¨‹è¿ç¯13é—®ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/357343339" target="_blank" rel="noopener noreferrer">Redisä¸æ˜¯ä¸€ç›´å·ç§°å•çº¿ç¨‹æ•ˆç‡ä¹Ÿå¾ˆé«˜å—ï¼Œä¸ºä»€ä¹ˆåˆé‡‡ç”¨å¤šçº¿ç¨‹äº†ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/112569352" target="_blank" rel="noopener noreferrer">ä¸€æ–‡æ·±å…¥äº†è§£ Redis å†…å­˜æ¨¡å‹ï¼ŒRedis çš„å¿«æ˜¯æœ‰åŸå› çš„ï¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (æ·±å…¥åº•å±‚è®²è§£Rediså†…å­˜)</li><li><a href="https://zhuanlan.zhihu.com/p/144268090" target="_blank" rel="noopener noreferrer">é«˜é¢‘Redisé¢è¯•é¢˜è§£æï¼šRedis äº‹åŠ¡æ˜¯å¦å…·å¤‡åŸå­æ€§ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (åå‘åŸç†)</li><li><a href="https://zhuanlan.zhihu.com/p/43897838" target="_blank" rel="noopener noreferrer">ç¬¬ä¸‰åä¸‰ç« ï¼šRedisäº‹åŠ¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (åå‘åŸºç¡€å’Œæ“ä½œ)</li><li><a href="https://juejin.cn/post/6844903986475057165" target="_blank" rel="noopener noreferrer">ã€Šæˆ‘ä»¬ä¸€èµ·è¿›å¤§å‚ã€‹ç³»åˆ—-ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.zhihu.com/question/300767410/answer/1749442787" target="_blank" rel="noopener noreferrer">æ€æ ·å®ç°redisåˆ†å¸ƒå¼é”ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/52756935" target="_blank" rel="noopener noreferrer">é«˜å¹¶å‘æ¶æ„ç³»åˆ—ï¼šRediså¹¶å‘ç«äº‰keyçš„è§£å†³æ–¹æ¡ˆè¯¦è§£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/59256821" target="_blank" rel="noopener noreferrer">Redlockï¼šRedisåˆ†å¸ƒå¼é”æœ€ç‰›é€¼çš„å®ç°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/111354065" target="_blank" rel="noopener noreferrer">ç»†è¯´Redisåˆ†å¸ƒå¼é”ï¼šsetnx/redisson/redlockï¼Ÿäº†è§£ä¸€æ³¢ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/qq_36417677/article/details/104904306" target="_blank" rel="noopener noreferrer">redisé›†ç¾¤æ­å»ºä»¥åŠredisé›†ç¾¤ä¸­æ·»åŠ æ–°ç»“ç‚¹ï¼Œé‡æ–°åˆ†é…å“ˆå¸Œæ§½<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/crazymakercircle/p/14731826.html" target="_blank" rel="noopener noreferrer">Redisåˆ†å¸ƒå¼é” (å›¾è§£-ç§’æ‡‚-å²ä¸Šæœ€å…¨)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="rediså¸¸è§çš„æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#rediså¸¸è§çš„æ•°æ®ç»“æ„" aria-hidden="true">#</a> Rediså¸¸è§çš„æ•°æ®ç»“æ„</h1><h2 id="string-1" tabindex="-1"><a class="header-anchor" href="#string-1" aria-hidden="true">#</a> String</h2><h3 id="åŸºæœ¬ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Stringæ˜¯Redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueï¼Œ<strong>ä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M</strong>ã€‚</p><p>Stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„å‘³ç€Redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šå¸¸ç”¨åœ¨éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ç­‰ã€‚</p><h3 id="æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>Stringçš„æ•°æ®ç»“æ„ä¸º<strong>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>(Simple Dynamic Stringï¼Œç¼©å†™SDS)ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œé‡‡ç”¨<strong>é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…</strong>ã€‚</p><figure><img src="/assets/202111091645431-cbc1c28e.png" alt="Stringæ•°æ®ç»“æ„" tabindex="0" loading="lazy"><figcaption>Stringæ•°æ®ç»“æ„</figcaption></figure><p>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´capacityä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenã€‚</p><p>å½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º512Mã€‚</p><h3 id="ç¼–ç æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ç¼–ç æ–¹å¼" aria-hidden="true">#</a> ç¼–ç æ–¹å¼</h3><p>å¯¹äº<code>string</code>ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå…¶åº•å±‚ç¼–ç æ–¹å¼å…±æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«ä¸º<code>int</code>ã€<code>embstr</code>å’Œ<code>raw</code>ã€‚</p><ul><li><code>int</code>ï¼šå½“å­˜å‚¨çš„å­—ç¬¦ä¸²å…¨æ˜¯æ•°å­—æ—¶ï¼Œæ­¤æ—¶ä½¿ç”¨<code>int</code>æ–¹å¼æ¥å­˜å‚¨ï¼›</li><li><code>embstr</code>ï¼šå½“å­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å°äº44ä¸ªå­—ç¬¦æ—¶ï¼Œæ­¤æ—¶ä½¿ç”¨<code>embstr</code>æ–¹å¼æ¥å­˜å‚¨ï¼›</li><li><code>raw</code>ï¼šå½“å­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äº44ä¸ªå­—ç¬¦æ—¶ï¼Œæ­¤æ—¶ä½¿ç”¨<code>raw</code>æ–¹å¼æ¥å­˜å‚¨ï¼›</li></ul><p>ä½¿ç”¨<code>object encoding key</code>å¯ä»¥æŸ¥çœ‹<code>key</code>å¯¹åº”çš„<code>encoding</code>ç±»å‹ã€‚</p><h2 id="list-1" tabindex="-1"><a class="header-anchor" href="#list-1" aria-hidden="true">#</a> List</h2><h3 id="åŸºæœ¬ä»‹ç»-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-1" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨(å·¦è¾¹)æˆ–è€…å°¾éƒ¨(å³è¾¹)ã€‚å®ƒæ˜¯å•é”®å¤šå€¼çš„ã€‚</p><p>å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ª<strong>åŒå‘é“¾è¡¨</strong>ï¼Œ<strong>å¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®</strong>ã€‚</p><figure><img src="/assets/202111091645367-229cfe0f.png" alt="image-20211109164542487" tabindex="0" loading="lazy"><figcaption>image-20211109164542487</figcaption></figure><p><strong>åº”ç”¨åœºæ™¯:</strong> å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚</p><h3 id="æ•°æ®ç»“æ„-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-1" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨quickListã€‚</p><ul><li>é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚</li><li>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆquicklistã€‚å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯intç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnextã€‚</li></ul><figure><img src="/assets/202111091647949-32c71a9b.png" alt="image-20211109164705085" tabindex="0" loading="lazy"><figcaption>image-20211109164705085</figcaption></figure><p>Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚</p><h4 id="linkedlist" tabindex="-1"><a class="header-anchor" href="#linkedlist" aria-hidden="true">#</a> linkedList</h4><p>ä¸<code>Java</code>ä¸­çš„<code>LinkedList</code>ç±»ä¼¼ï¼Œ<code>Redis</code>ä¸­çš„<code>linkedList</code>æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œä¹Ÿæ˜¯ç”±ä¸€ä¸ªä¸ªèŠ‚ç‚¹ç»„æˆçš„ã€‚<code>Redis</code>ä¸­å€ŸåŠ©<code>C</code>è¯­è¨€å®ç°çš„é“¾è¡¨èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//å®šä¹‰é“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„ä½“ 
typedf struct listNode{
    //å‰ä¸€ä¸ªèŠ‚ç‚¹
    struct listNode *prev;
    //åä¸€ä¸ªèŠ‚ç‚¹
    struct listNode *next;
    //å½“å‰èŠ‚ç‚¹çš„å€¼çš„æŒ‡é’ˆ
    void *value;
}listNode;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>pre</code>æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<code>next</code>æŒ‡é’ˆæŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<code>value</code>ä¿å­˜ç€å½“å‰èŠ‚ç‚¹å¯¹åº”çš„æ•°æ®å¯¹è±¡ã€‚<code>listNode</code>çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091749843-27f5bcd9.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>é“¾è¡¨çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>typedf struct list{
    //å¤´æŒ‡é’ˆ
    listNode *head;
    //å°¾æŒ‡é’ˆ
    listNode *tail;
    //èŠ‚ç‚¹æ‹·è´å‡½æ•°
    void *(*dup)(void *ptr);
    //é‡Šæ”¾èŠ‚ç‚¹å‡½æ•°
    void *(*free)(void *ptr);
    //åˆ¤æ–­ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰çš„å‡½æ•°
    int (*match)(void *ptr,void *key);
    //é“¾è¡¨é•¿åº¦
    unsigned long len;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>head</code>æŒ‡å‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œ<code>tail</code>æŒ‡å‘é“¾è¡¨çš„å°¾èŠ‚ç‚¹ï¼Œ<code>dup</code>å‡½æ•°ç”¨äºé“¾è¡¨è½¬ç§»å¤åˆ¶æ—¶å¯¹èŠ‚ç‚¹<code>value</code>æ‹·è´çš„ä¸€ä¸ªå®ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨<strong>ç­‰å·</strong>è¶³ä»¥ï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹å¯èƒ½ä¼šç”¨åˆ°èŠ‚ç‚¹è½¬ç§»å‡½æ•°ï¼Œé»˜è®¤å¯ä»¥ç»™è¿™ä¸ªå‡½æ•°èµ‹å€¼<code>NULL</code>å³è¡¨ç¤ºä½¿ç”¨ç­‰å·è¿›è¡ŒèŠ‚ç‚¹è½¬ç§»ã€‚<code>free</code>å‡½æ•°ç”¨äºé‡Šæ”¾ä¸€ä¸ªèŠ‚ç‚¹æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œé»˜è®¤èµ‹å€¼<code>NULL</code>çš„è¯ï¼Œå³ä½¿ç”¨<code>Redis</code>è‡ªå¸¦çš„<code>zfree</code>å‡½æ•°è¿›è¡Œå†…å­˜ç©ºé—´é‡Šæ”¾ã€‚<code>match</code>å‡½æ•°æ˜¯ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªé“¾è¡¨èŠ‚ç‚¹çš„<code>value</code>å€¼æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›1ï¼Œä¸ç­‰è¿”å›0ã€‚<code>len</code>è¡¨ç¤ºè¿™ä¸ªé“¾è¡¨å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨<code>O(1)</code>çš„æ—¶é—´å¤æ‚åº¦å†…è·å¾—é“¾è¡¨çš„é•¿åº¦ã€‚</p><p>é“¾è¡¨çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091750815-7874f826.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="ziplist" tabindex="-1"><a class="header-anchor" href="#ziplist" aria-hidden="true">#</a> ZipList</h4><p><code>Redis</code>çš„<code>zipList</code>ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">ziplist</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//å‹ç¼©åˆ—è¡¨å ç”¨å­—ç¬¦æ•°</span>
    int32 zlbytes<span class="token punctuation">;</span>
    <span class="token comment">//æœ€åä¸€ä¸ªå…ƒç´ è·ç¦»èµ·å§‹ä½ç½®çš„åç§»é‡ï¼Œç”¨äºå¿«é€Ÿå®šä½æœ€åä¸€ä¸ªèŠ‚ç‚¹</span>
    int32 zltail_offset<span class="token punctuation">;</span>
    <span class="token comment">//å…ƒç´ ä¸ªæ•°</span>
    int16 zllength<span class="token punctuation">;</span>
    <span class="token comment">//å…ƒç´ å†…å®¹</span>
    T<span class="token punctuation">[</span><span class="token punctuation">]</span> entries<span class="token punctuation">;</span>
    <span class="token comment">//ç»“æŸä½ 0xFF</span>
    int8 zlend<span class="token punctuation">;</span>
<span class="token punctuation">}</span>ziplist
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>zipList</code>çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091737927-f99044f0.png" alt="ziplist" tabindex="0" loading="lazy"><figcaption>ziplist</figcaption></figure><p>æ³¨æ„åˆ°<code>zltail_offset</code>è¿™ä¸ªå‚æ•°ï¼Œæœ‰äº†è¿™ä¸ªå‚æ•°å°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°æœ€åä¸€ä¸ª<code>entry</code>èŠ‚ç‚¹çš„ä½ç½®ï¼Œç„¶åå¼€å§‹å€’åºéå†ï¼Œä¹Ÿå°±æ˜¯è¯´<code>zipList</code>æ”¯æŒåŒå‘éå†ã€‚</p><p>ä¸‹é¢æ˜¯<code>entry</code>çš„ç»“æ„ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>typede struct entry{
    //å‰ä¸€ä¸ªentryçš„é•¿åº¦
    int&lt;var&gt; prelen;
    //å…ƒç´ ç±»å‹ç¼–ç 
    int&lt;var&gt; encoding;
    //å…ƒç´ å†…å®¹
    optional byte[] content;
}entry
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>prelen</code>ä¿å­˜çš„æ˜¯å‰ä¸€ä¸ª<code>entry</code>èŠ‚ç‚¹çš„é•¿åº¦ï¼Œè¿™æ ·åœ¨å€’åºéå†æ—¶å°±å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°å®šä½åˆ°ä¸Šä¸€ä¸ª<code>entry</code>çš„ä½ç½®ã€‚<code>encoding</code>ä¿å­˜äº†<code>content</code>çš„ç¼–ç ç±»å‹ã€‚<code>content</code>åˆ™æ˜¯ä¿å­˜çš„å…ƒç´ å†…å®¹ï¼Œå®ƒæ˜¯<code>optional</code>ç±»å‹çš„ï¼Œè¡¨ç¤ºè¿™ä¸ªå­—æ®µæ˜¯å¯é€‰çš„ã€‚å½“<code>content</code>æ˜¯å¾ˆå°çš„æ•´æ•°æ—¶ï¼Œå®ƒä¼šå†…è”åˆ°<code>content</code>å­—æ®µçš„å°¾éƒ¨ã€‚<code>entry</code>ç»“æ„çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091738937-0ee059a3.png" alt="entry" tabindex="0" loading="lazy"><figcaption>entry</figcaption></figure><p>å¥½äº†ï¼Œé‚£ç°åœ¨æˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæœ‰äº†<code>linkedList</code>è¿˜æœ‰è®¾è®¡ä¸€ä¸ª<code>zipList</code>å‘¢ï¼Ÿå°±åƒ<code>zipList</code>çš„åå­—ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ï¼Œæ˜¯ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ã€‚ç›¸æ¯”äº<code>linkedList</code>ï¼Œå…¶å°‘äº†<code>pre</code>å’Œ<code>next</code>ä¸¤ä¸ªæŒ‡é’ˆã€‚åœ¨<code>Redis</code>ä¸­ï¼Œ<code>pre</code>å’Œ<code>next</code>æŒ‡é’ˆå°±è¦å ç”¨16ä¸ªå­—èŠ‚(64ä½ç³»ç»Ÿçš„ä¸€ä¸ªæŒ‡é’ˆå°±æ˜¯8ä¸ªå­—èŠ‚)ã€‚å¦å¤–ï¼Œ<code>linkedList</code>çš„æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜éƒ½æ˜¯å•ç‹¬åˆ†é…ï¼ŒåŠ å‰§å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå½±å“å†…å­˜çš„ç®¡ç†æ•ˆç‡ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ï¼Œ<code>zipList</code>æ˜¯ç”±è¿ç»­çš„å†…å­˜ç»„æˆçš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºå†…å­˜æ˜¯è¿ç»­çš„ï¼Œå°±å‡å°‘äº†è®¸å¤šå†…å­˜ç¢ç‰‡å’ŒæŒ‡é’ˆçš„å†…å­˜å ç”¨ï¼Œè¿›è€ŒèŠ‚çº¦äº†å†…å­˜ã€‚</p><p><code>zipList</code>éå†æ—¶ï¼Œå…ˆæ ¹æ®<code>zlbytes</code>å’Œ<code>zltail_offset</code>å®šä½åˆ°æœ€åä¸€ä¸ª<code>entry</code>çš„ä½ç½®ï¼Œç„¶åå†æ ¹æ®æœ€åä¸€ä¸ª<code>entry</code>é‡Œçš„<code>prelen</code>æ—¶ç¡®å®šå‰ä¸€ä¸ª<code>entry</code>çš„ä½ç½®ã€‚</p><p><strong>è¿é”æ›´æ–°</strong></p><p>ä¸Šé¢è¯´åˆ°äº†ï¼Œ<code>entry</code>ä¸­æœ‰ä¸€ä¸ª<code>prelen</code>å­—æ®µï¼Œå®ƒçš„é•¿åº¦è¦ä¹ˆæ˜¯1ä¸ªå­—èŠ‚ï¼Œè¦ä¹ˆéƒ½æ˜¯5ä¸ªå­—èŠ‚ï¼š</p><ul><li>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å°äº254ä¸ªå­—èŠ‚ï¼Œåˆ™<code>prelen</code>é•¿åº¦ä¸º1å­—èŠ‚ï¼›</li><li>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å¤§äº254å­—èŠ‚ï¼Œåˆ™<code>prelen</code>é•¿åº¦ä¸º5å­—èŠ‚ï¼›</li></ul><p>å‡è®¾ç°åœ¨æœ‰ä¸€ç»„å‹ç¼©åˆ—è¡¨ï¼Œé•¿åº¦éƒ½åœ¨250~253å­—èŠ‚ä¹‹é—´ï¼Œçªç„¶æ–°å¢ä¸€ä¸ª<code>entry</code>èŠ‚ç‚¹ï¼Œè¿™ä¸ª<code>entry</code>èŠ‚ç‚¹é•¿åº¦å¤§äºç­‰äº254å­—èŠ‚ã€‚ç”±äºæ–°çš„<code>entry</code>èŠ‚ç‚¹å¤§äºç­‰äº254å­—èŠ‚ï¼Œè¿™ä¸ª<code>entry</code>èŠ‚ç‚¹çš„<code>prelen</code>ä¸º5ä¸ªå­—èŠ‚ï¼Œéšåä¼šå¯¼è‡´å…¶ä½™çš„æ‰€æœ‰<code>entry</code>èŠ‚ç‚¹çš„<code>prelen</code>å¢å¤§ä¸º5å­—èŠ‚ã€‚</p><figure><img src="/assets/202111091740545-83e6093a.png" alt="è¿é”æ›´æ–°" tabindex="0" loading="lazy"><figcaption>è¿é”æ›´æ–°</figcaption></figure><p>åŒæ ·åœ°ï¼Œåˆ é™¤æ“ä½œä¹Ÿä¼šå¯¼è‡´å‡ºç°<strong>è¿é”æ›´æ–°</strong>è¿™ç§æƒ…å†µï¼Œå‡è®¾åœ¨æŸä¸€æ—¶åˆ»ï¼Œæ’å…¥ä¸€ä¸ªé•¿åº¦å¤§äºç­‰äº254ä¸ªå­—èŠ‚çš„<code>entry</code>èŠ‚ç‚¹ï¼ŒåŒæ—¶åˆ é™¤å…¶åé¢çš„ä¸€ä¸ªé•¿åº¦å°äº254ä¸ªå­—èŠ‚çš„<code>entry</code>èŠ‚ç‚¹ï¼Œç”±äºå°äº254çš„<code>entry</code>èŠ‚ç‚¹çš„åˆ é™¤ï¼Œå¤§äºç­‰äº254ä¸ªå­—èŠ‚çš„<code>entry</code>èŠ‚ç‚¹å°†ä¼šä¸åé¢å°äº254ä¸ªå­—èŠ‚çš„<code>entry</code>èŠ‚ç‚¹ç›¸è¿ï¼Œæ­¤æ—¶å°±ä¸æ–°å¢ä¸€ä¸ªé•¿åº¦å¤§äºç­‰äº254ä¸ªå­—èŠ‚çš„<code>entry</code>èŠ‚ç‚¹æ—¶çš„æƒ…å†µä¸€æ ·ï¼Œå°†ä¼šå‘ç”Ÿè¿ç»­æ›´æ–°ã€‚å‘ç”Ÿè¿ç»­æ›´æ–°æ—¶ï¼Œ<code>Redis</code>éœ€è¦ä¸æ–­åœ°å¯¹å‹ç¼©åˆ—è¡¨è¿›è¡Œ<strong>å†…å­˜åˆ†é…å·¥ä½œ</strong>ï¼Œç›´åˆ°ç»“æŸã€‚</p><h4 id="quicklist" tabindex="-1"><a class="header-anchor" href="#quicklist" aria-hidden="true">#</a> quickList</h4><p>åœ¨<code>Redis</code>3.2ç‰ˆæœ¬ä¹‹åï¼Œ<code>list</code>çš„åº•å±‚å®ç°æ–¹å¼åˆå¤šäº†ä¸€ç§ï¼Œ<code>quickList</code>ã€‚<code>qucikList</code>æ˜¯ç”±<code>zipList</code>å’ŒåŒå‘é“¾è¡¨<code>linkedList</code>ç»„æˆçš„æ··åˆä½“ã€‚å®ƒå°†<code>linkedList</code>æŒ‰æ®µåˆ‡åˆ†ï¼Œæ¯ä¸€æ®µä½¿ç”¨<code>zipList</code>æ¥ç´§å‡‘å­˜å‚¨ï¼Œå¤šä¸ª<code>zipList</code>ä¹‹é—´ä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²æ¥èµ·æ¥ã€‚ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091743491-5b69067e.png" alt="quicklist" tabindex="0" loading="lazy"><figcaption>quicklist</figcaption></figure><p>èŠ‚ç‚¹<code>quickListNode</code>çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span><span class="token punctuation">{</span>
    <span class="token comment">//å‰ä¸€ä¸ªèŠ‚ç‚¹</span>
    quicklistNode<span class="token operator">*</span> prev<span class="token punctuation">;</span>
    <span class="token comment">//åä¸€ä¸ªèŠ‚ç‚¹</span>
    quicklistNode<span class="token operator">*</span> next<span class="token punctuation">;</span>
    <span class="token comment">//å‹ç¼©åˆ—è¡¨</span>
    ziplist<span class="token operator">*</span> zl<span class="token punctuation">;</span>	
    <span class="token comment">//ziplistå¤§å°</span>
    int32 size<span class="token punctuation">;</span>		
    <span class="token comment">//ziplist ä¸­å…ƒç´ æ•°é‡</span>
    int16 count<span class="token punctuation">;</span>
    <span class="token comment">//ç¼–ç å½¢å¼ å­˜å‚¨ ziplist è¿˜æ˜¯è¿›è¡Œ LZF å‹ç¼©å‚¨å­˜çš„zipList</span>
    int2 encoding<span class="token punctuation">;</span>			
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>quickListNode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>quickList</code>çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">quicklist</span><span class="token punctuation">{</span>
    <span class="token comment">//æŒ‡å‘å¤´ç»“ç‚¹</span>
    quicklistNode<span class="token operator">*</span> head<span class="token punctuation">;</span>
    <span class="token comment">//æŒ‡å‘å°¾èŠ‚ç‚¹</span>
    quicklistNode<span class="token operator">*</span> tail<span class="token punctuation">;</span>
    <span class="token comment">//å…ƒç´ æ€»æ•°</span>
    <span class="token keyword">long</span> count<span class="token punctuation">;</span>
    <span class="token comment">//quicklistNodeèŠ‚ç‚¹çš„ä¸ªæ•°</span>
    <span class="token keyword">int</span> nodes<span class="token punctuation">;</span>	
    <span class="token comment">//å‹ç¼©ç®—æ³•æ·±åº¦</span>
    <span class="token keyword">int</span> compressDepth<span class="token punctuation">;</span>		
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>quickList
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç®€å•åœ°è¡¨ç¤ºäº†<code>quickList</code>çš„å¤§è‡´ç»“æ„ï¼Œä¸ºäº†è¿›ä¸€æ­¥èŠ‚çº¦ç©ºé—´ï¼Œ<code>Redis</code>è¿˜ä¼šå¯¹<code>zipList</code>è¿›è¡Œå‹ç¼©å­˜å‚¨ï¼Œä½¿ç”¨<strong>LZF</strong>ç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥é€‰æ‹©å‹ç¼©æ·±åº¦ã€‚</p><h4 id="æ¯ä¸ªziplistå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªå…ƒç´ " tabindex="-1"><a class="header-anchor" href="#æ¯ä¸ªziplistå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªå…ƒç´ " aria-hidden="true">#</a> æ¯ä¸ªzipListå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªå…ƒç´ ï¼Ÿ</h4><p>æƒ³è¦äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œå°±å¾—æ‰“å¼€<code>redis.conf</code>æ–‡ä»¶äº†ã€‚åœ¨<code>DVANCED CONFIG</code>ä¸‹é¢æœ‰ç€æ¸…æ™°çš„è®°è½½ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Lists are also encoded in a special way to save a lot of space.
# The number of entries allowed per internal list node can be specified
# as a fixed maximum size or a maximum number of elements.
# For a fixed maximum size, use -5 through -1, meaning:
# -5: max size: 64 Kb  &lt;-- not recommended for normal workloads
# -4: max size: 32 Kb  &lt;-- not recommended
# -3: max size: 16 Kb  &lt;-- probably not recommended
# -2: max size: 8 Kb   &lt;-- good
# -1: max size: 4 Kb   &lt;-- good
# Positive numbers mean store up to _exactly_ that number of elements
# per list node.
# The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),
# but if your use case is unique, adjust the settings as necessary.
list-max-ziplist-size -2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>quickList</code>å†…éƒ¨é»˜è®¤å•ä¸ª<code>zipList</code>é•¿åº¦ä¸º<strong>8k</strong>å­—èŠ‚ï¼Œå³<code>list-max-ziplist-size</code>çš„å€¼è®¾ç½®ä¸º**-2**ï¼Œè¶…å‡ºäº†è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ª<code>zipList</code>æ¥å­˜å‚¨æ•°æ®ã€‚æ ¹æ®æ³¨é‡Šå¯çŸ¥ï¼Œæ€§èƒ½æœ€å¥½çš„æ—¶å€™å°±æ˜¯å°±æ˜¯<code>list-max-ziplist-size</code>ä¸º**-1<strong>å’Œ</strong>-2**ï¼Œå³åˆ†åˆ«æ˜¯<strong>4kbå’Œ8kb</strong>çš„æ—¶å€™ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªå€¼ä¹Ÿå¯ä»¥è¢«è®¾ç½®ä¸ºæ­£æ•°ï¼Œå½“<code>list-max-ziplist-szie</code>ä¸º<strong>æ­£æ•°n</strong>æ—¶ï¼Œè¡¨ç¤ºæ¯ä¸ª<code>quickList</code>èŠ‚ç‚¹ä¸Šçš„<code>zipList</code>æœ€å¤šåŒ…å«<strong>nä¸ª</strong>æ•°æ®é¡¹ã€‚</p><h4 id="å‹ç¼©æ·±åº¦" tabindex="-1"><a class="header-anchor" href="#å‹ç¼©æ·±åº¦" aria-hidden="true">#</a> å‹ç¼©æ·±åº¦</h4><p>ä¸Šé¢æåˆ°è¿‡ï¼Œ<code>quickList</code>ä¸­å¯ä»¥ä½¿ç”¨å‹ç¼©ç®—æ³•å¯¹<code>zipList</code>è¿›è¡Œè¿›ä¸€æ­¥çš„å‹ç¼©ï¼Œè¿™ä¸ªç®—æ³•å°±æ˜¯**<a href="https://blog.csdn.net/u012319493/article/details/83653860" target="_blank" rel="noopener noreferrer">LZFç®—æ³•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>**ï¼Œè¿™æ˜¯ä¸€ç§æ— æŸå‹ç¼©ç®—æ³•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸Šé¢çš„é“¾æ¥ã€‚ä½¿ç”¨å‹ç¼©ç®—æ³•å¯¹<code>zipList</code>è¿›è¡Œå‹ç¼©åï¼Œ<code>zipList</code>çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>typedf struct ziplist_compressed{
    //å…ƒç´ ä¸ªæ•°
    int32 size;
    //å…ƒç´ å†…å®¹
    byte[] compressed_data
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶<code>quickList</code>çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/assets/202111091748141-2776f62b.png" alt="img" loading="lazy">]</p><p>å½“ç„¶ï¼Œåœ¨<code>redis.conf</code>æ–‡ä»¶ä¸­çš„<code>DVANCED CONFIG</code>ä¸‹é¢ä¹Ÿå¯ä»¥å¯¹å‹ç¼©æ·±åº¦è¿›è¡Œé…ç½®ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Lists may also be compressed.
# Compress depth is the number of quicklist ziplist nodes from *each* side of
# the list to *exclude* from compression.  The head and tail of the list
# are always uncompressed for fast push/pop operations.  Settings are:
# 0: disable all list compression
# 1: depth 1 means &quot;don&#39;t start compressing until after 1 node into the list,
#    going from either the head or tail&quot;
#    So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]
#    [head], [tail] will always be uncompressed; inner nodes will compress.
# 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]
#    2 here means: don&#39;t compress head or head-&gt;next or tail-&gt;prev or tail,
#    but compress all nodes between them.
# 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]
# etc.
list-compress-depth 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>list-compress-depth</code>è¿™ä¸ªå‚æ•°è¡¨ç¤º**ä¸€ä¸ª<code>quickList</code>ä¸¤ç«¯ä¸è¢«å‹ç¼©çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„èŠ‚ç‚¹ä¸ªæ•°æ˜¯æŒ‡<code>quicklist</code>åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œè€Œä¸æ˜¯æŒ‡<code>ziplist</code>é‡Œé¢çš„æ•°æ®é¡¹ä¸ªæ•°ã€‚å®é™…ä¸Šï¼Œä¸€ä¸ª<code>quicklist</code>èŠ‚ç‚¹ä¸Šçš„<code>ziplist</code>ï¼Œå¦‚æœè¢«å‹ç¼©ï¼Œå°±æ˜¯æ•´ä½“è¢«å‹ç¼©çš„ã€‚</p><ul><li><code>quickList</code>é»˜è®¤çš„å‹ç¼©æ·±åº¦ä¸º<strong>0</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸å¼€å¯å‹ç¼©</li><li>å½“<code>list-compress-depth</code>ä¸º1ï¼Œè¡¨ç¤º<code>quickList</code>çš„ä¸¤ç«¯å„æœ‰1ä¸ªèŠ‚ç‚¹ä¸è¿›è¡Œå‹ç¼©ï¼Œä¸­é—´ç»“ç‚¹è¿›è¡Œå‹ç¼©ï¼›</li><li>å½“<code>list-compress-depth</code>ä¸º2ï¼Œè¡¨ç¤º<code>quickList</code>çš„é¦–å°¾2ä¸ªèŠ‚ç‚¹ä¸è¿›è¡Œå‹ç¼©ï¼Œä¸­é—´ç»“ç‚¹è¿›è¡Œå‹ç¼©ï¼›</li><li>ä»¥æ­¤ç±»æ¨</li></ul><p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå¯¹äº<code>quickList</code>æ¥è¯´ï¼Œå…¶é¦–å°¾ä¸¤ä¸ªèŠ‚ç‚¹æ°¸è¿œä¸ä¼šè¢«å‹ç¼©ã€‚</p><h2 id="hash-1" tabindex="-1"><a class="header-anchor" href="#hash-1" aria-hidden="true">#</a> Hash</h2><h3 id="åŸºæœ¬ä»‹ç»-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-2" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ç±»ä¼¼Javaé‡Œé¢çš„ <code>Map&lt;String,Object&gt;</code></p><p>ç”¨æˆ·IDä¸ºæŸ¥æ‰¾çš„keyï¼Œå­˜å‚¨çš„valueç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯ï¼Œå¦‚æœç”¨æ™®é€šçš„key/valueç»“æ„æ¥å­˜å‚¨ï¼Œä¸»è¦å¦‚ä¸‹ï¼š</p><p><strong>åº”ç”¨åœºæ™¯:</strong> ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ã€‚</p><h3 id="æ•°æ®ç»“æ„-2" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-2" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplist(å‹ç¼©åˆ—è¡¨)ï¼Œdict(å“ˆå¸Œè¡¨)ã€‚å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨dictã€‚</p><h3 id="dict" tabindex="-1"><a class="header-anchor" href="#dict" aria-hidden="true">#</a> Dict</h3><p>å­—å…¸<code>dict</code>ä½œä¸ºä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œ<code>C</code>è¯­è¨€å†…éƒ¨å¹¶ä¸å…·å¤‡ï¼Œå› è€Œ<code>Redis</code>çš„å¼€å‘äººå‘˜è‡ªå·±è®¾è®¡å’Œå¼€å‘äº†<code>Redis</code>ä¸­çš„<code>dict</code>ç»“æ„ã€‚</p><h4 id="dict-1" tabindex="-1"><a class="header-anchor" href="#dict-1" aria-hidden="true">#</a> dict</h4><p>å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">dict</span><span class="token punctuation">{</span>
    dictType <span class="token operator">*</span>type<span class="token punctuation">;</span><span class="token comment">//ç±»å‹ç‰¹å®šå‡½æ•°ï¼ŒåŒ…æ‹¬ä¸€äº›è‡ªå®šä¹‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œ</span>
                   <span class="token comment">//valueèƒ½å¤Ÿå­˜å‚¨</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>private<span class="token punctuation">;</span><span class="token comment">//ç§æœ‰æ•°æ®</span>
    dictht ht<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ä¸¤å¼ hashè¡¨ </span>
    <span class="token keyword">int</span> rehashidx<span class="token punctuation">;</span><span class="token comment">//rehashç´¢å¼•ï¼Œå­—å…¸æ²¡æœ‰è¿›è¡Œrehashæ—¶ï¼Œæ­¤å€¼ä¸º-1</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> iterators<span class="token punctuation">;</span> <span class="token comment">//æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span>
<span class="token punctuation">}</span>dict<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>type</code>å’Œ<code>private</code>è¿™ä¸¤ä¸ªå±æ€§æ˜¯ä¸ºäº†å®ç°å­—å…¸å¤šæ€è€Œè®¾ç½®çš„ï¼Œå½“å­—å…¸ä¸­å­˜æ”¾ç€ä¸åŒç±»å‹çš„å€¼ï¼Œå¯¹åº”çš„ä¸€äº›å¤åˆ¶ï¼Œæ¯”è¾ƒå‡½æ•°ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªå±æ€§é…åˆèµ·æ¥å¯ä»¥å®ç°å¤šæ€çš„æ–¹æ³•è°ƒç”¨ï¼›</li><li><code>ht[2]</code>ï¼Œä¸¤ä¸ª<code>hash</code>è¡¨</li><li><code>rehashidx</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å˜é‡ï¼Œç”¨äºè®°å½•<code>rehash</code>è¿‡ç¨‹çš„è¿›åº¦ï¼Œä»¥åŠæ˜¯å¦æ­£åœ¨è¿›è¡Œ<code>rehash</code>ç­‰ä¿¡æ¯ï¼Œå½“æ­¤å€¼ä¸º**-1**æ—¶ï¼Œè¡¨ç¤ºè¯¥<code>dict</code>æ­¤æ—¶æ²¡æœ‰<code>rehash</code>è¿‡ç¨‹</li><li><code>iterators</code>ï¼Œè®°å½•æ­¤æ—¶<code>dict</code>æœ‰å‡ ä¸ªè¿­ä»£å™¨æ­£åœ¨è¿›è¡Œéå†è¿‡ç¨‹</li></ul><h4 id="dictht" tabindex="-1"><a class="header-anchor" href="#dictht" aria-hidden="true">#</a> <strong>dictht</strong></h4><p>ç”±ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ<code>dict</code>æœ¬è´¨ä¸Šæ˜¯å¯¹å“ˆå¸Œè¡¨<code>dictht</code>çš„ä¸€ä¸ªç®€å•å°è£…ï¼Œ<code>dictht</code>çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">dictht</span><span class="token punctuation">{</span>
    dictEntry <span class="token operator">*</span><span class="token operator">*</span>table<span class="token punctuation">;</span><span class="token comment">//å­˜å‚¨æ•°æ®çš„æ•°ç»„ äºŒç»´</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span><span class="token comment">//æ•°ç»„çš„å¤§å°</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sizemask<span class="token punctuation">;</span><span class="token comment">//å“ˆå¸Œè¡¨çš„å¤§å°çš„æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ï¼Œæ€»æ˜¯ç­‰äº </span>
                           <span class="token comment">//size-1</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> used<span class="token punctuation">;</span><span class="token comment">//// å“ˆå¸Œè¡¨ä¸­ä¸­å…ƒç´ ä¸ªæ•°</span>
<span class="token punctuation">}</span>dictht<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>table</code>æ˜¯ä¸€ä¸ª<code>dictEntry</code>ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºçœŸæ­£å­˜å‚¨æ•°æ®ï¼›<code>size</code>è¡¨ç¤º<code>table</code>è¿™ä¸ªæ•°ç»„çš„å¤§å°ï¼›<code>sizemask</code>ç”¨äºè®¡ç®—ç´¢å¼•ä½ç½®ï¼Œä¸”æ€»æ˜¯ç­‰äº<code>size-1</code>ï¼›<code>used</code>è¡¨ç¤º<code>dictht</code>ä¸­å·²æœ‰çš„èŠ‚ç‚¹æ•°é‡ï¼Œå…¶ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š <img src="/assets/202111091726815-437fe666.png" alt="img" loading="lazy"></p><h4 id="dictentry" tabindex="-1"><a class="header-anchor" href="#dictentry" aria-hidden="true">#</a> <strong>dictEntry</strong></h4><p>ä¸Šé¢åˆ†æ<code>dictht</code>æ—¶è¯´åˆ°ï¼ŒçœŸæ­£å­˜å‚¨æ•°æ®çš„ç»“æ„æ˜¯<code>dictEntry</code>æ•°ç»„ï¼Œå…¶ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>typedf <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span><span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">;</span><span class="token comment">//é”®</span>
    <span class="token keyword">union</span><span class="token punctuation">{</span>
        <span class="token keyword">void</span> val<span class="token punctuation">;</span>
        <span class="token class-name">unit64_t</span> u64<span class="token punctuation">;</span>
        <span class="token class-name">int64_t</span> s64<span class="token punctuation">;</span>
        <span class="token keyword">double</span> d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>v<span class="token punctuation">;</span><span class="token comment">//å€¼</span>
    <span class="token keyword">struct</span> <span class="token class-name">dictEntry</span> <span class="token operator">*</span>nextï¼›<span class="token comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span>
<span class="token punctuation">}</span>dictEntry<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="/assets/202111091727359-59144519.png" alt="image-20200831175713878" tabindex="0" loading="lazy"><figcaption>image-20200831175713878</figcaption></figure><p>æœ€åæ•´ä¸ª<code>dict</code>çš„ç»“æ„ç¤ºæ„å›¾å¦‚ä¸Šæ‰€ç¤ºï¼š</p><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªæ²¡æœ‰å¤„äº<code>rehash</code>çŠ¶æ€ä¸‹çš„å­—å…¸<code>dict</code>ï¼Œæ•´ä¸ª<code>dict</code>ä¸­æœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨<code>dictht</code>ï¼Œå…¶ä¸­ä¸€ä¸ªå“ˆå¸Œè¡¨å­˜å‚¨æ•°æ®ï¼Œå¦ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸ºç©ºã€‚</p><h4 id="æ‰©å®¹å’Œç¼©å®¹" tabindex="-1"><a class="header-anchor" href="#æ‰©å®¹å’Œç¼©å®¹" aria-hidden="true">#</a> <strong>æ‰©å®¹å’Œç¼©å®¹</strong></h4><p>å½“å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ•°é‡é€æ¸å¢åŠ æ—¶ï¼Œæ­¤æ—¶äº§ç”Ÿ<code>hashå†²çª</code>çš„æ¦‚ç‡é€æ¸å¢å¤§ï¼Œä¸”ç”±äº<code>dict</code>ä¹Ÿæ˜¯é‡‡ç”¨<strong>æ‹‰é“¾æ³•</strong>è§£å†³<code>hashå†²çª</code>çš„ï¼Œéšç€<code>hashå†²çª</code>æ¦‚ç‡ä¸Šå‡ï¼Œé“¾è¡¨ä¼šè¶Šæ¥è¶Šé•¿ï¼Œè¿™å°±ä¼šå¯¼è‡´æŸ¥æ‰¾æ•ˆç‡ä¸‹é™ã€‚ç›¸åï¼Œå½“å…ƒç´ ä¸æ–­å‡å°‘æ—¶ï¼Œå…ƒç´ å ç”¨<code>dict</code>çš„ç©ºé—´å°±è¶Šå°‘ï¼Œå‡ºäºå¯¹å†…å­˜çš„æè‡´åˆ©ç”¨ï¼Œæ­¤æ—¶å°±éœ€è¦è¿›è¡Œç¼©å®¹æ“ä½œã€‚</p><p>æ—¢ç„¶è¯´åˆ°æ‰©å®¹å’Œç¼©å®¹ï¼Œç†Ÿæ‚‰<code>Java</code>é›†åˆçš„å°ä¼™ä¼´æ˜¯ä¸æ˜¯æƒ³åˆ°äº†ä»€ä¹ˆã€‚ä¸é”™ï¼Œé‚£å°±æ˜¯<strong>è´Ÿè½½å› å­</strong>ã€‚<strong>è´Ÿè½½å› å­ä¸€èˆ¬ç”¨äºæè¿°é›†åˆå½“å‰è¢«å¡«å……çš„ç¨‹åº¦</strong>ã€‚åœ¨<code>Redis</code>çš„å­—å…¸<code>dict</code>ä¸­ï¼Œ<strong>è´Ÿè´£å› å­=å“ˆå¸Œè¡¨ä¸­å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡/å“ˆå¸Œè¡¨çš„å¤§å°</strong>ï¼Œå³ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>load factor = ht[0].used / ht[0].size
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>Redis</code>ä¸­ï¼Œä¸‰æ¡å…³äºæ‰©å®¹å’Œç¼©å®¹çš„è§„åˆ™ï¼š</p><ul><li>æ²¡æœ‰æ‰§è¡ŒBGSAVEå’ŒBGREWRITEAOFæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº1æ—¶è¿›è¡Œæ‰©å®¹ï¼›</li><li>æ­£åœ¨æ‰§è¡ŒBGSAVEå’ŒBGREWRITEAOFæŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨çš„è´Ÿè½½å› å¤§äºç­‰äº5æ—¶è¿›è¡Œæ‰©å®¹ï¼›</li><li>è´Ÿè½½å› å­å°äº0.1æ—¶ï¼Œ<code>Redis</code>è‡ªåŠ¨å¼€å§‹å¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ”¶ç¼©æ“ä½œï¼›</li></ul><p>å…¶ä¸­ï¼Œæ‰©å®¹å’Œç¼©å®¹çš„æ•°é‡å¤§å°ä¹Ÿæœ‰ä¸€å®šçš„è§„åˆ™ï¼š</p><ul><li>æ‰©å®¹ï¼š<strong>æ‰©å®¹åçš„<code>dictEntry</code>æ•°ç»„æ•°é‡ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº<code>ht[0].used*2</code>çš„<code>2^n</code></strong>ï¼›</li><li>ç¼©å®¹ï¼š<strong>ç¼©å®¹åçš„<code>dictEntry</code>æ•°ç»„æ•°é‡ä¸ºç¬¬ä¸€ä¸ªå¤§äºç­‰äº<code>ht[0].used</code>çš„<code>2^n</code></strong>ï¼›</li></ul><h2 id="set-1" tabindex="-1"><a class="header-anchor" href="#set-1" aria-hidden="true">#</a> Set</h2><h3 id="åŸºæœ¬ä»‹ç»-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-3" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Redis setå¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºsetæ˜¯å¯ä»¥<strong>è‡ªåŠ¨æ’é‡</strong>çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„ã€‚</p><p>Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒ <strong>åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨</strong> ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„ <strong>å¤æ‚åº¦éƒ½æ˜¯O(1)</strong>ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šå¯ä»¥åŸºäº set è½»æ˜“å®ç°<strong>äº¤é›†ã€å¹¶é›†ã€å·®é›†</strong>çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚</p><h3 id="æ•°æ®ç»“æ„-3" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-3" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚</p><p>Javaä¸­HashSetçš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redisçš„setç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨hashç»“æ„ï¼Œæ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚</p><h2 id="zset" tabindex="-1"><a class="header-anchor" href="#zset" aria-hidden="true">#</a> ZSet</h2><h3 id="åŸºæœ¬ä»‹ç»-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-4" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Redisæœ‰åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª<strong>è¯„åˆ†</strong>(score),è¿™ä¸ªè¯„åˆ†(score)è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚<strong>é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤çš„</strong> ã€‚</p><p>å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†(score)æˆ–è€…æ¬¡åº(position)æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚</p><p>è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„,å› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚</p><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong> éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚æ¯”å¦‚åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯(å¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œ)ç­‰ä¿¡æ¯ã€‚</p><h3 id="æ•°æ®ç»“æ„-4" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„-4" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h3><p>SortedSet(zset)æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„ <code>Map&lt;String, Double&gt;</code>ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äº<code>TreeSet</code>ï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚</p><p>zsetåº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼š</p><ol><li><p>hashï¼Œhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚</p></li><li><p>è·³è·ƒè¡¨ï¼Œè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚</p></li></ol><p>zsetä¹Ÿæœ‰ä¸¤ç§ä¸åŒçš„å®ç°ï¼Œåˆ†åˆ«æ˜¯<code>zipList</code>å’Œ<code>skipList</code>ï¼š</p><ul><li>zipListï¼šæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ <ul><li><code>[score,value]</code>é”®å€¼å¯¹æ•°é‡å°‘äº128ä¸ªï¼›</li><li>æ¯ä¸ªå…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ï¼›</li></ul></li><li>skipListï¼šä¸æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶æ—¶ä½¿ç”¨è·³è¡¨ã€ç»„åˆäº†hashå’ŒskipList <ul><li><code>hash</code>ç”¨æ¥å­˜å‚¨<code>value</code>åˆ°<code>score</code>çš„æ˜ å°„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨<code>O(1)</code>æ—¶é—´å†…æ‰¾åˆ°<code>value</code>å¯¹åº”çš„åˆ†æ•°ï¼›</li><li><code>skipList</code>æŒ‰ç…§<strong>ä»å°åˆ°å¤§</strong>çš„é¡ºåºå­˜å‚¨åˆ†æ•°</li><li><code>skipList</code>æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½æ˜¯<code>[socre,value]</code>å¯¹</li></ul></li></ul><h3 id="è·³è·ƒè¡¨" tabindex="-1"><a class="header-anchor" href="#è·³è·ƒè¡¨" aria-hidden="true">#</a> è·³è·ƒè¡¨</h3><p>æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚</p><p>Redisé‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è¡¨å¯ä»¥ä¿è¯å¢ã€åˆ ã€æŸ¥ç­‰æ“ä½œæ—¶çš„æ—¶é—´å¤æ‚åº¦ä¸º<code>O(logN)</code>ï¼Œè¿™ä¸ªæ€§èƒ½å¯ä»¥ä¸å¹³è¡¡æ ‘ç›¸åª²ç¾ï¼Œä½†å®ç°æ–¹å¼ä¸Šå´æ›´åŠ ç®€å•ï¼Œå”¯ä¸€ç¾ä¸­ä¸è¶³çš„å°±æ˜¯è·³è¡¨å ç”¨çš„ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå…¶å®å°±æ˜¯ä¸€ç§<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„æ€æƒ³ã€‚</p><p>å®ä¾‹ï¼šå¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º51</p><p>(1) æœ‰åºé“¾è¡¨ï¼š</p><figure><img src="/assets/202111091711455-e9a0a0aa.png" alt="image-20211109171136112" tabindex="0" loading="lazy"><figcaption>image-20211109171136112</figcaption></figure><p>è¦æŸ¥æ‰¾å€¼ä¸º51çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ã€‚å…±éœ€è¦6æ¬¡æ¯”è¾ƒã€‚</p><p>(2) è·³è·ƒè¡¨</p><figure><img src="/assets/202111091712526-807d373b.png" alt="image-20211109171219713" tabindex="0" loading="lazy"><figcaption>image-20211109171219713</figcaption></figure><ul><li>ä»ç¬¬2å±‚å¼€å§‹ï¼Œ1èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚</li><li>21èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯NULLäº†ï¼Œæ‰€ä»¥ä»21èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬1å±‚</li><li>åœ¨ç¬¬1å±‚ï¼Œ41èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä»41å‘ä¸‹</li><li>åœ¨ç¬¬0å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾4æ¬¡ã€‚</li></ul><p>ä»æ­¤å¯ä»¥çœ‹å‡ºè·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜ã€‚</p><h2 id="bitmaps" tabindex="-1"><a class="header-anchor" href="#bitmaps" aria-hidden="true">#</a> Bitmaps</h2><h3 id="åŸºæœ¬ä»‹ç»-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-5" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶(ä½) ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ 1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œ ä¾‹å¦‚â€œabcâ€å­—ç¬¦ä¸²æ˜¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œ ä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ â€œabcâ€åˆ†åˆ«å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯97ã€ 98ã€ 99ï¼Œ å¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯01100001ã€ 01100010å’Œ01100011ï¼Œå¦‚ä¸‹å›¾</p><figure><img src="/assets/202111111002687-8857c33b.png" alt="image-20211111100250796" tabindex="0" loading="lazy"><figcaption>image-20211111100250796</figcaption></figure><p>åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚</p><p>Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€œæ•°æ®ç±»å‹â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š</p><p>(1) Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²(key-value) ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</p><p>(2) Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡ã€‚</p><figure><img src="/assets/202111111003757-5e84d813.png" alt="image-20211111100301872" tabindex="0" loading="lazy"><figcaption>image-20211111100301872</figcaption></figure><h3 id="ç›¸å…³å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³å‘½ä»¤" aria-hidden="true">#</a> ç›¸å…³å‘½ä»¤</h3><h4 id="_1ã€setbit" tabindex="-1"><a class="header-anchor" href="#_1ã€setbit" aria-hidden="true">#</a> 1ã€setbit</h4><p>è®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼(0æˆ–1)(offset:åç§»é‡ä»0å¼€å§‹)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>setbit<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapsä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„idã€‚</p><p>è®¾ç½®é”®çš„ç¬¬offsetä¸ªä½çš„å€¼(ä»0ç®—èµ·) ï¼Œ å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuserid=1ï¼Œ 6ï¼Œ 11ï¼Œ 15ï¼Œ 19çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰Bitmapsåˆå§‹åŒ–ç»“æœå¦‚å›¾:</p><figure><img src="/assets/202111111005756-8ba9f1d0.png" alt="image-20211111100540833" tabindex="0" loading="lazy"><figcaption>image-20211111100540833</figcaption></figure><p>unique:users:20201106ä»£è¡¨2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·çš„Bitmaps.</p><figure><img src="/assets/202111111006438-23f1074e.png" alt="image-20211111100601628" tabindex="0" loading="lazy"><figcaption>image-20211111100601628</figcaption></figure><blockquote><p>å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—(ä¾‹å¦‚10000) å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚</p></blockquote><h4 id="_2ã€getbit" tabindex="-1"><a class="header-anchor" href="#_2ã€getbit" aria-hidden="true">#</a> 2ã€getbit</h4><p>è·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼(åç§»é‡ä¸å­˜åœ¨ï¼Œä¹Ÿæ˜¯è¿”å›0)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>getbit<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span>offset<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3ã€bitcount" tabindex="-1"><a class="header-anchor" href="#_3ã€bitcount" aria-hidden="true">#</a> 3ã€bitcount</h4><p>ç»Ÿè®¡<strong>å­—ç¬¦ä¸²</strong>è¢«è®¾ç½®ä¸º1çš„bitæ•°ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡bitç»„çš„å­—èŠ‚çš„ä¸‹æ ‡æ•°ï¼ŒäºŒè€…çš†åŒ…å«ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ç»Ÿè®¡å­—ç¬¦ä¸²ä»startå­—èŠ‚åˆ°endå­—èŠ‚æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡</span>
bitcount<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token punctuation">[</span>start end<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4ã€bitop" tabindex="-1"><a class="header-anchor" href="#_4ã€bitop" aria-hidden="true">#</a> 4ã€bitop</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bitop and<span class="token punctuation">(</span>or/not/xor<span class="token punctuation">)</span> <span class="token operator">&lt;</span>destkey<span class="token operator">&gt;</span> <span class="token punctuation">[</span>keyâ€¦<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„and(äº¤é›†) ã€ or(å¹¶é›†) ã€ not(é) ã€ xor(å¼‚æˆ–) æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚</p><p>å®ä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 2020-11-04 æ—¥è®¿é—®ç½‘ç«™çš„userid=1,2,5,9ã€‚</span>
setbit unique:users:20201104 <span class="token number">1</span> <span class="token number">1</span>
setbit unique:users:20201104 <span class="token number">2</span> <span class="token number">1</span>
setbit unique:users:20201104 <span class="token number">5</span> <span class="token number">1</span>
setbit unique:users:20201104 <span class="token number">9</span> <span class="token number">1</span>

<span class="token comment">#2020-11-03 æ—¥è®¿é—®ç½‘ç«™çš„userid=0,1,4,9ã€‚</span>
setbit unique:users:20201103 <span class="token number">0</span> <span class="token number">1</span>
setbit unique:users:20201103 <span class="token number">1</span> <span class="token number">1</span>
setbit unique:users:20201103 <span class="token number">4</span> <span class="token number">1</span>
setbit unique:users:20201103 <span class="token number">9</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡:<code>bitop and unique:users:20201103 unique:users:20201104</code></p><p>è®¡ç®—å‡ºä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡(ä¾‹å¦‚æœˆæ´»è·ƒå°±æ˜¯ç±»ä¼¼è¿™ç§) ï¼Œ å¯ä»¥ä½¿ç”¨oræ±‚å¹¶é›†ï¼š<code>bitop or unique:users:20201103 unique:users:20201104</code></p><h3 id="bitmapsä¸setå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#bitmapsä¸setå¯¹æ¯”" aria-hidden="true">#</a> Bitmapsä¸setå¯¹æ¯”</h3><p>å‡è®¾ç½‘ç«™æœ‰1äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰5åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’ŒBitmapsåˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨ï¼š</p><figure><img src="/assets/202111111015921-66264340.png" alt="image-20211111101502391" tabindex="0" loading="lazy"><figcaption>image-20211111101502391</figcaption></figure><figure><img src="/assets/202111111015690-3dfc7093.png" alt="image-20211111101542846" tabindex="0" loading="lazy"><figcaption>image-20211111101542846</figcaption></figure><p>å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„ã€‚</p><p>ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡(å¤§é‡çš„åƒµå°¸ç”¨æˆ·) ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚</p><figure><img src="/assets/202111111016925-b655547b.png" alt="image-20211111101625476" tabindex="0" loading="lazy"><figcaption>image-20211111101625476</figcaption></figure><h2 id="hyperloglog" tabindex="-1"><a class="header-anchor" href="#hyperloglog" aria-hidden="true">#</a> HyperLogLog</h2><h3 id="åŸºæœ¬ä»‹ç»-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-6" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PV(PageViewé¡µé¢è®¿é—®é‡),å¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚</p><p>ä½†åƒUV(UniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢)ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§ <strong>æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°</strong> çš„é—®é¢˜ç§°ä¸º <strong>åŸºæ•°</strong> é—®é¢˜ã€‚è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š</p><p>(1)æ•°æ®å­˜å‚¨åœ¨MySQLè¡¨ä¸­ï¼Œä½¿ç”¨distinct countè®¡ç®—ä¸é‡å¤ä¸ªæ•°</p><p>(2)ä½¿ç”¨Redisæä¾›çš„hashã€setã€bitmapsç­‰æ•°æ®ç»“æ„æ¥å¤„ç†</p><p>ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p><p>**èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼Ÿ**Redisæ¨å‡ºäº†HyperLogLog</p><p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼Œ<strong>HyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</strong></p><p>åœ¨ Redis é‡Œé¢ï¼Œ<strong>æ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°</strong>ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯åŸºæ•°?</strong></p><p>æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚</p><h3 id="ç›¸å…³å‘½ä»¤-1" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³å‘½ä»¤-1" aria-hidden="true">#</a> ç›¸å…³å‘½ä»¤</h3><h4 id="_1ã€pfadd" tabindex="-1"><a class="header-anchor" href="#_1ã€pfadd" aria-hidden="true">#</a> 1ã€pfadd</h4><p>æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pfadd <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span><span class="token operator">&lt;</span> element<span class="token operator">&gt;</span> <span class="token punctuation">[</span>element <span class="token punctuation">..</span>.<span class="token punctuation">]</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šHyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤åHLLä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><figure><img src="/assets/202111111021159-c59786b6.png" alt="image-20211111102059470" tabindex="0" loading="lazy"><figcaption>image-20211111102059470</figcaption></figure><h4 id="_2ã€pfcount" tabindex="-1"><a class="header-anchor" href="#_2ã€pfcount" aria-hidden="true">#</a> 2ã€pfcount</h4><p><strong>è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°</strong>ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pfcount<span class="token operator">&lt;</span>key<span class="token operator">&gt;</span> <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_3ã€pfmerge" tabindex="-1"><a class="header-anchor" href="#_3ã€pfmerge" aria-hidden="true">#</a> 3ã€pfmerge</h4><p>å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pfmerge<span class="token operator">&lt;</span>destkey<span class="token operator">&gt;</span><span class="token operator">&lt;</span>sourcekey<span class="token operator">&gt;</span> <span class="token punctuation">[</span>sourcekey <span class="token punctuation">..</span>.<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="geospatial" tabindex="-1"><a class="header-anchor" href="#geospatial" aria-hidden="true">#</a> Geospatial</h2><h3 id="åŸºæœ¬ä»‹ç»-7" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-7" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>Redis 3.2 ä¸­å¢åŠ äº†å¯¹GEOç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„2ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redisåŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦Hashç­‰å¸¸è§æ“ä½œã€‚</p><h3 id="ç›¸å…³å‘½ä»¤-2" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³å‘½ä»¤-2" aria-hidden="true">#</a> ç›¸å…³å‘½ä»¤</h3><table><thead><tr><th style="text-align:left;">å‘½ä»¤</th><th style="text-align:left;">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3687.html" target="_blank" rel="noopener noreferrer">Redis GEOHASH å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„ Geohash è¡¨ç¤º</td></tr><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3688.html" target="_blank" rel="noopener noreferrer">Redis GEOPOS å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">ä»keyé‡Œè¿”å›æ‰€æœ‰ç»™å®šä½ç½®å…ƒç´ çš„ä½ç½®(ç»åº¦å’Œçº¬åº¦)</td></tr><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3686.html" target="_blank" rel="noopener noreferrer">Redis GEODIST å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»</td></tr><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3689.html" target="_blank" rel="noopener noreferrer">Redis GEORADIUS å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œ æ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ </td></tr><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3685.html" target="_blank" rel="noopener noreferrer">Redis GEOADD å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">å°†æŒ‡å®šçš„åœ°ç†ç©ºé—´ä½ç½®(çº¬åº¦ã€ç»åº¦ã€åç§°)æ·»åŠ åˆ°æŒ‡å®šçš„keyä¸­</td></tr><tr><td style="text-align:left;"><a href="https://www.redis.net.cn/order/3690.html" target="_blank" rel="noopener noreferrer">Redis GEORADIUSBYMEMBER å‘½ä»¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">æ‰¾å‡ºä½äºæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼Œä¸­å¿ƒç‚¹æ˜¯ç”±ç»™å®šçš„ä½ç½®å…ƒç´ å†³å®š</td></tr></tbody></table><h2 id="å‚çœ‹" tabindex="-1"><a class="header-anchor" href="#å‚çœ‹" aria-hidden="true">#</a> å‚çœ‹ï¼š</h2><ul><li><a href="https://www.bilibili.com/video/BV1Rv41177Af?p=4" target="_blank" rel="noopener noreferrer">ã€å°šç¡…è°·ã€‘Redis 6 å…¥é—¨åˆ°ç²¾é€š è¶…è¯¦ç»† æ•™ç¨‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/reecelin/p/13358432.html" target="_blank" rel="noopener noreferrer">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹List<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/reecelin/p/13362104.html" target="_blank" rel="noopener noreferrer">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹hash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/reecelin/p/13352694.html" target="_blank" rel="noopener noreferrer">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹string<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/reecelin/p/13364089.html" target="_blank" rel="noopener noreferrer">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹set<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/reecelin/p/13368374.html" target="_blank" rel="noopener noreferrer">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹ zset<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/en/distributed/cache/redis.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright Â© 2023 Mr.IIIDelay</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-50a824e8.js" defer></script>
  </body>
</html>
