<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/en/javabase/advance/jvm.html"><meta property="og:site_name" content="IIIDelayçš„ Blog"><meta property="og:title" content="VMè¿è¡Œæ—¶æ•°æ®åŒº"><meta property="og:description" content="VMè¿è¡Œæ—¶æ•°æ®åŒº è¿è¡Œæ—¶æ•°æ®åŒºå†…å­˜ç»“æ„å›¾ JVMå†…å­˜ç»“æ„ çº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †, ç‹¬å è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´, å¯ä»¥çœ‹åšå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ ä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤, ä»è€Œå®ç°æµç¨‹æ§åˆ¶ã€‚å¦‚ï¼šé¡ºåºé€‰æ‹©ã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®, ä»¥ä¾¿çº¿ç¨‹åˆ‡æ¢å›æ¥å¯ä»¥å¾—çŸ¥ä¸Šæ¬¡çš„æ‰§è¡Œä½ç½®ã€‚(é—®é¢˜ï¼šçº¿ç¨‹ä¸ºä»€ä¹ˆç‹¬å ç¨‹åºè®¡æ•°å™¨çš„ç­”æ¡ˆ)"><meta property="og:type" content="article"><meta property="og:image" content="https://mister-hope.github.io/"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="VMè¿è¡Œæ—¶æ•°æ®åŒº"><meta property="article:author" content="Mr.IIIDelay"><meta property="article:tag" content="vm"><meta property="article:tag" content="source"><meta property="article:tag" content="c|c++"><meta property="article:published_time" content="2023-03-26T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"VMè¿è¡Œæ—¶æ•°æ®åŒº","image":["https://mister-hope.github.io/"],"datePublished":"2023-03-26T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Mr.IIIDelay","url":"https://mrhope.site"}]}</script><title>VMè¿è¡Œæ—¶æ•°æ®åŒº | IIIDelayçš„ Blog</title><meta name="description" content="VMè¿è¡Œæ—¶æ•°æ®åŒº è¿è¡Œæ—¶æ•°æ®åŒºå†…å­˜ç»“æ„å›¾ JVMå†…å­˜ç»“æ„ çº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †, ç‹¬å è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´, å¯ä»¥çœ‹åšå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ ä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤, ä»è€Œå®ç°æµç¨‹æ§åˆ¶ã€‚å¦‚ï¼šé¡ºåºé€‰æ‹©ã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®, ä»¥ä¾¿çº¿ç¨‹åˆ‡æ¢å›æ¥å¯ä»¥å¾—çŸ¥ä¸Šæ¬¡çš„æ‰§è¡Œä½ç½®ã€‚(é—®é¢˜ï¼šçº¿ç¨‹ä¸ºä»€ä¹ˆç‹¬å ç¨‹åºè®¡æ•°å™¨çš„ç­”æ¡ˆ)">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-6a04a3cc.css" as="style"><link rel="stylesheet" href="/assets/style-6a04a3cc.css">
    <link rel="modulepreload" href="/assets/app-21433ee4.js"><link rel="modulepreload" href="/assets/framework-b5ea9e64.js"><link rel="modulepreload" href="/assets/jvm.html-8f089829.js"><link rel="modulepreload" href="/assets/jvm.html-50e5372d.js"><link rel="prefetch" href="/assets/intro.html-3cd3e86c.js" as="script"><link rel="prefetch" href="/assets/index.html-25ccf11e.js" as="script"><link rel="prefetch" href="/assets/slides.html-9b79b21a.js" as="script"><link rel="prefetch" href="/assets/disable.html-5833c3eb.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-5511ae0f.js" as="script"><link rel="prefetch" href="/assets/markdown.html-e4562c5e.js" as="script"><link rel="prefetch" href="/assets/page.html-5677046a.js" as="script"><link rel="prefetch" href="/assets/index.html-046ad4b0.js" as="script"><link rel="prefetch" href="/assets/intro.html-7d3ea627.js" as="script"><link rel="prefetch" href="/assets/index.html-fb2a0ee3.js" as="script"><link rel="prefetch" href="/assets/slides.html-9a7b8de6.js" as="script"><link rel="prefetch" href="/assets/disable.html-cf2277db.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-5219ca3b.js" as="script"><link rel="prefetch" href="/assets/markdown.html-3b8712bd.js" as="script"><link rel="prefetch" href="/assets/page.html-9f106f64.js" as="script"><link rel="prefetch" href="/assets/index.html-c3796375.js" as="script"><link rel="prefetch" href="/assets/disable.html-19217888.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-f9f4cdf1.js" as="script"><link rel="prefetch" href="/assets/markdown.html-890091b1.js" as="script"><link rel="prefetch" href="/assets/page.html-bf9b0ca5.js" as="script"><link rel="prefetch" href="/assets/index.html-28d85643.js" as="script"><link rel="prefetch" href="/assets/index.html-423a4e50.js" as="script"><link rel="prefetch" href="/assets/mysql.html-5a0be5f6.js" as="script"><link rel="prefetch" href="/assets/postgresql.html-65cc7a0e.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-90acf583.js" as="script"><link rel="prefetch" href="/assets/redis.html-cd83f8a8.js" as="script"><link rel="prefetch" href="/assets/idwork.html-9c43393f.js" as="script"><link rel="prefetch" href="/assets/css.html-4f40a97b.js" as="script"><link rel="prefetch" href="/assets/html.html-a3b9acb3.js" as="script"><link rel="prefetch" href="/assets/js.html-ce916738.js" as="script"><link rel="prefetch" href="/assets/elaticsearch.html-0843c52d.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-e0bf6a73.js" as="script"><link rel="prefetch" href="/assets/nginx.html-de1349d5.js" as="script"><link rel="prefetch" href="/assets/vue.html-de7169f8.js" as="script"><link rel="prefetch" href="/assets/list.html-7ad4f4ef.js" as="script"><link rel="prefetch" href="/assets/map.html-74dc8f5e.js" as="script"><link rel="prefetch" href="/assets/set.html-8f466ae8.js" as="script"><link rel="prefetch" href="/assets/juc.html-c42a7f22.js" as="script"><link rel="prefetch" href="/assets/thread.html-bc15370b.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-448b0268.js" as="script"><link rel="prefetch" href="/assets/spring.html-88b31e3c.js" as="script"><link rel="prefetch" href="/assets/springboot.html-90d3e17d.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-91a46607.js" as="script"><link rel="prefetch" href="/assets/springcloud.html-f6fa6894.js" as="script"><link rel="prefetch" href="/assets/springcloudAlibaba.html-9d982f31.js" as="script"><link rel="prefetch" href="/assets/404.html-8d7ddf59.js" as="script"><link rel="prefetch" href="/assets/index.html-117f57c1.js" as="script"><link rel="prefetch" href="/assets/index.html-64c23b9f.js" as="script"><link rel="prefetch" href="/assets/index.html-f3603623.js" as="script"><link rel="prefetch" href="/assets/index.html-cdb1cd21.js" as="script"><link rel="prefetch" href="/assets/index.html-2daae4c3.js" as="script"><link rel="prefetch" href="/assets/index.html-4c9b9c86.js" as="script"><link rel="prefetch" href="/assets/index.html-f1134fa2.js" as="script"><link rel="prefetch" href="/assets/index.html-d8f510ea.js" as="script"><link rel="prefetch" href="/assets/index.html-5b0d539d.js" as="script"><link rel="prefetch" href="/assets/index.html-78bed988.js" as="script"><link rel="prefetch" href="/assets/index.html-567289df.js" as="script"><link rel="prefetch" href="/assets/index.html-cbc6836f.js" as="script"><link rel="prefetch" href="/assets/index.html-8bd5f926.js" as="script"><link rel="prefetch" href="/assets/index.html-1986a589.js" as="script"><link rel="prefetch" href="/assets/index.html-9dd75139.js" as="script"><link rel="prefetch" href="/assets/index.html-311ca7c9.js" as="script"><link rel="prefetch" href="/assets/index.html-9a1933f9.js" as="script"><link rel="prefetch" href="/assets/index.html-0b7262b3.js" as="script"><link rel="prefetch" href="/assets/index.html-273e9410.js" as="script"><link rel="prefetch" href="/assets/index.html-6daa24b2.js" as="script"><link rel="prefetch" href="/assets/index.html-e64a306a.js" as="script"><link rel="prefetch" href="/assets/index.html-cbcea2f3.js" as="script"><link rel="prefetch" href="/assets/index.html-8b43dfd1.js" as="script"><link rel="prefetch" href="/assets/index.html-b9502ddb.js" as="script"><link rel="prefetch" href="/assets/index.html-860a114f.js" as="script"><link rel="prefetch" href="/assets/index.html-782963b7.js" as="script"><link rel="prefetch" href="/assets/index.html-fb4b5ad1.js" as="script"><link rel="prefetch" href="/assets/index.html-fd7d15c8.js" as="script"><link rel="prefetch" href="/assets/index.html-2c51a30d.js" as="script"><link rel="prefetch" href="/assets/index.html-a0864148.js" as="script"><link rel="prefetch" href="/assets/index.html-5fc0e626.js" as="script"><link rel="prefetch" href="/assets/index.html-263613fb.js" as="script"><link rel="prefetch" href="/assets/index.html-cce1ce08.js" as="script"><link rel="prefetch" href="/assets/index.html-6851c096.js" as="script"><link rel="prefetch" href="/assets/index.html-4ff8c7b7.js" as="script"><link rel="prefetch" href="/assets/index.html-3ac086ff.js" as="script"><link rel="prefetch" href="/assets/index.html-d1d41465.js" as="script"><link rel="prefetch" href="/assets/index.html-3b736981.js" as="script"><link rel="prefetch" href="/assets/index.html-2adeca1e.js" as="script"><link rel="prefetch" href="/assets/index.html-7f81a989.js" as="script"><link rel="prefetch" href="/assets/index.html-329bd63b.js" as="script"><link rel="prefetch" href="/assets/index.html-379e8d35.js" as="script"><link rel="prefetch" href="/assets/index.html-a84b8e15.js" as="script"><link rel="prefetch" href="/assets/index.html-4b5c4258.js" as="script"><link rel="prefetch" href="/assets/index.html-c954921e.js" as="script"><link rel="prefetch" href="/assets/index.html-c5d3e9ea.js" as="script"><link rel="prefetch" href="/assets/index.html-50403a74.js" as="script"><link rel="prefetch" href="/assets/index.html-4fa66a8d.js" as="script"><link rel="prefetch" href="/assets/index.html-68cb03c4.js" as="script"><link rel="prefetch" href="/assets/index.html-72a13ac8.js" as="script"><link rel="prefetch" href="/assets/index.html-6b6a187d.js" as="script"><link rel="prefetch" href="/assets/index.html-b882d86f.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2f0e41.js" as="script"><link rel="prefetch" href="/assets/index.html-0a302d00.js" as="script"><link rel="prefetch" href="/assets/index.html-e497066a.js" as="script"><link rel="prefetch" href="/assets/index.html-b9a16419.js" as="script"><link rel="prefetch" href="/assets/index.html-8eaf66f1.js" as="script"><link rel="prefetch" href="/assets/index.html-b4337409.js" as="script"><link rel="prefetch" href="/assets/index.html-5aac597d.js" as="script"><link rel="prefetch" href="/assets/index.html-76d6ea93.js" as="script"><link rel="prefetch" href="/assets/index.html-e18f4f65.js" as="script"><link rel="prefetch" href="/assets/index.html-66912fe2.js" as="script"><link rel="prefetch" href="/assets/index.html-1d6c1649.js" as="script"><link rel="prefetch" href="/assets/index.html-9951b9f6.js" as="script"><link rel="prefetch" href="/assets/index.html-72a61392.js" as="script"><link rel="prefetch" href="/assets/index.html-5866170e.js" as="script"><link rel="prefetch" href="/assets/index.html-e9a7e2c1.js" as="script"><link rel="prefetch" href="/assets/index.html-b9068540.js" as="script"><link rel="prefetch" href="/assets/index.html-a1ad137c.js" as="script"><link rel="prefetch" href="/assets/index.html-d34fcedf.js" as="script"><link rel="prefetch" href="/assets/index.html-5fbb46f5.js" as="script"><link rel="prefetch" href="/assets/index.html-bc23c6fe.js" as="script"><link rel="prefetch" href="/assets/index.html-72c728d5.js" as="script"><link rel="prefetch" href="/assets/index.html-d53bd539.js" as="script"><link rel="prefetch" href="/assets/index.html-0b3ed243.js" as="script"><link rel="prefetch" href="/assets/index.html-9820ca5c.js" as="script"><link rel="prefetch" href="/assets/index.html-ee8320a3.js" as="script"><link rel="prefetch" href="/assets/index.html-4f6ef9fe.js" as="script"><link rel="prefetch" href="/assets/index.html-0ca60537.js" as="script"><link rel="prefetch" href="/assets/index.html-57a98e87.js" as="script"><link rel="prefetch" href="/assets/index.html-a25d2e5c.js" as="script"><link rel="prefetch" href="/assets/index.html-8fb62574.js" as="script"><link rel="prefetch" href="/assets/index.html-653530f0.js" as="script"><link rel="prefetch" href="/assets/index.html-c7ccd5a2.js" as="script"><link rel="prefetch" href="/assets/index.html-e6bad382.js" as="script"><link rel="prefetch" href="/assets/index.html-92d775ea.js" as="script"><link rel="prefetch" href="/assets/index.html-b3374bc9.js" as="script"><link rel="prefetch" href="/assets/index.html-04f02cbe.js" as="script"><link rel="prefetch" href="/assets/index.html-f0912e82.js" as="script"><link rel="prefetch" href="/assets/index.html-82c102ea.js" as="script"><link rel="prefetch" href="/assets/index.html-b83f8df8.js" as="script"><link rel="prefetch" href="/assets/index.html-467ea473.js" as="script"><link rel="prefetch" href="/assets/index.html-94c1a7a1.js" as="script"><link rel="prefetch" href="/assets/index.html-8dd82581.js" as="script"><link rel="prefetch" href="/assets/intro.html-88bbbba3.js" as="script"><link rel="prefetch" href="/assets/index.html-f6fd53c8.js" as="script"><link rel="prefetch" href="/assets/slides.html-b6ffd39e.js" as="script"><link rel="prefetch" href="/assets/disable.html-66a5c74b.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-3033137a.js" as="script"><link rel="prefetch" href="/assets/markdown.html-cb727f4d.js" as="script"><link rel="prefetch" href="/assets/page.html-8678032e.js" as="script"><link rel="prefetch" href="/assets/index.html-3499a5f6.js" as="script"><link rel="prefetch" href="/assets/intro.html-63d51bdd.js" as="script"><link rel="prefetch" href="/assets/index.html-5d64d0b2.js" as="script"><link rel="prefetch" href="/assets/slides.html-af8ef7ce.js" as="script"><link rel="prefetch" href="/assets/disable.html-5dcf458d.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-0f82cb4a.js" as="script"><link rel="prefetch" href="/assets/markdown.html-b9914991.js" as="script"><link rel="prefetch" href="/assets/page.html-8e83bdc7.js" as="script"><link rel="prefetch" href="/assets/index.html-b594eaa5.js" as="script"><link rel="prefetch" href="/assets/disable.html-2277927a.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-1aabfd29.js" as="script"><link rel="prefetch" href="/assets/markdown.html-5245eceb.js" as="script"><link rel="prefetch" href="/assets/page.html-1004e52f.js" as="script"><link rel="prefetch" href="/assets/index.html-b3c715af.js" as="script"><link rel="prefetch" href="/assets/index.html-980af55e.js" as="script"><link rel="prefetch" href="/assets/mysql.html-c6a831a9.js" as="script"><link rel="prefetch" href="/assets/postgresql.html-ae4c86e1.js" as="script"><link rel="prefetch" href="/assets/mongodb.html-c8cedc56.js" as="script"><link rel="prefetch" href="/assets/redis.html-c1b5bdc0.js" as="script"><link rel="prefetch" href="/assets/idwork.html-d41a4af5.js" as="script"><link rel="prefetch" href="/assets/css.html-006c799c.js" as="script"><link rel="prefetch" href="/assets/html.html-1323cb24.js" as="script"><link rel="prefetch" href="/assets/js.html-aafa85cf.js" as="script"><link rel="prefetch" href="/assets/elaticsearch.html-67956eb2.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-37a31dca.js" as="script"><link rel="prefetch" href="/assets/nginx.html-96968426.js" as="script"><link rel="prefetch" href="/assets/vue.html-a28e63e0.js" as="script"><link rel="prefetch" href="/assets/list.html-ae9043b4.js" as="script"><link rel="prefetch" href="/assets/map.html-3d18fdea.js" as="script"><link rel="prefetch" href="/assets/set.html-92d35319.js" as="script"><link rel="prefetch" href="/assets/juc.html-bc37c26f.js" as="script"><link rel="prefetch" href="/assets/thread.html-ca30083f.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-067666aa.js" as="script"><link rel="prefetch" href="/assets/spring.html-d835cc1f.js" as="script"><link rel="prefetch" href="/assets/springboot.html-c5be012c.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-59b25145.js" as="script"><link rel="prefetch" href="/assets/springcloud.html-8e6e289f.js" as="script"><link rel="prefetch" href="/assets/springcloudAlibaba.html-fe047c42.js" as="script"><link rel="prefetch" href="/assets/404.html-efcbdfb8.js" as="script"><link rel="prefetch" href="/assets/index.html-ebf9fe5f.js" as="script"><link rel="prefetch" href="/assets/index.html-990bfc25.js" as="script"><link rel="prefetch" href="/assets/index.html-91822548.js" as="script"><link rel="prefetch" href="/assets/index.html-db9428bf.js" as="script"><link rel="prefetch" href="/assets/index.html-afb5bce3.js" as="script"><link rel="prefetch" href="/assets/index.html-fbdff309.js" as="script"><link rel="prefetch" href="/assets/index.html-48e2a336.js" as="script"><link rel="prefetch" href="/assets/index.html-c3c2c32b.js" as="script"><link rel="prefetch" href="/assets/index.html-9df0f0b3.js" as="script"><link rel="prefetch" href="/assets/index.html-b9049faa.js" as="script"><link rel="prefetch" href="/assets/index.html-da1eec3f.js" as="script"><link rel="prefetch" href="/assets/index.html-c167fb4a.js" as="script"><link rel="prefetch" href="/assets/index.html-58b4f273.js" as="script"><link rel="prefetch" href="/assets/index.html-178f0ee6.js" as="script"><link rel="prefetch" href="/assets/index.html-11b87b78.js" as="script"><link rel="prefetch" href="/assets/index.html-4d0f7e32.js" as="script"><link rel="prefetch" href="/assets/index.html-4f9a4b5f.js" as="script"><link rel="prefetch" href="/assets/index.html-565f97fc.js" as="script"><link rel="prefetch" href="/assets/index.html-7b822086.js" as="script"><link rel="prefetch" href="/assets/index.html-5ec2fddd.js" as="script"><link rel="prefetch" href="/assets/index.html-17eeb5a1.js" as="script"><link rel="prefetch" href="/assets/index.html-d7c67c90.js" as="script"><link rel="prefetch" href="/assets/index.html-8c0771f4.js" as="script"><link rel="prefetch" href="/assets/index.html-b93c98f4.js" as="script"><link rel="prefetch" href="/assets/index.html-74822ef3.js" as="script"><link rel="prefetch" href="/assets/index.html-e82c4191.js" as="script"><link rel="prefetch" href="/assets/index.html-5d3e9263.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0d7594.js" as="script"><link rel="prefetch" href="/assets/index.html-27aa4c3a.js" as="script"><link rel="prefetch" href="/assets/index.html-51ef4f9f.js" as="script"><link rel="prefetch" href="/assets/index.html-d80f1d2d.js" as="script"><link rel="prefetch" href="/assets/index.html-9a262995.js" as="script"><link rel="prefetch" href="/assets/index.html-7a0739b7.js" as="script"><link rel="prefetch" href="/assets/index.html-28bf1937.js" as="script"><link rel="prefetch" href="/assets/index.html-7a26a869.js" as="script"><link rel="prefetch" href="/assets/index.html-f69eb88c.js" as="script"><link rel="prefetch" href="/assets/index.html-c0990ba7.js" as="script"><link rel="prefetch" href="/assets/index.html-87fc4efd.js" as="script"><link rel="prefetch" href="/assets/index.html-dbf81064.js" as="script"><link rel="prefetch" href="/assets/index.html-7702533e.js" as="script"><link rel="prefetch" href="/assets/index.html-890a76e8.js" as="script"><link rel="prefetch" href="/assets/index.html-068b0923.js" as="script"><link rel="prefetch" href="/assets/index.html-cd3cd59c.js" as="script"><link rel="prefetch" href="/assets/index.html-9f82e955.js" as="script"><link rel="prefetch" href="/assets/index.html-e12d1d6e.js" as="script"><link rel="prefetch" href="/assets/index.html-48db118f.js" as="script"><link rel="prefetch" href="/assets/index.html-28893f80.js" as="script"><link rel="prefetch" href="/assets/index.html-9de5fbad.js" as="script"><link rel="prefetch" href="/assets/index.html-85615883.js" as="script"><link rel="prefetch" href="/assets/index.html-c20b48b5.js" as="script"><link rel="prefetch" href="/assets/index.html-fec46570.js" as="script"><link rel="prefetch" href="/assets/index.html-1ee7a748.js" as="script"><link rel="prefetch" href="/assets/index.html-e3b7b7c5.js" as="script"><link rel="prefetch" href="/assets/index.html-2cfeeffe.js" as="script"><link rel="prefetch" href="/assets/index.html-41c6d8bb.js" as="script"><link rel="prefetch" href="/assets/index.html-a3cf3b28.js" as="script"><link rel="prefetch" href="/assets/index.html-69f2b437.js" as="script"><link rel="prefetch" href="/assets/index.html-b2a58a8d.js" as="script"><link rel="prefetch" href="/assets/index.html-074d1cea.js" as="script"><link rel="prefetch" href="/assets/index.html-065ae608.js" as="script"><link rel="prefetch" href="/assets/index.html-177d03c9.js" as="script"><link rel="prefetch" href="/assets/index.html-6ff47688.js" as="script"><link rel="prefetch" href="/assets/index.html-d65d8d73.js" as="script"><link rel="prefetch" href="/assets/index.html-025251c7.js" as="script"><link rel="prefetch" href="/assets/index.html-ff2ab13e.js" as="script"><link rel="prefetch" href="/assets/index.html-edee18a6.js" as="script"><link rel="prefetch" href="/assets/index.html-298c38c9.js" as="script"><link rel="prefetch" href="/assets/index.html-fba460db.js" as="script"><link rel="prefetch" href="/assets/index.html-64389379.js" as="script"><link rel="prefetch" href="/assets/index.html-a36273be.js" as="script"><link rel="prefetch" href="/assets/index.html-409f1932.js" as="script"><link rel="prefetch" href="/assets/index.html-89bfd3d4.js" as="script"><link rel="prefetch" href="/assets/index.html-da90ef68.js" as="script"><link rel="prefetch" href="/assets/index.html-b7547097.js" as="script"><link rel="prefetch" href="/assets/index.html-a8902bc2.js" as="script"><link rel="prefetch" href="/assets/index.html-78efc0d0.js" as="script"><link rel="prefetch" href="/assets/index.html-eefe09e4.js" as="script"><link rel="prefetch" href="/assets/index.html-6ee8b06d.js" as="script"><link rel="prefetch" href="/assets/index.html-c8e4cb15.js" as="script"><link rel="prefetch" href="/assets/index.html-7c752282.js" as="script"><link rel="prefetch" href="/assets/index.html-8447273f.js" as="script"><link rel="prefetch" href="/assets/index.html-8128a73c.js" as="script"><link rel="prefetch" href="/assets/index.html-f52000ab.js" as="script"><link rel="prefetch" href="/assets/index.html-4c6d8a73.js" as="script"><link rel="prefetch" href="/assets/index.html-616a6c28.js" as="script"><link rel="prefetch" href="/assets/index.html-ca4faf6e.js" as="script"><link rel="prefetch" href="/assets/index.html-e3aa9d99.js" as="script"><link rel="prefetch" href="/assets/index.html-737b3cec.js" as="script"><link rel="prefetch" href="/assets/index.html-5551fcaa.js" as="script"><link rel="prefetch" href="/assets/index.html-2ad7ffac.js" as="script"><link rel="prefetch" href="/assets/index.html-b87283e0.js" as="script"><link rel="prefetch" href="/assets/index.html-07adeb48.js" as="script"><link rel="prefetch" href="/assets/index.html-166d26e5.js" as="script"><link rel="prefetch" href="/assets/index.html-144bdc4f.js" as="script"><link rel="prefetch" href="/assets/giscus-16d370b8.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-8764208e.js" as="script"><link rel="prefetch" href="/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-35e03ae3.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-ec0807fa.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-6e6cbe40.js" as="script"><link rel="prefetch" href="/assets/SearchResult-7cc7ddf7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="IIIDelayçš„ Blog"><!----><span class="site-name hide-in-pad">IIIDelayçš„ Blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="Blog Home"><span class="font-icon icon iconfont icon-home" style=""></span>Blog Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/demo/" class="nav-link" aria-label="Demo"><span class="font-icon icon iconfont icon-discover" style=""></span>Demo<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="JavaBase"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaBase</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>é›†åˆ</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javabase/collection/list.html" class="nav-link" aria-label="List"><span class="font-icon icon iconfont icon-edit" style=""></span>List<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/collection/set.html" class="nav-link" aria-label="Set"><span class="font-icon icon iconfont icon-edit" style=""></span>Set<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/collection/map.html" class="nav-link" aria-label="Map"><span class="font-icon icon iconfont icon-edit" style=""></span>Map<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¹¶å‘ç¼–ç¨‹</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javabase/juc/thread.html" class="nav-link" aria-label="Thread"><span class="font-icon icon iconfont icon-edit" style=""></span>Thread<!----></a></li><li class="dropdown-subitem"><a href="/en/javabase/juc/juc.html" class="nav-link" aria-label="JUC"><span class="font-icon icon iconfont icon-edit" style=""></span>JUC<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>è¿›é˜¶</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-current="page" href="/en/javabase/advance/jvm.html" class="router-link-active router-link-exact-active nav-link active" aria-label="JVM"><span class="font-icon icon iconfont icon-edit" style=""></span>JVM<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>dbms</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/database/dbms/mysql.html" class="nav-link" aria-label="Mysql"><span class="font-icon icon iconfont icon-edit" style=""></span>Mysql<!----></a></li><li class="dropdown-subitem"><a href="/en/database/dbms/postgresql.html" class="nav-link" aria-label="Postgresql"><span class="font-icon icon iconfont icon-edit" style=""></span>Postgresql<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSql</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/database/nosql/mongodb.html" class="nav-link" aria-label="MongoDB"><span class="font-icon icon iconfont icon-edit" style=""></span>MongoDB<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>åˆ†å¸ƒå¼</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Cache</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/cache/redis.html" class="nav-link" aria-label="Redis"><span class="font-icon icon iconfont icon-edit" style=""></span>Redis<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Load-Balance</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/loadbalance/nginx.html" class="nav-link" aria-label="Nginx"><span class="font-icon icon iconfont icon-edit" style=""></span>Nginx<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>MQS</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/mqs/rocketmq.html" class="nav-link" aria-label="RocketMQ"><span class="font-icon icon iconfont icon-edit" style=""></span>RocketMQ<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Common</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/distributed/common/idwork.html" class="nav-link" aria-label="åˆ†å¸ƒå¼ID"><span class="font-icon icon iconfont icon-edit" style=""></span>åˆ†å¸ƒå¼ID<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="JavaEE"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaEE</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring-Framework</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javaee/spring_framework/spring.html" class="nav-link" aria-label="Spring"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring<!----></a></li><li class="dropdown-subitem"><a href="/en/javaee/spring_framework/springmvc.html" class="nav-link" aria-label="SpringMVC"><span class="font-icon icon iconfont icon-edit" style=""></span>SpringMVC<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/javaee/orm/mybatis.html" class="nav-link" aria-label="Mybatis"><span class="font-icon icon iconfont icon-edit" style=""></span>Mybatis<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¾®æœåŠ¡"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>å¾®æœåŠ¡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>springå¾®æœåŠ¡ä½“ç³»</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/mricoservices/springio/springcloud.html" class="nav-link" aria-label="Spring-Cloud"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring-Cloud<!----></a></li><li class="dropdown-subitem"><a href="/en/mricoservices/springio/springcloudAlibaba.html" class="nav-link" aria-label="Spring-Cloud Alibaba"><span class="font-icon icon iconfont icon-edit" style=""></span>Spring-Cloud Alibaba<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¤§å‰ç«¯"><span class="title"><span class="font-icon icon iconfont icon-edit" style=""></span>å¤§å‰ç«¯</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Base</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/h5/base/html.html" class="nav-link" aria-label="HTML"><span class="font-icon icon iconfont icon-edit" style=""></span>HTML<!----></a></li><li class="dropdown-subitem"><a href="/en/h5/base/css.html" class="nav-link" aria-label="CSS"><span class="font-icon icon iconfont icon-edit" style=""></span>CSS<!----></a></li><li class="dropdown-subitem"><a href="/en/h5/base/js.html" class="nav-link" aria-label="JavaScript"><span class="font-icon icon iconfont icon-edit" style=""></span>JavaScript<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Framework</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/en/h5/framework/vue.html" class="nav-link" aria-label="VUE"><span class="font-icon icon iconfont icon-edit" style=""></span>VUE<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://github.com/" rel="noopener noreferrer" target="_blank" aria-label="å®˜ç½‘" class="nav-link"><span class="font-icon icon iconfont icon-note" style=""></span>å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button class="dropdown-title" type="button" aria-label="Select language"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-current="page" href="/en/javabase/advance/jvm.html" class="router-link-active router-link-exact-active nav-link active" aria-label="English"><!---->English<!----></a></li><li class="dropdown-item"><a href="/zh/" class="nav-link" aria-label="ç®€ä½“ä¸­æ–‡"><!---->ç®€ä½“ä¸­æ–‡<!----></a></li></ul></button></div></div><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">Search</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/" class="nav-link sidebar-link sidebar-page" aria-label="Blog Home"><span class="font-icon icon iconfont icon-home" style=""></span>Blog Home<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-discover" style=""></span><a href="/demo/" class="title">Demo</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/demo/page.html" class="nav-link sidebar-link sidebar-page" aria-label="Page Config"><span class="font-icon icon iconfont icon-page" style=""></span>Page Config<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/markdown.html" class="nav-link sidebar-link sidebar-page" aria-label="Markdown Enhance"><span class="font-icon icon iconfont icon-markdown" style=""></span>Markdown Enhance<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/disable.html" class="nav-link sidebar-link sidebar-page" aria-label="Disabling layout and features"><span class="font-icon icon iconfont icon-config" style=""></span>Disabling layout and features<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/demo/encrypt.html" class="nav-link sidebar-link sidebar-page" aria-label="Encryption Article"><span class="font-icon icon iconfont icon-lock" style=""></span>Encryption Article<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><span class="font-icon icon iconfont icon-note" style=""></span><span class="title">Articles</span><!----></p><ul class="sidebar-links"></ul></section></li><li><!--[--><a href="/intro.html" class="nav-link sidebar-link sidebar-page" aria-label="Intro Page"><span class="font-icon icon iconfont icon-info" style=""></span>Intro Page<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/slides.html" class="nav-link sidebar-link sidebar-page" aria-label="Slide page"><span class="font-icon icon iconfont icon-slides" style=""></span>Slide page<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon iconfont icon-edit" style=""></span>VMè¿è¡Œæ—¶æ•°æ®åŒº</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mrhope.site" target="_blank" rel="noopener noreferrer">Mr.IIIDelay</a></span><span property="author" content="Mr.IIIDelay"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-26T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 98 min</span><meta property="timeRequired" content="PT98M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category6 clickable" role="navigation">JavaBase</span><meta property="articleSection" content="JavaBase"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag4 clickable" role="navigation">vm</span><span class="page-tag-item tag3 clickable" role="navigation">source</span><span class="page-tag-item tag2 clickable" role="navigation">c|c++</span><meta property="keywords" content="vm,source,c|c++"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<button class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ç¨‹åºè®¡æ•°å™¨" class="router-link-active router-link-exact-active toc-link level2">ç¨‹åºè®¡æ•°å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è™šæ‹Ÿæœºæ ˆ" class="router-link-active router-link-exact-active toc-link level2">è™šæ‹Ÿæœºæ ˆ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å±€éƒ¨å˜é‡è¡¨" class="router-link-active router-link-exact-active toc-link level3">å±€éƒ¨å˜é‡è¡¨ï¼š</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æœ¬åœ°æ–¹æ³•æ ˆ" class="router-link-active router-link-exact-active toc-link level2">æœ¬åœ°æ–¹æ³•æ ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å †" class="router-link-active router-link-exact-active toc-link level2">å †</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ–¹æ³•åŒº" class="router-link-active router-link-exact-active toc-link level2">æ–¹æ³•åŒº</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è¿è¡Œæ—¶å¸¸é‡æ± " class="router-link-active router-link-exact-active toc-link level3">è¿è¡Œæ—¶å¸¸é‡æ± </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¸¸ç”¨å‚æ•°" class="router-link-active router-link-exact-active toc-link level3">å¸¸ç”¨å‚æ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-permgen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-metaspace-å‘¢" class="router-link-active router-link-exact-active toc-link level3">ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢?</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ç›´æ¥å†…å­˜" class="router-link-active router-link-exact-active toc-link level2">ç›´æ¥å†…å­˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="router-link-active router-link-exact-active toc-link level2">å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#step1-ç±»åŠ è½½æ£€æŸ¥" class="router-link-active router-link-exact-active toc-link level3">Step1:ç±»åŠ è½½æ£€æŸ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#step2-åˆ†é…å†…å­˜" class="router-link-active router-link-exact-active toc-link level3">Step2:åˆ†é…å†…å­˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#step3-åˆå§‹åŒ–é›¶å€¼" class="router-link-active router-link-exact-active toc-link level3">Step3:åˆå§‹åŒ–é›¶å€¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#step4-è®¾ç½®å¯¹è±¡å¤´" class="router-link-active router-link-exact-active toc-link level3">Step4:è®¾ç½®å¯¹è±¡å¤´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#step5-æ‰§è¡Œ-init-æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">Step5:æ‰§è¡Œ init æ–¹æ³•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="router-link-active router-link-exact-active toc-link level2">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯¹è±¡å¤´" class="router-link-active router-link-exact-active toc-link level3">å¯¹è±¡å¤´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å®ä¾‹æ•°æ®" class="router-link-active router-link-exact-active toc-link level3">å®ä¾‹æ•°æ®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯¹é½å¡«å……éƒ¨åˆ†" class="router-link-active router-link-exact-active toc-link level3">å¯¹é½å¡«å……éƒ¨åˆ†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯¹è±¡çš„è®¿é—®å®šä½" class="router-link-active router-link-exact-active toc-link level3">å¯¹è±¡çš„è®¿é—®å®šä½</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#javaå †æº¢å‡º" class="router-link-active router-link-exact-active toc-link level2">Javaå †æº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º" class="router-link-active router-link-exact-active toc-link level2">è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º" class="router-link-active router-link-exact-active toc-link level2">æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º" class="router-link-active router-link-exact-active toc-link level2">æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²" class="router-link-active router-link-exact-active toc-link level2">å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#string-ç±»å’Œå¸¸é‡æ± " class="router-link-active router-link-exact-active toc-link level2">String ç±»å’Œå¸¸é‡æ± </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#string-s1-new-string-abc-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡" class="router-link-active router-link-exact-active toc-link level2">String s1 = new String(&quot;abc&quot;);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#_8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± " class="router-link-active router-link-exact-active toc-link level2">8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸ºä»€ä¹ˆéœ€è¦äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level2">ä¸ºä»€ä¹ˆéœ€è¦äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å“ªäº›åŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶" class="router-link-active router-link-exact-active toc-link level2">å“ªäº›åŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¦‚ä½•åˆ¤æ–­å¯¹è±¡éœ€è¦è¢«å›æ”¶" class="router-link-active router-link-exact-active toc-link level2">å¦‚ä½•åˆ¤æ–­å¯¹è±¡éœ€è¦è¢«å›æ”¶ï¼Ÿ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¼•ç”¨è®¡æ•°ç®—æ³•" class="router-link-active router-link-exact-active toc-link level3">å¼•ç”¨è®¡æ•°ç®—æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¯è¾¾æ€§åˆ†æç®—æ³•" class="router-link-active router-link-exact-active toc-link level3">å¯è¾¾æ€§åˆ†æç®—æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡" class="router-link-active router-link-exact-active toc-link level3">åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•, å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#javaä¸­çš„å¼•ç”¨" class="router-link-active router-link-exact-active toc-link level2">Javaä¸­çš„å¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ–¹æ³•åŒºçš„å›æ”¶" class="router-link-active router-link-exact-active toc-link level2">æ–¹æ³•åŒºçš„å›æ”¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åƒåœ¾å›æ”¶ç®—æ³•" class="router-link-active router-link-exact-active toc-link level2">åƒåœ¾å›æ”¶ç®—æ³•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åˆ†ä»£æ”¶é›†ç†è®º" class="router-link-active router-link-exact-active toc-link level3">åˆ†ä»£æ”¶é›†ç†è®º</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åƒåœ¾å›æ”¶ç±»å‹" class="router-link-active router-link-exact-active toc-link level3">åƒåœ¾å›æ”¶ç±»å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ ‡è®°-æ¸…é™¤ç®—æ³•-mark-sweep" class="router-link-active router-link-exact-active toc-link level3">æ ‡è®°-æ¸…é™¤ç®—æ³•(Mark-Sweep)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ ‡è®°-å¤åˆ¶ç®—æ³•-mark-copying" class="router-link-active router-link-exact-active toc-link level3">æ ‡è®°-å¤åˆ¶ç®—æ³•(Mark-Copying)</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ ‡è®°-æ•´ç†ç®—æ³•-mark-compact" class="router-link-active router-link-exact-active toc-link level3">æ ‡è®°-æ•´ç†ç®—æ³•(Mark-Compact)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#hotspotå®ç°åƒåœ¾å›æ”¶çš„ç®—æ³•ç»†èŠ‚-äº†è§£" class="router-link-active router-link-exact-active toc-link level2">HotSpotå®ç°åƒåœ¾å›æ”¶çš„ç®—æ³•ç»†èŠ‚(äº†è§£)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ ¹èŠ‚ç‚¹æšä¸¾" class="router-link-active router-link-exact-active toc-link level3">æ ¹èŠ‚ç‚¹æšä¸¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å®‰å…¨ç‚¹" class="router-link-active router-link-exact-active toc-link level3">å®‰å…¨ç‚¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å®‰å…¨åŒºåŸŸ" class="router-link-active router-link-exact-active toc-link level3">å®‰å…¨åŒºåŸŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è®°å¿†é›†ä¸å¡è¡¨" class="router-link-active router-link-exact-active toc-link level3">è®°å¿†é›†ä¸å¡è¡¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å†™å±éšœ" class="router-link-active router-link-exact-active toc-link level3">å†™å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#young-gc-å’Œ-full-gc-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘" class="router-link-active router-link-exact-active toc-link level2">Young GC å’Œ Full GC åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸‰è‰²æ ‡è®°æ³•" class="router-link-active router-link-exact-active toc-link level2">ä¸‰è‰²æ ‡è®°æ³•</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸‰è‰²æ ‡è®°åŸç†" class="router-link-active router-link-exact-active toc-link level3">ä¸‰è‰²æ ‡è®°åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¤šæ ‡â€”â€”æµ®åŠ¨åƒåœ¾" class="router-link-active router-link-exact-active toc-link level3">å¤šæ ‡â€”â€”æµ®åŠ¨åƒåœ¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#æ¼æ ‡-è¯»å†™å±éšœ" class="router-link-active router-link-exact-active toc-link level3">æ¼æ ‡-è¯»å†™å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å†™å±éšœ-1" class="router-link-active router-link-exact-active toc-link level3">å†™å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å†™å±éšœ-å¢é‡æ›´æ–°" class="router-link-active router-link-exact-active toc-link level3">å†™å±éšœ + å¢é‡æ›´æ–°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è¯»å±éšœ" class="router-link-active router-link-exact-active toc-link level3">è¯»å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸‰è‰²æ ‡è®°æ³•ä¸ç°ä»£åƒåœ¾å›æ”¶å™¨" class="router-link-active router-link-exact-active toc-link level3">ä¸‰è‰²æ ‡è®°æ³•ä¸ç°ä»£åƒåœ¾å›æ”¶å™¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level2">ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#serialæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">Serialæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#parnewæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">ParNewæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#parallel-scavengeæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">Parallel Scavengeæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#serial-oldæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">Serial Oldæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#parallel-oldæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">Parallel Oldæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#cmsæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">CMSæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#garbage-firstæ”¶é›†å™¨-g1" class="router-link-active router-link-exact-active toc-link level3">Garbage Firstæ”¶é›†å™¨ (G1)</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#cmså’Œg1çš„åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level2">*CMSå’ŒG1çš„åŒºåˆ«</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åŒºåˆ«" class="router-link-active router-link-exact-active toc-link level3">åŒºåˆ«</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#g1çš„ä¼˜åŠ£åŠ¿åˆ†æ" class="router-link-active router-link-exact-active toc-link level3">G1çš„ä¼˜åŠ£åŠ¿åˆ†æ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level2">ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#shenandoahæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">Shenandoahæ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#zgcæ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">ZGCæ”¶é›†å™¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level2">å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨ï¼Ÿ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ä¸»è¦å› ç´ " class="router-link-active router-link-exact-active toc-link level3">ä¸»è¦å› ç´ </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¦‚ä½•é€‰æ‹©" class="router-link-active router-link-exact-active toc-link level3">å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åŠ è½½" class="router-link-active router-link-exact-active toc-link level2">åŠ è½½</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è¿æ¥" class="router-link-active router-link-exact-active toc-link level2">è¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åˆå§‹åŒ–" class="router-link-active router-link-exact-active toc-link level2">åˆå§‹åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è¡¥å……-å¸è½½" class="router-link-active router-link-exact-active toc-link level2">è¡¥å……ï¼šå¸è½½</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#ç±»åŠ è½½å™¨æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">ç±»åŠ è½½å™¨æ€»ç»“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åŒäº²å§”æ´¾æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level2">åŒäº²å§”æ´¾æ¨¡å‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹" class="router-link-active router-link-exact-active toc-link level3">åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¥½å¤„" class="router-link-active router-link-exact-active toc-link level3">å¥½å¤„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#å¦‚ä½•ç ´ååŒäº²å§”æ´¾æ¨¡å‹" class="router-link-active router-link-exact-active toc-link level3">å¦‚ä½•ç ´ååŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/en/javabase/advance/jvm.html#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="router-link-active router-link-exact-active toc-link level3">è‡ªå®šä¹‰ç±»åŠ è½½å™¨</a></li><!----><!--]--></ul><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="vmè¿è¡Œæ—¶æ•°æ®åŒº" tabindex="-1"><a class="header-anchor" href="#vmè¿è¡Œæ—¶æ•°æ®åŒº" aria-hidden="true">#</a> VMè¿è¡Œæ—¶æ•°æ®åŒº</h1><figure><img src="/assets/20210621153304-52ab334d.png" alt="è¿è¡Œæ—¶æ•°æ®åŒºå†…å­˜ç»“æ„å›¾" tabindex="0" loading="lazy"><figcaption>è¿è¡Œæ—¶æ•°æ®åŒºå†…å­˜ç»“æ„å›¾</figcaption></figure><figure><img src="/assets/20210810171112-bdd48b0c.png" alt="JVMå†…å­˜ç»“æ„" tabindex="0" loading="lazy"><figcaption>JVMå†…å­˜ç»“æ„</figcaption></figure><p>çº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †, ç‹¬å è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚</p><h2 id="ç¨‹åºè®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#ç¨‹åºè®¡æ•°å™¨" aria-hidden="true">#</a> ç¨‹åºè®¡æ•°å™¨</h2><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´, å¯ä»¥çœ‹åšå½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</p><p><strong>ä½œç”¨ï¼š</strong></p><ol><li><strong>å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤, ä»è€Œå®ç°æµç¨‹æ§åˆ¶</strong>ã€‚å¦‚ï¼šé¡ºåºé€‰æ‹©ã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚</li><li><strong>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, ç¨‹åºè®¡æ•°å™¨è®°å½•å½“å‰çº¿ç¨‹çš„æ‰§è¡Œä½ç½®, ä»¥ä¾¿çº¿ç¨‹åˆ‡æ¢å›æ¥å¯ä»¥å¾—çŸ¥ä¸Šæ¬¡çš„æ‰§è¡Œä½ç½®</strong>ã€‚(é—®é¢˜ï¼šçº¿ç¨‹ä¸ºä»€ä¹ˆç‹¬å ç¨‹åºè®¡æ•°å™¨çš„ç­”æ¡ˆ)</li></ol><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><strong>ç¨‹åºè®¡æ•°å™¨æ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ²¡æœ‰è§„å®šä»»ä½•<code>OutOfMemoryError</code>æƒ…å†µçš„åŒºåŸŸ, å®ƒçš„ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»º, éšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚</strong></li><li>å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯Javaæ–¹æ³•, è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯<strong>æœ¬åœ°(Native)æ–¹æ³•</strong>, è¿™ä¸ª<strong>è®¡æ•°å™¨å€¼åˆ™åº”ä¸ºç©º(<code>Undefined</code>)</strong>ã€‚</li></ul><h2 id="è™šæ‹Ÿæœºæ ˆ" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿæœºæ ˆ" aria-hidden="true">#</a> è™šæ‹Ÿæœºæ ˆ</h2><p>æè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å†…å­˜æ¨¡å‹, æ¯ä¸ªæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª<strong>æ ˆå¸§</strong>, æ ˆå¸§ä¸­å­˜æ”¾<strong>å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£</strong>ç­‰ä¿¡æ¯ã€‚</p><p><strong>æ–¹æ³•/å‡½æ•°å¦‚ä½•è°ƒç”¨ï¼Ÿ</strong></p><p>Java æ ˆå¯ç”¨ç±»æ¯”æ•°æ®ç»“æ„ä¸­æ ˆ, Java æ ˆä¸­ä¿å­˜çš„ä¸»è¦å†…å®¹æ˜¯æ ˆå¸§, æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„æ ˆå¸§è¢«å‹å…¥ Java æ ˆ, æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ç»“æŸå, éƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå¸§è¢«å¼¹å‡ºã€‚</p><p>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›æ–¹å¼ï¼š</p><ol><li>return è¯­å¥ã€‚</li><li>æŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><p>ä¸ç®¡å“ªç§è¿”å›æ–¹å¼éƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</p><p>æ¯ä¸ªæ–¹æ³•è¢«è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæ¯•çš„è¿‡ç¨‹, å¯¹åº”ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆå…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><p><em>(æ ˆå†…å­˜ä¸€èˆ¬æŒ‡å±€éƒ¨å˜é‡è¡¨)</em></p><h3 id="å±€éƒ¨å˜é‡è¡¨" tabindex="-1"><a class="header-anchor" href="#å±€éƒ¨å˜é‡è¡¨" aria-hidden="true">#</a> <strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼š</h3><p>å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸä¸­å„ç§çš„<strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>ã€<strong>å¯¹è±¡å¼•ç”¨</strong>(å¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«, å¯èƒ½æ˜¯æŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„ä¸€ä¸ªå¼•ç”¨æŒ‡é’ˆ, ä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ä¿¡æ¯)å’Œ<strong>returnAddressç±»å‹</strong>(æŒ‡å‘ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€)ã€‚</p><ul><li>64ä½çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´, å…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨1ä¸ª</li><li>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€å†…å­˜ç¼–è¯‘æœŸå®Œæˆåˆ†é…, è¿›å…¥ä¸€ä¸ªæ–¹æ³•å, æ ˆåˆ†é…å¤šå°‘å†…å­˜æ˜¯å›ºå®šçš„, è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜ã€‚</li></ul><p>OOM</p><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹è§„å®š,</p><p>1)å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦, å°†æŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸ã€‚ 2)å¦‚æœè™šæ‹Ÿæœºçš„æ ˆå†…å­˜å…è®¸åŠ¨æ€æ‰©å±•, å½“æ‰©å±•æ ˆå®¹é‡æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜æ—¶, å°†æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>ä½†æ˜¯HotSpotè™šæ‹Ÿæœºçš„é€‰æ‹©æ˜¯ä¸æ”¯æŒæ‰©å±•, æ‰€ä»¥é™¤éåœ¨åˆ›å»ºçº¿ç¨‹ç”³è¯·å†…å­˜æ—¶å°±å› æ— æ³•è·å¾—è¶³å¤Ÿå†…å­˜è€Œå‡ºç° <code>OutOfMemoryError</code>å¼‚å¸¸, å¦åˆ™åœ¨çº¿ç¨‹è¿è¡Œæ—¶æ˜¯ä¸ä¼šå› ä¸ºæ‰©å±•è€Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„, åªä¼šå› ä¸ºæ ˆå®¹é‡æ— æ³•å®¹çº³æ–°çš„æ ˆå¸§è€Œå¯¼è‡´<code>StackOverflowError</code>å¼‚å¸¸ã€‚</p><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°æ–¹æ³•æ ˆ" aria-hidden="true">#</a> æœ¬åœ°æ–¹æ³•æ ˆ</h2><ul><li><p>å’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼, ä¸¤è€…çš„åŒºåˆ«å°±æ˜¯<strong>è™šæ‹Ÿæœºæ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºæ‰§è¡Œjavaæ–¹æ³•æœåŠ¡</strong>, <strong>æœ¬åœ°æ–¹æ³•æ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡Œnativeæ–¹æ³•æœåŠ¡</strong>ã€‚</p></li><li><p><strong>HotSpotè™šæ‹Ÿæœºä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆ</strong>(åˆäºŒä¸ºä¸€)ã€‚</p></li></ul><h2 id="å †" tabindex="-1"><a class="header-anchor" href="#å †" aria-hidden="true">#</a> å †</h2><ul><li><p>Java è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—, Java å †æ˜¯<strong>æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸ</strong>, åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚</p></li><li><p><strong>æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹, å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</strong></p></li><li><p>å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸ, å› æ­¤ä¹Ÿè¢«ç§°ä¸º&quot;GCå †&quot;</p></li><li><p>JAVAå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­, åªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ã€‚</p></li><li><p>å¯é€šè¿‡å‚æ•° -Xmx -Xms æ¥æŒ‡å®šè¿è¡Œæ—¶å †å†…å­˜çš„å¤§å°, åœ¨Javaå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…, å¹¶ä¸”ä¹Ÿæ— æ³•æ‰©å±•æ—¶, ä¼šæŠ›<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p></li></ul><h2 id="æ–¹æ³•åŒº" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åŒº" aria-hidden="true">#</a> æ–¹æ³•åŒº</h2><ul><li>æ–¹æ³•åŒºä¹Ÿæ˜¯çº¿ç¨‹å…±äº«åŒº, ç”¨äºå­˜å‚¨ã€è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»ä¿¡æ¯</strong>(ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£), <strong>å¸¸é‡</strong>, <strong>é™æ€å˜é‡</strong>, <strong>å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜</strong>ç­‰æ•°æ®ã€‘</li></ul><p><strong>æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»</strong>ï¼š</p><blockquote><p>ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹åªæ˜¯è§„å®šäº†æœ‰æ–¹æ³•åŒºè¿™ä¹ˆä¸ªæ¦‚å¿µå’Œå®ƒçš„ä½œç”¨, å¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å»å®ç°å®ƒã€‚é‚£ä¹ˆ, åœ¨ä¸åŒçš„ JVM ä¸Šæ–¹æ³•åŒºçš„å®ç°è‚¯å®šæ˜¯ä¸åŒçš„äº†ã€‚ <strong>æ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£çš„å…³ç³»å¾ˆåƒ Java ä¸­æ¥å£å’Œç±»çš„å…³ç³», ç±»å®ç°äº†æ¥å£, è€Œæ°¸ä¹…ä»£å°±æ˜¯ HotSpot è™šæ‹Ÿæœºå¯¹è™šæ‹Ÿæœºè§„èŒƒä¸­æ–¹æ³•åŒºçš„ä¸€ç§å®ç°æ–¹å¼ã€‚</strong> ä¹Ÿå°±æ˜¯è¯´, æ°¸ä¹…ä»£æ˜¯ HotSpot çš„æ¦‚å¿µ, æ–¹æ³•åŒºæ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­çš„å®šä¹‰, æ˜¯ä¸€ç§è§„èŒƒ, è€Œæ°¸ä¹…ä»£æ˜¯ä¸€ç§å®ç°, ä¸€ä¸ªæ˜¯æ ‡å‡†ä¸€ä¸ªæ˜¯å®ç°, å…¶ä»–çš„è™šæ‹Ÿæœºå®ç°å¹¶æ²¡æœ‰æ°¸ä¹…ä»£è¿™ä¸€è¯´æ³•ã€‚</p></blockquote><p><strong>JDK8ç§»é™¤äº†æ°¸ä¹…ä»£, æ”¹ä¸ºå…ƒç©ºé—´ä»£æ›¿ã€‚ä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p>å› ä¸ºæ°¸ä¹…ä»£æœ‰ä¸Šé™, å¯¼è‡´Javaåº”ç”¨æ›´å®¹æ˜“é‡åˆ°å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</p><p>å†…å­˜å›æ”¶çš„ç›®æ ‡ä¸»è¦é’ˆå¯¹ å¸¸é‡æ± çš„å›æ”¶ å’Œ ç±»å‹çš„å¸è½½ã€‚</p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#è¿è¡Œæ—¶å¸¸é‡æ± " aria-hidden="true">#</a> è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>è¿è¡Œæ—¶å¸¸é‡æ± (Runtime Constant Pool)æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†, ç”¨äº<strong>å­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨</strong>(å±äºç±»ä¿¡æ¯çš„ä¸€éƒ¨åˆ†)ã€‚</p><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¹¶æ²¡æœ‰åšä»»ä½•ç»†èŠ‚è¦æ±‚, å¯ä»¥ç”±ä¾›åº”å•†è‡ªå·±å®ç°ã€‚</p><p>è¿è¡Œæ—¶å¸¸é‡æ± ä¸Classæ–‡ä»¶å¸¸é‡æ± å¯¹æ¯” æœ€å¤§ç‰¹å¾æ˜¯<strong>å…·å¤‡åŠ¨æ€æ€§</strong>ã€‚è¿è¡Œæ—¶å¯ä»¥å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­, å…¸å‹çš„æœ‰<code>String</code>ç±»çš„<code>intern()</code>æ–¹æ³•ã€‚</p><blockquote><p><code>String</code>ç±»çš„<code>intern()</code>æ–¹æ³•ï¼šè¿”å›å­—ç¬¦ä¸²å¯¹è±¡çš„è§„èŒƒåŒ–è¡¨ç¤ºå½¢å¼ã€‚</p><p>ä¸€ä¸ªåˆå§‹æ—¶ä¸ºç©ºçš„å­—ç¬¦ä¸²æ± , å®ƒç”±ç±» String ç§æœ‰åœ°ç»´æŠ¤ã€‚</p><p><strong>å½“è°ƒç”¨ intern æ–¹æ³•æ—¶, å¦‚æœæ± å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡çš„å­—ç¬¦ä¸²(è¯¥å¯¹è±¡ç”± <code>equals(Object)</code> æ–¹æ³•ç¡®å®š), åˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²ã€‚å¦åˆ™, å°†æ­¤ String å¯¹è±¡æ·»åŠ åˆ°æ± ä¸­, å¹¶ä¸”è¿”å›æ­¤ String å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p><p>å®ƒéµå¾ªå¯¹äºä»»ä½•ä¸¤ä¸ªå­—ç¬¦ä¸² s å’Œ t, å½“ä¸”ä»…å½“ <code>s.equals(t)</code> ä¸º <code>true</code> æ—¶, <code>s.intern() == t.intern() </code>æ‰ä¸º <code>true</code>ã€‚</p></blockquote><h3 id="å¸¸ç”¨å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å‚æ•°" aria-hidden="true">#</a> å¸¸ç”¨å‚æ•°</h3><p>JDK 1.8 ä¹‹å‰æ°¸ä¹…ä»£è¿˜æ²¡è¢«å½»åº•ç§»é™¤çš„æ—¶å€™é€šå¸¸é€šè¿‡ä¸‹é¢è¿™äº›å‚æ•°æ¥è°ƒèŠ‚æ–¹æ³•åŒºå¤§å°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">PermSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) åˆå§‹å¤§å°</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxPermSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//æ–¹æ³•åŒº (æ°¸ä¹…ä»£) æœ€å¤§å¤§å°,è¶…è¿‡è¿™ä¸ªå€¼å°†ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸:java.lang.OutOfMemoryError: PermGenCopy to clipboardErrorCopied</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸å¯¹è€Œè¨€, åƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„, ä½†å¹¶éæ•°æ®è¿›å…¥æ–¹æ³•åŒºåå°±&quot;æ°¸ä¹…å­˜åœ¨&quot;äº†ã€‚</p><p>JDK 1.8 çš„æ—¶å€™, æ–¹æ³•åŒº(HotSpot çš„æ°¸ä¹…ä»£)è¢«å½»åº•ç§»é™¤äº†(JDK1.7 å°±å·²ç»å¼€å§‹äº†), å–è€Œä»£ä¹‹æ˜¯å…ƒç©ºé—´, å…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨å‚æ•°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MetaspaceSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//è®¾ç½® Metaspace çš„åˆå§‹(å’Œæœ€å°å¤§å°)</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxMetaspaceSize</span><span class="token operator">=</span><span class="token class-name">N</span> <span class="token comment">//è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°Copy to clipboardErrorCopied</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸æ°¸ä¹…ä»£å¾ˆå¤§çš„ä¸åŒå°±æ˜¯, å¦‚æœä¸æŒ‡å®šå¤§å°çš„è¯, éšç€æ›´å¤šç±»çš„åˆ›å»º, è™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿå†…å­˜ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-permgen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-metaspace-å‘¢" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£-permgen-æ›¿æ¢ä¸ºå…ƒç©ºé—´-metaspace-å‘¢" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦å°†æ°¸ä¹…ä»£ (PermGen) æ›¿æ¢ä¸ºå…ƒç©ºé—´ (MetaSpace) å‘¢?</h3><blockquote><p>è€ƒè™‘åˆ°HotSpotæœªæ¥çš„å‘å±•, åœ¨JDK 6çš„æ—¶å€™HotSpotå¼€å‘å›¢é˜Ÿå°±æœ‰æ”¾å¼ƒæ°¸ä¹…ä»£, é€æ­¥æ”¹ä¸ºé‡‡ç”¨æœ¬åœ°å†…å­˜(Native Memory)æ¥å®ç°æ–¹æ³•åŒºçš„è®¡åˆ’äº†[1], åˆ°äº†JDK 7çš„HotSpot, å·²ç»æŠŠåŸæœ¬æ”¾åœ¨æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ç§»å‡º, è€Œåˆ°äº†JDK 8, ç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µ, æ”¹ç”¨ä¸JRockitã€J9ä¸€æ ·åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´(Meta-space)æ¥ä»£æ›¿, æŠŠJDK 7ä¸­æ°¸ä¹…ä»£è¿˜å‰©ä½™çš„å†…å®¹(ä¸»è¦æ˜¯ç±»å‹ä¿¡æ¯)å…¨éƒ¨ç§»åˆ°å…ƒç©ºé—´ä¸­ã€‚</p></blockquote><ol><li><p>æ•´ä¸ªæ°¸ä¹…ä»£æœ‰ä¸€ä¸ª JVM æœ¬èº«è®¾ç½®çš„å›ºå®šå¤§å°ä¸Šé™, æ— æ³•è¿›è¡Œè°ƒæ•´, è€Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜, å—æœ¬æœºå¯ç”¨å†…å­˜çš„é™åˆ¶, è™½ç„¶å…ƒç©ºé—´ä»æ—§å¯èƒ½æº¢å‡º, ä½†æ˜¯æ¯”åŸæ¥å‡ºç°çš„å‡ ç‡ä¼šæ›´å°ã€‚</p><blockquote><p>å½“å…ƒç©ºé—´æº¢å‡ºæ—¶ä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š <code>java.lang.OutOfMemoryError: MetaSpace</code></p></blockquote><p>ä½ å¯ä»¥ä½¿ç”¨ <code>-XXï¼šMaxMetaspaceSize</code> æ ‡å¿—è®¾ç½®æœ€å¤§å…ƒç©ºé—´å¤§å°, é»˜è®¤å€¼ä¸º unlimited, è¿™æ„å‘³ç€å®ƒåªå—ç³»ç»Ÿå†…å­˜çš„é™åˆ¶ã€‚<code>-XXï¼šMetaspaceSize</code> è°ƒæ•´æ ‡å¿—å®šä¹‰å…ƒç©ºé—´çš„åˆå§‹å¤§å°å¦‚æœæœªæŒ‡å®šæ­¤æ ‡å¿—, åˆ™ Metaspace å°†æ ¹æ®è¿è¡Œæ—¶çš„åº”ç”¨ç¨‹åºéœ€æ±‚åŠ¨æ€åœ°é‡æ–°è°ƒæ•´å¤§å°ã€‚</p></li><li><p>å…ƒç©ºé—´é‡Œé¢å­˜æ”¾çš„æ˜¯ç±»çš„å…ƒæ•°æ®, è¿™æ ·åŠ è½½å¤šå°‘ç±»çš„å…ƒæ•°æ®å°±ä¸ç”± <code>MaxPermSize</code> æ§åˆ¶äº†, è€Œç”±ç³»ç»Ÿçš„å®é™…å¯ç”¨ç©ºé—´æ¥æ§åˆ¶, è¿™æ ·èƒ½åŠ è½½çš„ç±»å°±æ›´å¤šäº†ã€‚</p></li><li><p>åœ¨ JDK8, åˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶, JRockit ä»æ¥æ²¡æœ‰ä¸€ä¸ªå«æ°¸ä¹…ä»£çš„ä¸œè¥¿, åˆå¹¶ä¹‹åå°±æ²¡æœ‰å¿…è¦é¢å¤–çš„è®¾ç½®è¿™ä¹ˆä¸€ä¸ªæ°¸ä¹…ä»£çš„åœ°æ–¹äº†ã€‚</p></li></ol><h2 id="ç›´æ¥å†…å­˜" tabindex="-1"><a class="header-anchor" href="#ç›´æ¥å†…å­˜" aria-hidden="true">#</a> ç›´æ¥å†…å­˜</h2><p><strong>ç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†, ä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸ, ä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ <code>OutOfMemoryError</code> å¼‚å¸¸å‡ºç°</strong>ã€‚</p><p>æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †çš„é™åˆ¶, ä½†æ˜¯, æ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ã€‚</p><p>ä¸€èˆ¬é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ä¼šæ ¹æ®å®é™…å†…å­˜å»è®¾ç½®-Xmxç­‰ä¿¡æ¯, ä½†ç»å¸¸å¿½ç•¥ç›´æ¥å†…å­˜, å¯¼è‡´æ€»å†…å­˜å¤§äºç‰©ç†å†…å­˜é™åˆ¶, åŠ¨æ€æ‰©å®¹æ—¶å‡ºç°<code>OutOfMemoryError</code> å¼‚å¸¸ã€‚</p><blockquote><p>JDK1.4 ä¸­æ–°åŠ å…¥çš„ <strong>NIO(New Input/Output) ç±»</strong>, å¼•å…¥äº†ä¸€ç§åŸºäº<strong>é€šé“(Channel)</strong> ä¸<strong>ç¼“å­˜åŒº(Buffer)</strong> çš„ I/O æ–¹å¼, å®ƒå¯ä»¥ç›´æ¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜, ç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·å°±èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½, å› ä¸º<strong>é¿å…äº†åœ¨ Java å †å’Œ Native å †ä¹‹é—´æ¥å›å¤åˆ¶æ•°æ®</strong>ã€‚</p></blockquote><h1 id="hotspotè™šæ‹Ÿæœº" tabindex="-1"><a class="header-anchor" href="#hotspotè™šæ‹Ÿæœº" aria-hidden="true">#</a> HotSpotè™šæ‹Ÿæœº</h1><p>æ€»ç»“HotSpotè™šæ‹Ÿæœºåœ¨Javaå †ä¸­å¯¹è±¡åˆ†é…ã€å¸ƒå±€å’Œè®¿é—®çš„å…¨è¿‡ç¨‹ã€‚</p><h2 id="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" aria-hidden="true">#</a> å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h2><figure><img src="/assets/20210621161216-663e9c2a.png" alt="Javaåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹" tabindex="0" loading="lazy"><figcaption>Javaåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹</figcaption></figure><h3 id="step1-ç±»åŠ è½½æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#step1-ç±»åŠ è½½æ£€æŸ¥" aria-hidden="true">#</a> Step1:ç±»åŠ è½½æ£€æŸ¥</h3><p>è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶, é¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨, å¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰, é‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><h3 id="step2-åˆ†é…å†…å­˜" tabindex="-1"><a class="header-anchor" href="#step2-åˆ†é…å†…å­˜" aria-hidden="true">#</a> Step2:åˆ†é…å†…å­˜</h3><p>åœ¨<strong>ç±»åŠ è½½æ£€æŸ¥</strong>é€šè¿‡å, æ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸ºæ–°ç”Ÿå¯¹è±¡<strong>åˆ†é…å†…å­˜</strong>ã€‚å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåä¾¿å¯ç¡®å®š, ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚<strong>åˆ†é…æ–¹å¼</strong>æœ‰ <strong>&quot;æŒ‡é’ˆç¢°æ’&quot;</strong> å’Œ <strong>&quot;ç©ºé—²åˆ—è¡¨&quot;</strong> ä¸¤ç§, <strong>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”± Java å †æ˜¯å¦è§„æ•´å†³å®š, è€Œ Java å †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</strong>ã€‚</p><p><strong>å†…å­˜åˆ†é…çš„ä¸¤ç§æ–¹å¼ï¼š</strong></p><p>é€‰æ‹©ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­çš„å“ªä¸€ç§, å–å†³äº Java å †å†…å­˜æ˜¯å¦è§„æ•´ã€‚è€Œ Java å †å†…å­˜æ˜¯å¦è§„æ•´, å–å†³äº GC æ”¶é›†å™¨çš„ç®—æ³•æ˜¯&quot;æ ‡è®°-æ¸…é™¤&quot;, è¿˜æ˜¯&quot;æ ‡è®°-æ•´ç†&quot;(ä¹Ÿç§°ä½œ&quot;æ ‡è®°-å‹ç¼©&quot;), å€¼å¾—æ³¨æ„çš„æ˜¯, å¤åˆ¶ç®—æ³•å†…å­˜ä¹Ÿæ˜¯è§„æ•´çš„ã€‚</p><figure><img src="/assets/20210621161720-61a08cc1.png" alt="image-20210621161720591" tabindex="0" loading="lazy"><figcaption>image-20210621161720591</figcaption></figure><p><strong>å†…å­˜åˆ†é…å¹¶å‘é—®é¢˜ï¼š</strong></p><p>åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜, å°±æ˜¯çº¿ç¨‹å®‰å…¨, å› ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­, åˆ›å»ºå¯¹è±¡æ˜¯å¾ˆé¢‘ç¹çš„äº‹æƒ…, ä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´, å¿…é¡»è¦ä¿è¯çº¿ç¨‹æ˜¯å®‰å…¨çš„, é€šå¸¸æ¥è®², è™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</p><ul><li><strong>CAS+å¤±è´¥é‡è¯•ï¼š</strong> CAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯, æ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œ, å¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•, ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚<strong>è™šæ‹Ÿæœºé‡‡ç”¨ CAS é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚</strong></li><li><strong>TLABï¼š</strong> ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨ Eden åŒºåˆ†é…ä¸€å—å„¿å†…å­˜, JVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶, é¦–å…ˆåœ¨ TLAB åˆ†é…, å½“å¯¹è±¡å¤§äº TLAB ä¸­çš„å‰©ä½™å†…å­˜æˆ– TLAB çš„å†…å­˜å·²ç”¨å°½æ—¶, å†é‡‡ç”¨ä¸Šè¿°çš„ CAS è¿›è¡Œå†…å­˜åˆ†é…</li></ul><h3 id="step3-åˆå§‹åŒ–é›¶å€¼" tabindex="-1"><a class="header-anchor" href="#step3-åˆå§‹åŒ–é›¶å€¼" aria-hidden="true">#</a> Step3:åˆå§‹åŒ–é›¶å€¼</h3><p>å†…å­˜åˆ†é…å®Œæˆå, è™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½<strong>åˆå§‹åŒ–ä¸ºé›¶å€¼(ä¸åŒ…æ‹¬å¯¹è±¡å¤´)</strong>, è¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨, ç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</p><h3 id="step4-è®¾ç½®å¯¹è±¡å¤´" tabindex="-1"><a class="header-anchor" href="#step4-è®¾ç½®å¯¹è±¡å¤´" aria-hidden="true">#</a> Step4:è®¾ç½®å¯¹è±¡å¤´</h3><p>åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹å, <strong>è™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®</strong>, ä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨<strong>å¯¹è±¡å¤´</strong>ä¸­ã€‚ å¦å¤–, æ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒ, å¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰, å¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</p><h3 id="step5-æ‰§è¡Œ-init-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#step5-æ‰§è¡Œ-init-æ–¹æ³•" aria-hidden="true">#</a> Step5:æ‰§è¡Œ init æ–¹æ³•</h3><p>åœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹å, ä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹, ä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†, ä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹, å¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹, <code>&lt;init&gt;</code> æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œ, æ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´, æ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œ <code>&lt;init&gt;</code> æ–¹æ³•, æŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–, è¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§ç”Ÿå‡ºæ¥ã€‚</p><h2 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" aria-hidden="true">#</a> å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h2><p>åœ¨ Hotspot è™šæ‹Ÿæœºä¸­, å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€å¯ä»¥åˆ†ä¸º 3 å—åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´</strong>ã€<strong>å®ä¾‹æ•°æ®</strong>å’Œ<strong>å¯¹é½å¡«å……</strong>ã€‚</p><h3 id="å¯¹è±¡å¤´" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡å¤´" aria-hidden="true">#</a> å¯¹è±¡å¤´</h3><p><strong>Hotspot è™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯</strong>ï¼š</p><ol><li>ç”¨äºå­˜å‚¨<strong>å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®</strong>(å“ˆå¸Œç (HashCode)ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰)ã€‚å®˜æ–¹ç§°è¿™éƒ¨åˆ†ä¸º&quot;Mark Word&quot;ã€‚</li><li><strong>ç±»å‹æŒ‡é’ˆ</strong>, å³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆ, è™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯é‚£ä¸ªç±»çš„å®ä¾‹ã€‚</li><li>ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªJavaæ•°ç»„, é‚£åœ¨å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®, å› ä¸ºè™šæ‹Ÿæœºå¯ä»¥é€šè¿‡æ™®é€š Javaå¯¹è±¡çš„å…ƒæ•°æ®ä¿¡æ¯ç¡®å®šJavaå¯¹è±¡çš„å¤§å°, ä½†æ˜¯å¦‚æœæ•°ç»„çš„é•¿åº¦æ˜¯ä¸ç¡®å®šçš„, å°†æ— æ³•é€šè¿‡å…ƒæ•°æ®ä¸­çš„ ä¿¡æ¯æ¨æ–­å‡ºæ•°ç»„çš„å¤§å°ã€‚</li></ol><figure><img src="/assets/202109242103520-44fef798.png" alt="HotSpotè™šæ‹Ÿæœºå¯¹è±¡å¤´Mark Word" tabindex="0" loading="lazy"><figcaption>HotSpotè™šæ‹Ÿæœºå¯¹è±¡å¤´Mark Word</figcaption></figure><h3 id="å®ä¾‹æ•°æ®" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹æ•°æ®" aria-hidden="true">#</a> å®ä¾‹æ•°æ®</h3><p><strong>å®ä¾‹æ•°æ®éƒ¨åˆ†æ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯</strong>, ä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹ã€‚</p><h3 id="å¯¹é½å¡«å……éƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#å¯¹é½å¡«å……éƒ¨åˆ†" aria-hidden="true">#</a> å¯¹é½å¡«å……éƒ¨åˆ†</h3><p><strong>å¯¹é½å¡«å……éƒ¨åˆ†ä¸æ˜¯å¿…ç„¶å­˜åœ¨çš„, ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰, ä»…ä»…èµ·å ä½ä½œç”¨ã€‚</strong></p><p>å› ä¸º Hotspot è™šæ‹Ÿæœºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€, æ¢å¥è¯è¯´å°±æ˜¯å¯¹è±¡çš„å¤§å°å¿…é¡»æ˜¯ 8 å­—èŠ‚çš„æ•´æ•°å€ã€‚è€Œå¯¹è±¡å¤´éƒ¨åˆ†æ­£å¥½æ˜¯ 8 å­—èŠ‚çš„å€æ•°(1 å€æˆ– 2 å€), å› æ­¤, å½“å¯¹è±¡å®ä¾‹æ•°æ®éƒ¨åˆ†æ²¡æœ‰å¯¹é½æ—¶, å°±éœ€è¦é€šè¿‡å¯¹é½å¡«å……æ¥è¡¥å…¨ã€‚</p><h3 id="å¯¹è±¡çš„è®¿é—®å®šä½" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡çš„è®¿é—®å®šä½" aria-hidden="true">#</a> å¯¹è±¡çš„è®¿é—®å®šä½</h3><p>å»ºç«‹å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿ç”¨å¯¹è±¡, æˆ‘ä»¬çš„ Java ç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®æ–¹å¼ç”±è™šæ‹Ÿæœºå®ç°è€Œå®š, ç›®å‰ä¸»æµçš„è®¿é—®æ–¹å¼æœ‰<strong>â‘  ä½¿ç”¨å¥æŸ„</strong>å’Œ<strong>â‘¡ ç›´æ¥æŒ‡é’ˆ</strong>ä¸¤ç§ï¼š</p><p><strong>å¥æŸ„è®¿é—®ï¼š</strong> å¦‚æœä½¿ç”¨å¥æŸ„çš„è¯, é‚£ä¹ˆ Java å †ä¸­å°†ä¼šåˆ’åˆ†å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± , reference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€, è€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼›</p><p>ä¼˜ç‚¹ï¼šreferenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šå¥æŸ„åœ°å€, åœ¨å¯¹è±¡è¢«ç§»åŠ¨(åƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ˜¯éå¸¸æ™®éçš„è¡Œä¸º)æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆ, è€Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹ã€‚</p><figure><img src="/assets/20210621162654-8d60dbeb.png" alt="é€šè¿‡å¥æŸ„è®¿é—®å¯¹è±¡" tabindex="0" loading="lazy"><figcaption>é€šè¿‡å¥æŸ„è®¿é—®å¯¹è±¡</figcaption></figure><p><strong>ç›´æ¥æŒ‡é’ˆè®¿é—®</strong>ï¼š å¦‚æœä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®, é‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯, è€Œ reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚</p><p>ä¼˜ç‚¹ï¼šé€Ÿåº¦æ›´å¿«, å®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€, ç”±äºå¯¹è±¡è®¿é—®åœ¨Javaä¸­éå¸¸é¢‘ç¹, å› æ­¤è¿™ç±»å¼€é”€ç§¯å°‘æˆå¤šä¹Ÿæ˜¯ä¸€é¡¹æä¸ºå¯è§‚çš„æ‰§è¡Œæˆæœ¬ã€‚</p><figure><img src="/assets/20210621162734-d1c88786.png" alt="é€šè¿‡ç›´æ¥æŒ‡é’ˆè®¿é—®å¯¹è±¡" tabindex="0" loading="lazy"><figcaption>é€šè¿‡ç›´æ¥æŒ‡é’ˆè®¿é—®å¯¹è±¡</figcaption></figure><p>HotSpotè€Œè¨€, å®ƒä¸»è¦ä½¿ç”¨<strong>ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼</strong>è¿›è¡Œå¯¹è±¡è®¿é—®(æœ‰ä¾‹å¤–æƒ…å†µ, å¦‚æœä½¿ç”¨äº†Shenandoahæ”¶é›†å™¨çš„è¯ä¹Ÿä¼šæœ‰ä¸€æ¬¡é¢å¤–çš„è½¬å‘)</p><h1 id="outofmemoryerrorå¼‚å¸¸" tabindex="-1"><a class="header-anchor" href="#outofmemoryerrorå¼‚å¸¸" aria-hidden="true">#</a> OutOfMemoryErrorå¼‚å¸¸</h1><h2 id="javaå †æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#javaå †æº¢å‡º" aria-hidden="true">#</a> Javaå †æº¢å‡º</h2><p>Javaå †ç”¨æ¥ä¸æ–­åˆ›å»ºå¯¹è±¡å®ä¾‹, åªè¦ä¸æ–­åˆ›å»ºå¯¹è±¡, å¹¶ä¸”é¿å…åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤è¿™äº›å¯¹è±¡(<strong>ä¿è¯GC Rootsåˆ°å¯¹è±¡ä¹‹é—´æœ‰å¯è¾¾è·¯å¾„</strong><strong>æ¥é¿å…åƒåœ¾å›æ”¶æœºåˆ¶æ¸…é™¤è¿™äº›å¯¹è±¡</strong>), é‚£ä¹ˆéšç€å¯¹è±¡æ•°é‡å¢åŠ , è¶…å‡ºæ€»å®¹é‡åŠæœ€å¤§å®¹é‡é™åˆ¶åå°±ä¼šäº§ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><p>é™åˆ¶Javaå †çš„å¤§å°ä¸º20MB, ä¸å¯æ‰©å±•(å°†å †çš„æœ€å°å€¼-Xmså‚æ•°ä¸æœ€å¤§å€¼-Xmxå‚æ•°è®¾ç½®ä¸ºä¸€æ ·å³å¯é¿å…å †è‡ªåŠ¨æ‰©å±•), é€šè¿‡å‚æ•°<code>-XXï¼š+HeapDumpOnOutOfMemoryError</code>å¯ä»¥è®©è™šæ‹Ÿæœºåœ¨å‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸çš„æ—¶å€™Dumpå‡ºå½“å‰çš„å†…å­˜å †è½¬å‚¨å¿«ç…§ä»¥ä¾¿è¿›è¡Œäº‹ååˆ†æã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * description:Javaå †å†…å­˜æº¢å‡ºå¼‚å¸¸æµ‹è¯•
 * VM Argsï¼š-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError
 *
 * <span class="token keyword">@author</span> RenShiWei
 * Date: 2021/6/20 17:26
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOOM</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OOMObject</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OOMObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœï¼š ![image-20210620173433707](./images/jvm/ Javaå †æº¢å‡ºç»“æœ.png)</p><p>Javaå †å†…å­˜çš„<code>OutOfMemoryError</code>å¼‚å¸¸æ˜¯å®é™…åº”ç”¨ä¸­æœ€å¸¸è§çš„å†…å­˜æº¢å‡ºå¼‚å¸¸æƒ…å†µã€‚å‡ºç°Javaå †å†…å­˜æº¢å‡ºæ—¶, å¼‚å¸¸å †æ ˆä¿¡æ¯&quot;<code>java.lang.OutOfMemoryError</code>&quot;ä¼šè·Ÿéšè¿›ä¸€æ­¥æç¤º&quot;<code>Java heap space</code>&quot;ã€‚</p><p><strong>è§£å†³</strong>ï¼š</p><p>è§£å†³è¿™ä¸ªå¼‚å¸¸, éœ€è¦é€šè¿‡<strong>å†…å­˜æ˜ åƒåˆ†æå·¥å…·</strong>å¯¹Dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æã€‚</p><p>ç¬¬ä¸€æ­¥ç¡®å®šå¯¼è‡´å†…å­˜OMMçš„å¯¹è±¡æ˜¯å¦å¿…è¦, å³ç¡®å®šåˆ°åº•æ˜¯<strong>å†…å­˜æ³„æ¼</strong>, è¿˜æ˜¯<strong>å†…å­˜æº¢å‡º</strong>ã€‚</p><p>å¦‚æœæ˜¯<strong>å†…å­˜æ³„æ¼</strong>, å¯è¿›ä¸€æ­¥é€šè¿‡å·¥å…·<strong>æŸ¥çœ‹æ³„æ¼å¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾</strong>, æ‰¾åˆ°æ³„æ¼å¯¹è±¡æ˜¯é€šè¿‡æ€æ ·çš„å¼•ç”¨è·¯å¾„ã€ä¸å“ªäº›GC Rootsç›¸å…³è”, æ‰å¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•å›æ”¶å®ƒä»¬, æ ¹æ®æ³„æ¼å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ä»¥åŠå®ƒåˆ°GC Rootså¼•ç”¨é“¾çš„ä¿¡æ¯, ä¸€èˆ¬å¯ä»¥æ¯”è¾ƒå‡†ç¡®åœ°å®šä½åˆ°è¿™äº›å¯¹è±¡åˆ›å»ºçš„ä½ç½®, è¿›è€Œæ‰¾å‡ºäº§ç”Ÿå†…å­˜æ³„æ¼çš„ä»£ç çš„å…·ä½“ä½ç½®ã€‚</p><p>å¦‚æœæ˜¯<strong>å†…å­˜æº¢å‡º</strong>, æ¢å¥è¯è¯´å°±æ˜¯<strong>å†…å­˜ä¸­çš„å¯¹è±¡ç¡®å®éƒ½æ˜¯å¿…é¡»å­˜æ´»çš„</strong>, é‚£å°±åº”å½“<strong>æ£€æŸ¥Javaè™šæ‹Ÿæœºçš„å †å‚æ•°(-Xmxä¸-Xms)è®¾ç½®</strong>, ä¸æœºå™¨çš„å†…å­˜å¯¹æ¯”, çœ‹çœ‹æ˜¯å¦è¿˜æœ‰å‘ä¸Šè°ƒæ•´çš„ç©ºé—´ã€‚å†<strong>ä»ä»£ç ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ã€æŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿ã€å­˜å‚¨ç»“æ„è®¾è®¡ä¸åˆç†ç­‰æƒ…å†µ, å°½é‡å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—</strong>ã€‚</p><h2 id="è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º" aria-hidden="true">#</a> è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º</h2><p>ç”±äºHotSpotè™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆ, å› æ­¤å¯¹äºHotSpotæ¥è¯´, -Xosså‚æ•°(è®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°)è™½ç„¶å­˜åœ¨, ä½†å®é™…ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœçš„, æ ˆå®¹é‡åªèƒ½ç”±<code>-Xss</code>å‚æ•°æ¥è®¾å®šã€‚å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆ, åœ¨ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š</p><p>1)<strong>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦, å°†æŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸</strong>ã€‚</p><p>2)<strong>å¦‚æœè™šæ‹Ÿæœºçš„æ ˆå†…å­˜å…è®¸åŠ¨æ€æ‰©å±•, å½“æ‰©å±•æ ˆå®¹é‡æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜æ—¶, å°†æŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸</strong>ã€‚</p><blockquote><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹æ˜ç¡®å…è®¸Javaè™šæ‹Ÿæœºå®ç°è‡ªè¡Œé€‰æ‹©æ˜¯å¦æ”¯æŒæ ˆçš„åŠ¨æ€æ‰©å±•, è€ŒHotSpotè™šæ‹Ÿæœºçš„é€‰æ‹©æ˜¯ä¸æ”¯æŒæ‰©å±•, æ‰€ä»¥é™¤éåœ¨åˆ›å»ºçº¿ç¨‹ç”³è¯·å†…å­˜æ—¶å°±å› æ— æ³•è·å¾—è¶³å¤Ÿå†…å­˜è€Œå‡ºç°<code>OutOfMemoryError</code>å¼‚å¸¸, å¦åˆ™åœ¨çº¿ç¨‹è¿è¡Œæ—¶æ˜¯ä¸ä¼šå› ä¸ºæ‰©å±•è€Œå¯¼è‡´å†…å­˜æº¢å‡ºçš„, åªä¼šå› ä¸ºæ ˆå®¹é‡æ— æ³•å®¹çº³æ–°çš„æ ˆå¸§è€Œå¯¼è‡´<code>StackOverflowError</code>å¼‚å¸¸ã€‚</p></blockquote><p>ä¸ºäº†éªŒè¯è¿™ç‚¹, æˆ‘ä»¬å¯ä»¥åšä¸¤ä¸ªå®éªŒ, å…ˆå°†å®éªŒèŒƒå›´é™åˆ¶åœ¨å•çº¿ç¨‹ä¸­æ“ä½œ, å°è¯•ä¸‹é¢ä¸¤ç§è¡Œä¸ºæ˜¯å¦èƒ½è®©HotSpotè™šæ‹Ÿæœºäº§ç”ŸOutOfMemoryErrorå¼‚å¸¸ï¼š</p><p><strong>å®ä¾‹ä¸€ï¼šä½¿ç”¨<code>-Xss</code>å‚æ•°å‡å°‘æ ˆå†…å­˜å®¹é‡ã€‚</strong> ç»“æœï¼šæŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸, å¼‚å¸¸å‡ºç°æ—¶è¾“å‡ºçš„å †æ ˆæ·±åº¦ç›¸åº”ç¼©å°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * description:VM Argsï¼š-Xss128k
 * å‡å°‘å†…å­˜å®¹é‡, æµ‹è¯•è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º
 *
 * <span class="token keyword">@author</span> RenShiWei
 * Date: 2021/6/21 10:27
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackSOF</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ— é™é€’å½’å‹æ ˆ, å‡ºç°æ ˆæº¢å‡ºç°è±¡
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackSOF</span> oom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StackSOF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            oom<span class="token punctuation">.</span><span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;stack length:&quot;</span> <span class="token operator">+</span> oom<span class="token punctuation">.</span>stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœï¼š</p><figure><img src="/assets/20210621103925-991c993a.png" alt="image-20210621103925493" tabindex="0" loading="lazy"><figcaption>image-20210621103925493</figcaption></figure><p><strong>å®ä¾‹äºŒï¼šå®šä¹‰äº†å¤§é‡çš„æœ¬åœ°å˜é‡, å¢å¤§æ­¤æ–¹æ³•å¸§ä¸­æœ¬åœ°å˜é‡è¡¨çš„é•¿åº¦ã€‚</strong> ç»“æœï¼šæŠ›å‡º<code>StackOverflowError</code>å¼‚å¸¸, å¼‚å¸¸å‡ºç°æ—¶è¾“å‡ºçš„å †æ ˆæ·±åº¦ç›¸åº”ç¼©å°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * description:å®šä¹‰äº†å¤§é‡çš„æœ¬åœ°å˜é‡, å¢å¤§æ­¤æ–¹æ³•å¸§ä¸­æœ¬åœ°å˜é‡è¡¨çš„é•¿åº¦, æµ‹è¯•è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆçš„æº¢å‡º
 *
 * <span class="token keyword">@author</span> RenShiWei
 * Date: 2021/6/21 10:37
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackSOF2</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * å®šä¹‰å¤§é‡çš„å˜é‡, å¹¶ä¸”èµ‹å€¼
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> unused1<span class="token punctuation">,</span> unused2<span class="token punctuation">,</span> unused3<span class="token punctuation">,</span> unused4<span class="token punctuation">,</span> unused5<span class="token punctuation">,</span>
                unused6<span class="token punctuation">,</span> unused7<span class="token punctuation">,</span> unused8<span class="token punctuation">,</span> unused9<span class="token punctuation">,</span> unused10<span class="token punctuation">,</span>
                unused11<span class="token punctuation">,</span> unused12<span class="token punctuation">,</span> unused13<span class="token punctuation">,</span> unused14<span class="token punctuation">,</span> unused15<span class="token punctuation">,</span>
                unused16<span class="token punctuation">,</span> unused17<span class="token punctuation">,</span> unused18<span class="token punctuation">,</span> unused19<span class="token punctuation">,</span> unused20<span class="token punctuation">,</span>
                unused21<span class="token punctuation">,</span> unused22<span class="token punctuation">,</span> unused23<span class="token punctuation">,</span> unused24<span class="token punctuation">,</span> unused25<span class="token punctuation">,</span>
                unused26<span class="token punctuation">,</span> unused27<span class="token punctuation">,</span> unused28<span class="token punctuation">,</span> unused29<span class="token punctuation">,</span> unused30<span class="token punctuation">,</span>
                unused31<span class="token punctuation">,</span> unused32<span class="token punctuation">,</span> unused33<span class="token punctuation">,</span> unused34<span class="token punctuation">,</span> unused35<span class="token punctuation">,</span>
                unused36<span class="token punctuation">,</span> unused37<span class="token punctuation">,</span> unused38<span class="token punctuation">,</span> unused39<span class="token punctuation">,</span> unused40<span class="token punctuation">,</span>
                unused41<span class="token punctuation">,</span> unused42<span class="token punctuation">,</span> unused43<span class="token punctuation">,</span> unused44<span class="token punctuation">,</span> unused45<span class="token punctuation">,</span>
                unused46<span class="token punctuation">,</span> unused47<span class="token punctuation">,</span> unused48<span class="token punctuation">,</span> unused49<span class="token punctuation">,</span> unused50<span class="token punctuation">,</span>
                unused51<span class="token punctuation">,</span> unused52<span class="token punctuation">,</span> unused53<span class="token punctuation">,</span> unused54<span class="token punctuation">,</span> unused55<span class="token punctuation">,</span>
                unused56<span class="token punctuation">,</span> unused57<span class="token punctuation">,</span> unused58<span class="token punctuation">,</span> unused59<span class="token punctuation">,</span> unused60<span class="token punctuation">,</span>
                unused61<span class="token punctuation">,</span> unused62<span class="token punctuation">,</span> unused63<span class="token punctuation">,</span> unused64<span class="token punctuation">,</span> unused65<span class="token punctuation">,</span>
                unused66<span class="token punctuation">,</span> unused67<span class="token punctuation">,</span> unused68<span class="token punctuation">,</span> unused69<span class="token punctuation">,</span> unused70<span class="token punctuation">,</span>
                unused71<span class="token punctuation">,</span> unused72<span class="token punctuation">,</span> unused73<span class="token punctuation">,</span> unused74<span class="token punctuation">,</span> unused75<span class="token punctuation">,</span>
                unused76<span class="token punctuation">,</span> unused77<span class="token punctuation">,</span> unused78<span class="token punctuation">,</span> unused79<span class="token punctuation">,</span> unused80<span class="token punctuation">,</span>
                unused81<span class="token punctuation">,</span> unused82<span class="token punctuation">,</span> unused83<span class="token punctuation">,</span> unused84<span class="token punctuation">,</span> unused85<span class="token punctuation">,</span>
                unused86<span class="token punctuation">,</span> unused87<span class="token punctuation">,</span> unused88<span class="token punctuation">,</span> unused89<span class="token punctuation">,</span> unused90<span class="token punctuation">,</span>
                unused91<span class="token punctuation">,</span> unused92<span class="token punctuation">,</span> unused93<span class="token punctuation">,</span> unused94<span class="token punctuation">,</span> unused95<span class="token punctuation">,</span>
                unused96<span class="token punctuation">,</span> unused97<span class="token punctuation">,</span> unused98<span class="token punctuation">,</span> unused99<span class="token punctuation">,</span> unused100<span class="token punctuation">;</span>

        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        unused1 <span class="token operator">=</span> unused2 <span class="token operator">=</span> unused3 <span class="token operator">=</span> unused4 <span class="token operator">=</span> unused5 <span class="token operator">=</span>
                unused6 <span class="token operator">=</span> unused7 <span class="token operator">=</span> unused8 <span class="token operator">=</span> unused9 <span class="token operator">=</span> unused10 <span class="token operator">=</span>
                        unused11 <span class="token operator">=</span> unused12 <span class="token operator">=</span> unused13 <span class="token operator">=</span> unused14 <span class="token operator">=</span> unused15 <span class="token operator">=</span>
                                unused16 <span class="token operator">=</span> unused17 <span class="token operator">=</span> unused18 <span class="token operator">=</span> unused19 <span class="token operator">=</span> unused20 <span class="token operator">=</span>
                                        unused21 <span class="token operator">=</span> unused22 <span class="token operator">=</span> unused23 <span class="token operator">=</span> unused24 <span class="token operator">=</span> unused25 <span class="token operator">=</span>
                                                unused26 <span class="token operator">=</span> unused27 <span class="token operator">=</span> unused28 <span class="token operator">=</span> unused29 <span class="token operator">=</span> unused30 <span class="token operator">=</span>
                                                        unused31 <span class="token operator">=</span> unused32 <span class="token operator">=</span> unused33 <span class="token operator">=</span> unused34 <span class="token operator">=</span> unused35 <span class="token operator">=</span>
                                                                unused36 <span class="token operator">=</span> unused37 <span class="token operator">=</span> unused38 <span class="token operator">=</span> unused39 <span class="token operator">=</span> unused40 <span class="token operator">=</span>
                                                                        unused41 <span class="token operator">=</span> unused42 <span class="token operator">=</span> unused43 <span class="token operator">=</span> unused44 <span class="token operator">=</span>
                                                                                unused45 <span class="token operator">=</span>
                                                                                        unused46 <span class="token operator">=</span> unused47 <span class="token operator">=</span> unused48 <span class="token operator">=</span>
                                                                                                unused49 <span class="token operator">=</span> unused50 <span class="token operator">=</span>
                                                                                                        unused51 <span class="token operator">=</span>
                                                                                                                unused52 <span class="token operator">=</span>
                                                                                                                        unused53 <span class="token operator">=</span> unused54 <span class="token operator">=</span>
                                                                                                                                unused55 <span class="token operator">=</span>
                                                                                                                                        unused56 <span class="token operator">=</span> unused57 <span class="token operator">=</span>
                                                                                                                                                unused58 <span class="token operator">=</span>
                                                                                                                                                        unused59 <span class="token operator">=</span> unused60 <span class="token operator">=</span>
                                                                                                                                                                unused61 <span class="token operator">=</span>
                                                                                                                                                                        unused62 <span class="token operator">=</span> unused63 <span class="token operator">=</span> unused64 <span class="token operator">=</span> unused65 <span class="token operator">=</span>
                                                                                                                                                                                unused66 <span class="token operator">=</span> unused67 <span class="token operator">=</span> unused68 <span class="token operator">=</span> unused69 <span class="token operator">=</span> unused70 <span class="token operator">=</span>
                                                                                                                                                                                        unused71 <span class="token operator">=</span> unused72 <span class="token operator">=</span> unused73 <span class="token operator">=</span> unused74 <span class="token operator">=</span> unused75 <span class="token operator">=</span>
                                                                                                                                                                                                unused76 <span class="token operator">=</span> unused77 <span class="token operator">=</span> unused78 <span class="token operator">=</span> unused79 <span class="token operator">=</span> unused80 <span class="token operator">=</span>
                                                                                                                                                                                                        unused81 <span class="token operator">=</span> unused82 <span class="token operator">=</span> unused83 <span class="token operator">=</span> unused84 <span class="token operator">=</span> unused85 <span class="token operator">=</span>
                                                                                                                                                                                                                unused86 <span class="token operator">=</span> unused87 <span class="token operator">=</span> unused88 <span class="token operator">=</span> unused89 <span class="token operator">=</span> unused90 <span class="token operator">=</span>
                                                                                                                                                                                                                        unused91 <span class="token operator">=</span> unused92 <span class="token operator">=</span> unused93 <span class="token operator">=</span> unused94 <span class="token operator">=</span> unused95 <span class="token operator">=</span>
                                                                                                                                                                                                                                unused96 <span class="token operator">=</span> unused97 <span class="token operator">=</span> unused98 <span class="token operator">=</span> unused99 <span class="token operator">=</span> unused100 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;stack length:&quot;</span> <span class="token operator">+</span> stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/20210621104016-614b0b37.png" alt="image-20210621104016532" tabindex="0" loading="lazy"><figcaption>image-20210621104016532</figcaption></figure><p>å¦‚æœæ˜¯è¿œå¤æ—¶ä»£çš„Classicè™šæ‹Ÿæœº, è¿™æ¬¾è™šæ‹Ÿæœºå¯ä»¥æ”¯æŒåŠ¨æ€æ‰©å±•æ ˆå†…å­˜çš„å®¹é‡, å®šä¹‰å¤§é‡çš„æœ¬åœ°å˜é‡ä¼šäº§ç”ŸOutOfMemoryErrorè€Œä¸æ˜¯StackOverflowErrorå¼‚å¸¸ã€‚</p><p>ç»“æœè¡¨æ˜ï¼š<strong>æ— è®ºæ˜¯ç”±äºæ ˆå¸§å¤ªå¤§è¿˜æ˜¯è™šæ‹Ÿæœºæ ˆå®¹é‡å¤ªå°, å½“æ–°çš„æ ˆå¸§å†…å­˜æ— æ³•åˆ†é…çš„æ—¶å€™, HotSpotè™šæ‹ŸæœºæŠ›å‡ºçš„éƒ½æ˜¯StackOverflowErrorå¼‚å¸¸</strong>ã€‚</p><h2 id="æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º" aria-hidden="true">#</a> æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º</h2><p>æ–¹æ³•åŒºçš„ä¸»è¦èŒè´£æ˜¯ç”¨äºå­˜æ”¾ç±»å‹çš„ç›¸å…³ä¿¡æ¯, å¦‚ç±»åã€è®¿é—®ä¿®é¥°ç¬¦ã€å¸¸é‡æ± ã€å­—æ®µæè¿°ã€æ–¹æ³•æè¿°ç­‰ã€‚å¯¹äºè¿™éƒ¨åˆ†åŒºåŸŸçš„æµ‹è¯•, åŸºæœ¬çš„æ€è·¯æ˜¯è¿è¡Œæ—¶äº§å¤§é‡çš„ç±»å»å¡«æ»¡æ–¹æ³•åŒº, ç›´åˆ°æº¢å‡ºä¸ºæ­¢ã€‚</p><p>ç›´æ¥ä½¿ç”¨Java SE APIä¹Ÿå¯ä»¥åŠ¨æ€äº§ç”Ÿç±»(å¦‚åå°„æ—¶çš„GeneratedConstructorAccessorå’ŒåŠ¨æ€ä»£ç†ç­‰)</p><p>å€ŸåŠ©CGLibä½¿å¾—æ–¹æ³•åŒºå‡ºç°å†…å­˜æº¢å‡ºå¼‚å¸¸ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * VM Argsï¼š-XX:PermSize=10M -XX:MaxPermSize=10M
 * <span class="token keyword">@author</span> zzm
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaMethodAreaOOM</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">OOMObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setUseCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span>
                    <span class="token keyword">return</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœ¨JDK7çš„ç¯å¢ƒä¸­æµ‹è¯•</strong>ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span><span class="token operator">:</span> <span class="token class-name">PermGen</span> space
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClass1</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClassCond</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">632</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">616</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">8</span> more
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ–¹æ³•åŒºæº¢å‡ºä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„å†…å­˜æº¢å‡ºå¼‚å¸¸, ä¸€ä¸ªç±»å¦‚æœè¦è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶, è¦è¾¾æˆçš„æ¡ä»¶æ˜¯æ¯”è¾ƒè‹›åˆ»çš„</strong>ã€‚</p><p>åœ¨ç»å¸¸è¿è¡Œæ—¶ç”Ÿæˆå¤§é‡åŠ¨æ€ç±»çš„åº”ç”¨åœºæ™¯é‡Œ, å°±åº”è¯¥ç‰¹åˆ«å…³æ³¨è¿™äº›ç±»çš„å›æ”¶çŠ¶å†µã€‚è¿™ç±»åœºæ™¯é™¤äº†ä¹‹å‰æåˆ°çš„ç¨‹åºä½¿ç”¨äº†<strong>CGLibå­—èŠ‚ç å¢å¼º</strong>å’ŒåŠ¨æ€è¯­è¨€å¤–, å¸¸è§çš„è¿˜æœ‰ï¼š**å¤§é‡JSPæˆ–åŠ¨æ€äº§ç”ŸJSPæ–‡ä»¶çš„åº”ç”¨(JSPç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦ç¼–è¯‘ä¸ºJavaç±»)**ç­‰ã€‚</p><p><strong>åœ¨JDK 8ä»¥å, å…ƒç©ºé—´æ›¿ä»£æ°¸ä¹…ä»£ã€‚åœ¨é»˜è®¤è®¾ç½®ä¸‹, å¾ˆéš¾å†è¿«ä½¿è™šæ‹Ÿæœºäº§ç”Ÿæ–¹æ³•åŒºçš„æº¢å‡ºå¼‚å¸¸äº†</strong>ã€‚ä¸è¿‡HotSpotè¿˜æ˜¯æä¾›äº†ä¸€äº›å‚æ•°ä½œä¸ºå…ƒç©ºé—´çš„é˜²å¾¡æªæ–½, ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><code>-XXï¼šMaxMetaspaceSize</code>ï¼šè®¾ç½®å…ƒç©ºé—´æœ€å¤§å€¼, é»˜è®¤æ˜¯-1, å³ä¸é™åˆ¶, æˆ–è€…è¯´åªå—é™äºæœ¬åœ°å†…å­˜å¤§å°ã€‚</li><li><code>-XXï¼šMetaspaceSize</code>ï¼šæŒ‡å®šå…ƒç©ºé—´çš„åˆå§‹ç©ºé—´å¤§å°, ä»¥å­—èŠ‚ä¸ºå•ä½, è¾¾åˆ°è¯¥å€¼å°±ä¼šè§¦å‘åƒåœ¾æ”¶é›†è¿›è¡Œç±»å‹å¸è½½, åŒæ—¶æ”¶é›†å™¨ä¼šå¯¹è¯¥å€¼è¿›è¡Œè°ƒæ•´ï¼šå¦‚æœé‡Šæ”¾äº†å¤§é‡çš„ç©ºé—´, å°±é€‚å½“é™ä½è¯¥å€¼ï¼›å¦‚æœé‡Šæ”¾äº†å¾ˆå°‘çš„ç©ºé—´, é‚£ä¹ˆåœ¨ä¸è¶…è¿‡-XXï¼šMaxMetaspaceSize(å¦‚æœè®¾ç½®äº†çš„è¯)çš„æƒ…å†µä¸‹, é€‚å½“æé«˜è¯¥å€¼ã€‚</li><li><code>-XXï¼šMinMetaspaceFreeRatio</code>ï¼šä½œç”¨æ˜¯åœ¨åƒåœ¾æ”¶é›†ä¹‹åæ§åˆ¶æœ€å°çš„å…ƒç©ºé—´å‰©ä½™å®¹é‡çš„ç™¾åˆ†æ¯”, å¯å‡å°‘å› ä¸ºå…ƒç©ºé—´ä¸è¶³å¯¼è‡´çš„åƒåœ¾æ”¶é›†çš„é¢‘ç‡ã€‚ç±»ä¼¼çš„è¿˜æœ‰<code>-XXï¼šMax-MetaspaceFreeRatio</code>, ç”¨äºæ§åˆ¶æœ€å¤§çš„å…ƒç©ºé—´å‰©ä½™å®¹é‡çš„ç™¾åˆ†æ¯”ã€‚</li></ul><h2 id="æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º" tabindex="-1"><a class="header-anchor" href="#æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º" aria-hidden="true">#</a> æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º</h2><p>ç›´æ¥å†…å­˜(Direct Memory)çš„å®¹é‡å¤§å°å¯é€šè¿‡<code>-XXï¼šMaxDirectMemorySize</code>å‚æ•°æ¥æŒ‡å®š, å¦‚æœä¸å»æŒ‡å®š, åˆ™é»˜è®¤ä¸Javaå †æœ€å¤§å€¼(ç”±-XmxæŒ‡å®š)ä¸€è‡´ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Exception</span> in thread <span class="token string">&quot;main&quot;</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>OutOfMemoryError</span>
    at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span><span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
    at org<span class="token punctuation">.</span>fenixsoft<span class="token punctuation">.</span>oom<span class="token punctuation">.</span><span class="token constant">DMOOM</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token constant">DMOOM</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±ç›´æ¥å†…å­˜å¯¼è‡´çš„å†…å­˜æº¢å‡º, ä¸€ä¸ªæ˜æ˜¾çš„ç‰¹å¾æ˜¯åœ¨Heap Dumpæ–‡ä»¶ä¸­ä¸ä¼šçœ‹è§æœ‰ä»€ä¹ˆæ˜æ˜¾çš„å¼‚å¸¸æƒ…å†µ, å¦‚æœè¯»è€…å‘ç°å†…å­˜æº¢å‡ºä¹‹åäº§ç”Ÿçš„Dumpæ–‡ä»¶å¾ˆå°, è€Œç¨‹åºä¸­åˆç›´æ¥æˆ–é—´æ¥ä½¿ç”¨äº†DirectMemory(å…¸å‹çš„é—´æ¥ä½¿ç”¨å°±æ˜¯NIO), é‚£å°±å¯ä»¥è€ƒè™‘é‡ç‚¹æ£€æŸ¥ä¸€ä¸‹ç›´æ¥å†…å­˜æ–¹é¢çš„åŸå› äº†</p><h2 id="å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²" aria-hidden="true">#</a> å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„éœ²</h2><p>1ã€å†…å­˜æ³„æ¼memory leak :</p><p>æ˜¯æŒ‡ç¨‹åºåœ¨ç”³è¯·å†…å­˜å, æ— æ³•é‡Šæ”¾å·²ç”³è¯·çš„å†…å­˜ç©ºé—´, ä¸€æ¬¡å†…å­˜æ³„æ¼ä¼¼ä¹ä¸ä¼šæœ‰å¤§çš„å½±å“, ä½†å†…å­˜æ³„æ¼å †ç§¯åçš„åæœå°±æ˜¯å†…å­˜æº¢å‡ºã€‚</p><p>2ã€å†…å­˜æº¢å‡º out of memory :</p><p>æŒ‡ç¨‹åºç”³è¯·å†…å­˜æ—¶, æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›ç”³è¯·è€…ä½¿ç”¨, æˆ–è€…è¯´, ç»™äº†ä½ ä¸€å—å­˜å‚¨intç±»å‹æ•°æ®çš„å­˜å‚¨ç©ºé—´, ä½†æ˜¯ä½ å´å­˜å‚¨longç±»å‹çš„æ•°æ®, é‚£ä¹ˆç»“æœå°±æ˜¯å†…å­˜ä¸å¤Ÿç”¨, æ­¤æ—¶å°±ä¼šæŠ¥é”™OOM, å³æ‰€è°“çš„å†…å­˜æº¢å‡ºã€‚</p><ul><li><a href="https://www.php.cn/java/base/482400.html" target="_blank" rel="noopener noreferrer">javaä¸­å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºæ˜¯ä»€ä¹ˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="stringç±»å’Œå¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#stringç±»å’Œå¸¸é‡æ± " aria-hidden="true">#</a> Stringç±»å’Œå¸¸é‡æ± </h1><h2 id="string-ç±»å’Œå¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#string-ç±»å’Œå¸¸é‡æ± " aria-hidden="true">#</a> String ç±»å’Œå¸¸é‡æ± </h2><p><strong>String å¯¹è±¡çš„ä¸¤ç§åˆ›å»ºæ–¹å¼ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;abcd&quot;</span><span class="token punctuation">;</span><span class="token comment">//å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰&quot;abcd&quot;, å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰, åˆ™åˆ›å»ºä¸€ä¸ª, ç„¶å str1 æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡, å¦‚æœæœ‰, åˆ™ç›´æ¥å°† str1 æŒ‡å‘&quot;abcd&quot;&quot;ï¼›</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</span>
<span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abcd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å †ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token operator">==</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str2<span class="token operator">==</span>str3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ç§ä¸åŒçš„åˆ›å»ºæ–¹æ³•æ˜¯æœ‰å·®åˆ«çš„ã€‚</p><ul><li>ç¬¬ä¸€ç§æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­æ‹¿å¯¹è±¡ï¼›</li><li>ç¬¬äºŒç§æ–¹å¼æ˜¯ç›´æ¥åœ¨å †å†…å­˜ç©ºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ul><p>è®°ä½ä¸€ç‚¹ï¼š<strong>åªè¦ä½¿ç”¨ new æ–¹æ³•, ä¾¿éœ€è¦åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</strong></p><figure><img src="https://snailclimb.gitee.io/javaguide/docs/java/jvm/pictures/javaå†…å­˜åŒºåŸŸ/2019-3String-Pool-Java1-450x249.png" alt="String-Pool-Java" tabindex="0" loading="lazy"><figcaption>String-Pool-Java</figcaption></figure><p><strong>String ç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š</strong></p><ol><li>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ String å¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚</li><li>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„ String å¯¹è±¡, å¯ä»¥ä½¿ç”¨ String æä¾›çš„ <code>intern()</code> æ–¹æ³•ã€‚<code>String.intern()</code> æ˜¯ä¸€ä¸ª Native æ–¹æ³•, å®ƒçš„ä½œç”¨æ˜¯ï¼šå¦‚æœè¿è¡Œæ—¶å¸¸é‡æ± ä¸­å·²ç»åŒ…å«ä¸€ä¸ªç­‰äºæ­¤ String å¯¹è±¡å†…å®¹çš„å­—ç¬¦ä¸², åˆ™è¿”å›å¸¸é‡æ± ä¸­è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰, JDK1.7 ä¹‹å‰(ä¸åŒ…å« 1.7)çš„å¤„ç†æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸æ­¤ String å†…å®¹ç›¸åŒçš„å­—ç¬¦ä¸², å¹¶è¿”å›å¸¸é‡æ± ä¸­åˆ›å»ºçš„å­—ç¬¦ä¸²çš„å¼•ç”¨, JDK1.7 ä»¥åŠä¹‹åçš„å¤„ç†æ–¹å¼æ˜¯åœ¨å¸¸é‡æ± ä¸­è®°å½•æ­¤å­—ç¬¦ä¸²çš„å¼•ç”¨, å¹¶è¿”å›è¯¥å¼•ç”¨ã€‚</li></ol><blockquote><p>åœ¨JDK 6ä¸­, intern()æ–¹æ³•ä¼šæŠŠé¦–æ¬¡é‡åˆ°çš„å­—ç¬¦ä¸²å®ä¾‹å¤åˆ¶åˆ°æ°¸ä¹…ä»£çš„å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜å‚¨, è¿”å›çš„ä¹Ÿæ˜¯æ°¸ä¹…ä»£é‡Œé¢è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ã€‚</p><p>JDK 7(ä»¥åŠéƒ¨åˆ†å…¶ä»–è™šæ‹Ÿæœº, ä¾‹å¦‚JRockit)çš„intern()æ–¹æ³•å®ç°å°±ä¸éœ€è¦å†æ‹·è´å­—ç¬¦ä¸²çš„å®ä¾‹åˆ°æ°¸ä¹…ä»£äº†, æ—¢ç„¶å­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»ç§»åˆ°Javaå †ä¸­, é‚£åªéœ€è¦åœ¨å¸¸é‡æ± é‡Œè®°å½•ä¸€ä¸‹é¦–æ¬¡å‡ºç°çš„å®ä¾‹å¼•ç”¨å³å¯ã€‚</p></blockquote><p>JDK8 :</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;è®¡ç®—æœº&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;è®¡ç®—æœº&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¡ç®—æœº</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true, å› ä¸ºä¸¤ä¸ªéƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ String å¯¹è±¡</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å­—ç¬¦ä¸²æ‹¼æ¥:</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> str3 <span class="token operator">=</span> <span class="token string">&quot;str&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;ing&quot;</span><span class="token punctuation">;</span><span class="token comment">//å¸¸é‡æ± ä¸­çš„å¯¹è±¡</span>
<span class="token class-name">String</span> str4 <span class="token operator">=</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span> <span class="token comment">//åœ¨å †ä¸Šåˆ›å»ºçš„æ–°çš„å¯¹è±¡</span>
<span class="token class-name">String</span> str5 <span class="token operator">=</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">;</span><span class="token comment">//å¸¸é‡æ± ä¸­çš„å¯¹è±¡</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str3 <span class="token operator">==</span> str4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str3 <span class="token operator">==</span> str5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str4 <span class="token operator">==</span> str5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://snailclimb.gitee.io/javaguide/docs/java/jvm/pictures/javaå†…å­˜åŒºåŸŸ/å­—ç¬¦ä¸²æ‹¼æ¥-å¸¸é‡æ± 2.png" alt="å­—ç¬¦ä¸²æ‹¼æ¥" tabindex="0" loading="lazy"><figcaption>å­—ç¬¦ä¸²æ‹¼æ¥</figcaption></figure><p>å°½é‡é¿å…å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥, å› ä¸ºè¿™æ ·ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¹å˜å­—ç¬¦ä¸²çš„è¯, å¯ä»¥ä½¿ç”¨ StringBuilder æˆ–è€… StringBufferã€‚</p><h2 id="string-s1-new-string-abc-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#string-s1-new-string-abc-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡" aria-hidden="true">#</a> <code>String s1 = new String(&quot;abc&quot;);</code>è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Ÿ</h2><p><strong>å°†åˆ›å»º 1 æˆ– 2 ä¸ªå­—ç¬¦ä¸²ã€‚å¦‚æœæ± ä¸­å·²å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡&quot;abc&quot;, åˆ™åªä¼šåœ¨å †ç©ºé—´åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡&quot;abc&quot;ã€‚å¦‚æœæ± ä¸­æ²¡æœ‰å­—ç¬¦ä¸²å¸¸é‡&quot;abc&quot;, é‚£ä¹ˆå®ƒå°†é¦–å…ˆåœ¨æ± ä¸­åˆ›å»º, ç„¶ååœ¨å †ç©ºé—´ä¸­åˆ›å»º, å› æ­¤å°†åˆ›å»ºæ€»å…± 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</strong></p><p><strong>éªŒè¯ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å †å†…å­˜çš„åœ°å€å€¼</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º false,å› ä¸ºä¸€ä¸ªæ˜¯å †å†…å­˜, ä¸€ä¸ªæ˜¯å¸¸é‡æ± çš„å†…å­˜, æ•…ä¸¤è€…æ˜¯ä¸åŒçš„ã€‚</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç»“æœï¼š</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>false
true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± " tabindex="-1"><a class="header-anchor" href="#_8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± " aria-hidden="true">#</a> 8ç§åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å’Œå¸¸é‡æ± </h2><p><strong>Java åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»çš„å¤§éƒ¨åˆ†éƒ½å®ç°äº†å¸¸é‡æ± æŠ€æœ¯, å³ Byte,Short,Integer,Long,Character,Booleanï¼›å‰é¢ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼[-128, 127] çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®, Character åˆ›å»ºäº†æ•°å€¼åœ¨[0,127]èŒƒå›´çš„ç¼“å­˜æ•°æ®, Boolean ç›´æ¥è¿”å› True Or Falseã€‚å¦‚æœè¶…å‡ºå¯¹åº”èŒƒå›´ä»ç„¶ä¼šå»åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</strong> ä¸ºå•¥æŠŠç¼“å­˜è®¾ç½®ä¸º[-128, 127]åŒºé—´ï¼Ÿ(<a href="https://github.com/Snailclimb/JavaGuide/issues/461" target="_blank" rel="noopener noreferrer">å‚è§ issue/461<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)æ€§èƒ½å’Œèµ„æºä¹‹é—´çš„æƒè¡¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Boolean</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>b <span class="token operator">?</span> <span class="token constant">TRUE</span> <span class="token operator">:</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CharacterCache</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">CharacterCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Character</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            cache<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Character</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸¤ç§æµ®ç‚¹æ•°ç±»å‹çš„åŒ…è£…ç±» Float,Double å¹¶æ²¡æœ‰å®ç°å¸¸é‡æ± æŠ€æœ¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º true</span>
<span class="token class-name">Integer</span> i11 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> i22 <span class="token operator">=</span> <span class="token number">333</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i11 <span class="token operator">==</span> i22<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º false</span>
<span class="token class-name">Double</span> i3 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token class-name">Double</span> i4 <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i3 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¾“å‡º false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Integer ç¼“å­˜æºä»£ç ï¼š</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
*æ­¤æ–¹æ³•å°†å§‹ç»ˆç¼“å­˜-128 åˆ° 127(åŒ…æ‹¬ç«¯ç‚¹)èŒƒå›´å†…çš„å€¼, å¹¶å¯ä»¥ç¼“å­˜æ­¤èŒƒå›´ä¹‹å¤–çš„å…¶ä»–å€¼ã€‚
*/</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><ol><li><code>Integer i1=40</code>ï¼›Java åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šç›´æ¥å°†ä»£ç å°è£…æˆ <code>Integer i1=Integer.valueOf(40);</code>, ä»è€Œä½¿ç”¨å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚</li><li><code>Integer i1 = new Integer(40);</code>è¿™ç§æƒ…å†µä¸‹ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i1<span class="token operator">==</span>i2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¾“å‡º false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Integer æ¯”è¾ƒæ›´ä¸°å¯Œçš„ä¸€ä¸ªä¾‹å­:</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>  <span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Integer</span> i6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i1=i2   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i1=i2+i3   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2 <span class="token operator">+</span> i3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i1=i4   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i4=i5   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;i4=i5+i6   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i4 <span class="token operator">==</span> i5 <span class="token operator">+</span> i6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;40=i5+i6   &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">40</span> <span class="token operator">==</span> i5 <span class="token operator">+</span> i6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“æœï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>i1=i2   true
i1=i2+i3   true
i1=i4   false
i4=i5   false
i4=i5+i6   true
40=i5+i6   true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£é‡Šï¼š</p><p>è¯­å¥ <code>i4 == i5 + i6</code>, å› ä¸º+è¿™ä¸ªæ“ä½œç¬¦ä¸é€‚ç”¨äº Integer å¯¹è±¡, é¦–å…ˆ i5 å’Œ i6 è¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ“ä½œ, è¿›è¡Œæ•°å€¼ç›¸åŠ , å³ i4 == 40ã€‚ç„¶å Integer å¯¹è±¡æ— æ³•ä¸æ•°å€¼è¿›è¡Œç›´æ¥æ¯”è¾ƒ, æ‰€ä»¥ i4 è‡ªåŠ¨æ‹†ç®±è½¬ä¸º int å€¼ 40, æœ€ç»ˆè¿™æ¡è¯­å¥è½¬ä¸º 40 == 40 è¿›è¡Œæ•°å€¼æ¯”è¾ƒã€‚</p><h1 id="åƒåœ¾å›æ”¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶æœºåˆ¶" aria-hidden="true">#</a> åƒåœ¾å›æ”¶æœºåˆ¶</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶" aria-hidden="true">#</a> <strong>ä¸ºä»€ä¹ˆéœ€è¦äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶</strong>ï¼Ÿ</h2><p>å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼é—®é¢˜æ—¶, å½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘é‡çš„ç“¶é¢ˆæ—¶, æˆ‘ä»¬å°±å¿…é¡»å¯¹è¿™äº›&quot;è‡ªåŠ¨åŒ–&quot;çš„æŠ€æœ¯å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚ã€‚</p><h2 id="å“ªäº›åŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶" tabindex="-1"><a class="header-anchor" href="#å“ªäº›åŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶" aria-hidden="true">#</a> <strong>å“ªäº›åŒºåŸŸéœ€è¦åƒåœ¾å›æ”¶</strong>ï¼Ÿ</h2><p>ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåŒçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸€è‡´, æ–¹æ³•/çº¿ç¨‹æŠ€ç»“æŸ, å†…å­˜ç›´æ¥å›æ”¶, æ— éœ€è¿‡å¤šè€ƒè™‘ã€‚</p><p><strong>å †å’Œæ–¹æ³•åŒºæœ‰ç€ä¸ç¡®å®šæ€§</strong>ï¼šä¸€ä¸ªæ¥å£å¤šä¸ªå®ç°ç±»æ‰€éœ€å†…å­˜ä¸ä¸€æ ·, ä¸€ä¸ªæ–¹æ³•ä¸åŒçš„æ¡ä»¶å’Œåˆ†æ”¯æ‰€éœ€å†…å­˜ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚åªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰çŸ¥é“ç¨‹åºä¼šåˆ›å»ºå“ªäº›å¯¹è±¡ã€å¤šå°‘ä¸ªå¯¹è±¡ã€‚è¿™éƒ¨åˆ†å†…å­˜åˆ†é…å’Œå›æ”¶æ˜¯åŠ¨æ€, æ‰€ä»¥éœ€è¦å…³æ³¨å†…å­˜çš„åˆ†é…ä¸å›æ”¶ã€‚</p><h2 id="å¦‚ä½•åˆ¤æ–­å¯¹è±¡éœ€è¦è¢«å›æ”¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ¤æ–­å¯¹è±¡éœ€è¦è¢«å›æ”¶" aria-hidden="true">#</a> å¦‚ä½•åˆ¤æ–­å¯¹è±¡éœ€è¦è¢«å›æ”¶ï¼Ÿ</h2><h3 id="å¼•ç”¨è®¡æ•°ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å¼•ç”¨è®¡æ•°ç®—æ³•" aria-hidden="true">#</a> å¼•ç”¨è®¡æ•°ç®—æ³•</h3><blockquote><p>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨, æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒ, è®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆ, è®¡æ•°å™¨å°±å‡ 1ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p></blockquote><p><strong>è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•, æ•ˆç‡é«˜, ä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜, å…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</strong></p><blockquote><p>å¯¹è±¡objAå’ŒobjBéƒ½æœ‰å­—æ®µ<code>instance</code>, èµ‹å€¼ä»¤ <code>objA.instance=objB</code> åŠ <code>objB.instance=objA</code> , é™¤æ­¤ä¹‹å¤–, è¿™ä¸¤ä¸ªå¯¹è±¡å†æ— ä»»ä½•å¼•ç”¨, å®é™…ä¸Šè¿™ä¸¤ä¸ªå¯¹è±¡å·²ç»ä¸å¯èƒ½å†è¢«è®¿é—®, ä½†æ˜¯å®ƒä»¬å› ä¸ºäº’ç›¸å¼•ç”¨ç€å¯¹æ–¹, å¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°éƒ½ä¸ä¸ºé›¶, å¼•ç”¨è®¡æ•°ç®—æ³•ä¹Ÿå°±æ— æ³•å›æ”¶å®ƒä»¬ã€‚</p></blockquote><h3 id="å¯è¾¾æ€§åˆ†æç®—æ³•" tabindex="-1"><a class="header-anchor" href="#å¯è¾¾æ€§åˆ†æç®—æ³•" aria-hidden="true">#</a> å¯è¾¾æ€§åˆ†æç®—æ³•</h3><blockquote><p>é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º <strong>&quot;GC Roots&quot;</strong> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹, ä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢, èŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾, å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯, åˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p></blockquote><p>![image-20210622161600979](./images/jvm/ å¯è¾¾æ€§åˆ†æç®—æ³•20210622161601.png)</p><p><strong>å¯ä½œä¸º GC Roots çš„å¯¹è±¡</strong>ï¼š</p><ul><li><strong>åœ¨è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡</strong>, è­¬å¦‚å„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚</li><li><strong>åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</strong>, è­¬å¦‚Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚</li><li><strong>åœ¨æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong>, è­¬å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± (String Table)é‡Œçš„å¼•ç”¨ã€‚</li><li><strong>åœ¨æœ¬åœ°æ–¹æ³•æ ˆä¸­JNI(å³é€šå¸¸æ‰€è¯´çš„Nativeæ–¹æ³•)å¼•ç”¨çš„å¯¹è±¡</strong>ã€‚</li><li><strong>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨</strong>, å¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡, ä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡(æ¯”å¦‚NullPointExcepitonã€OutOfMemoryError)ç­‰, è¿˜æœ‰ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li><li><strong>æ‰€æœ‰è¢«åŒæ­¥é”(synchronizedå…³é”®å­—)æŒæœ‰çš„å¯¹è±¡</strong>ã€‚</li><li><strong>åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰</strong>ã€‚</li></ul><h3 id="åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡" tabindex="-1"><a class="header-anchor" href="#åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•-å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡" aria-hidden="true">#</a> <strong>åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•, å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ­»äº¡</strong>ï¼Ÿ</h3><p>å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­åˆ¤å®šä¸ºä¸å¯è¾¾çš„å¯¹è±¡, ä¹Ÿä¸æ˜¯&quot;éæ­»ä¸å¯&quot;çš„, è¿™æ—¶å€™å®ƒä»¬æš‚æ—¶è¿˜å¤„äº**&quot;ç¼“åˆ‘&quot;é˜¶æ®µ**, è¦çœŸæ­£å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡, è‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ã€‚</p><p>ç¬¬ä¸€æ¬¡æ ‡è®°ï¼šå¯¹è±¡æ²¡æœ‰ä¸<code>GC Roots</code>ç›¸è¿æ—¶, åˆ¤æ–­è¯¥å¯¹è±¡çš„<code>finalize</code>æ–¹æ³•æœ‰æ²¡æœ‰è¢«è¦†ç›–è¿‡, æˆ–è€…æœ‰æ²¡æœ‰è¢«è™šæ‹Ÿæœºæ‰§è¡Œè¿‡ã€‚å¦‚æœæ²¡æœ‰, åˆ™ç›´æ¥è¢«å›æ”¶ï¼›å¦‚æœæ‰§è¡Œè¿‡, å¯¹è±¡è¢«æ”¾ç½®è¿›<code>F-Queue</code>é˜Ÿåˆ—ä¸­, è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ã€‚</p><p>ç¬¬äºŒæ¬¡æ ‡è®°ï¼šå¦‚æœå¯¹è±¡åœ¨<code>finalize</code>å…³è”ä¸Šäº†<code>GC Roots</code>, åœ¨é˜Ÿåˆ—ä¸­ç§»é™¤(åªèƒ½å…³è”ä¸€æ¬¡)ï¼›å¦‚æœæ²¡æœ‰, è¢«å›æ”¶ã€‚</p><h2 id="javaä¸­çš„å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#javaä¸­çš„å¼•ç”¨" aria-hidden="true">#</a> Javaä¸­çš„å¼•ç”¨</h2><p>JDK1.2 ä¹‹å‰, Java ä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼šå¦‚æœ reference ç±»å‹çš„æ•°æ®å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€, å°±ç§°è¿™å—å†…å­˜ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ã€‚</p><p>JDK1.2 ä»¥å, Java å¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……, å°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§(å¼•ç”¨å¼ºåº¦é€æ¸å‡å¼±)ã€‚</p><figure><img src="/assets/Javaå››ç§å¼•ç”¨çš„ç»“æ„20210622164831-97e69702.png" alt="Javaå››ç§å¼•ç”¨çš„ç»“æ„" tabindex="0" loading="lazy"><figcaption>Javaå››ç§å¼•ç”¨çš„ç»“æ„</figcaption></figure><p><strong>1ã€å¼ºå¼•ç”¨</strong></p><p>å¼ºå¼•ç”¨æ˜¯æœ€ä¼ ç»Ÿçš„&quot;å¼•ç”¨&quot;çš„å®šä¹‰, æ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¹‹ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼, å³ç±»ä¼¼<code>Objectobj=new Object()</code>è¿™ç§å¼•ç”¨å…³ç³»ã€‚</p><p><strong>åªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨, åƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶æ‰è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚</strong></p><p><strong>2ã€è½¯å¼•ç”¨</strong>(<code>SoftReference</code>)</p><p>æè¿°æœ‰äº›<strong>è¿˜æœ‰ç”¨ä½†å¹¶éå¿…éœ€çš„å¯¹è±¡</strong>ã€‚</p><p><strong>åœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰, å°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´è¿›è¡ŒäºŒæ¬¡å›æ”¶</strong>ã€‚å¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜, æ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><p><strong>3ã€å¼±å¼•ç”¨</strong>(<code>WeakReference</code>)</p><p>æè¿°éå¿…éœ€å¯¹è±¡ã€‚<strong>è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹å‰</strong>, åƒåœ¾æ”¶é›†å™¨å·¥ä½œä¹‹å, æ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿ, éƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</p><p><strong>4ã€è™šå¼•ç”¨</strong>(<code>PhantomReference</code>)</p><p>è¿™ä¸ªå¼•ç”¨å­˜åœ¨çš„<strong>å”¯ä¸€ç›®çš„å°±æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</strong>, <strong>è¢«è™šå¼•ç”¨å…³è”çš„å¯¹è±¡, å’Œå…¶ç”Ÿå­˜æ—¶é—´å®Œå…¨æ²¡å…³ç³»</strong>ã€‚</p><p>å…³äºåº”ç”¨çš„ä½¿ç”¨æ¡ˆä¾‹å‚è€ƒï¼š<a href="https://blog.csdn.net/TJtulong/article/details/104879688" target="_blank" rel="noopener noreferrer">Javaçš„å››ç§å¼•ç”¨è¯¦è§£ä¸ä½¿ç”¨æ¡ˆä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æåˆ°Javaå¼•ç”¨åŠåƒåœ¾å›æ”¶æœºåˆ¶, å½“æˆ‘è”æƒ³åˆ°äº†ä»¥å‰çš„ä¸€ä¸ªè¯´æ³•, <strong>åœ¨é“¾è¡¨åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™, å°†è¿™ä¸ªèŠ‚ç‚¹ç½®ä¸ºnull, ä»¥æ–¹ä¾¿ä¸‹æ¬¡åƒåœ¾å›æ”¶æœºåˆ¶åˆ é™¤</strong>, è¿™ä¸ªæ“ä½œæ˜¯å¦æœ‰æ„ä¹‰ï¼Ÿ</p><p>é€šå¸¸æƒ…å†µä¸‹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰, é™¤éåœ¨ç‰¹å®šçš„ä¸€äº›æƒ…å†µä¸‹ï¼š</p><p>1 åŒä¸€ä¸ªæ–¹æ³•ä¸­ 2 å®šä¹‰äº†ä¸€ä¸ªå¤§å¯¹è±¡(å°å¯¹è±¡æ²¡æœ‰æ„ä¹‰) 3 ä¹‹åè·Ÿç€ä¸€ä¸ªéå¸¸è€—æ—¶çš„æ“ä½œ. 4 æ²¡æœ‰æ»¡è¶³JITç¼–è¯‘æ¡ä»¶</p><p>ä¸Šé¢4ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯,æŠŠobjæ˜¾å¼è®¾ç½®æˆnullæ‰æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.itranslater.com/qa/details/2126692746223158272" target="_blank" rel="noopener noreferrer">åœ¨Javaä¸­å°†å¯¹è±¡åˆ†é…ä¸ºnullä¼šå½±å“åƒåœ¾å›æ”¶å—ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/qq_42945742/article/details/84107531" target="_blank" rel="noopener noreferrer">javaä¸­å°†å¯¹è±¡èµ‹å€¼ä¸ºnull, å¯¹åƒåœ¾å›æ”¶æœ‰ç”¨å—ï¼Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="æ–¹æ³•åŒºçš„å›æ”¶" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•åŒºçš„å›æ”¶" aria-hidden="true">#</a> æ–¹æ³•åŒºçš„å›æ”¶</h2><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚</p><p>æ–¹æ³•åŒºåƒåœ¾æ”¶é›†çš„&quot;æ€§ä»·æ¯”&quot;é€šå¸¸ä¹Ÿæ˜¯æ¯”è¾ƒä½çš„ï¼šåœ¨Javaå †ä¸­, å°¤å…¶æ˜¯åœ¨æ–°ç”Ÿä»£ä¸­, å¯¹å¸¸è§„åº”ç”¨è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†é€šå¸¸å¯ä»¥å›æ”¶70%è‡³99%çš„å†…å­˜ç©ºé—´, ç›¸æ¯”ä¹‹ä¸‹, æ–¹æ³•åŒºå›æ”¶å›¿äºè‹›åˆ»çš„åˆ¤å®šæ¡ä»¶, å…¶åŒºåŸŸåƒåœ¾æ”¶é›†çš„å›æ”¶æˆæœå¾€å¾€è¿œä½äºæ­¤ã€‚</p><p><strong>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šåºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹</strong>ã€‚</p><blockquote><p>ä¸¾ä¸ªå¸¸é‡æ± ä¸­å­—é¢é‡å›æ”¶çš„ä¾‹å­, å‡å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²&quot;java&quot;æ›¾ç»è¿›å…¥å¸¸é‡æ± ä¸­, ä½†æ˜¯å½“å‰ç³»ç»Ÿåˆæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å€¼æ˜¯&quot;java&quot;, æ¢å¥è¯è¯´, å·²ç»æ²¡æœ‰ä»»ä½•å­—ç¬¦ä¸²å¯¹è±¡å¼•ç”¨å¸¸é‡æ± ä¸­çš„&quot;java&quot;å¸¸é‡, ä¸”è™šæ‹Ÿæœºä¸­ä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ªå­—é¢é‡ã€‚å¦‚æœåœ¨è¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶, è€Œä¸” åƒåœ¾æ”¶é›†å™¨åˆ¤æ–­ç¡®æœ‰å¿…è¦çš„è¯, è¿™ä¸ª&quot;java&quot;å¸¸é‡å°±å°†ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å…¶ä»–ç±»(æ¥å£)ã€æ–¹æ³•ã€å­—æ®µçš„ç¬¦å·å¼•ç”¨ä¹Ÿä¸æ­¤ä¼¼ã€‚</p></blockquote><p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦&quot;åºŸå¼ƒ&quot;è¿˜æ˜¯ç›¸å¯¹ç®€å•, è€Œè¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äº&quot;ä¸å†è¢«ä½¿ç”¨çš„ç±»&quot;çš„æ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶, ä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶, è¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯, å¦‚OSGiã€JSPçš„é‡åŠ è½½ç­‰, å¦åˆ™é€šå¸¸æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚</li><li>Â·è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨, æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><p><strong>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰å­—èŠ‚ç æ¡†æ¶, åŠ¨æ€ç”ŸæˆJSPä»¥åŠOSGiè¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åœºæ™¯ä¸­, é€šå¸¸éƒ½éœ€è¦Javaè™šæ‹Ÿæœºå…·å¤‡ç±»å‹å¸è½½çš„èƒ½åŠ›, ä»¥ä¿è¯ä¸ä¼šå¯¹æ–¹æ³•åŒºé€ æˆè¿‡å¤§çš„å†…å­˜å‹åŠ›</strong>ã€‚</p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶ç®—æ³•" aria-hidden="true">#</a> åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="åˆ†ä»£æ”¶é›†ç†è®º" tabindex="-1"><a class="header-anchor" href="#åˆ†ä»£æ”¶é›†ç†è®º" aria-hidden="true">#</a> åˆ†ä»£æ”¶é›†ç†è®º</h3><p>å»ºç«‹åœ¨ä¸¤ä¸ªåˆ†ä»£å‡è¯´ä¹‹ä¸Šï¼š</p><p>1)<strong>å¼±åˆ†ä»£å‡è¯´(Weak Generational Hypothesis)ï¼šç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•ç­çš„</strong>ã€‚</p><p>2)<strong>å¼ºåˆ†ä»£å‡è¯´(Strong Generational Hypothesis)ï¼šç†¬è¿‡è¶Šå¤šæ¬¡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„å¯¹è±¡å°±è¶Šéš¾ä»¥æ¶ˆäº¡</strong>ã€‚</p><p>æ”¶é›†å™¨åº”è¯¥å°†Javaå †åˆ’åˆ†å‡ºä¸åŒçš„åŒºåŸŸ, ç„¶åå°†å›æ”¶å¯¹è±¡ä¾æ®å…¶å¹´é¾„(å¹´é¾„å³å¯¹è±¡ç†¬è¿‡åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„æ¬¡æ•°)åˆ†é…åˆ°ä¸åŒçš„åŒºåŸŸä¹‹ä¸­å­˜å‚¨ã€‚</p><p>å› ä¸ºå¯¹è±¡ä¹‹é—´ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨, è¿›è¡Œä¸€æ¬¡Minor GC, ä½†æ–°ç”Ÿä»£å¯¹è±¡å¯èƒ½è¢«è€å¹´ä»£å¼•ç”¨, ä¸å¾—ä¸åœ¨GC Rootsä¹‹å¤–å†éå†è€å¹´ä»£ç¡®ä¿å¯è¾¾æ€§åˆ†æçš„æ­£ç¡®æ€§, åä¹‹ä¸€æ ·ã€‚å¯èƒ½ä¼šç»™å†…å­˜å›æ”¶å¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½è´Ÿæ‹…ã€‚</p><p><strong>è·¨ä»£å¼•ç”¨å‡è¯´(Intergenerational Reference Hypothesis)ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´ä»…å æå°‘æ•°</strong>ã€‚éšå«æ¨è®ºï¼šå­˜åœ¨äº’ç›¸å¼•ç”¨å…³ç³»çš„ä¸¤ä¸ªå¯¹è±¡, æ˜¯åº”è¯¥å€¾å‘äºåŒæ—¶ç”Ÿå­˜æˆ–è€…åŒæ—¶æ¶ˆäº¡çš„ã€‚</p><p>éœ€åœ¨æ–°ç”Ÿä»£ä¸Šå»ºç«‹ä¸€ä¸ªå…¨å±€çš„æ•°æ®ç»“æ„, æŠŠè€å¹´ä»£åˆ’åˆ†æˆè‹¥å¹²å°å—, æ ‡è¯†å‡ºè€å¹´ä»£çš„å“ªä¸€å—å†…å­˜ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨, å¯ä»¥ç¼©å°æ‰«æèŒƒå›´ã€‚</p><h3 id="åƒåœ¾å›æ”¶ç±»å‹" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾å›æ”¶ç±»å‹" aria-hidden="true">#</a> åƒåœ¾å›æ”¶ç±»å‹</h3><ul><li>éƒ¨åˆ†æ”¶é›†(Partial GC)ï¼šæŒ‡ç›®æ ‡ä¸æ˜¯å®Œæ•´æ”¶é›†æ•´ä¸ªJavaå †çš„åƒåœ¾æ”¶é›†, å…¶ä¸­åˆåˆ†ä¸ºï¼š <ul><li>æ–°ç”Ÿä»£æ”¶é›†(Minor GC/Young GC)ï¼šæŒ‡ç›®æ ‡åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ã€‚</li><li>è€å¹´ä»£æ”¶é›†(Major GC/Old GC)ï¼šæŒ‡ç›®æ ‡åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰CMSæ”¶é›†å™¨ä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚å¦å¤–è¯·æ³¨æ„&quot;Major GC&quot;è¿™ä¸ªè¯´æ³•ç°åœ¨æœ‰ç‚¹æ··æ·†, åœ¨ä¸åŒèµ„æ–™ä¸Šå¸¸æœ‰ä¸åŒæ‰€æŒ‡, è¯»è€…éœ€æŒ‰ä¸Šä¸‹æ–‡åŒºåˆ†åˆ°åº•æ˜¯æŒ‡è€å¹´ä»£çš„æ”¶é›†è¿˜æ˜¯æ•´å †æ”¶é›†ã€‚</li><li>æ··åˆæ”¶é›†(Mixed GC)ï¼šæŒ‡ç›®æ ‡æ˜¯æ”¶é›†æ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ã€‚ç›®å‰åªæœ‰G1æ”¶é›†å™¨ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li></ul></li><li>æ•´å †æ”¶é›†(Full GC)ï¼šæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li></ul><h3 id="æ ‡è®°-æ¸…é™¤ç®—æ³•-mark-sweep" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-æ¸…é™¤ç®—æ³•-mark-sweep" aria-hidden="true">#</a> æ ‡è®°-æ¸…é™¤ç®—æ³•(Mark-Sweep)</h3><p><strong>æ ‡è®°éœ€å›æ”¶/å­˜æ´»å¯¹è±¡, ç»Ÿä¸€æ¸…é™¤æ ‡è®°çš„å¯¹è±¡</strong>ã€‚</p><p><strong>åœ¨CMSå›æ”¶å™¨ä¸­ç”¨äºè€å¹´ä»£</strong>ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>æ‰§è¡Œæ•ˆç‡ä¸ç¨³å®š</strong>ã€‚å¯¹è±¡è¶Šå¤š, æ•ˆç‡è¶Šä½ã€‚</li><li><strong>å†…å­˜ç©ºé—´çš„ç¢ç‰‡åŒ–é—®é¢˜</strong>ã€‚</li></ul><h3 id="æ ‡è®°-å¤åˆ¶ç®—æ³•-mark-copying" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-å¤åˆ¶ç®—æ³•-mark-copying" aria-hidden="true">#</a> æ ‡è®°-å¤åˆ¶ç®—æ³•(Mark-Copying)</h3><p><strong>&quot;åŠåŒºå¤åˆ¶&quot;, æ¯æ¬¡åªç”¨ä¸€å—å†…å­˜, å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—, å·²ç»ä½¿ç”¨çš„é‚£ä¸€å—ç›´æ¥æ¸…é™¤</strong>ã€‚</p><p>ä¸€èˆ¬ç”¨äº<strong>æ–°ç”Ÿä»£</strong></p><p>ä¼˜ç‚¹ï¼šæ— å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ã€‚</p><p>ç¼ºç‚¹ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜æ—¶, å¤§é‡å¤åˆ¶, æ•ˆç‡ä½ã€‚</p><h4 id="æ–°ç”Ÿä»£edenå’Œsurvivoræ¯”ä¾‹é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#æ–°ç”Ÿä»£edenå’Œsurvivoræ¯”ä¾‹é—®é¢˜" aria-hidden="true">#</a> æ–°ç”Ÿä»£Edenå’ŒSurvivoræ¯”ä¾‹é—®é¢˜</h4><blockquote><p>ç°åœ¨çš„å•†ç”¨Javaè™šæ‹Ÿæœºå¤§å¤šéƒ½ä¼˜å…ˆé‡‡ç”¨äº†è¿™ç§æ”¶é›†ç®—æ³•å»å›æ”¶æ–°ç”Ÿä»£, IBMå…¬å¸æ›¾æœ‰ä¸€é¡¹ä¸“é—¨ç ”ç©¶å¯¹æ–°ç”Ÿä»£&quot;æœç”Ÿå¤•ç­&quot;çš„ç‰¹ç‚¹åšäº†æ›´é‡åŒ–çš„è¯ é‡Šâ€”â€”<strong>æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡æœ‰98%ç†¬ä¸è¿‡ç¬¬ä¸€è½®æ”¶é›†</strong>ã€‚å› æ­¤å¹¶ä¸éœ€è¦æŒ‰ç…§1âˆ¶1çš„æ¯”ä¾‹æ¥åˆ’åˆ†æ–°ç”Ÿä»£çš„å†…å­˜ç©ºé—´ã€‚</p><p><strong>&quot;Appelå¼å›æ”¶&quot;</strong>ï¼šAppelå¼å›æ”¶çš„å…·ä½“åšæ³•æ˜¯æŠŠæ–°ç”Ÿä»£åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´, æ¯æ¬¡åˆ†é…å†…å­˜åªä½¿ç”¨Edenå’Œå…¶ä¸­ä¸€å—Survivorã€‚<strong>å‘ç”Ÿåƒåœ¾æœé›†æ—¶, å°†Edenå’ŒSurvivorä¸­ä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦å¤–ä¸€å—Survivorç©ºé—´ä¸Š, ç„¶åç›´æ¥æ¸…ç†æ‰Edenå’Œå·²ç”¨è¿‡çš„é‚£å—Survivorç©ºé—´</strong>ã€‚</p></blockquote><p>EdenåŒºæ˜¯ä¸€å—, SurvivoråŒºæ˜¯ä¸¤å—ã€‚EdenåŒºå’ŒSurvivoråŒºçš„æ¯”ä¾‹æ˜¯8ï¼š1ï¼š1ã€‚</p><p>98%çš„å¯¹è±¡å¯è¢«å›æ”¶ä»…ä»…æ˜¯&quot;æ™®é€šåœºæ™¯&quot;ä¸‹æµ‹å¾—çš„æ•°æ®, ä»»ä½•äººéƒ½æ²¡æœ‰åŠæ³•ç™¾åˆ†ç™¾ä¿è¯æ¯æ¬¡å›æ”¶éƒ½åªæœ‰ä¸å¤šäº10%çš„å¯¹è±¡å­˜æ´», å› æ­¤Appelå¼å›æ”¶è¿˜æœ‰ä¸€ä¸ªå……å½“ç½•è§æƒ…å†µçš„&quot;é€ƒç”Ÿé—¨&quot;çš„å®‰å…¨è®¾è®¡ã€‚å½“Survivorç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸€æ¬¡Minor GCä¹‹åå­˜æ´»çš„å¯¹è±¡æ—¶, å°±éœ€è¦ä¾èµ–å…¶ä»–å†…å­˜åŒºåŸŸ(å®é™…ä¸Šå¤§å¤šå°±æ˜¯è€å¹´ä»£)è¿›è¡Œ<strong>åˆ†é…æ‹…ä¿(Handle Promotion)</strong>ã€‚</p><p><strong>å¦‚æœå¦å¤–ä¸€å—Survivorç©ºé—´æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡, è¿™äº›å¯¹è±¡ä¾¿å°†é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/lojze_ly/article/details/49456255" target="_blank" rel="noopener noreferrer">æ–°ç”Ÿä»£Edenä¸ä¸¤ä¸ªSurvivoråŒºçš„è§£é‡Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="æ ‡è®°-æ•´ç†ç®—æ³•-mark-compact" tabindex="-1"><a class="header-anchor" href="#æ ‡è®°-æ•´ç†ç®—æ³•-mark-compact" aria-hidden="true">#</a> æ ‡è®°-æ•´ç†ç®—æ³•(Mark-Compact)</h3><p>æ ‡è®°å­˜æ´»å¯¹è±¡, è®©æ‰€æœ‰å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯, ç„¶åæ¸…ç†æ‰€æœ‰çš„è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p><p>ä¸€èˆ¬ç”¨äº<strong>è€å¹´ä»£</strong>ã€‚</p><p><strong>æ˜¯å¦ç§»åŠ¨å¯¹è±¡éƒ½æœ‰å¼Šç«¯, ç§»åŠ¨å†…å­˜å›æ”¶æ¯”è¾ƒå¤æ‚, ä¸ç§»åŠ¨å†…å­˜åˆ†é…æ¯”è¾ƒå¤æ‚(ç©ºé—´ç¢ç‰‡åŒ–)</strong>ã€‚</p><p>ä¸€ç§æ–¹æ¡ˆï¼š<strong>è™šæ‹Ÿæœºå¹³æ—¶é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•, æš‚æ—¶å®¹å¿ç¢ç‰‡å­˜åœ¨, ç›´åˆ°ç¢ç‰‡å½±å“å¤§åˆ°å†…å­˜åˆ†é…æ—¶, åœ¨è¿›è¡Œæ ‡è®°-æ•´ç†ç®—æ³•, å¯è·å¾—è§„æ•´çš„å†…å­˜ç©ºé—´</strong>ã€‚</p><p>å…³äº<strong>æ ‡è®°-æ•´ç†ç®—æ³•çš„å¯å›æ”¶å¯¹è±¡ä¸å­˜æ´»å¯¹è±¡å¦‚ä½•ç§»åŠ¨ï¼Ÿ</strong>, å¯å‚è€ƒï¼š<a href="https://blog.csdn.net/luliuliu1234/article/details/104058259" target="_blank" rel="noopener noreferrer">åƒåœ¾å›æ”¶ç®—æ³•â€”â€”æ ‡è®°â€”æ•´ç†å›æ”¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (äº†è§£)</p><h2 id="hotspotå®ç°åƒåœ¾å›æ”¶çš„ç®—æ³•ç»†èŠ‚-äº†è§£" tabindex="-1"><a class="header-anchor" href="#hotspotå®ç°åƒåœ¾å›æ”¶çš„ç®—æ³•ç»†èŠ‚-äº†è§£" aria-hidden="true">#</a> HotSpotå®ç°åƒåœ¾å›æ”¶çš„ç®—æ³•ç»†èŠ‚(äº†è§£)</h2><blockquote><p>äº†è§£è¿™éƒ¨åˆ†å†…å®¹æ˜¯å¾ˆå¥½ç†è§£åƒåœ¾å›æ”¶å™¨å·¥ä½œåŸç†çš„å‰æ, ä½†æ˜¯è¿™éƒ¨åˆ†å†…å®¹å¾€å¾€æ¯”è¾ƒéš¾ä»¥ç†è§£, éœ€è¦ç»“åˆåƒåœ¾æ”¶é›†å™¨åå¤æ¨æ•²ã€‚</p><p>è¿™éƒ¨åˆ†ä¸»è¦è®²è§£åƒåœ¾æ”¶é›†ä¸­é‡åˆ°çš„å“ªäº›é—®é¢˜, ä»¥åŠå¦‚ä½•è§£å†³çš„ï¼Ÿ</p><p><em>ç®€å•æ€»ç»“, è¯¦ç»†å†…å®¹å‚çœ‹ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº(ç¬¬ä¸‰ç‰ˆ)ã€‹</em></p></blockquote><h3 id="æ ¹èŠ‚ç‚¹æšä¸¾" tabindex="-1"><a class="header-anchor" href="#æ ¹èŠ‚ç‚¹æšä¸¾" aria-hidden="true">#</a> æ ¹èŠ‚ç‚¹æšä¸¾</h3><p>å›ºå®šå¯ä½œä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨(ä¾‹å¦‚å¸¸é‡æˆ–ç±»é™æ€å±æ€§)ä¸æ‰§è¡Œä¸Šä¸‹æ–‡(ä¾‹å¦‚æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­, å°½ç®¡ç›®æ ‡æ˜ç¡®, ä½†æŸ¥æ‰¾è¿‡ç¨‹è¦åšåˆ°é«˜æ•ˆå¹¶éä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…, ç°åœ¨Javaåº”ç”¨è¶Šåšè¶Šåºå¤§, å…‰æ˜¯æ–¹æ³•åŒºçš„å¤§å°å°±å¸¸æœ‰æ•°ç™¾ä¸Šåƒå…†, é‡Œé¢çš„ç±»ã€å¸¸é‡ç­‰æ›´æ˜¯æ’æ²³æ²™æ•°, è‹¥è¦é€ä¸ªæ£€æŸ¥ä»¥è¿™é‡Œä¸ºèµ·æºçš„å¼•ç”¨è‚¯å®šå¾—æ¶ˆè€—ä¸å°‘æ—¶é—´ã€‚</p><p>è¿„ä»Šä¸ºæ­¢, <strong>æ‰€æœ‰æ”¶é›†å™¨åœ¨æ ¹èŠ‚ç‚¹æšä¸¾è¿™ä¸€æ­¥éª¤æ—¶éƒ½æ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹çš„</strong>, å› æ­¤æ¯«æ— ç–‘é—®æ ¹èŠ‚ç‚¹æšä¸¾ä¸ä¹‹å‰æåŠçš„æ•´ç†å†…å­˜ç¢ç‰‡ä¸€æ ·ä¼šé¢ä¸´ç›¸ä¼¼çš„&quot;Stop The World&quot;çš„å›°æ‰°ã€‚</p><p><strong>åƒåœ¾æ”¶é›†è¿‡ç¨‹å¿…é¡»åœé¡¿æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› </strong>ï¼š</p><p>ç°åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•è€—æ—¶æœ€é•¿çš„æŸ¥æ‰¾å¼•ç”¨é“¾çš„è¿‡ç¨‹å·²ç»å¯ä»¥åšåˆ°ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘, ä½†æ ¹èŠ‚ç‚¹æšä¸¾å§‹ç»ˆè¿˜æ˜¯å¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­æ‰å¾—ä»¥è¿›è¡Œâ€”â€”è¿™é‡Œ**&quot;ä¸€è‡´æ€§&quot;çš„æ„æ€æ˜¯æ•´ä¸ªæšä¸¾æœŸé—´æ‰§è¡Œå­ç³»ç»Ÿçœ‹èµ·æ¥å°±åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š, ä¸ä¼šå‡ºç°åˆ†æè¿‡ç¨‹ä¸­, æ ¹èŠ‚ç‚¹é›†åˆçš„å¯¹è±¡å¼•ç”¨å…³ç³»è¿˜åœ¨ä¸æ–­å˜åŒ–çš„æƒ…å†µ**, è‹¥è¿™ç‚¹ä¸èƒ½æ»¡è¶³çš„è¯, åˆ†æç»“æœå‡†ç¡®æ€§ä¹Ÿå°±æ— æ³•ä¿è¯ã€‚</p><p>ç”±äºç›®å‰ä¸»æµJavaè™šæ‹Ÿæœºä½¿ç”¨çš„éƒ½æ˜¯<strong>å‡†ç¡®å¼åƒåœ¾æ”¶é›†</strong>, æ‰€ä»¥<strong>å½“ç”¨æˆ·çº¿ç¨‹åœé¡¿ä¸‹æ¥ä¹‹å, å…¶å®å¹¶ä¸éœ€è¦ä¸€ä¸ªä¸æ¼åœ°æ£€æŸ¥å®Œæ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€çš„å¼•ç”¨ä½ç½®, è™šæ‹Ÿæœºåº”å½“æ˜¯æœ‰åŠæ³•ç›´æ¥å¾—åˆ°å“ªäº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨çš„</strong>ã€‚</p><blockquote><p>åœ¨HotSpotçš„è§£å†³æ–¹æ¡ˆé‡Œ, ä½¿ç”¨OopMapçš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ä¸€æ—¦ç±»åŠ è½½åŠ¨ä½œå®Œæˆçš„æ—¶å€™, HotSpotå°±ä¼šæŠŠå¯¹è±¡å†…ä»€ä¹ˆåç§»é‡ä¸Šæ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®è®¡ç®—å‡ºæ¥, åœ¨å³æ—¶ç¼–è¯‘è¿‡ç¨‹ä¸­, ä¹Ÿä¼šåœ¨ç‰¹å®šçš„ä½ç½®è®°å½•ä¸‹æ ˆé‡Œå’Œå¯„å­˜å™¨é‡Œå“ªäº›ä½ç½®æ˜¯å¼•ç”¨ã€‚è¿™æ ·æ”¶é›†å™¨åœ¨æ‰«ææ—¶å°±å¯ä»¥ç›´æ¥å¾—çŸ¥è¿™äº›ä¿¡æ¯äº†, å¹¶ä¸éœ€è¦çœŸæ­£ä¸€ä¸ªä¸æ¼åœ°ä»æ–¹æ³•åŒºç­‰GC Rootså¼€å§‹æŸ¥æ‰¾ã€‚</p></blockquote><p>æ€»ç»“ï¼š</p><ol><li><strong>æ‰€æœ‰æ”¶é›†å™¨åœ¨æ ¹èŠ‚ç‚¹æšä¸¾è¿™ä¸€æ­¥éª¤æ—¶éƒ½æ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹çš„</strong></li><li><strong>åœ¨HotSpotä¸­, ä½¿ç”¨OopMapçš„æ•°æ®ç»“æ„å¯ä»¥, å½“ç”¨æˆ·çº¿ç¨‹åœé¡¿ä¸‹æ¥ä¹‹å, ä½¿è™šæ‹Ÿæœºç›´æ¥å¾—åˆ°å“ªäº›åœ°æ–¹å­˜æ”¾ç€å¯¹è±¡å¼•ç”¨, è€Œä¸éœ€è¦ä¸€ä¸ªä¸æ¼åœ°æ£€æŸ¥å®Œæ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€çš„å¼•ç”¨ä½ç½®ã€‚</strong></li><li>OopMapçš„ç›®çš„ï¼š<strong>ä½¿HotSpotå¯ä»¥å¿«é€Ÿå‡†ç¡®åœ°å®ŒæˆGC Rootsæšä¸¾</strong></li></ol><h3 id="å®‰å…¨ç‚¹" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨ç‚¹" aria-hidden="true">#</a> å®‰å…¨ç‚¹</h3><p>åœ¨OopMapçš„ååŠ©ä¸‹, HotSpotå¯ä»¥å¿«é€Ÿå‡†ç¡®åœ°å®ŒæˆGC Rootsæšä¸¾, <strong>ä½†æ˜¯å¯èƒ½å¯¼è‡´å¼•ç”¨å…³ç³»å˜åŒ–, æˆ–è€…è¯´å¯¼è‡´OopMapå†…å®¹å˜åŒ–çš„æŒ‡ä»¤éå¸¸å¤š, å¦‚æœä¸ºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½ç”Ÿæˆå¯¹åº”çš„OopMap, é‚£å°†ä¼šéœ€è¦å¤§é‡çš„é¢å¤–å­˜å‚¨ç©ºé—´, æˆæœ¬é«˜æ˜‚</strong>ã€‚</p><p>åœ¨&quot;ç‰¹å®šçš„ä½ç½®&quot;è®°å½•äº†è¿™äº›ä¿¡æ¯, è¿™äº›ä½ç½®è¢«ç§°ä¸ºå®‰å…¨ç‚¹(Safepoint), æœ‰äº†å®‰å…¨ç‚¹çš„è®¾å®š, ä¹Ÿå°±å†³å®šäº†ç”¨æˆ·ç¨‹åºæ‰§è¡Œæ—¶å¹¶éåœ¨ä»£ç æŒ‡ä»¤æµçš„ä»»æ„ä½ç½®éƒ½èƒ½å¤Ÿåœé¡¿ä¸‹æ¥å¼€å§‹åƒåœ¾æ”¶é›†, è€Œæ˜¯<strong>å¼ºåˆ¶è¦æ±‚å¿…é¡»æ‰§è¡Œåˆ°è¾¾å®‰å…¨ç‚¹åæ‰èƒ½å¤Ÿæš‚åœ</strong>ã€‚</p><p><strong>å®‰å…¨ç‚¹çš„é€‰å®šæ—¢ä¸èƒ½å¤ªå°‘ä»¥è‡³äºè®©æ”¶é›†å™¨ç­‰å¾…æ—¶é—´è¿‡é•¿, ä¹Ÿä¸èƒ½å¤ªè¿‡é¢‘ç¹ä»¥è‡³äºè¿‡åˆ†å¢å¤§è¿è¡Œæ—¶çš„å†…å­˜è´Ÿè·</strong>ã€‚å®‰å…¨ç‚¹ä½ç½®çš„é€‰å–åŸºæœ¬ä¸Šæ˜¯ä»¥&quot;<strong>æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾</strong>&quot;ä¸ºæ ‡å‡†è¿›è¡Œé€‰å®šçš„, å› ä¸ºæ¯æ¡æŒ‡ä»¤æ‰§è¡Œçš„æ—¶é—´éƒ½éå¸¸çŸ­æš‚, ç¨‹åºä¸å¤ªå¯èƒ½å› ä¸ºæŒ‡ä»¤æµé•¿åº¦å¤ªé•¿è¿™æ ·çš„åŸå› è€Œé•¿æ—¶é—´æ‰§è¡Œ, &quot;é•¿æ—¶é—´æ‰§è¡Œ&quot;çš„æœ€æ˜æ˜¾ç‰¹å¾å°±æ˜¯<strong>æŒ‡ä»¤åºåˆ—çš„å¤ç”¨</strong>, ä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰åŠŸèƒ½çš„æŒ‡ä»¤æ‰ä¼šäº§ç”Ÿå®‰å…¨ç‚¹ã€‚</p><p>å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•åœ¨åƒåœ¾æ”¶é›†å‘ç”Ÿæ—¶è®©æ‰€æœ‰çº¿ç¨‹(è¿™é‡Œå…¶å®ä¸åŒ…æ‹¬æ‰§è¡ŒJNIè°ƒç”¨çš„çº¿ç¨‹)éƒ½è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹, ç„¶ååœé¡¿ä¸‹æ¥ï¼Ÿ</strong></p><p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼šæŠ¢å…ˆå¼ä¸­æ–­(Preemptive Suspension)å’Œ<strong>ä¸»åŠ¨å¼ä¸­æ–­</strong>(Voluntary Suspension, ä¸€èˆ¬é‡‡ç”¨çš„æ–¹æ¡ˆ)ã€‚</p><blockquote><p><strong>ä¸»åŠ¨å¼ä¸­æ–­</strong>çš„æ€æƒ³æ˜¯å½“åƒåœ¾æ”¶é›†éœ€è¦ä¸­æ–­çº¿ç¨‹çš„æ—¶å€™, ä¸ç›´æ¥å¯¹çº¿ç¨‹æ“ä½œ, ä»…ä»…ç®€å•åœ°è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½, å„ä¸ªçº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹æ—¶ä¼šä¸åœåœ°ä¸»åŠ¨å»è½®è¯¢è¿™ä¸ªæ ‡å¿—, ä¸€æ—¦å‘ç°ä¸­æ–­æ ‡å¿—ä¸ºçœŸæ—¶å°±è‡ªå·±åœ¨æœ€è¿‘çš„å®‰å…¨ç‚¹ä¸Šä¸»åŠ¨ä¸­æ–­æŒ‚èµ·ã€‚è½®è¯¢æ ‡å¿—çš„åœ°æ–¹å’Œå®‰å…¨ç‚¹æ˜¯é‡åˆçš„, å¦å¤–è¿˜è¦åŠ ä¸Šæ‰€æœ‰åˆ›å»ºå¯¹è±¡å’Œå…¶ä»–éœ€è¦åœ¨Javaå †ä¸Šåˆ†é…å†…å­˜çš„åœ°æ–¹, è¿™æ˜¯ä¸ºäº†æ£€æŸ¥æ˜¯å¦å³å°†è¦å‘ç”Ÿåƒåœ¾æ”¶é›†, é¿å…æ²¡æœ‰è¶³å¤Ÿå†…å­˜åˆ†é…æ–°å¯¹è±¡ã€‚</p></blockquote><p>æ€»ç»“ï¼š</p><ol><li>å®‰å…¨ç‚¹çš„ç›®çš„ï¼š<strong>åœ¨&quot;ç‰¹å®šçš„ä½ç½®&quot;è®°å½•OopMapéœ€è¦è®°å½•çš„ä¿¡æ¯, è§£å†³æ¯ä¸€ä¸ªæŒ‡ä»¤ç”Ÿæˆå¯¹åº”OopMapçš„é«˜æ˜‚å­˜å‚¨ç©ºé—´é—®é¢˜</strong>ã€‚å³<strong>è§£å†³å¦‚ä½•åœé¡¿ç”¨æˆ·çº¿ç¨‹, è®©è™šæ‹Ÿæœºè¿›å…¥åƒåœ¾å›æ”¶çŠ¶æ€çš„é—®é¢˜</strong>ã€‚</li><li>å¦‚ä½•é€‰å–å®‰å…¨ç‚¹ä½ç½®ï¼šä»¥&quot;<strong>æ˜¯å¦å…·æœ‰è®©ç¨‹åºé•¿æ—¶é—´æ‰§è¡Œçš„ç‰¹å¾</strong>&quot;ä¸ºæ ‡å‡†(å³æŒ‡ä»¤å¤ç”¨), ä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¾ªç¯è·³è½¬ã€å¼‚å¸¸è·³è½¬ç­‰åŠŸèƒ½çš„æŒ‡ä»¤æ‰ä¼šäº§ç”Ÿå®‰å…¨ç‚¹ã€‚</li><li>å¦‚ä½•ä½¿åƒåœ¾æ”¶é›†æ—¶çº¿ç¨‹è·‘åˆ°æœ€è¿‘çš„å®‰å…¨ç‚¹ï¼š<strong>ä¸»åŠ¨å¼ä¸­æ–­</strong>ã€‚</li></ol><h3 id="å®‰å…¨åŒºåŸŸ" tabindex="-1"><a class="header-anchor" href="#å®‰å…¨åŒºåŸŸ" aria-hidden="true">#</a> å®‰å…¨åŒºåŸŸ</h3><p>ä½¿ç”¨å®‰å…¨ç‚¹çš„è®¾è®¡ä¼¼ä¹å·²ç»å®Œç¾è§£å†³å¦‚ä½•åœé¡¿ç”¨æˆ·çº¿ç¨‹, è®©è™šæ‹Ÿæœºè¿›å…¥åƒåœ¾å›æ”¶çŠ¶æ€çš„é—®é¢˜äº†ã€‚å®‰å…¨ç‚¹æœºåˆ¶ä¿è¯äº†ç¨‹åºæ‰§è¡Œæ—¶, åœ¨ä¸å¤ªé•¿çš„æ—¶é—´å†…å°±ä¼šé‡åˆ°å¯è¿›å…¥åƒåœ¾æ”¶é›†è¿‡ç¨‹çš„å®‰å…¨ç‚¹ã€‚ä½†æ˜¯, <strong>ç¨‹åº&quot;ä¸æ‰§è¡Œ&quot;çš„æ—¶å€™å‘¢ï¼Ÿ<strong>æ‰€è°“çš„ç¨‹åºä¸æ‰§è¡Œå°±æ˜¯</strong>æ²¡æœ‰åˆ†é…å¤„ç†å™¨æ—¶é—´</strong>, å…¸å‹çš„åœºæ™¯ä¾¿æ˜¯<em><strong>ç”¨æˆ·çº¿ç¨‹å¤„äºSleepçŠ¶æ€æˆ–è€…BlockedçŠ¶æ€, è¿™æ—¶å€™çº¿ç¨‹æ— æ³•å“åº”è™šæ‹Ÿæœºçš„ä¸­æ–­è¯·æ±‚, ä¸èƒ½å†èµ°åˆ°å®‰å…¨çš„åœ°æ–¹å»ä¸­æ–­æŒ‚èµ·è‡ªå·±, è™šæ‹Ÿæœºä¹Ÿæ˜¾ç„¶ä¸å¯èƒ½æŒç»­ç­‰å¾…çº¿ç¨‹é‡æ–°è¢«æ¿€æ´»åˆ†é…å¤„ç†å™¨æ—¶é—´</strong></em>ã€‚å¯¹äºè¿™ç§æƒ…å†µ, å°±å¿…é¡»å¼•å…¥å®‰å…¨åŒºåŸŸ(Safe Region)æ¥è§£å†³ã€‚</p><p><strong>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡èƒ½å¤Ÿç¡®ä¿åœ¨æŸä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­, å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–</strong>, å› æ­¤, åœ¨è¿™ä¸ªåŒºåŸŸä¸­ä»»æ„åœ°æ–¹å¼€å§‹åƒåœ¾æ”¶é›†éƒ½æ˜¯å®‰å…¨çš„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®‰å…¨åŒºåŸŸçœ‹ä½œè¢«æ‰©å±•æ‹‰ä¼¸äº†çš„å®‰å…¨ç‚¹ã€‚</p><blockquote><p>æµç¨‹ï¼š</p><p>å½“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨åŒºåŸŸé‡Œé¢çš„ä»£ç æ—¶, é¦–å…ˆä¼šæ ‡è¯†è‡ªå·±å·²ç»è¿›å…¥äº†å®‰å…¨åŒºåŸŸ, é‚£æ ·å½“è¿™æ®µæ—¶é—´é‡Œè™šæ‹Ÿæœºè¦å‘èµ·åƒåœ¾æ”¶é›†æ—¶å°±ä¸å¿…å»ç®¡è¿™äº›å·²å£°æ˜è‡ªå·±åœ¨å®‰å…¨åŒºåŸŸå†…çš„çº¿ç¨‹äº†ã€‚</p><p>å½“çº¿ç¨‹è¦ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶, å®ƒè¦æ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦å·²ç»å®Œæˆäº†æ ¹èŠ‚ç‚¹æšä¸¾(æˆ–è€…åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­å…¶ä»–éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹çš„ é˜¶æ®µ), å¦‚æœå®Œæˆäº†, é‚£çº¿ç¨‹å°±å½“ä½œæ²¡äº‹å‘ç”Ÿè¿‡, ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™å®ƒå°±å¿…é¡»ä¸€ç›´ç­‰å¾…, ç›´åˆ°æ”¶åˆ°å¯ä»¥ç¦»å¼€å®‰å…¨åŒºåŸŸçš„ä¿¡å·ä¸ºæ­¢ã€‚</p></blockquote><p>æ€»ç»“ï¼š</p><ol><li>å¼•å…¥å®‰å…¨åŒºåŸŸçš„ç›®çš„ï¼š<strong>è§£å†³ç¨‹åºä¸æ‰§è¡Œæ—¶(æ²¡æœ‰åˆ†é…å¤„ç†å™¨æ—¶é—´), çº¿ç¨‹æ— æ³•å“åº”è™šæ‹Ÿæœºçš„ä¸­æ–­è¯·æ±‚æŒ‚èµ·è‡ªå·±çš„é—®é¢˜</strong>ã€‚</li><li><strong>å®‰å…¨åŒºåŸŸæ˜¯æŒ‡èƒ½å¤Ÿç¡®ä¿åœ¨æŸä¸€æ®µä»£ç ç‰‡æ®µä¹‹ä¸­, å¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–, ä¿è¯åœ¨è¿™ä¸ªåŒºåŸŸä¸­ä»»æ„åœ°æ–¹å¼€å§‹åƒåœ¾æ”¶é›†éƒ½æ˜¯å®‰å…¨çš„ã€‚</strong></li></ol><h3 id="è®°å¿†é›†ä¸å¡è¡¨" tabindex="-1"><a class="header-anchor" href="#è®°å¿†é›†ä¸å¡è¡¨" aria-hidden="true">#</a> è®°å¿†é›†ä¸å¡è¡¨</h3><p>åƒåœ¾æ”¶é›†å™¨<strong>åœ¨æ–°ç”Ÿä»£ä¸­å»ºç«‹äº†åä¸ºè®°å¿†é›†</strong>(Remembered Set)çš„æ•°æ®ç»“æ„, ç”¨ä»¥<strong>é¿å…æŠŠæ•´ä¸ªè€å¹´ä»£åŠ è¿›GC Rootsæ‰«æèŒƒå›´</strong>ã€‚</p><p>è®°å¿†é›†æ˜¯ä¸€ç§ç”¨äºè®°å½•ä»éæ”¶é›†åŒºåŸŸæŒ‡å‘æ”¶é›†åŒºåŸŸçš„æŒ‡é’ˆé›†åˆçš„æŠ½è±¡æ•°æ®ç»“æ„, å¡è¡¨æ˜¯å…¶å®ç°ã€‚</p><h3 id="å†™å±éšœ" tabindex="-1"><a class="header-anchor" href="#å†™å±éšœ" aria-hidden="true">#</a> å†™å±éšœ</h3><p>è®°å¿†é›†æ¥ç¼©å‡GC Rootsæ‰«æèŒƒå›´çš„é—®é¢˜, ä½†è¿˜æ²¡æœ‰<strong>è§£å†³å¡è¡¨å…ƒç´ å¦‚ä½•ç»´æŠ¤çš„é—®é¢˜, ä¾‹å¦‚å®ƒä»¬ä½•æ—¶å˜è„ã€è°æ¥æŠŠå®ƒä»¬å˜è„ç­‰</strong>, ä½¿ç”¨å†™å±éšœã€‚</p><h3 id="å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ" aria-hidden="true">#</a> å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ</h3><p>å¯è¾¾æ€§åˆ†æç®—æ³•ç†è®ºä¸Šè¦æ±‚å…¨è¿‡ç¨‹éƒ½åŸºäºä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­æ‰èƒ½å¤Ÿè¿›è¡Œåˆ†æ, è¿™æ„å‘³ç€å¿…é¡»å…¨ç¨‹å†»ç»“ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œã€‚</p><p>æ ¹èŠ‚ç‚¹æšä¸¾ åœ¨å„ç§ä¼˜åŒ–ä¸‹æ—¶é—´å›ºå®š, ä½†æ˜¯&quot;æ ‡è®°&quot;é˜¶æ®µ, ä¹Ÿå°±æ˜¯<strong>GC Rootså†ç»§ç»­å¾€ä¸‹éå†å¯¹è±¡å›¾æ—¶, åœé¡¿æ—¶é—´å°±å¿…å®šä¼šä¸Javaå †å®¹é‡ç›´æ¥æˆæ­£æ¯”ä¾‹å…³ç³»</strong>ã€‚å¦‚æœè¿™ä¸ªé˜¶æ®µä¼šéšç€å †å˜å¤§è€Œç­‰æ¯”ä¾‹å¢åŠ åœé¡¿æ—¶é—´, å…¶å½±å“å°±ä¼šæ³¢åŠå‡ ä¹æ‰€æœ‰çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>ä½¿ç”¨å¹¶å‘æ‰«æå¯ä»¥, å¤§å¤§æå‡&quot;æ ‡è®°&quot;é˜¶æ®µçš„é€Ÿåº¦, ä½†æ˜¯å¯èƒ½å­˜åœ¨<strong>å¯¹è±¡æ¶ˆå¤±é—®é¢˜</strong>ã€‚</p><p>è§£å†³ï¼šCMSæ˜¯åŸºäºå¢é‡æ›´æ–°æ¥åšå¹¶å‘æ ‡è®°çš„, G1ã€Shenandoahåˆ™æ˜¯ç”¨åŸå§‹å¿«ç…§æ¥å®ç°ã€‚</p><p>è¿™éƒ¨åˆ†è¯¦ç»†å‚çœ‹ï¼šã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº(ç¬¬ä¸‰ç‰ˆ)ã€‹</p><h2 id="young-gc-å’Œ-full-gc-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘" tabindex="-1"><a class="header-anchor" href="#young-gc-å’Œ-full-gc-åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘" aria-hidden="true">#</a> Young GC å’Œ Full GC åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è§¦å‘ï¼Ÿ</h2><ul><li>Minor GCï¼šæ–°ç”Ÿä»£çš„ GC</li><li>Major GCï¼šè€å¹´ä»£çš„ GC</li><li>Full GCï¼šæ•´å †æ”¶é›†, æ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†</li></ul><p>å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£EdenåŒºä¸­åˆ†é…, å¦‚æœEdenåŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶, å°±ä¼šè§¦å‘ä¸€æ¬¡young gc</p><p>Full gcçš„è§¦å‘æ¡ä»¶æœ‰å¤šä¸ª, FULL GCçš„æ—¶å€™ä¼šSTOP THE WORLDã€‚</p><ul><li><p>åœ¨æ‰§è¡ŒYoung gcä¹‹å‰, JVMä¼šè¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿â€”â€”å¦‚æœè€å¹´ä»£çš„è¿ç»­ç©ºé—´å°äºæ–°ç”Ÿä»£å¯¹è±¡çš„æ€»å¤§å°(æˆ–å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°), åˆ™è§¦å‘ä¸€æ¬¡full gcã€‚å¦‚æœå¤§äºå†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°, é‚£ä¹ˆä¼šè¿›è¡Œä¸€æ¬¡Minor GC, å°½ç®¡è¿™æ¬¡Minor GCæ˜¯æœ‰é£é™©çš„ã€‚</p></li><li><p>æ˜¾å¼è°ƒç”¨System.gc()æ–¹æ³•æ—¶, ç³»ç»Ÿå»ºè®®æ‰§è¡Œ, ä¸æ˜¯å¿…ç„¶æ‰§è¡Œï¼›</p></li><li><p>è€å¹´ä»£ç©ºé—´ä¸è¶³</p></li><li><p>æ–¹æ³•åŒº(å…ƒç©ºé—´)ç©ºé—´ä¸è¶³</p></li></ul><h2 id="ä¸‰è‰²æ ‡è®°æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸‰è‰²æ ‡è®°æ³•" aria-hidden="true">#</a> ä¸‰è‰²æ ‡è®°æ³•</h2><h3 id="ä¸‰è‰²æ ‡è®°åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸‰è‰²æ ‡è®°åŸç†" aria-hidden="true">#</a> ä¸‰è‰²æ ‡è®°åŸç†</h3><p>é¢œè‰²å«ä¹‰ï¼š</p><ul><li>ç™½è‰²ï¼šè¿˜æ²¡æœ‰æœç´¢è¿‡çš„å¯¹è±¡(æ ‡è®°ç»“æŸå, ç™½è‰²å¯¹è±¡ä¼šè¢«å½“æˆåƒåœ¾å¯¹è±¡)</li><li>ç°è‰²ï¼šæ­£åœ¨æœç´¢çš„å¯¹è±¡</li><li>é»‘è‰²ï¼šæœç´¢å®Œæˆçš„å¯¹è±¡(ä¸ä¼šå½“æˆåƒåœ¾å¯¹è±¡, ä¸ä¼šè¢«GC)</li></ul><p>å‡è®¾ç°åœ¨æœ‰ç™½ã€ç°ã€é»‘ä¸‰ä¸ªé›†åˆ(è¡¨ç¤ºå½“å‰å¯¹è±¡çš„é¢œè‰²), å…¶éå†è®¿é—®è¿‡ç¨‹ä¸ºï¼š</p><ol><li>åˆå§‹æ—¶, æ‰€æœ‰å¯¹è±¡éƒ½åœ¨ã€ç™½è‰²é›†åˆã€‘ä¸­ï¼›</li><li>å°† GC Roots ç›´æ¥å¼•ç”¨åˆ°çš„å¯¹è±¡æŒªåˆ° ã€ç°è‰²é›†åˆã€‘ä¸­ï¼›</li><li>ä»ç°è‰²é›†åˆä¸­è·å–å¯¹è±¡ï¼š 3.1. å°†æœ¬å¯¹è±¡å¼•ç”¨åˆ°çš„å…¶ä»–å¯¹è±¡å…¨éƒ¨æŒªåˆ° ã€ç°è‰²é›†åˆã€‘ä¸­ï¼› 3.2. å°†æœ¬å¯¹è±¡æŒªåˆ°ã€é»‘è‰²é›†åˆã€‘é‡Œé¢ã€‚</li><li>é‡å¤æ­¥éª¤3, ç›´è‡³ã€ç°è‰²é›†åˆã€‘ä¸ºç©ºæ—¶ç»“æŸã€‚</li><li>ç»“æŸå, ä»åœ¨ã€ç™½è‰²é›†åˆã€‘çš„å¯¹è±¡å³ä¸º GC Roots ä¸å¯è¾¾, å¯ä»¥è¿›è¡Œå›æ”¶ã€‚</li></ol><blockquote><p>æ³¨ï¼šå¦‚æœæ ‡è®°ç»“æŸåå¯¹è±¡ä»ä¸ºç™½è‰², æ„å‘³ç€å·²ç»&quot;æ‰¾ä¸åˆ°&quot;è¯¥å¯¹è±¡åœ¨å“ªäº†, ä¸å¯èƒ½ä¼šå†è¢«é‡æ–°å¼•ç”¨ã€‚</p></blockquote><figure><img src="/assets/202112292135030-733bd788.gif" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>å½“ Stop The World (ä»¥ä¸‹ç®€ç§° STW)æ—¶, å¯¹è±¡é—´çš„å¼•ç”¨æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„, å¯ä»¥è½»æ¾å®Œæˆæ ‡è®°ã€‚</p><p>è€Œå½“éœ€è¦æ”¯æŒå¹¶å‘æ ‡è®°æ—¶, å³æ ‡è®°æœŸé—´åº”ç”¨çº¿ç¨‹è¿˜åœ¨ç»§ç»­è·‘, å¯¹è±¡é—´çš„å¼•ç”¨å¯èƒ½å‘ç”Ÿå˜åŒ–, å¤šæ ‡å’Œæ¼æ ‡çš„æƒ…å†µå°±æœ‰å¯èƒ½å‘ç”Ÿã€‚</p><h3 id="å¤šæ ‡â€”â€”æµ®åŠ¨åƒåœ¾" tabindex="-1"><a class="header-anchor" href="#å¤šæ ‡â€”â€”æµ®åŠ¨åƒåœ¾" aria-hidden="true">#</a> å¤šæ ‡â€”â€”æµ®åŠ¨åƒåœ¾</h3><p>å‡è®¾å·²ç»éå†åˆ° E(å˜ä¸ºç°è‰²äº†), æ­¤æ—¶åº”ç”¨æ‰§è¡Œäº† objD.fieldE = null (D &gt; E çš„å¼•ç”¨æ–­å¼€)ï¼š</p><figure><img src="/assets/202112292142247-91117b7a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ­¤åˆ»ä¹‹å, å¯¹è±¡ E/F/G æ˜¯&quot;åº”è¯¥&quot;è¢«å›æ”¶çš„ã€‚ç„¶è€Œå› ä¸º E å·²ç»å˜ä¸ºç°è‰²äº†, å…¶ä»ä¼šè¢«å½“ä½œå­˜æ´»å¯¹è±¡ç»§ç»­éå†ä¸‹å»ã€‚æœ€ç»ˆçš„ç»“æœæ˜¯ï¼šè¿™éƒ¨åˆ†å¯¹è±¡ä»ä¼šè¢«æ ‡è®°ä¸ºå­˜æ´», å³æœ¬è½® GC ä¸ä¼šå›æ”¶è¿™éƒ¨åˆ†å†…å­˜ã€‚</p><p>è¿™éƒ¨åˆ†æœ¬åº”è¯¥å›æ”¶ ä½†æ˜¯æ²¡æœ‰å›æ”¶åˆ°çš„å†…å­˜, è¢«ç§°ä¹‹ä¸º&quot;æµ®åŠ¨åƒåœ¾&quot;ã€‚æµ®åŠ¨åƒåœ¾å¹¶ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ€§, åªæ˜¯éœ€è¦ç­‰åˆ°ä¸‹ä¸€è½®åƒåœ¾å›æ”¶ä¸­æ‰è¢«æ¸…é™¤ã€‚</p><p>å¦å¤–, é’ˆå¯¹å¹¶å‘æ ‡è®°å¼€å§‹åçš„æ–°å¯¹è±¡, é€šå¸¸çš„åšæ³•æ˜¯ç›´æ¥å…¨éƒ¨å½“æˆé»‘è‰², æœ¬è½®ä¸ä¼šè¿›è¡Œæ¸…é™¤ã€‚è¿™éƒ¨åˆ†å¯¹è±¡æœŸé—´å¯èƒ½ä¼šå˜ä¸ºåƒåœ¾, è¿™ä¹Ÿç®—æ˜¯æµ®åŠ¨åƒåœ¾çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="æ¼æ ‡-è¯»å†™å±éšœ" tabindex="-1"><a class="header-anchor" href="#æ¼æ ‡-è¯»å†™å±éšœ" aria-hidden="true">#</a> æ¼æ ‡-è¯»å†™å±éšœ</h3><p>å‡è®¾ GC çº¿ç¨‹å·²ç»éå†åˆ° E(å˜ä¸ºç°è‰²äº†), æ­¤æ—¶åº”ç”¨çº¿ç¨‹å…ˆæ‰§è¡Œäº†ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>var G = objE.fieldG; 
objE.fieldG = null;  // ç°è‰²E æ–­å¼€å¼•ç”¨ ç™½è‰²G 
objD.fieldG = G;  // é»‘è‰²D å¼•ç”¨ ç™½è‰²G
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/202112292143458-c4fee9a0.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ­¤æ—¶åˆ‡å› GC çº¿ç¨‹ç»§ç»­è·‘, å› ä¸º E å·²ç»æ²¡æœ‰å¯¹ G çš„å¼•ç”¨äº†, æ‰€ä»¥ä¸ä¼šå°† G æ”¾åˆ°ç°è‰²é›†åˆï¼›å°½ç®¡å› ä¸º D é‡æ–°å¼•ç”¨äº† G, ä½†å› ä¸º D å·²ç»æ˜¯é»‘è‰²äº†, ä¸ä¼šå†é‡æ–°åšéå†å¤„ç†ã€‚</p><p>æœ€ç»ˆå¯¼è‡´çš„ç»“æœæ˜¯ï¼šG ä¼šä¸€ç›´åœç•™åœ¨ç™½è‰²é›†åˆä¸­, æœ€åè¢«å½“ä½œåƒåœ¾è¿›è¡Œæ¸…é™¤ã€‚è¿™ç›´æ¥å½±å“åˆ°äº†åº”ç”¨ç¨‹åºçš„æ­£ç¡®æ€§, æ˜¯ä¸å¯æ¥å—çš„ã€‚</p><p>ä¸éš¾åˆ†æ, æ¼æ ‡åªæœ‰åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶æ‰ä¼šå‘ç”Ÿï¼š</p><ol><li>ç°è‰²å¯¹è±¡æ–­å¼€äº†ç™½è‰²å¯¹è±¡çš„å¼•ç”¨(ç›´æ¥æˆ–é—´æ¥çš„å¼•ç”¨)ï¼›å³ç°è‰²å¯¹è±¡åŸæ¥æˆå‘˜å˜é‡çš„å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–ã€‚</li><li>é»‘è‰²å¯¹è±¡é‡æ–°å¼•ç”¨äº†è¯¥ç™½è‰²å¯¹è±¡ï¼›å³é»‘è‰²å¯¹è±¡æˆå‘˜å˜é‡å¢åŠ äº†æ–°çš„å¼•ç”¨ã€‚</li></ol><p>ä»ä»£ç çš„è§’åº¦çœ‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>var G = objE.fieldG; // 1.è¯»
objE.fieldG = null;  // 2.å†™
objD.fieldG = G;     // 3.å†™
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>è¯»å–å¯¹è±¡ E çš„æˆå‘˜å˜é‡ fieldG çš„å¼•ç”¨å€¼, å³å¯¹è±¡ Gï¼›</li><li>å¯¹è±¡ E å¾€å…¶æˆå‘˜å˜é‡ fieldG, å†™å…¥ nullå€¼ã€‚</li><li>å¯¹è±¡ D å¾€å…¶æˆå‘˜å˜é‡ fieldG, å†™å…¥å¯¹è±¡ G ï¼›</li></ol><p>æˆ‘ä»¬åªè¦åœ¨ä¸Šé¢è¿™ä¸‰æ­¥ä¸­çš„ä»»æ„ä¸€æ­¥ä¸­åšä¸€äº›&quot;æ‰‹è„š&quot;, å°†å¯¹è±¡ G è®°å½•èµ·æ¥, ç„¶åä½œä¸ºç°è‰²å¯¹è±¡å†è¿›è¡Œéå†å³å¯ã€‚æ¯”å¦‚æ”¾åˆ°ä¸€ä¸ªç‰¹å®šçš„é›†åˆ, ç­‰åˆå§‹çš„ GC Roots éå†å®Œ(å¹¶å‘æ ‡è®°), è¯¥é›†åˆçš„å¯¹è±¡éå†å³å¯(é‡æ–°æ ‡è®°)ã€‚</p><blockquote><p>é‡æ–°æ ‡è®°æ˜¯éœ€è¦ STW çš„, å› ä¸ºåº”ç”¨ç¨‹åºä¸€ç›´åœ¨è·‘çš„è¯, è¯¥é›†åˆå¯èƒ½ä¼šä¸€ç›´å¢åŠ æ–°çš„å¯¹è±¡, å¯¼è‡´æ°¸è¿œéƒ½è·‘ä¸å®Œã€‚å½“ç„¶, å¹¶å‘æ ‡è®°æœŸé—´ä¹Ÿå¯ä»¥å°†è¯¥é›†åˆä¸­çš„å¤§éƒ¨åˆ†å…ˆè·‘äº†, ä»è€Œç¼©çŸ­é‡æ–°æ ‡è®° STW çš„æ—¶é—´, è¿™ä¸ªæ˜¯ä¼˜åŒ–é—®é¢˜äº†ã€‚</p></blockquote><p>å†™å±éšœç”¨äºæ‹¦æˆªç¬¬äºŒå’Œç¬¬ä¸‰æ­¥ï¼›è€Œè¯»å±éšœåˆ™æ˜¯æ‹¦æˆªç¬¬ä¸€æ­¥ã€‚å®ƒä»¬çš„æ‹¦æˆªçš„ç›®çš„å¾ˆç®€å•ï¼šå°±æ˜¯åœ¨è¯»å†™å‰å, å°†å¯¹è±¡ G ç»™è®°å½•ä¸‹æ¥ã€‚</p><h3 id="å†™å±éšœ-1" tabindex="-1"><a class="header-anchor" href="#å†™å±éšœ-1" aria-hidden="true">#</a> å†™å±éšœ</h3><p>ç»™æŸä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹å€¼æ—¶, å…¶åº•å±‚ä»£ç å¤§æ¦‚é•¿è¿™æ ·ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/**
* @param field æŸå¯¹è±¡çš„æˆå‘˜å˜é‡, å¦‚ D.fieldG
* @param new_value æ–°å€¼, å¦‚ null
*/
void oop_field_store(oop* field, oop new_value) { 
    *field = new_value; // èµ‹å€¼æ“ä½œ
} 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€è°“çš„å†™å±éšœ, å…¶å®å°±æ˜¯æŒ‡åœ¨èµ‹å€¼æ“ä½œå‰å, åŠ å…¥ä¸€äº›å¤„ç†(å¯ä»¥å‚è€ƒAOPçš„æ¦‚å¿µ), è¯»å±éšœçš„å«ä¹‰ä¹Ÿç±»ä¼¼ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>void oop_field_store(oop* field, oop new_value) {  
    pre_write_barrier(field); // å†™å±éšœ-å†™å‰æ“ä½œ
    *field = new_value; 
    post_write_barrier(field, value);  // å†™å±éšœ-å†™åæ“ä½œ
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å†™å±éšœ-satb" tabindex="-1"><a class="header-anchor" href="#å†™å±éšœ-satb" aria-hidden="true">#</a> å†™å±éšœ + SATB</h4><p>å½“å¯¹è±¡ E çš„æˆå‘˜å˜é‡çš„å¼•ç”¨å‘ç”Ÿå˜åŒ–æ—¶(objE.fieldG = null;), æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å†™å±éšœ, å°† E åŸæ¥æˆå‘˜å˜é‡çš„å¼•ç”¨å¯¹è±¡ G è®°å½•ä¸‹æ¥ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>void pre_write_barrier(oop* field) {
    oop old_value = *field; // è·å–æ—§å€¼
    remark_set.add(old_value); // è®°å½• åŸæ¥çš„å¼•ç”¨å¯¹è±¡
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“åŸæ¥æˆå‘˜å˜é‡çš„å¼•ç”¨å‘ç”Ÿå˜åŒ–ä¹‹å‰, è®°å½•ä¸‹åŸæ¥çš„å¼•ç”¨å¯¹è±¡ã€‚</p><p>è¿™ç§åšæ³•çš„æ€è·¯æ˜¯ï¼šå°è¯•ä¿ç•™å¼€å§‹æ—¶çš„å¯¹è±¡å›¾, å³åŸå§‹å¿«ç…§(Snapshot At The Beginning, SATB), å½“æŸä¸ªæ—¶åˆ» çš„ GC Roots ç¡®å®šå, å½“æ—¶çš„å¯¹è±¡å›¾å°±å·²ç»ç¡®å®šäº†ã€‚</p><p>æ¯”å¦‚ å½“æ—¶ D æ˜¯å¼•ç”¨ç€ G çš„, é‚£åç»­çš„æ ‡è®°ä¹Ÿåº”è¯¥æ˜¯æŒ‰ç…§è¿™ä¸ªæ—¶åˆ»çš„å¯¹è±¡å›¾èµ°(D å¼•ç”¨ç€ G)ã€‚å¦‚æœæœŸé—´å‘ç”Ÿå˜åŒ–, åˆ™å¯ä»¥è®°å½•èµ·æ¥, ä¿è¯æ ‡è®°ä¾ç„¶æŒ‰ç…§åŸæœ¬çš„è§†å›¾æ¥ã€‚</p><blockquote><p>SATB ç ´åäº†æ¡ä»¶ä¸€ï¼šã€ç°è‰²å¯¹è±¡æ–­å¼€äº†ç™½è‰²å¯¹è±¡çš„å¼•ç”¨ã€‘, ä»è€Œä¿è¯äº†ä¸ä¼šæ¼æ ‡ã€‚</p></blockquote><h3 id="å†™å±éšœ-å¢é‡æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#å†™å±éšœ-å¢é‡æ›´æ–°" aria-hidden="true">#</a> å†™å±éšœ + å¢é‡æ›´æ–°</h3><p>å½“å¯¹è±¡ D çš„æˆå‘˜å˜é‡çš„å¼•ç”¨å‘ç”Ÿå˜åŒ–æ—¶(objD.fieldG = G;), æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å†™å±éšœ, å°† D æ–°çš„æˆå‘˜å˜é‡å¼•ç”¨å¯¹è±¡ G è®°å½•ä¸‹æ¥ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>void post_write_barrier(oop* field, oop new_value) {  
  if($gc_phase == GC_CONCURRENT_MARK &amp;&amp; !isMarkd(field)) {
      remark_set.add(new_value); // è®°å½•æ–°å¼•ç”¨çš„å¯¹è±¡
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æœ‰æ–°å¼•ç”¨æ’å…¥è¿›æ¥æ—¶, è®°å½•ä¸‹æ–°çš„å¼•ç”¨å¯¹è±¡ã€‚</p><p>è¿™ç§åšæ³•çš„æ€è·¯æ˜¯ï¼šä¸è¦æ±‚ä¿ç•™åŸå§‹å¿«ç…§, è€Œæ˜¯é’ˆå¯¹æ–°å¢çš„å¼•ç”¨, å°†å…¶è®°å½•ä¸‹æ¥ç­‰å¾…éå†, å³å¢é‡æ›´æ–°(Incremental Update)ã€‚</p><blockquote><p>å¢é‡æ›´æ–°ç ´åäº†æ¡ä»¶äºŒï¼šã€é»‘è‰²å¯¹è±¡é‡æ–°å¼•ç”¨äº†è¯¥ç™½è‰²å¯¹è±¡ã€‘, ä»è€Œä¿è¯äº†ä¸ä¼šæ¼æ ‡ã€‚</p></blockquote><h3 id="è¯»å±éšœ" tabindex="-1"><a class="header-anchor" href="#è¯»å±éšœ" aria-hidden="true">#</a> è¯»å±éšœ</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>oop oop_field_load(oop* field) {
    pre_load_barrier(field); // è¯»å±éšœ-è¯»å–å‰æ“ä½œ
    return *field;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯»å±éšœæ˜¯ç›´æ¥é’ˆå¯¹ç¬¬ä¸€æ­¥ï¼švar G = objE.fieldG;, å½“è¯»å–æˆå‘˜å˜é‡æ—¶, ä¸€å¾‹è®°å½•ä¸‹æ¥ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>void pre_load_barrier(oop* field, oop old_value) {  
  if($gc_phase == GC_CONCURRENT_MARK &amp;&amp; !isMarkd(field)) {
      oop old_value = *field;
      remark_set.add(old_value); // è®°å½•è¯»å–åˆ°çš„å¯¹è±¡
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§åšæ³•æ˜¯ä¿å®ˆçš„, ä½†ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚å› ä¸ºæ¡ä»¶äºŒä¸­ã€é»‘è‰²å¯¹è±¡é‡æ–°å¼•ç”¨äº†è¯¥ç™½è‰²å¯¹è±¡ã€‘, é‡æ–°å¼•ç”¨çš„å‰ææ˜¯ï¼šå¾—è·å–åˆ°è¯¥ç™½è‰²å¯¹è±¡, æ­¤æ—¶å·²ç»è¯»å±éšœå°±å‘æŒ¥ä½œç”¨äº†ã€‚</p><h3 id="ä¸‰è‰²æ ‡è®°æ³•ä¸ç°ä»£åƒåœ¾å›æ”¶å™¨" tabindex="-1"><a class="header-anchor" href="#ä¸‰è‰²æ ‡è®°æ³•ä¸ç°ä»£åƒåœ¾å›æ”¶å™¨" aria-hidden="true">#</a> ä¸‰è‰²æ ‡è®°æ³•ä¸ç°ä»£åƒåœ¾å›æ”¶å™¨</h3><p>ç°ä»£è¿½è¸ªå¼(å¯è¾¾æ€§åˆ†æ)çš„åƒåœ¾å›æ”¶å™¨å‡ ä¹éƒ½å€Ÿé‰´äº†ä¸‰è‰²æ ‡è®°çš„ç®—æ³•æ€æƒ³, å°½ç®¡å®ç°çš„æ–¹å¼ä¸å°½ç›¸åŒï¼šæ¯”å¦‚ç™½è‰²/é»‘è‰²é›†åˆä¸€èˆ¬éƒ½ä¸ä¼šå‡ºç°(ä½†æ˜¯æœ‰å…¶ä»–ä½“ç°é¢œè‰²çš„åœ°æ–¹)ã€ç°è‰²é›†åˆå¯ä»¥é€šè¿‡æ ˆ/é˜Ÿåˆ—/ç¼“å­˜æ—¥å¿—ç­‰æ–¹å¼è¿›è¡Œå®ç°ã€éå†æ–¹å¼å¯ä»¥æ˜¯å¹¿åº¦/æ·±åº¦éå†ç­‰ç­‰ã€‚</p><p>å¯¹äºè¯»å†™å±éšœ, ä»¥Java HotSpot VM ä¸ºä¾‹, å…¶å¹¶å‘æ ‡è®°æ—¶å¯¹æ¼æ ‡çš„å¤„ç†æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>CMSï¼šå†™å±éšœ + å¢é‡æ›´æ–°</li><li>G1ï¼šå†™å±éšœ + SATB</li><li>ZGCï¼šè¯»å±éšœ</li></ul><p>å‚çœ‹ï¼š<a href="https://www.cnblogs.com/jmcui/p/14165601.html" target="_blank" rel="noopener noreferrer">JVMç³»åˆ—åå…­(ä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœ)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h1 id="åƒåœ¾æ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#åƒåœ¾æ”¶é›†å™¨" aria-hidden="true">#</a> åƒåœ¾æ”¶é›†å™¨</h1><h2 id="ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨" aria-hidden="true">#</a> ç»å…¸çš„åƒåœ¾æ”¶é›†å™¨</h2><figure><img src="/assets/åƒåœ¾æ”¶é›†å™¨æ€»ç»“-49e3179d.png" alt="åƒåœ¾æ”¶é›†å™¨æ€»ç»“" tabindex="0" loading="lazy"><figcaption>åƒåœ¾æ”¶é›†å™¨æ€»ç»“</figcaption></figure><p>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°å¹¶æ²¡æœ‰åšå‡ºä»»ä½•è§„å®šã€‚</p><p><strong>jdk1.8é»˜è®¤ä½¿ç”¨ParallelGCã€‚æ–°ç”Ÿä»£é‡‡ç”¨çš„æ˜¯Parallel Scavenge, è€å¹´ä»£Parallel Oldã€‚</strong></p><p>ä½¿ç”¨ParNew(æ ‡è®°å¤åˆ¶ã€å¹¶è¡Œã€ä½œç”¨äºæ–°ç”Ÿä»£) + CMSçš„åƒåœ¾æ”¶é›†å™¨(æ ‡è®°æ¸…é™¤ã€å¹¶è¡Œã€ä½œç”¨äºè€å¹´ä»£), è¿½æ±‚å“åº”é€Ÿåº¦ä¼˜å…ˆ, å…¶é€‚ç”¨äºå¤šCPUç¯å¢ƒçš„Serveræ¨¡å¼çš„äº’è”ç½‘æˆ–è€…B/Sä¸šåŠ¡ã€‚</p><p>å¦‚æœè¿½æ±‚ååé‡ä¼˜å…ˆ, åº”ç”¨åœ¨åå°è¿ç®—å¹¶ä¸éœ€è¦å¤ªå¤šäº¤äº’åœºæ™¯çš„, å¯é‡‡ç”¨Parallel(æ ‡è®°å¤åˆ¶ã€å¹¶è¡Œã€ä½œç”¨äºæ–°ç”Ÿä»£) + Parallel Old çš„åƒåœ¾æ”¶é›†å™¨(æ ‡è®°æ•´ç†ã€å¹¶è¡Œã€ä½œç”¨äºè€å¹´ä»£)</p><blockquote><p><strong>&quot;Stop The World&quot;</strong>ï¼š<strong>è™šæ‹Ÿæœºåœ¨åå°è‡ªåŠ¨å‘èµ·å’Œè‡ªåŠ¨å®Œæˆçš„, åœ¨ç”¨æˆ·ä¸å¯çŸ¥ã€ä¸å¯æ§çš„æƒ…å†µä¸‹æŠŠç”¨æˆ·çš„æ­£å¸¸å·¥ä½œçš„ç”¨æˆ·çº¿ç¨‹å…¨éƒ¨åœæ‰</strong>ã€‚è¿™å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´éƒ½æ˜¯ä¸èƒ½æ¥å—çš„ã€‚</p></blockquote><h3 id="serialæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#serialæ”¶é›†å™¨" aria-hidden="true">#</a> Serialæ”¶é›†å™¨</h3><p>æ–°ç”Ÿä»£ å•çº¿ç¨‹ å¤åˆ¶ç®—æ³•</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸å…¶ä»–å•çº¿ç¨‹åƒåœ¾æ”¶é›†å™¨ç›¸æ¯”ç®€å•é«˜æ•ˆ</li><li>å¯¹äºå†…å­˜å—é™çš„ç¯å¢ƒ, é¢å¤–å†…å­˜æ¶ˆè€—æœ€å°</li><li>å¯¹äºå•æ ¸æˆ–è€…æ ¸å¿ƒæ•°è¾ƒå°‘çš„ç¯å¢ƒæ¥è¯´, å…¶æ²¡æœ‰çº¿ç¨‹äº¤äº’å¼€é”€, ä¸“å¿ƒåšåƒåœ¾æ”¶é›†å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p>Serialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨<strong>å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœº</strong>æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p><blockquote><p>åœ¨ç”¨æˆ·æ¡Œé¢çš„åº”ç”¨åœºæ™¯ä»¥åŠè¿‘å¹´æ¥æµè¡Œçš„éƒ¨åˆ†å¾®æœåŠ¡åº”ç”¨ä¸­, åˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬æ¥è¯´å¹¶ä¸ä¼šç‰¹åˆ«å¤§, æ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„æ–°ç”Ÿä»£(ä»…ä»…æ˜¯æŒ‡æ–°ç”Ÿä»£ä½¿ç”¨çš„å†…å­˜, æ¡Œé¢åº”ç”¨ç”šå°‘è¶…è¿‡è¿™ä¸ªå®¹é‡), åƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´å®Œå…¨å¯ä»¥æ§åˆ¶åœ¨åå‡ ã€å‡ åæ¯«ç§’, æœ€å¤šä¸€ ç™¾å¤šæ¯«ç§’ä»¥å†…, åªè¦ä¸æ˜¯é¢‘ç¹å‘ç”Ÿæ”¶é›†, è¿™ç‚¹åœé¡¿æ—¶é—´å¯¹è®¸å¤šç”¨æˆ·æ¥è¯´æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</p></blockquote><p>Serial/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p><figure><img src="/assets/202110021731339-c7102274.png" alt="Serial/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>Serial/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><h3 id="parnewæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#parnewæ”¶é›†å™¨" aria-hidden="true">#</a> ParNewæ”¶é›†å™¨</h3><p>ParNewæ”¶é›†å™¨å®è´¨ä¸Šæ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹å¹¶è¡Œç‰ˆæœ¬ã€‚</p><p>ParNewæ”¶é›†å™¨æ˜¯æ¿€æ´»CMSå(ä½¿ç”¨-XXï¼š+UseConcMarkSweepGCé€‰é¡¹)çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚</p><p>æ–°ç”Ÿä»£ å¤šçº¿ç¨‹ å¤åˆ¶ç®—æ³•ã€‚</p><p><strong>JDK9ä»¥å‰ParNew + CMS é€‚ç”¨äº æœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„åƒåœ¾æ”¶é›†å™¨ç»„åˆ</strong>ã€‚</p><p>ParNew/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p><figure><img src="/assets/202110021732241-c7ae49cd.png" alt="ParNew/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>ParNew/Serial Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><h3 id="parallel-scavengeæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#parallel-scavengeæ”¶é›†å™¨" aria-hidden="true">#</a> Parallel Scavengeæ”¶é›†å™¨</h3><p>æ–°ç”Ÿä»£ å¤šçº¿ç¨‹ å¤åˆ¶ç®—æ³•</p><p>CMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´, è€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯<strong>è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„åå</strong><strong>é‡</strong>(Throughput)ã€‚æ‰€è°“ååé‡å°±æ˜¯å¤„ç†å™¨ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸å¤„ç†å™¨æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚</p><p>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’æˆ–éœ€è¦ä¿è¯æœåŠ¡å“åº”è´¨é‡çš„ç¨‹åº, è‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼›è€Œé«˜ååé‡åˆ™å¯ä»¥æœ€é«˜æ•ˆç‡åœ°åˆ©ç”¨å¤„ç†å™¨èµ„æº, å°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡, ä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„åˆ†æä»»åŠ¡ã€‚</p><blockquote><p>Parallel Scavengeæ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡, åˆ†åˆ«æ˜¯æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´çš„<code>-XXï¼šMaxGCPauseMillis</code>å‚æ•°ä»¥åŠç›´æ¥è®¾ç½®ååé‡å¤§å°çš„<code>XXï¼šGCTimeRatio</code>å‚æ•°ã€‚</p><p><strong>-XXï¼šMaxGCPauseMilliså‚æ•°å…è®¸çš„å€¼æ˜¯ä¸€ä¸ªå¤§äº0çš„æ¯«ç§’æ•°, æ”¶é›†å™¨å°†å°½åŠ›ä¿è¯å†…å­˜å›æ”¶èŠ±è´¹çš„æ—¶é—´ä¸è¶…è¿‡ç”¨æˆ·è®¾å®šå€¼</strong>ã€‚åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ç¼©çŸ­æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œæ–°ç”Ÿä»£ç©ºé—´ä¸ºä»£ä»·æ¢å–çš„ï¼šç³»ç»ŸæŠŠæ–°ç”Ÿä»£è°ƒå¾—å°ä¸€äº›, æ”¶é›†300MBæ–°ç”Ÿä»£è‚¯å®šæ¯”æ”¶é›†500MBå¿«, ä½†è¿™ä¹Ÿç›´æ¥å¯¼è‡´åƒåœ¾æ”¶é›†å‘ç”Ÿå¾—æ›´é¢‘ç¹, åŸæ¥10ç§’æ”¶é›†ä¸€æ¬¡ã€æ¯æ¬¡åœé¡¿100æ¯«ç§’, ç°åœ¨å˜æˆ5ç§’æ”¶é›†ä¸€æ¬¡ã€æ¯æ¬¡åœé¡¿70æ¯«ç§’ã€‚åœé¡¿æ—¶é—´çš„ç¡®åœ¨ä¸‹é™, ä½†ååé‡ä¹Ÿé™ä¸‹æ¥äº†ã€‚</p><p>-XXï¼šGCTimeRatioå‚æ•°çš„å€¼åˆ™åº”å½“æ˜¯ä¸€ä¸ªå¤§äº0å°äº100çš„æ•´æ•°, ä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡, ç›¸å½“äºååé‡çš„å€’æ•°ã€‚è­¬å¦‚æŠŠæ­¤å‚æ•°è®¾ç½®ä¸º19, é‚£å…è®¸çš„æœ€å¤§åƒåœ¾æ”¶é›†æ—¶é—´å°±å æ€»æ—¶é—´çš„5%, å³1/(1+19)), é»˜è®¤å€¼ä¸º99, å³å…è®¸æœ€å¤§1%(å³1/(1+99))çš„åƒåœ¾æ”¶é›†æ—¶é—´ã€‚</p></blockquote><p>Parallel Scavenge/Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p><figure><img src="/assets/202110021732331-29ce1669.png" alt="Parallel Scavenge/Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>Parallel Scavenge/Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><h3 id="serial-oldæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#serial-oldæ”¶é›†å™¨" aria-hidden="true">#</a> Serial Oldæ”¶é›†å™¨</h3><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚</p><p>è€å¹´ä»£ å•çº¿ç¨‹ æ•´ç†ç®—æ³•</p><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><p>è¿™ä¸ªæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯ä¾›å®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨ã€‚</p><p>å¦‚æœåœ¨æœåŠ¡ç«¯æ¨¡å¼ä¸‹, å®ƒä¹Ÿå¯èƒ½æœ‰ä¸¤ç§ç”¨é€”ï¼š</p><ol><li>åœ¨JDK 5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨[1],</li><li>ä½œä¸ºCMSæ”¶é›†å™¨å‘ç”Ÿå¤±è´¥æ—¶çš„åå¤‡é¢„æ¡ˆ, åœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚</li></ol><h3 id="parallel-oldæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#parallel-oldæ”¶é›†å™¨" aria-hidden="true">#</a> Parallel Oldæ”¶é›†å™¨</h3><p>Parallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚</p><p>è€å¹´ä»£ å¤šçº¿ç¨‹ æ•´ç†ç®—æ³•</p><p>ç›´åˆ°Parallel Oldæ”¶é›†å™¨å‡ºç°å, &quot;ååé‡ä¼˜å…ˆ&quot;æ”¶é›†å™¨ç»ˆäºæœ‰äº†æ¯”è¾ƒåå‰¯å…¶å®çš„æ­é…ç»„åˆ, <strong>åœ¨æ³¨é‡ååé‡æˆ–è€…å¤„ç†å™¨èµ„æºè¾ƒä¸ºç¨€ç¼ºçš„åœºåˆ, éƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel Scavenge / Parallel Oldæ”¶é›†å™¨è¿™ä¸ªç»„åˆ</strong>ã€‚</p><h3 id="cmsæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#cmsæ”¶é›†å™¨" aria-hidden="true">#</a> CMSæ”¶é›†å™¨</h3><blockquote><p><strong>CMS(Concurrent Mark Sweep)æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨</strong>ã€‚è¿™æ˜¯å› ä¸ºCMSæ”¶é›†å™¨å·¥ä½œæ—¶, GCå·¥ä½œçº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¯ä»¥<code>å¹¶å‘</code>æ‰§è¡Œ, ä»¥æ­¤æ¥è¾¾åˆ°é™ä½æ”¶é›†åœé¡¿æ—¶é—´çš„ç›®çš„ã€‚</p></blockquote><p>ä½¿ç”¨åœºæ™¯ï¼šé›†ä¸­åœ¨ <strong>äº’è”ç½‘ç½‘ç«™æˆ–è€…åŸºäºæµè§ˆå™¨çš„B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯</strong> ä¸Š, è¿™ç±»åº”ç”¨é€šå¸¸éƒ½ä¼šè¾ƒä¸ºå…³æ³¨æœåŠ¡çš„å“åº”é€Ÿåº¦, å¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´å°½å¯èƒ½çŸ­, ä»¥ç»™ç”¨æˆ·å¸¦æ¥è‰¯å¥½çš„äº¤äº’ä½“éªŒã€‚</p><p>CMSæ”¶é›†å™¨ä»…ä½œç”¨äº<strong>è€å¹´ä»£</strong>çš„æ”¶é›†, æ˜¯åŸºäº<code>æ ‡è®°-æ¸…é™¤ç®—æ³•</code>çš„, å®ƒçš„è¿ä½œè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š</p><ol><li>åˆå§‹æ ‡è®°(CMS initial mark)ï¼šä»…ä»…åªæ˜¯<strong>æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡</strong>, é€Ÿåº¦å¾ˆå¿«, éœ€è¦&quot;Stop The World&quot;ã€‚</li><li>å¹¶å‘æ ‡è®°(CMS concurrent mark)ï¼šæ˜¯<strong>ä»GC Rootsçš„ç›´æ¥å…³è”å¯¹è±¡å¼€å§‹éå†æ•´ä¸ªå¯¹è±¡å›¾çš„è¿‡ç¨‹</strong>, è¿™ä¸ªè¿‡ç¨‹è€—æ—¶è¾ƒé•¿ä½†æ˜¯ä¸éœ€è¦åœé¡¿ç”¨æˆ·çº¿ç¨‹, å¯ä»¥ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸€èµ·å¹¶å‘è¿è¡Œã€‚</li><li>é‡æ–°æ ‡è®°(CMS remark)ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•</strong>, è¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›, ä½†è¿œæ¯”å¹¶å‘æ ‡è®°çš„æ—¶é—´çŸ­ã€‚æ­¤é˜¶æ®µä¹Ÿéœ€è¦&quot;Stop The World&quot;ã€‚</li><li>å¹¶å‘æ¸…é™¤(CMS concurrent sweep)ï¼š<strong>æ¸…ç†åˆ é™¤æ‰æ ‡è®°é˜¶æ®µåˆ¤æ–­çš„å·²ç»æ­»äº¡çš„å¯¹è±¡</strong>ã€‚ç”±äºä¸éœ€è¦ç§»åŠ¨å­˜æ´»å¯¹è±¡, æ‰€ä»¥è¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å¹¶å‘çš„</li></ol><blockquote><p>CMSä»¥æµæ°´çº¿æ–¹å¼æ‹†åˆ†äº†æ”¶é›†å‘¨æœŸ, å°†è€—æ—¶é•¿çš„æ“ä½œå•å…ƒä¿æŒä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚åªå°†é‚£äº›å¿…éœ€STWæ‰èƒ½æ‰§è¡Œçš„æ“ä½œå•å…ƒå•ç‹¬æ‹å‡ºæ¥, æ§åˆ¶è¿™äº›å•å…ƒåœ¨æ°å½“çš„æ—¶æœºè¿è¡Œ, å¹¶èƒ½ä¿è¯ä»…éœ€çŸ­æš‚çš„æ—¶é—´å°±å¯ä»¥å®Œæˆã€‚è¿™æ ·, åœ¨æ•´ä¸ªæ”¶é›†å‘¨æœŸå†…, åªæœ‰<strong>ä¸¤æ¬¡çŸ­æš‚çš„æš‚åœ(åˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°)</strong>, <strong>è¾¾åˆ°äº†è¿‘ä¼¼å¹¶å‘çš„ç›®çš„</strong>ã€‚</p></blockquote><p>ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œã€‚æ‰€ä»¥, ä»æ€»ä½“ä¸Šæ¥è¯´, CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚é€šè¿‡ä¸‹å›¾å¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°CMSæ”¶é›†å™¨çš„è¿ä½œæ­¥éª¤ä¸­å¹¶å‘å’Œéœ€è¦åœé¡¿çš„æ—¶é—´ï¼š</p><figure><img src="/assets/202110021739818-d00a4878.png" alt="Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>Concurrent Mark Sweepæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><p>CMSæ”¶é›†å™¨<strong>ä¼˜ç‚¹</strong>ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚</p><p>CMSæ”¶é›†å™¨<strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><strong>CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿ</strong>ã€‚é¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µ, å®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿, ä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹(æˆ–è€…è¯´CPUèµ„æº)è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢, æ€»ååé‡ä¼šé™ä½ã€‚</li><li><strong>CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾(Floating Garbage)</strong>ã€‚ <ul><li>ç”±äºCMSå¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œç€, ä¼´éšç¨‹åºè¿è¡Œè‡ªç„¶å°±è¿˜ä¼šæœ‰æ–°çš„åƒåœ¾ä¸æ–­äº§ç”Ÿã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ä¹‹å, CMSæ— æ³•å†å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬, åªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡GCæ—¶å†æ¸…ç†æ‰ã€‚</li><li>è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±è¢«ç§°ä¸º&quot;æµ®åŠ¨åƒåœ¾&quot;ã€‚ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦è¿è¡Œ, é‚£ä¹Ÿå°±è¿˜éœ€è¦é¢„ç•™æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨, å› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†, éœ€è¦é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´æä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚</li></ul></li><li><strong>CMSæ”¶é›†å™¨æ˜¯åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•, æ”¶é›†ç»“æŸæ—¶å¯èƒ½å­˜åœ¨å¤§é‡ç©ºé—´ç¢ç‰‡</strong>ã€‚ç¢ç‰‡è¿‡å¤šæ—¶, å°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦, å¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™, ä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡(æ‰€ä»¥æœªæä¾›CMSçš„æ–°ç”Ÿä»£ç‰ˆæœ¬)ã€‚</li></ul><h3 id="garbage-firstæ”¶é›†å™¨-g1" tabindex="-1"><a class="header-anchor" href="#garbage-firstæ”¶é›†å™¨-g1" aria-hidden="true">#</a> Garbage Firstæ”¶é›†å™¨ (G1)</h3><h4 id="g1ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#g1ç®€ä»‹" aria-hidden="true">#</a> G1ç®€ä»‹</h4><p>Garbage First(ç®€ç§°G1)æ”¶é›†å™¨æ˜¯åƒåœ¾æ”¶é›†å™¨æŠ€æœ¯å‘å±•å†å²ä¸Šçš„é‡Œç¨‹ç¢‘å¼çš„æˆæœ, å®ƒå¼€åˆ›äº†<strong>æ”¶é›†å™¨é¢å‘å±€éƒ¨æ”¶é›†çš„è®¾è®¡æ€è·¯</strong>å’Œ<strong>åŸºäºRegionçš„å†…å­˜å¸ƒå±€å½¢å¼</strong>ã€‚</p><p>G1æ˜¯ä¸€æ¬¾ä¸»è¦é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚</p><p>G1 GCåˆ‡åˆ†å †å†…å­˜ä¸ºå¤šä¸ªåŒºé—´(Region), ä»è€Œé¿å…å¾ˆå¤šGCæ“ä½œåœ¨æ•´ä¸ªJavaå †æˆ–è€…æ•´ä¸ªå¹´è½»ä»£è¿›è¡Œã€‚G1 GCåªå…³æ³¨ä½ æœ‰æ²¡æœ‰å­˜è´§å¯¹è±¡, éƒ½ä¼šè¢«å›æ”¶å¹¶æ”¾å…¥å¯ç”¨çš„Regioné˜Ÿåˆ—ã€‚G1 GCæ˜¯åŸºäºRegionçš„GC, <strong>é€‚ç”¨äºå¤§å†…å­˜æœºå™¨ã€‚å³ä½¿å†…å­˜å¾ˆå¤§, Regionæ‰«æ, æ€§èƒ½è¿˜æ˜¯å¾ˆé«˜çš„</strong>ã€‚</p><blockquote><p>JDK 9å‘å¸ƒä¹‹æ—¥, G1å®£å‘Šå–ä»£Parallel ScavengeåŠ Parallel Oldç»„åˆ, æˆä¸ºæœåŠ¡ç«¯æ¨¡å¼ä¸‹çš„é»˜è®¤åƒåœ¾æ”¶é›†å™¨, è€ŒCMSåˆ™æ²¦è½è‡³è¢«å£°æ˜ä¸ºä¸æ¨èä½¿ç”¨(Deprecate)çš„æ”¶é›†å™¨ã€‚å¦‚æœå¯¹JDK 9åŠä»¥ä¸Šç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºä½¿ç”¨å‚æ•° <code>-XXï¼š+UseConcMarkSweepGC</code> æ¥å¼€å¯CMSæ”¶é›†å™¨çš„è¯, ç”¨æˆ·ä¼šæ”¶åˆ°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯, æç¤ºCMSæœªæ¥å°†ä¼šè¢«åºŸå¼ƒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Java</span> <span class="token class-name">HotSpot</span><span class="token punctuation">(</span><span class="token constant">TM</span><span class="token punctuation">)</span> <span class="token number">64</span><span class="token operator">-</span><span class="token class-name">Bit</span> <span class="token class-name">Server</span> <span class="token constant">VM</span> warning<span class="token operator">:</span> <span class="token class-name">Option</span> <span class="token class-name">UseConcMarkSweepGC</span> was deprecated in version <span class="token number">9.0</span> and will likely
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></blockquote><h4 id="g1ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#g1ç‰¹ç‚¹" aria-hidden="true">#</a> G1ç‰¹ç‚¹</h4><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong>ï¼šG1èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿, ä½¿ç”¨å¤šä¸ªCPUæ¥ç¼©çŸ­Stop-the-worldåœé¡¿çš„æ—¶é—´, éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæ¥éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCæ“ä½œ, G1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡<strong>å¹¶å‘</strong>çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­è¿è¡Œã€‚</li><li>åˆ†ä»£æ”¶é›†ï¼šG1èƒ½å¤Ÿè‡ªå·±ç®¡ç†ä¸åŒåˆ†ä»£å†…å·²åˆ›å»ºå¯¹è±¡å’Œæ–°å¯¹è±¡çš„æ”¶é›†ã€‚</li><li>ç©ºé—´æ•´åˆï¼šä¸CMSçš„æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸åŒ, G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>å®ç°çš„æ”¶é›†å™¨, ä»å±€éƒ¨(ä¸¤ä¸ªRegionä¹‹é—´)ä¸Šæ¥çœ‹æ˜¯åŸºäº&quot;<strong>å¤åˆ¶</strong>&quot;ç®—æ³•å®ç°çš„ã€‚ä½†æ— è®ºå¦‚ä½•, è¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡, æ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚<strong>è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œ, åˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GC</strong>ã€‚</li><li>å¯é¢„æµ‹çš„åœé¡¿ï¼šè¿™æ˜¯G1ç›¸å¯¹äºCMSçš„ä¸€ä¸ªä¼˜åŠ¿, é™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ã€‚</li></ul><h4 id="g1çš„ç›®æ ‡" tabindex="-1"><a class="header-anchor" href="#g1çš„ç›®æ ‡" aria-hidden="true">#</a> <strong>G1çš„ç›®æ ‡ï¼š</strong></h4><p>ä½œä¸ºCMSæ”¶é›†å™¨çš„æ›¿ä»£è€…å’Œç»§æ‰¿äºº, è®¾è®¡è€…ä»¬å¸Œæœ›åšå‡ºä¸€æ¬¾èƒ½å¤Ÿå»ºç«‹èµ·**&quot;åœé¡¿æ—¶é—´æ¨¡å‹&quot;**(PausePrediction Model)çš„æ”¶é›†å™¨, <strong>åœé¡¿æ—¶é—´æ¨¡å‹çš„æ„æ€æ˜¯èƒ½å¤Ÿæ”¯æŒæŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…, æ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´å¤§æ¦‚ç‡ä¸è¶…è¿‡Næ¯«ç§’è¿™æ ·çš„ç›®æ ‡</strong>, è¿™å‡ ä¹å·²ç»æ˜¯å®æ—¶Java(RTSJ)çš„ä¸­è½¯å®æ—¶åƒåœ¾æ”¶é›†å™¨ç‰¹å¾äº†ã€‚</p><h4 id="æ€ä¹ˆåšæ‰èƒ½å®ç°g1çš„ç›®æ ‡å‘¢" tabindex="-1"><a class="header-anchor" href="#æ€ä¹ˆåšæ‰èƒ½å®ç°g1çš„ç›®æ ‡å‘¢" aria-hidden="true">#</a> <strong>æ€ä¹ˆåšæ‰èƒ½å®ç°G1çš„ç›®æ ‡å‘¢ï¼Ÿ</strong></h4><p>1ã€é¦–å…ˆè¦æœ‰ä¸€ä¸ªæ€æƒ³ä¸Šçš„æ”¹å˜</p><p>åœ¨G1æ”¶é›†å™¨å‡ºç°ä¹‹å‰çš„æ‰€æœ‰å…¶ä»–æ”¶é›†å™¨, åŒ…æ‹¬CMSåœ¨å†…, åƒåœ¾æ”¶é›†çš„ç›®æ ‡èŒƒå›´è¦ä¹ˆæ˜¯æ•´ä¸ªæ–°ç”Ÿä»£(Minor GC), è¦ä¹ˆå°±æ˜¯æ•´ä¸ªè€å¹´ä»£(Major GC), å†è¦ä¹ˆå°±æ˜¯æ•´ä¸ªJavaå †(Full GC)ã€‚</p><p>è€ŒG1è·³å‡ºäº†è¿™ä¸ªæ¨Šç¬¼, å®ƒå¯ä»¥<strong>é¢å‘å †å†…å­˜ä»»ä½•éƒ¨åˆ†æ¥ç»„æˆå›æ”¶é›†(Collection Set, ä¸€èˆ¬ç®€ç§°CSet)è¿›è¡Œå›æ”¶</strong>, è¡¡é‡æ ‡å‡†ä¸å†æ˜¯å®ƒå±äºå“ªä¸ªåˆ†ä»£, è€Œæ˜¯å“ªå—å†…å­˜ä¸­å­˜æ”¾çš„åƒåœ¾æ•°é‡æœ€å¤š, å›æ”¶æ”¶ç›Šæœ€å¤§, è¿™å°±æ˜¯G1æ”¶é›†å™¨çš„<strong>Mixed GCæ¨¡å¼</strong>ã€‚</p><p>2ã€G1å¼€åˆ›çš„<strong>åŸºäºRegionçš„å †å†…å­˜å¸ƒå±€</strong>æ˜¯å®ƒèƒ½å¤Ÿå®ç°è¿™ä¸ªç›®æ ‡çš„å…³é”®</p><p>è™½ç„¶G1ä¹Ÿä»æ˜¯éµå¾ªåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡çš„, ä½†å…¶å †å†…å­˜çš„å¸ƒå±€ä¸å…¶ä»–æ”¶é›†å™¨æœ‰éå¸¸æ˜æ˜¾çš„å·®å¼‚ï¼š</p><p><strong>G1ä¸å†åšæŒå›ºå®šå¤§å°ä»¥åŠå›ºå®šæ•°é‡çš„åˆ†ä»£åŒºåŸŸåˆ’åˆ†, è€Œæ˜¯æŠŠè¿ç»­çš„Javaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸ(Region), æ¯ä¸€ä¸ªRegionéƒ½å¯ä»¥æ ¹æ®éœ€è¦, æ‰®æ¼”æ–°ç”Ÿä»£çš„Edenç©ºé—´ã€Survivorç©ºé—´, æˆ–è€…è€å¹´ä»£ç©ºé—´</strong>ã€‚æ”¶é›†å™¨èƒ½å¤Ÿå¯¹æ‰®æ¼”ä¸åŒè§’è‰²çš„Regioné‡‡ç”¨ä¸åŒçš„ç­–ç•¥å»å¤„ç†, è¿™æ ·æ— è®ºæ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡è¿˜æ˜¯å·²ç»å­˜æ´»äº†ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡æ”¶é›†çš„æ—§å¯¹è±¡éƒ½èƒ½è·å–å¾ˆå¥½çš„æ”¶é›†æ•ˆæœã€‚</p><p>Regionä¸­è¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„HumongousåŒºåŸŸ, ä¸“é—¨ç”¨æ¥å­˜å‚¨å¤§å¯¹è±¡ã€‚<strong>G1è®¤ä¸ºåªè¦å¤§å°è¶…è¿‡äº†ä¸€ä¸ªRegionå®¹é‡ä¸€åŠçš„å¯¹è±¡å³å¯åˆ¤å®šä¸ºå¤§å¯¹è±¡</strong>ã€‚</p><p>æ¯ä¸ªRegionçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°<code>-XXï¼šG1HeapRegionSize</code>è®¾å®š, å–å€¼èŒƒå›´ä¸º1MBï½32MB, ä¸”åº”ä¸º2çš„Næ¬¡å¹‚ã€‚è€Œå¯¹äºé‚£äº›è¶…è¿‡äº†æ•´ä¸ªRegionå®¹é‡çš„è¶…çº§å¤§å¯¹è±¡, å°†ä¼šè¢«å­˜æ”¾åœ¨Nä¸ªè¿ç»­çš„Humongous Regionä¹‹ä¸­, G1çš„å¤§å¤šæ•°è¡Œä¸ºéƒ½æŠŠHumongous Regionä½œä¸ºè€å¹´ä»£çš„ä¸€éƒ¨åˆ†æ¥è¿›è¡Œçœ‹å¾…ã€‚</p><p><strong>3ã€å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹</strong></p><p>å°†Regionä½œä¸ºå•æ¬¡å›æ”¶çš„æœ€å°å•å…ƒ, å³æ¯æ¬¡æ”¶é›†åˆ°çš„å†…å­˜ç©ºé—´éƒ½æ˜¯Regionå¤§å°çš„æ•´æ•°å€, è¿™æ ·å¯ä»¥<strong>æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†</strong>ã€‚</p><p>å…·ä½“çš„å¤„ç†æ€è·¯æ˜¯è®©G1æ”¶é›†å™¨å»è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„&quot;ä»·å€¼&quot;å¤§å°, ä»·å€¼å³å›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼, ç„¶ååœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆçº§åˆ—è¡¨, æ¯æ¬¡æ ¹æ®ç”¨æˆ·è®¾å®šå…è®¸çš„æ”¶é›†åœé¡¿æ—¶é—´(ä½¿ç”¨å‚æ•°-XXï¼šMaxGCPauseMillisæŒ‡å®š, é»˜è®¤å€¼æ˜¯200æ¯«ç§’), ä¼˜å…ˆå¤„ç†å›æ”¶ä»·å€¼æ”¶ç›Šæœ€å¤§çš„é‚£äº›Region, è¿™ä¹Ÿå°±æ˜¯&quot;Garbage First&quot;åå­—çš„ç”±æ¥ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´, ä»¥åŠå…·æœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼, ä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚</p><h4 id="g1æ”¶é›†å™¨regionåˆ†åŒºç¤ºæ„å›¾" tabindex="-1"><a class="header-anchor" href="#g1æ”¶é›†å™¨regionåˆ†åŒºç¤ºæ„å›¾" aria-hidden="true">#</a> G1æ”¶é›†å™¨Regionåˆ†åŒºç¤ºæ„å›¾</h4><figure><img src="/assets/202110021758946-68dbf19b.png" alt="G1æ”¶é›†å™¨Regionåˆ†åŒºç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>G1æ”¶é›†å™¨Regionåˆ†åŒºç¤ºæ„å›¾</figcaption></figure><h4 id="g1å°†å †å†…å­˜-åŒ–æ•´ä¸ºé›¶-çš„-è§£é¢˜æ€è·¯-é‡åˆ°çš„éš¾é¢˜" tabindex="-1"><a class="header-anchor" href="#g1å°†å †å†…å­˜-åŒ–æ•´ä¸ºé›¶-çš„-è§£é¢˜æ€è·¯-é‡åˆ°çš„éš¾é¢˜" aria-hidden="true">#</a> G1å°†å †å†…å­˜&quot;åŒ–æ•´ä¸ºé›¶&quot;çš„&quot;è§£é¢˜æ€è·¯&quot;, é‡åˆ°çš„éš¾é¢˜</h4><p>ä»2004å¹´Sunå®éªŒå®¤å‘è¡¨ç¬¬ä¸€ç¯‡å…³äºG1çš„è®ºæ–‡åä¸€ç›´æ‹–åˆ°2012å¹´4æœˆJDK 7 Update 4å‘å¸ƒ, ç”¨å°†è¿‘10å¹´æ—¶é—´æ‰å€’è…¾å‡ºèƒ½å¤Ÿå•†ç”¨çš„G1æ”¶é›†å™¨æ¥ã€‚G1æ”¶é›†å™¨è‡³å°‘æœ‰(ä¸é™äº)ä»¥ä¸‹è¿™äº›å…³é”®çš„ç»†èŠ‚é—®é¢˜éœ€è¦å¦¥å–„è§£å†³ï¼š</p><p><strong>1ã€å°†Javaå †åˆ†æˆå¤šä¸ªç‹¬ç«‹Regionå, Regioné‡Œé¢å­˜åœ¨çš„è·¨Regionå¼•ç”¨å¯¹è±¡å¦‚ä½•è§£å†³ï¼Ÿ</strong></p><p>ä½¿ç”¨è®°å¿†é›†é¿å…å…¨å †ä½œä¸ºGC Rootsæ‰«æ, ä½†åœ¨G1æ”¶é›†å™¨ä¸Šè®°å¿†é›†çš„åº”ç”¨å¤æ‚å¾ˆå¤šã€‚</p><p>å®ƒçš„æ¯ä¸ªRegionéƒ½ç»´æŠ¤æœ‰è‡ªå·±çš„è®°å¿†é›†, è¿™äº›è®°å¿†é›†ä¼šè®°å½•ä¸‹åˆ«çš„RegionæŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆ, å¹¶æ ‡è®°è¿™äº›æŒ‡é’ˆåˆ†åˆ«åœ¨å“ªäº›å¡é¡µçš„èŒƒå›´ä¹‹å†…ã€‚</p><p>G1çš„è®°å¿†é›†åœ¨å­˜å‚¨ç»“æ„çš„æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>å“ˆå¸Œè¡¨</strong>, <strong>Keyæ˜¯åˆ«çš„Regionçš„èµ·å§‹åœ°å€, Valueæ˜¯ä¸€ä¸ªé›†åˆ, é‡Œé¢å­˜å‚¨çš„å…ƒç´ æ˜¯å¡è¡¨çš„ç´¢å¼•å·</strong>ã€‚è¿™ ç§&quot;åŒå‘&quot;çš„å¡è¡¨ç»“æ„(å¡è¡¨æ˜¯&quot;æˆ‘æŒ‡å‘è°&quot;, è¿™ç§ç»“æ„è¿˜è®°å½•äº†&quot;è°æŒ‡å‘æˆ‘&quot;)æ¯”åŸæ¥çš„å¡è¡¨å®ç°èµ·æ¥æ›´å¤æ‚, åŒæ—¶ç”±äºRegionæ•°é‡æ¯”ä¼ ç»Ÿæ”¶é›†å™¨çš„åˆ†ä»£æ•°é‡æ˜æ˜¾è¦å¤šå¾—å¤š, å› æ­¤<strong>G1æ”¶é›†å™¨è¦æ¯”å…¶ä»–çš„ä¼ ç»Ÿåƒåœ¾æ”¶é›†å™¨æœ‰ç€æ›´é«˜çš„å†…å­˜å ç”¨è´Ÿæ‹…</strong>ã€‚</p><p>æ ¹æ®ç»éªŒ, <strong>G1è‡³å°‘è¦è€—è´¹å¤§çº¦ç›¸å½“äºJavaå †å®¹é‡10%è‡³20%çš„é¢å¤–å†…å­˜æ¥ç»´æŒæ”¶é›†å™¨å·¥ä½œ</strong>ã€‚</p><p><strong>2ã€åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå¦‚ä½•ä¿è¯æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹äº’ä¸å¹²æ‰°åœ°è¿è¡Œï¼Ÿ</strong></p><p><strong>é¦–å…ˆè¦è§£å†³çš„æ˜¯ç”¨æˆ·çº¿ç¨‹æ”¹å˜å¯¹è±¡å¼•ç”¨å…³ç³»æ—¶, å¿…é¡»ä¿è¯å…¶ä¸èƒ½æ‰“ç ´åŸæœ¬çš„å¯¹è±¡å›¾ç»“æ„, å¯¼è‡´æ ‡è®°ç»“æœå‡ºç°é”™è¯¯ã€‚</strong></p><p>è§£å†³åŠæ³•ï¼š</p><p>CMSæ”¶é›†å™¨é‡‡ç”¨å¢é‡æ›´æ–°ç®—æ³•å®ç°, è€ŒG1æ”¶é›†å™¨åˆ™æ˜¯é€šè¿‡åŸå§‹å¿«ç…§(SATB)ç®—æ³•æ¥å®ç°çš„ã€‚</p><p><strong>å›æ”¶è¿‡ç¨‹ä¸­æ–°åˆ›å»ºå¯¹è±¡çš„å†…å­˜åˆ†é…ä¸Š, ç¨‹åºè¦ç»§ç»­è¿è¡Œä¼šæŒç»­åˆ›å»ºæ–°å¯¹è±¡ã€‚</strong></p><p>è§£å†³åŠæ³•ï¼š</p><p>G1ä¸ºæ¯ä¸€ä¸ªRegionè®¾è®¡äº†ä¸¤ä¸ªåä¸ºTAMS(Top at Mark Start)çš„æŒ‡é’ˆ, æŠŠRegionä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´åˆ’åˆ†å‡ºæ¥ç”¨äºå¹¶å‘å›æ”¶è¿‡ç¨‹ä¸­çš„æ–°å¯¹è±¡åˆ†é…, å¹¶å‘å›æ”¶æ—¶æ–°åˆ†é…çš„å¯¹è±¡åœ°å€éƒ½å¿…é¡»è¦åœ¨è¿™ä¸¤ä¸ªæŒ‡é’ˆä½ç½®ä»¥ä¸Šã€‚G1æ”¶é›†å™¨é»˜è®¤åœ¨è¿™ä¸ªåœ°å€ä»¥ä¸Šçš„å¯¹è±¡æ˜¯è¢«éšå¼æ ‡è®°è¿‡çš„, å³é»˜è®¤å®ƒä»¬æ˜¯å­˜æ´»çš„, ä¸çº³å…¥å›æ”¶èŒƒå›´ã€‚ä¸CMSä¸­çš„&quot;Concurrent Mode Failure&quot;å¤±è´¥ä¼šå¯¼è‡´Full GCç±»ä¼¼, å¦‚æœå†…å­˜å›æ”¶çš„é€Ÿåº¦èµ¶ä¸ä¸Šå†…å­˜åˆ†é…çš„é€Ÿåº¦, <strong>G1æ”¶é›†å™¨ä¹Ÿè¦è¢«è¿«å†»ç»“ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œ, å¯¼è‡´Full GCè€Œäº§ç”Ÿé•¿æ—¶é—´&quot;Stop The World&quot;</strong>ã€‚</p><p><strong>3ã€æ€æ ·å»ºç«‹èµ·å¯é çš„åœé¡¿é¢„æµ‹æ¨¡å‹ï¼Ÿ</strong></p><p>ç”¨æˆ·é€šè¿‡ <code>-XXï¼šMaxGCPauseMillis</code> å‚æ•°æŒ‡å®šçš„åœé¡¿æ—¶é—´åªæ„å‘³ç€åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰çš„æœŸæœ›å€¼, ä½†G1æ”¶é›†å™¨è¦æ€ä¹ˆåšæ‰èƒ½æ»¡è¶³ç”¨æˆ·çš„æœŸæœ›å‘¢ï¼Ÿ</p><p>G1æ”¶é›†å™¨çš„åœé¡¿é¢„æµ‹æ¨¡å‹æ˜¯ä»¥<strong>è¡°å‡å‡å€¼</strong>(Decaying Average)ä¸ºç†è®ºåŸºç¡€æ¥å®ç°çš„ã€‚</p><p>åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­, G1æ”¶é›†å™¨ä¼šè®°å½•æ¯ä¸ªRegionçš„å›æ”¶è€—æ—¶ã€æ¯ä¸ªRegionè®°å¿†é›†é‡Œçš„è„å¡æ•°é‡ç­‰å„ä¸ªå¯æµ‹é‡çš„æ­¥éª¤èŠ±è´¹çš„æˆæœ¬, å¹¶åˆ†æå¾—å‡ºå¹³å‡å€¼ã€æ ‡å‡†åå·®ã€ç½®ä¿¡åº¦ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚è¿™é‡Œå¼ºè°ƒçš„&quot;è¡°å‡å¹³å‡å€¼&quot;æ˜¯æŒ‡å®ƒä¼šæ¯”æ™®é€šçš„å¹³å‡å€¼æ›´å®¹æ˜“å—åˆ°æ–°æ•°æ®çš„å½±å“, å¹³å‡å€¼ä»£è¡¨æ•´ä½“å¹³å‡çŠ¶æ€, ä½†è¡°å‡å¹³å‡å€¼æ›´å‡†ç¡®åœ°ä»£è¡¨&quot;æœ€è¿‘çš„&quot;å¹³å‡çŠ¶æ€ã€‚</p><p>æ¢å¥è¯è¯´, <strong>Regionçš„ç»Ÿè®¡çŠ¶æ€è¶Šæ–°è¶Šèƒ½å†³å®šå…¶å›æ”¶çš„ä»·å€¼</strong>ã€‚ç„¶åé€šè¿‡è¿™äº›ä¿¡æ¯é¢„æµ‹ç°åœ¨å¼€å§‹å›æ”¶çš„è¯, <strong>ç”±å“ªäº›Regionç»„æˆå›æ”¶é›†æ‰å¯ä»¥åœ¨ä¸è¶…è¿‡æœŸæœ›åœé¡¿æ—¶é—´çš„çº¦æŸä¸‹è·å¾—æœ€é«˜çš„æ”¶ç›Š</strong>ã€‚</p><h4 id="g1çš„è¿ä½œè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#g1çš„è¿ä½œè¿‡ç¨‹" aria-hidden="true">#</a> G1çš„è¿ä½œè¿‡ç¨‹</h4><p>å¦‚æœæˆ‘ä»¬ä¸å»è®¡ç®—ç”¨æˆ·çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­çš„åŠ¨ä½œ(å¦‚ä½¿ç”¨å†™å±éšœç»´æŠ¤è®°å¿†é›†çš„æ“ä½œ), G1æ”¶é›†å™¨è¿ä½œè¿‡ç¨‹å¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>åˆå§‹æ ‡è®°(Initial Marking)</strong>ï¼š<strong>ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡, å¹¶ä¸”ä¿®æ”¹TAMSæŒ‡é’ˆçš„å€¼, è®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·çº¿ç¨‹å¹¶å‘è¿è¡Œæ—¶, èƒ½æ­£ç¡®åœ°åœ¨å¯ç”¨çš„Regionä¸­åˆ†é…æ–°å¯¹è±¡</strong>ã€‚è¿™ä¸ªé˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹, ä½†è€—æ—¶å¾ˆçŸ­, è€Œä¸”æ˜¯å€Ÿç”¨è¿›è¡ŒMinor GCçš„æ—¶å€™åŒæ­¥å®Œæˆçš„, æ‰€ä»¥G1æ”¶é›†å™¨åœ¨è¿™ä¸ªé˜¶æ®µå®é™…å¹¶æ²¡æœ‰é¢å¤–çš„åœé¡¿ã€‚</li><li><strong>å¹¶å‘æ ‡è®°(Concurrent Marking)</strong>ï¼š<strong>ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æ, é€’å½’æ‰«ææ•´ä¸ªå †é‡Œçš„å¯¹è±¡å›¾, æ‰¾å‡ºè¦å›æ”¶çš„å¯¹è±¡</strong>ã€‚è¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿, ä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚å½“å¯¹è±¡å›¾æ‰«æå®Œæˆä»¥å, è¿˜è¦é‡æ–°å¤„ç†SATBè®°å½•ä¸‹çš„åœ¨å¹¶å‘æ—¶æœ‰å¼•ç”¨å˜åŠ¨çš„å¯¹è±¡ã€‚</li><li><strong>æœ€ç»ˆæ ‡è®°(Final Marking)</strong>ï¼š<strong>å¯¹ç”¨æˆ·çº¿ç¨‹åšå¦ä¸€ä¸ªçŸ­æš‚çš„æš‚åœ, ç”¨äºå¤„ç†å¹¶å‘é˜¶æ®µç»“æŸåä»é—ç•™ä¸‹æ¥çš„æœ€åé‚£å°‘é‡çš„SATBè®°å½•</strong>ã€‚</li><li><strong>ç­›é€‰å›æ”¶(Live Data Counting and Evacuation)</strong>ï¼š**è´Ÿè´£æ›´æ–°Regionçš„ç»Ÿè®¡æ•°æ®, å¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åº, æ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„åœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’, å¯ä»¥è‡ªç”±é€‰æ‹©ä»»æ„å¤šä¸ªRegionæ„æˆå›æ”¶é›†, ç„¶åæŠŠå†³å®šå›æ”¶çš„é‚£ä¸€éƒ¨åˆ†Regionçš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°ç©ºçš„Regionä¸­, å†æ¸…ç†æ‰æ•´ä¸ªæ—§Regionçš„å…¨éƒ¨ç©ºé—´ã€‚**è¿™é‡Œçš„æ“ä½œæ¶‰åŠå­˜æ´»å¯¹è±¡çš„ç§»åŠ¨, æ˜¯å¿…é¡»æš‚åœç”¨æˆ·çº¿ç¨‹, ç”±å¤šæ¡æ”¶é›†å™¨çº¿ç¨‹å¹¶è¡Œå®Œæˆçš„ã€‚</li></ol><p>G1æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾ï¼š</p><figure><img src="/assets/202110021813564-419000a1.png" alt="G1æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾" tabindex="0" loading="lazy"><figcaption>G1æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</figcaption></figure><h2 id="cmså’Œg1çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#cmså’Œg1çš„åŒºåˆ«" aria-hidden="true">#</a> *CMSå’ŒG1çš„åŒºåˆ«</h2><h3 id="åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#åŒºåˆ«" aria-hidden="true">#</a> åŒºåˆ«</h3><p><strong>åŒºåˆ«ä¸€ï¼š ä½¿ç”¨èŒƒå›´ä¸ä¸€æ ·</strong></p><p>CMSæ”¶é›†å™¨æ˜¯è€å¹´ä»£çš„æ”¶é›†å™¨, å¯ä»¥é…åˆæ–°ç”Ÿä»£çš„Serialå’ŒParNewæ”¶é›†å™¨ä¸€èµ·ä½¿ç”¨</p><p>G1æ”¶é›†å™¨æ”¶é›†èŒƒå›´æ˜¯è€å¹´ä»£å’Œæ–°ç”Ÿä»£ã€‚ä¸éœ€è¦ç»“åˆå…¶ä»–æ”¶é›†å™¨ä½¿ç”¨</p><p><strong>åŒºåˆ«äºŒï¼š STWçš„æ—¶é—´</strong></p><p>CMSæ”¶é›†å™¨ä»¥æœ€å°çš„åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚</p><p>G1æ”¶é›†å™¨å¯é¢„æµ‹åƒåœ¾å›æ”¶çš„åœé¡¿æ—¶é—´(å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹)</p><p><strong>åŒºåˆ«ä¸‰ï¼š åƒåœ¾ç¢ç‰‡</strong></p><p>CMSæ”¶é›†å™¨æ˜¯ä½¿ç”¨&quot;æ ‡è®°-æ¸…é™¤&quot;ç®—æ³•è¿›è¡Œçš„åƒåœ¾å›æ”¶, å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡</p><p>G1æ”¶é›†å™¨ä½¿ç”¨çš„æ˜¯&quot;æ ‡è®°-æ•´ç†&quot;ç®—æ³•, è¿›è¡Œäº†ç©ºé—´æ•´åˆ, é™ä½äº†å†…å­˜ç©ºé—´ç¢ç‰‡ã€‚</p><p><strong>åŒºåˆ«å››ï¼š åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸ä¸€æ ·</strong></p><p>CMSæ”¶é›†å™¨ G1æ”¶é›†å™¨</p><ol><li>åˆå§‹æ ‡è®° 1. åˆå§‹æ ‡è®°</li><li>å¹¶å‘æ ‡è®° 2. å¹¶å‘æ ‡è®°</li><li>é‡æ–°æ ‡è®° 3. æœ€ç»ˆæ ‡è®°</li><li>å¹¶å‘æ¸…é™¤ 4. ç­›é€‰å›æ”¶</li></ol><h3 id="g1çš„ä¼˜åŠ£åŠ¿åˆ†æ" tabindex="-1"><a class="header-anchor" href="#g1çš„ä¼˜åŠ£åŠ¿åˆ†æ" aria-hidden="true">#</a> G1çš„ä¼˜åŠ£åŠ¿åˆ†æ</h3><p><strong>G1çš„ä¼˜åŠ¿</strong>ï¼š</p><p>1ã€æœ€å¤§åœé¡¿æ—¶é—´ã€åˆ†Regionçš„å†…å­˜å¸ƒå±€ã€æŒ‰æ”¶ç›ŠåŠ¨æ€ç¡®å®šå›æ”¶é›†è¿™äº›åˆ›æ–°æ€§è®¾è®¡å¸¦æ¥çš„ä¼˜åŠ¿</p><p>2ã€ç®—æ³•å±‚é¢çš„ä¼˜åŠ¿</p><p>ä¸CMSçš„&quot;æ ‡è®°-æ¸…é™¤&quot;ç®—æ³•ä¸åŒ, G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäº&quot;æ ‡è®°-æ•´ç†&quot;ç®—æ³•å®ç°çš„æ”¶é›†å™¨, ä½†ä»å±€éƒ¨(ä¸¤ä¸ªRegionä¹‹é—´)ä¸Šçœ‹åˆæ˜¯åŸºäº&quot;æ ‡è®°-å¤åˆ¶&quot;ç®—æ³•å®ç°, æ— è®ºå¦‚ä½•, è¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€<strong>G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡, åƒåœ¾æ”¶é›†å®Œæˆä¹‹åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜</strong>ã€‚</p><p>è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œ, åœ¨ç¨‹åºä¸ºå¤§å¯¹è±¡åˆ†é…å†…å­˜æ—¶ä¸å®¹æ˜“å› æ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡æ”¶é›†</p><p><strong>G1çš„å¼±åŠ¿</strong>ï¼š</p><p>åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­, G1æ— è®ºæ˜¯ä¸ºäº†åƒåœ¾æ”¶é›†äº§ç”Ÿçš„å†…å­˜å ç”¨(Footprint)è¿˜æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„é¢å¤–æ‰§è¡Œè´Ÿè½½(Overload)éƒ½è¦æ¯”CMSè¦é«˜ã€‚</p><blockquote><p><strong>å°±å†…å­˜å ç”¨æ¥è¯´</strong>, è™½ç„¶G1å’ŒCMSéƒ½ä½¿ç”¨å¡è¡¨æ¥å¤„ç†è·¨ä»£æŒ‡é’ˆ, ä½†G1çš„å¡è¡¨å®ç°æ›´ä¸ºå¤æ‚, è€Œä¸”å †ä¸­æ¯ä¸ªRegion, æ— è®ºæ‰®æ¼”çš„æ˜¯æ–°ç”Ÿä»£è¿˜æ˜¯è€å¹´ä»£è§’è‰², éƒ½å¿…é¡»æœ‰ä¸€ä»½å¡è¡¨, è¿™å¯¼è‡´G1çš„è®°å¿†é›†(å’Œå…¶ä»–å†…å­˜æ¶ˆè€—)å¯èƒ½ä¼šå æ•´ä¸ªå †å®¹é‡çš„20%ä¹ƒè‡³æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼›ç›¸æ¯”èµ·æ¥CMSçš„å¡è¡¨å°±ç›¸å½“ç®€å•, åªæœ‰å”¯ä¸€ä¸€ä»½, è€Œä¸”åªéœ€è¦å¤„ç†è€å¹´ä»£åˆ°æ–°ç”Ÿä»£çš„å¼•ç”¨, åè¿‡æ¥åˆ™ä¸éœ€è¦, ç”±äºæ–°ç”Ÿä»£çš„å¯¹è±¡å…·æœ‰æœç”Ÿå¤•ç­çš„ä¸ç¨³å®šæ€§, å¼•ç”¨å˜åŒ–é¢‘ç¹, èƒ½çœä¸‹è¿™ä¸ªåŒºåŸŸçš„ç»´æŠ¤å¼€é”€æ˜¯å¾ˆåˆ’ç®—çš„ã€‚</p><p><strong>åœ¨æ‰§è¡Œè´Ÿè½½çš„è§’åº¦ä¸Š</strong>, åŒæ ·ç”±äºä¸¤ä¸ªæ”¶é›†å™¨å„è‡ªçš„ç»†èŠ‚å®ç°ç‰¹ç‚¹å¯¼è‡´äº†ç”¨æˆ·ç¨‹åºè¿è¡Œæ—¶çš„è´Ÿè½½ä¼šæœ‰ä¸åŒ, è­¬å¦‚å®ƒä»¬éƒ½ä½¿ç”¨åˆ°å†™å±éšœ, CMSç”¨å†™åå±éšœæ¥æ›´æ–°ç»´æŠ¤å¡è¡¨ï¼›è€ŒG1é™¤äº†ä½¿ç”¨å†™åå±éšœæ¥è¿›è¡ŒåŒæ ·çš„(ç”±äºG1çš„å¡è¡¨ç»“æ„å¤æ‚, å…¶å®æ˜¯æ›´çƒ¦ççš„)å¡è¡¨ç»´æŠ¤æ“ä½œå¤–, ä¸ºäº†å®ç°åŸå§‹å¿«ç…§æœç´¢(SATB)ç®—æ³•, è¿˜éœ€è¦ä½¿ç”¨å†™å‰å±éšœæ¥è·Ÿè¸ªå¹¶å‘æ—¶çš„æŒ‡é’ˆå˜åŒ–æƒ…å†µã€‚ç›¸æ¯”èµ·å¢é‡æ›´æ–°ç®—æ³•, åŸå§‹å¿«ç…§æœç´¢èƒ½å¤Ÿå‡å°‘å¹¶å‘æ ‡è®°å’Œé‡æ–°æ ‡è®°é˜¶æ®µçš„æ¶ˆè€—, é¿å…CMSé‚£æ ·åœ¨æœ€ç»ˆæ ‡è®°é˜¶æ®µåœé¡¿æ—¶é—´è¿‡é•¿çš„ç¼ºç‚¹, ä½†æ˜¯åœ¨ç”¨æˆ·ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç¡®å®ä¼šäº§ç”Ÿç”±è·Ÿè¸ªå¼•ç”¨å˜åŒ–å¸¦æ¥çš„é¢å¤–è´Ÿæ‹…ã€‚ç”±äºG1å¯¹å†™å±éšœçš„å¤æ‚æ“ä½œè¦æ¯”CMSæ¶ˆè€—æ›´å¤šçš„è¿ç®—èµ„æº, æ‰€ä»¥CMSçš„å†™å±éšœå®ç°æ˜¯ç›´æ¥çš„åŒæ­¥æ“ä½œ, è€ŒG1å°±ä¸å¾—ä¸å°†å…¶å®ç°ä¸ºç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„, æŠŠå†™å‰å±éšœå’Œå†™åå±éšœä¸­è¦åšçš„äº‹æƒ…éƒ½æ”¾åˆ°é˜Ÿåˆ—é‡Œ, ç„¶åå†å¼‚æ­¥å¤„ç†ã€‚</p></blockquote><p><strong>æ€»è§ˆ</strong></p><table><thead><tr><th style="text-align:left;"></th><th>CMS</th><th>G1</th></tr></thead><tbody><tr><td style="text-align:left;">JDKç‰ˆæœ¬</td><td></td><td></td></tr><tr><td style="text-align:left;">å›æ”¶ç®—æ³•</td><td>æ ‡è®°â€”æ¸…é™¤</td><td>æ ‡è®°â€”æ•´ç†(æ ‡è®°â€”å¤åˆ¶)</td></tr><tr><td style="text-align:left;">è¿è¡Œç¯å¢ƒ</td><td>é’ˆå¯¹70Gä»¥å†…çš„å †å†…å­˜</td><td>å¯é’ˆå¯¹å¥½å‡ ç™¾Gçš„å¤§å†…å­˜</td></tr><tr><td style="text-align:left;">å›æ”¶åŒºåŸŸ</td><td>è€å¹´ä»£</td><td>æ–°ç”Ÿä»£å’Œè€å¹´ä»£</td></tr><tr><td style="text-align:left;">å†…å­˜å¸ƒå±€</td><td>ä¼ ç»Ÿè¿ç»­çš„æ–°ç”Ÿä»£å’Œè€å¹´ä»£åŒºåŸŸ</td><td>Region(å°†æ–°ç”Ÿä»£å’Œè€å¹´ä»£åˆ‡åˆ†æˆRegion, é»˜è®¤ä¸€ä¸ªRegion 1 M,é»˜è®¤2048å—)<br>MIN_REGION_SIZEï¼šå…è®¸çš„æœ€å°çš„REGION_SIZE, å³1M, ä¸å¯èƒ½æ¯”1Mè¿˜å°ï¼›<br>MAX_REGION_SIZEï¼šå…è®¸çš„æœ€å¤§çš„REGION_SIZE, å³32M, ä¸å¯èƒ½æ¯”32Mæ›´å¤§ï¼›<br>é™åˆ¶æœ€å¤§REGION_SIZEæ˜¯ä¸ºäº†è€ƒè™‘GCæ—¶çš„æ¸…ç†æ•ˆæœï¼›</td></tr><tr><td style="text-align:left;">æµ®åŠ¨åƒåœ¾</td><td>æ˜¯</td><td>å¦</td></tr><tr><td style="text-align:left;">å†…å­˜ç¢ç‰‡</td><td>æ˜¯</td><td>å¦</td></tr><tr><td style="text-align:left;">å…¨å †æ‰«æ</td><td>æ˜¯</td><td>å¦</td></tr><tr><td style="text-align:left;">å›æ”¶æ—¶é—´å¯æ§</td><td>å¦</td><td>æ˜¯</td></tr><tr><td style="text-align:left;">å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„</td><td></td><td></td></tr><tr><td style="text-align:left;">ç©ºé—´åŠ¨æ€è°ƒæ•´</td><td>å¦</td><td>æ˜¯(æ–°ç”Ÿä»£5%-60%åŠ¨æ€è°ƒæ•´, ä¸€èˆ¬ä¸éœ€æ±‚æŒ‡å®š)</td></tr><tr><td style="text-align:left;">è°ƒä¼˜å‚æ•°</td><td>å¤š(è¿‘ç™¾ä¸ª)</td><td>å°‘(åå‡ ä¸ª)</td></tr></tbody></table><h2 id="ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨" aria-hidden="true">#</a> ä½å»¶è¿Ÿçš„åƒåœ¾æ”¶é›†å™¨</h2><p>åƒåœ¾æ”¶é›†å™¨çš„ä¸‰é¡¹é‡è¦æŒ‡æ ‡ï¼š<strong>å†…å­˜å ç”¨ã€ååé‡ã€å»¶è¿Ÿ</strong>ã€‚</p><p><strong>å†…å­˜çš„æ‰©å¤§, å¯¹ä½å»¶è¿Ÿåè€Œä¼šå¸¦æ¥è´Ÿé¢æ•ˆæœ</strong>ï¼šè™šæ‹Ÿæœºè¦å›æ”¶å®Œæ•´çš„1TBçš„å †å†…å­˜, è¦æ¯”å›æ”¶1GBçš„å †å†…å­˜è€—è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><blockquote><p>CMSå’ŒG1åˆ†åˆ«ä½¿ç”¨å¢é‡æ›´æ–°å’ŒåŸå§‹å¿«ç…§æŠ€æœ¯, å®ç°äº†æ ‡è®°é˜¶æ®µçš„å¹¶å‘, ä¸ä¼šå› ç®¡ç†çš„å †å†…å­˜å˜å¤§, è¦æ ‡è®°çš„å¯¹è±¡å˜å¤šè€Œå¯¼è‡´åœé¡¿æ—¶é—´éšä¹‹å¢é•¿ã€‚ä½†æ˜¯å¯¹äºæ ‡è®°é˜¶æ®µä¹‹åçš„å¤„ç†, ä»æœªå¾—åˆ°å¦¥å–„è§£å†³ã€‚</p><p>CMSä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•, è™½ç„¶é¿å…äº†æ•´ç†é˜¶æ®µæ”¶é›†å™¨å¸¦æ¥çš„åœé¡¿, ä½†æ˜¯æ¸…é™¤ç®—æ³•ä¸è®ºå¦‚ä½•ä¼˜åŒ–æ”¹è¿›, åœ¨è®¾è®¡åŸç†ä¸Šé¿å…ä¸äº†ç©ºé—´ç¢ç‰‡çš„äº§ç”Ÿ, éšç€ç©ºé—´ç¢ç‰‡ä¸æ–­æ·¤ç§¯æœ€ç»ˆä¾ç„¶é€ƒä¸è¿‡&quot;Stop TheWorld&quot;çš„å‘½è¿ã€‚</p><p>G1è™½ç„¶å¯ä»¥æŒ‰æ›´å°çš„ç²’åº¦è¿›è¡Œå›æ”¶, ä»è€ŒæŠ‘åˆ¶æ•´ç†é˜¶æ®µå‡ºç°æ—¶é—´è¿‡é•¿çš„åœé¡¿, ä½†æ¯•ç«Ÿä¹Ÿè¿˜æ˜¯è¦æš‚åœçš„ã€‚</p></blockquote><h3 id="shenandoahæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#shenandoahæ”¶é›†å™¨" aria-hidden="true">#</a> Shenandoahæ”¶é›†å™¨</h3><p>Shenandoahæ˜¯ä¸€æ¬¾åªæœ‰OpenJDKæ‰ä¼šåŒ…å«, è€ŒOracleJDKé‡Œåè€Œä¸å­˜åœ¨çš„æ”¶é›†å™¨ã€‚</p><p>ç›®æ ‡æ˜¯å®ç°ä¸€ç§èƒ½åœ¨ä»»ä½•å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„åƒåœ¾æ”¶é›†å™¨, è¯¥ç›®æ ‡æ„å‘³ç€ç›¸æ¯”CMSå’ŒG1, Shenandoahä¸ä»…è¦è¿›è¡Œå¹¶å‘çš„åƒåœ¾æ ‡è®°, è¿˜è¦å¹¶å‘åœ°è¿›è¡Œå¯¹è±¡æ¸…ç†åçš„æ•´ç†åŠ¨ä½œã€‚</p><h3 id="zgcæ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#zgcæ”¶é›†å™¨" aria-hidden="true">#</a> ZGCæ”¶é›†å™¨</h3><blockquote><p>ZGC(&quot;Z&quot;å¹¶éä»€ä¹ˆä¸“ä¸šåè¯çš„ç¼©å†™, è¿™æ¬¾æ”¶é›†å™¨çš„åå­—å°±å«ä½œZ Garbage Collector)æ˜¯ä¸€æ¬¾åœ¨JDK 11ä¸­æ–°åŠ å…¥çš„å…·æœ‰å®éªŒæ€§è´¨[1]çš„ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨, æ˜¯ç”±Oracleå…¬å¸ç ”å‘çš„ã€‚2018å¹´Oracleåˆ›å»ºäº†JEP 333å°†ZGCæäº¤ç»™OpenJDK, æ¨åŠ¨å…¶è¿›å…¥OpenJDK 11çš„å‘å¸ƒæ¸…å•ä¹‹ä¸­ã€‚</p></blockquote><p>ZGCå’ŒShenandoahçš„ç›®æ ‡æ˜¯é«˜åº¦ç›¸ä¼¼çš„, éƒ½å¸Œæœ›åœ¨<strong>å°½å¯èƒ½å¯¹ååé‡å½±å“ä¸å¤ªå¤§çš„å‰æä¸‹, å®ç°åœ¨ä»»æ„å †å†…å­˜å¤§å°ä¸‹éƒ½å¯ä»¥æŠŠåƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´é™åˆ¶åœ¨åæ¯«ç§’ä»¥å†…çš„ä½å»¶è¿Ÿ</strong>ã€‚</p><h2 id="å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨" aria-hidden="true">#</a> å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨ï¼Ÿ</h2><h3 id="ä¸»è¦å› ç´ " tabindex="-1"><a class="header-anchor" href="#ä¸»è¦å› ç´ " aria-hidden="true">#</a> ä¸»è¦å› ç´ </h3><ol><li>åº”ç”¨ç¨‹åºçš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ <ol><li>å¦‚æœæ˜¯æ•°æ®åˆ†æã€ç§‘å­¦è®¡ç®—ç±»çš„ä»»åŠ¡, ç›®æ ‡æ˜¯èƒ½å°½å¿«ç®—å‡ºç»“æœ, é‚£ååé‡å°±æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼›</li><li>å¦‚æœæ˜¯SLAåº”ç”¨, é‚£åœé¡¿æ—¶é—´ç›´æ¥å½±å“æœåŠ¡è´¨é‡, ä¸¥é‡çš„ç”šè‡³ä¼šå¯¼è‡´äº‹åŠ¡è¶…æ—¶, è¿™æ ·å»¶è¿Ÿå°±æ˜¯ä¸»è¦å…³æ³¨ç‚¹ï¼›</li><li>å¦‚æœæ˜¯å®¢æˆ·ç«¯åº”ç”¨æˆ–è€…åµŒå…¥å¼åº”ç”¨, é‚£åƒåœ¾æ”¶é›†çš„å†…å­˜å ç”¨åˆ™æ˜¯ä¸å¯å¿½è§†çš„ã€‚</li></ol></li><li>è¿è¡Œåº”ç”¨çš„åŸºç¡€è®¾æ–½å¦‚ä½•ï¼Ÿ</li><li>ä½¿ç”¨JDKçš„å‘è¡Œå•†æ˜¯ä»€ä¹ˆï¼Ÿç‰ˆæœ¬å·æ˜¯å¤šå°‘ï¼Ÿ</li></ol><h3 id="å¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•é€‰æ‹©" aria-hidden="true">#</a> å¦‚ä½•é€‰æ‹©ï¼Ÿ</h3><blockquote><p>ä½¿ç”¨ParNew(æ ‡è®°å¤åˆ¶ã€å¹¶è¡Œã€ä½œç”¨äºæ–°ç”Ÿä»£) + CMSçš„åƒåœ¾æ”¶é›†å™¨(æ ‡è®°æ¸…é™¤ã€å¹¶è¡Œã€ä½œç”¨äºè€å¹´ä»£), è¿½æ±‚å“åº”é€Ÿåº¦ä¼˜å…ˆ, å…¶é€‚ç”¨äºå¤šCPUç¯å¢ƒçš„Serveræ¨¡å¼çš„äº’è”ç½‘æˆ–è€…B/Sä¸šåŠ¡ã€‚</p><p>å¦‚æœè¿½æ±‚ååé‡ä¼˜å…ˆ, åº”ç”¨åœ¨åå°è¿ç®—å¹¶ä¸éœ€è¦å¤ªå¤šäº¤äº’åœºæ™¯çš„, å¯é‡‡ç”¨Parallel(æ ‡è®°å¤åˆ¶ã€å¹¶è¡Œã€ä½œç”¨äºæ–°ç”Ÿä»£) + Parallel Old çš„åƒåœ¾æ”¶é›†å™¨(æ ‡è®°æ•´ç†ã€å¹¶è¡Œã€ä½œç”¨äºè€å¹´ä»£)</p></blockquote><p>å¦‚æœæ˜¯ç›´æ¥é¢å‘ç”¨æˆ·æä¾›æœåŠ¡çš„B/Sç³»ç»Ÿ, å»¶è¿Ÿæ—¶é—´æ˜¯ä¸»è¦å…³æ³¨ç‚¹ã€‚</p><ul><li>æœ‰å……è¶³çš„é¢„ç®—ä½†æ²¡æœ‰å¤ªå¤šè°ƒä¼˜ç»éªŒ, å¯ä»¥é€‰æ‹©å•†ä¸šæ€§è§£å†³æ–¹æ¡ˆ, Zing VMå¯ä»¥ä½¿ç”¨C4æ”¶é›†å™¨</li><li>èƒ½å¤ŸæŒæ§è½¯ç¡¬ä»¶å‹å·, ä½¿ç”¨è¾ƒæ–°çš„ç‰ˆæœ¬, åŒæ—¶åˆç‰¹åˆ«æ³¨é‡å»¶è¿Ÿ, é‚£ZGCå¾ˆå€¼å¾—å°è¯•</li><li>é—ç•™ç³»ç»Ÿ, è½¯ç¡¬ä»¶åŸºç¡€è®¾æ–½å’ŒJDKç‰ˆæœ¬éƒ½æ¯”è¾ƒè½å, å¯¹äºå¤§æ¦‚4GBåˆ°6GBä»¥ä¸‹çš„å †å†…å­˜, CMSä¸€èˆ¬èƒ½å¤„ç†å¾—æ¯”è¾ƒå¥½, è€Œå¯¹äºæ›´å¤§çš„å †å†…å­˜, å¯é‡ç‚¹è€ƒå¯Ÿä¸€ä¸‹G1ã€‚</li></ul><p>å¦‚æœæ˜¯é¢å‘è®¡ç®—, æ²¡æœ‰å¤ªå¤šäº¤äº’, æ³¨é‡é«˜ååé‡, å¯ä»¥ä½¿ç”¨Java8é»˜è®¤æä¾›çš„åƒåœ¾æ”¶é›†å™¨â€”â€”Parallel Scavengeæ”¶é›†å™¨å’ŒParallel Oldã€‚</p><h1 id="å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥" aria-hidden="true">#</a> å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h1><p>å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥(å³åƒåœ¾å›æ”¶è¿‡ç¨‹)</p><ul><li><strong>å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…</strong>ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹, å¯¹è±¡åœ¨æ–°ç”Ÿä»£EdenåŒºä¸­åˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶, è™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡Minor GCã€‚</li><li><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ã€‚å¤§å¯¹è±¡å°±æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„Javaå¯¹è±¡, æœ€å…¸å‹çš„å¤§å¯¹è±¡ä¾¿æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸², æˆ–è€…å…ƒç´ æ•°é‡å¾ˆåºå¤§çš„æ•°ç»„ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯é¿å…åœ¨EdenåŒºåŠä¸¤ä¸ªSurvivoråŒºä¹‹é—´æ¥å›å¤åˆ¶, äº§ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶æ“ä½œã€‚</li><li><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</strong>ã€‚ <ul><li>HotSpotè™šæ‹Ÿæœºä¸­å¤šæ•°æ”¶é›†å™¨éƒ½é‡‡ç”¨äº†åˆ†ä»£æ”¶é›†æ¥ç®¡ç†å †å†…å­˜, é‚£å†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½å†³ç­–å“ªäº›å­˜æ´»å¯¹è±¡åº”å½“æ”¾åœ¨æ–°ç”Ÿä»£, å“ªäº›å­˜æ´»å¯¹è±¡æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºåšåˆ°è¿™ç‚¹, è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„(Age)è®¡æ•°å™¨, å­˜å‚¨åœ¨å¯¹è±¡å¤´ä¸­(è¯¦è§ç¬¬2ç« )ã€‚å¯¹è±¡é€šå¸¸åœ¨EdenåŒºé‡Œè¯ç”Ÿ, å¦‚æœç»è¿‡ç¬¬ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´», å¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯, è¯¥å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ä¸­, å¹¶ä¸”å°†å…¶å¯¹è±¡ å¹´é¾„è®¾ä¸º1å²ã€‚å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡Minor GC, å¹´é¾„å°±å¢åŠ 1å², å½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦(é»˜è®¤ä¸º15), å°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼, å¯ä»¥é€šè¿‡å‚æ•°<code>-XXï¼šMaxTenuringThreshold</code>è®¾ç½®ã€‚</li></ul></li><li><strong>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong>ã€‚ <ul><li>ä¸ºäº†èƒ½æ›´å¥½åœ°é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜çŠ¶å†µ, HotSpotè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°<code>-XXï¼šMaxTenuringThreshold</code>æ‰èƒ½æ™‹å‡è€å¹´ä»£, å¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠ, å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£, æ— é¡»ç­‰åˆ°<code>-XXï¼šMaxTenuringThreshold</code>ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</li></ul></li><li><strong>ç©ºé—´åˆ†é…æ‹…ä¿</strong>ã€‚ <ul><li>åœ¨å‘ç”ŸMinor GCä¹‹å‰, è™šæ‹Ÿæœºå¿…é¡»å…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´, å¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹, é‚£è¿™ä¸€æ¬¡Minor GCå¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹, åˆ™è™šæ‹Ÿæœºä¼šå…ˆæŸ¥çœ‹<code>-XXï¼šHandlePromotionFailure</code>å‚æ•°çš„è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥(Handle Promotion Failure)ï¼›å¦‚æœå…è®¸, é‚£ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°, å¦‚æœå¤§äº, å°†å°è¯•è¿›è¡Œä¸€æ¬¡Minor GC, å°½ç®¡è¿™æ¬¡Minor GCæ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äº, æˆ–è€…<code>-XXï¼šHandlePromotionFailure</code>è®¾ç½®ä¸å…è®¸å†’é™©, é‚£è¿™æ—¶å°±è¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCã€‚</li></ul></li></ul><p>(å‚è€ƒï¼šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºç¬¬ä¸‰ç‰ˆçš„3.8èŠ‚)</p><p>å…³äºåƒåœ¾æ”¶é›†æœºåˆ¶çš„è¯¦ç»†å†…å®¹å¯å‚è€ƒï¼š<a href="https://www.cnblogs.com/hexinwei1/p/9525737.html" target="_blank" rel="noopener noreferrer">JVMåƒåœ¾å›æ”¶æœºåˆ¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h1 id="ç±»åŠ è½½è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½è¿‡ç¨‹" aria-hidden="true">#</a> ç±»åŠ è½½è¿‡ç¨‹</h1><p>ç³»ç»ŸåŠ è½½ Class ç±»å‹çš„æ–‡ä»¶ä¸»è¦ä¸‰æ­¥ï¼š<strong>åŠ è½½-&gt;è¿æ¥-&gt;åˆå§‹åŒ–</strong>ã€‚è¿æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥ï¼š<strong>éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ</strong>ã€‚</p><p>å¦‚ä¸‹å›¾ï¼š</p><figure><img src="/assets/20210701103844-728d61bd.png" alt="ç±»åŠ è½½è¿‡ç¨‹" tabindex="0" loading="lazy"><figcaption>ç±»åŠ è½½è¿‡ç¨‹</figcaption></figure><h2 id="åŠ è½½" tabindex="-1"><a class="header-anchor" href="#åŠ è½½" aria-hidden="true">#</a> åŠ è½½</h2><p>åœ¨åŠ è½½é˜¶æ®µ, JVMä¸»è¦å®Œæˆä¸‹é¢ä¸‰ä»¶äº‹æƒ…ï¼š</p><ol><li>é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ <code>Class</code> å¯¹è±¡, ä½œä¸ºæ–¹æ³•åŒºè¿™äº›æ•°æ®çš„è®¿é—®å…¥å£</li></ol><p>è™šæ‹Ÿæœºè§„èŒƒä¸Šé¢è¿™ 3 ç‚¹å¹¶ä¸å…·ä½“, å› æ­¤æ˜¯éå¸¸çµæ´»çš„ã€‚æ¯”å¦‚ï¼š&quot;é€šè¿‡å…¨ç±»åè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ&quot; å¹¶æ²¡æœ‰æŒ‡æ˜å…·ä½“ä»å“ªé‡Œè·å–ã€æ€æ ·è·å–ã€‚æ¯”å¦‚ï¼šæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯ä» <code>ZIP</code> åŒ…ä¸­è¯»å–(æ—¥åå‡ºç°çš„ <code>JAR</code>ã€<code>EAR</code>ã€<code>WAR</code> æ ¼å¼çš„åŸºç¡€)ã€å…¶ä»–æ–‡ä»¶ç”Ÿæˆ(å…¸å‹åº”ç”¨å°±æ˜¯ <code>JSP</code>)ç­‰ç­‰ã€‚</p><p><strong>ä¸€ä¸ªéæ•°ç»„ç±»çš„åŠ è½½é˜¶æ®µ(åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œ)æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µ, è¿™ä¸€æ­¥å¯ä»¥å»å®Œæˆ, è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»æ§åˆ¶å­—èŠ‚æµçš„è·å–æ–¹å¼(é‡å†™ä¸€ä¸ªç±»åŠ è½½å™¨çš„ <code>loadClass()</code> æ–¹æ³•)ã€‚æ•°ç»„ç±»å‹ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»º, å®ƒç”± Java è™šæ‹Ÿæœºç›´æ¥åˆ›å»ºã€‚</strong></p><p>åŠ è½½é˜¶æ®µå’Œè¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹æ˜¯äº¤å‰è¿›è¡Œçš„, åŠ è½½é˜¶æ®µå°šæœªç»“æŸ, è¿æ¥é˜¶æ®µå¯èƒ½å°±å·²ç»å¼€å§‹äº†ã€‚</p><blockquote><p>è¯´æ˜ï¼šé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ–¹å¼å±€éƒ¨å‚ä¸å¤–, å…¶ä½™åŠ¨ä½œéƒ½å®Œå…¨ç”±Javaè™šæ‹Ÿæœºæ¥ä¸»å¯¼æ§åˆ¶ã€‚</p></blockquote><h2 id="è¿æ¥" tabindex="-1"><a class="header-anchor" href="#è¿æ¥" aria-hidden="true">#</a> è¿æ¥</h2><h4 id="éªŒè¯" tabindex="-1"><a class="header-anchor" href="#éªŒè¯" aria-hidden="true">#</a> éªŒè¯</h4><h5 id="_1ã€æ–‡ä»¶æ ¼å¼éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_1ã€æ–‡ä»¶æ ¼å¼éªŒè¯" aria-hidden="true">#</a> 1ã€æ–‡ä»¶æ ¼å¼éªŒè¯</h5><p>ä¸»è¦éªŒè¯å†…å®¹ï¼š</p><ul><li>æ˜¯å¦ä»¥é­”æ•°<code>0xCAFEBABE</code>å¼€å¤´ã€‚</li><li>ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰Javaè™šæ‹Ÿæœºæ¥å—èŒƒå›´ä¹‹å†…ã€‚</li><li>å¸¸é‡æ± çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„å¸¸é‡ç±»å‹(æ£€æŸ¥å¸¸é‡tagæ ‡å¿—)ã€‚</li><li>æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ã€‚</li><li><code>CONSTANT_Utf8_info</code>å‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆUTF-8ç¼–ç çš„æ•°æ®ã€‚</li><li>Classæ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†åŠæ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„æˆ–é™„åŠ çš„å…¶ä»–ä¿¡æ¯ã€‚</li><li>â€¦â€¦</li></ul><p>è¯¥éªŒè¯é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯<strong>ä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…, æ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ªJavaç±»å‹ä¿¡æ¯çš„è¦æ±‚</strong>ã€‚è¿™é˜¶æ®µçš„éªŒè¯æ˜¯åŸºäºäºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œçš„, åªæœ‰é€šè¿‡äº†è¿™ä¸ªé˜¶æ®µçš„éªŒè¯ä¹‹å, è¿™æ®µå­—èŠ‚æµæ‰è¢«å…è®¸è¿›å…¥Javaè™šæ‹Ÿæœºå†…å­˜çš„æ–¹æ³•åŒºä¸­è¿›è¡Œå­˜å‚¨, æ‰€ä»¥åé¢çš„ä¸‰ä¸ªéªŒè¯é˜¶æ®µå…¨éƒ¨æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„ä¸Šè¿›è¡Œçš„, ä¸ä¼šå†ç›´æ¥è¯»å–ã€æ“ä½œå­—èŠ‚æµäº†ã€‚</p><h5 id="_2ã€å…ƒæ•°æ®éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2ã€å…ƒæ•°æ®éªŒè¯" aria-hidden="true">#</a> 2ã€å…ƒæ•°æ®éªŒè¯</h5><p>è¿™ä¸ªé˜¶æ®µæ˜¯<strong>å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æ</strong>ã€‚ä¸»è¦éªŒè¯å†…å®¹ï¼š</p><ul><li>è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»(é™¤äº†java.lang.Objectä¹‹å¤–, æ‰€æœ‰çš„ç±»éƒ½åº”å½“æœ‰çˆ¶ç±»)ã€‚</li><li>è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»(è¢«finalä¿®é¥°çš„ç±»)ã€‚</li><li>å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±», æ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³•ã€‚</li><li>ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾(ä¾‹å¦‚è¦†ç›–äº†çˆ¶ç±»çš„finalå­—æ®µ, æˆ–è€…å‡ºç°ä¸ç¬¦åˆè§„åˆ™çš„æ–¹æ³•é‡è½½, ä¾‹å¦‚æ–¹æ³•å‚æ•°éƒ½ä¸€è‡´, ä½†è¿”å›å€¼ç±»å‹å´ä¸åŒç­‰)ã€‚</li></ul><h5 id="_3ã€å­—èŠ‚ç éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_3ã€å­—èŠ‚ç éªŒè¯" aria-hidden="true">#</a> 3ã€å­—èŠ‚ç éªŒè¯</h5><p>ç¬¬ä¸‰é˜¶æ®µæ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µ, ä¸»è¦ç›®çš„æ˜¯<strong>é€šè¿‡æ•°æ®æµåˆ†æå’Œæ§åˆ¶æµåˆ†æ, ç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„</strong>ã€‚ä¸»è¦éªŒè¯å†…å®¹ï¼š</p><ul><li>ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½èƒ½é…åˆå·¥ä½œ, ä¾‹å¦‚ä¸ä¼šå‡ºç°ç±»ä¼¼äº&quot;åœ¨æ“ä½œæ ˆæ”¾ç½®äº†ä¸€ä¸ªintç±»å‹çš„æ•°æ®, ä½¿ç”¨æ—¶å´æŒ‰longç±»å‹æ¥åŠ è½½å…¥æœ¬åœ°å˜é‡è¡¨ä¸­&quot;è¿™æ ·çš„æƒ…å†µã€‚</li><li>ä¿è¯ä»»ä½•è·³è½¬æŒ‡ä»¤éƒ½ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Šã€‚</li><li>ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ€»æ˜¯æœ‰æ•ˆçš„, ä¾‹å¦‚å¯ä»¥æŠŠä¸€ä¸ªå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹, è¿™æ˜¯å®‰å…¨çš„, ä½†æ˜¯æŠŠçˆ¶ç±»å¯¹è±¡èµ‹å€¼ç»™å­ç±»æ•°æ®ç±»å‹, ç”šè‡³æŠŠå¯¹è±¡èµ‹å€¼ç»™ä¸å®ƒæ¯«æ— ç»§æ‰¿å…³ç³»ã€å®Œå…¨ä¸ç›¸å¹²çš„ä¸€ä¸ªæ•°æ®ç±»å‹, åˆ™æ˜¯å±é™©å’Œä¸åˆæ³•çš„ã€‚</li></ul><p>å…ƒæ•°æ®éªŒè¯æ®µå¯¹å…ƒæ•°æ®ä¿¡æ¯ä¸­çš„æ•°æ®ç±»å‹æ ¡éªŒå®Œæ¯•ä»¥å, è¿™é˜¶æ®µå°±è¦å¯¹ç±»çš„æ–¹æ³•ä½“(Classæ–‡ä»¶ä¸­çš„Codeå±æ€§)è¿›è¡Œæ ¡éªŒåˆ†æ, ä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºã€‚</p><h5 id="_4ã€ç¬¦å·å¼•ç”¨éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_4ã€ç¬¦å·å¼•ç”¨éªŒè¯" aria-hidden="true">#</a> 4ã€ç¬¦å·å¼•ç”¨éªŒè¯</h5><p>æ ¡éªŒè¡Œä¸ºå‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™, è¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚ç›®çš„ï¼š<strong>ç¡®ä¿è§£æåŠ¨ä½œæ­£ç¡®æ‰§è¡Œ</strong>ã€‚ä¸»è¦éªŒè¯å†…å®¹ï¼š</p><ul><li>ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚</li><li>åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ç¬¦åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚</li><li>ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„å¯è®¿é—®æ€§(<code>private</code>ã€<code>protected</code>ã€<code>public</code>ã€<code>&lt;package&gt;</code>)æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®</li></ul><h4 id="å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡" aria-hidden="true">#</a> å‡†å¤‡</h4><p><strong>å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»ä¸­å®šä¹‰çš„å˜é‡(å³é™æ€å˜é‡, è¢«staticä¿®é¥°çš„å˜é‡)åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µ</strong>ã€‚è¿™ä¸€é˜¶æ®µå¹¶ä¸åŒ…æ‹¬å®ä¾‹å˜é‡, å®ä¾‹å˜é‡çš„åˆå§‹åŒ–éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­ã€‚</p><blockquote><p>ä»æ¦‚å¿µä¸Šè®², è¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜éƒ½åº”å½“åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…, ä½†å¿…é¡»æ³¨æ„åˆ°æ–¹æ³•åŒºæœ¬èº«æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„åŒºåŸŸ, åœ¨JDK 7åŠä¹‹å‰, HotSpotä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºæ—¶, å®ç°æ˜¯å®Œå…¨ç¬¦åˆè¿™ç§é€»è¾‘æ¦‚å¿µçš„ï¼›è€Œåœ¨JDK 8åŠä¹‹å, ç±»å˜é‡åˆ™ä¼šéšç€Classå¯¹è±¡ä¸€èµ·å­˜æ”¾åœ¨Javaå †ä¸­, è¿™æ—¶å€™&quot;ç±»å˜é‡åœ¨æ–¹æ³•åŒº&quot;å°±å®Œå…¨æ˜¯ä¸€ç§å¯¹é€»è¾‘æ¦‚å¿µçš„è¡¨è¿°äº†ã€‚</p></blockquote><p><strong>è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼&quot;é€šå¸¸æƒ…å†µ&quot;ä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼</strong>(å¦‚ 0ã€0Lã€nullã€false ç­‰), æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†public static int value=111 , é‚£ä¹ˆ value å˜é‡åœ¨å‡†å¤‡é˜¶æ®µçš„åˆå§‹å€¼å°±æ˜¯ 0 è€Œä¸æ˜¯ 111(åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šèµ‹å€¼)ã€‚ç‰¹æ®Šæƒ…å†µï¼šæ¯”å¦‚ç»™ value å˜é‡åŠ ä¸Šäº† final å…³é”®å­—public static final int value=111 , é‚£ä¹ˆå‡†å¤‡é˜¶æ®µ value çš„å€¼å°±è¢«èµ‹å€¼ä¸º 111ã€‚</p><h4 id="è§£æ" tabindex="-1"><a class="header-anchor" href="#è§£æ" aria-hidden="true">#</a> è§£æ</h4><p>è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚</p><blockquote><p>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡, å¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚</p></blockquote><blockquote><p><strong>ç›´æ¥å¼•ç”¨</strong>å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚åœ¨ç¨‹åºå®é™…è¿è¡Œæ—¶, åªæœ‰ç¬¦å·å¼•ç”¨æ˜¯ä¸å¤Ÿçš„, ä¸¾ä¸ªä¾‹å­ï¼šåœ¨ç¨‹åºæ‰§è¡Œæ–¹æ³•æ—¶, ç³»ç»Ÿéœ€è¦æ˜ç¡®çŸ¥é“è¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ä½ç½®ã€‚Java è™šæ‹Ÿæœºä¸ºæ¯ä¸ªç±»éƒ½å‡†å¤‡äº†ä¸€å¼ æ–¹æ³•è¡¨æ¥å­˜æ”¾ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚å½“éœ€è¦è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•çš„æ—¶å€™, åªè¦çŸ¥é“è¿™ä¸ªæ–¹æ³•åœ¨æ–¹æ³•è¡¨ä¸­çš„åç§»é‡å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•äº†ã€‚é€šè¿‡è§£ææ“ä½œç¬¦å·å¼•ç”¨å°±å¯ä»¥ç›´æ¥è½¬å˜ä¸ºç›®æ ‡æ–¹æ³•åœ¨ç±»ä¸­æ–¹æ³•è¡¨çš„ä½ç½®, ä»è€Œä½¿å¾—æ–¹æ³•å¯ä»¥è¢«è°ƒç”¨ã€‚</p></blockquote><p>ç»¼ä¸Š, è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹, ä¹Ÿå°±æ˜¯å¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ã€‚</p><p>å¯¹ç±»/æ¥å£ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£æ–¹æ³•çš„è§£æè¿‡ç¨‹, å¯å‚çœ‹ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº(ç¬¬3ç‰ˆ)ã€‹ã€‚</p><h2 id="åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–" aria-hidden="true">#</a> åˆå§‹åŒ–</h2><p>åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³• <code>&lt;clinit&gt; ()</code>æ–¹æ³•çš„è¿‡ç¨‹, æ˜¯ç±»åŠ è½½çš„æœ€åä¸€æ­¥, è¿™ä¸€æ­¥ JVM æ‰å¼€å§‹çœŸæ­£æ‰§è¡Œç±»ä¸­å®šä¹‰çš„ Java ç¨‹åºä»£ç (å­—èŠ‚ç )ã€‚</p><blockquote><p>è¯´æ˜ï¼š <code>&lt;clinit&gt; ()</code>æ–¹æ³•æ˜¯ç¼–è¯‘ä¹‹åè‡ªåŠ¨ç”Ÿæˆçš„ã€‚</p></blockquote><p>å¯¹äº<code>&lt;clinit&gt; ()</code> æ–¹æ³•çš„è°ƒç”¨, è™šæ‹Ÿæœºä¼šè‡ªå·±ç¡®ä¿å…¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„å®‰å…¨æ€§ã€‚å› ä¸º <code>&lt;clinit&gt; ()</code> æ–¹æ³•æ˜¯å¸¦é”çº¿ç¨‹å®‰å…¨, æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œç±»åˆå§‹åŒ–çš„è¯å¯èƒ½ä¼šå¼•èµ·å¤šä¸ªè¿›ç¨‹é˜»å¡, å¹¶ä¸”è¿™ç§é˜»å¡å¾ˆéš¾è¢«å‘ç°ã€‚</p><p>å¯¹äºåˆå§‹åŒ–é˜¶æ®µ, è™šæ‹Ÿæœºä¸¥æ ¼è§„èŒƒäº†æœ‰ä¸”åªæœ‰ ä»¥ä¸‹æƒ…å†µä¸‹, å¿…é¡»å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–(åªæœ‰ä¸»åŠ¨å»ä½¿ç”¨ç±»æ‰ä¼šåˆå§‹åŒ–ç±»)ï¼š</p><ol><li><p>å½“é‡åˆ° new ã€ getstaticã€putstatic æˆ– invokestatic è¿™ 4 æ¡ç›´æ¥ç æŒ‡ä»¤æ—¶, æ¯”å¦‚ new ä¸€ä¸ªç±», è¯»å–ä¸€ä¸ªé™æ€å­—æ®µ(æœªè¢« final ä¿®é¥°)ã€æˆ–è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•æ—¶ã€‚</p><p>å½“ jvm æ‰§è¡Œ new æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³å½“ç¨‹åºåˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p><p>å½“ jvm æ‰§è¡Œ getstatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè®¿é—®ç±»çš„é™æ€å˜é‡(ä¸æ˜¯é™æ€å¸¸é‡, å¸¸é‡ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± )ã€‚</p><p>å½“ jvm æ‰§è¡Œ putstatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºç»™ç±»çš„é™æ€å˜é‡èµ‹å€¼ã€‚</p><p>å½“ jvm æ‰§è¡Œ invokestatic æŒ‡ä»¤æ—¶ä¼šåˆå§‹åŒ–ç±»ã€‚å³ç¨‹åºè°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚</p></li><li><p>ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨æ—¶å¦‚ Class.forname(&quot;...&quot;), newInstance() ç­‰ç­‰ã€‚å¦‚æœç±»æ²¡åˆå§‹åŒ–, éœ€è¦è§¦å‘å…¶åˆå§‹åŒ–ã€‚</p></li><li><p>åˆå§‹åŒ–ä¸€ä¸ªç±», å¦‚æœå…¶çˆ¶ç±»è¿˜æœªåˆå§‹åŒ–, åˆ™å…ˆè§¦å‘è¯¥çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</p></li><li><p>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶, ç”¨æˆ·éœ€è¦å®šä¹‰ä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±» (åŒ…å« main æ–¹æ³•çš„é‚£ä¸ªç±»), è™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªç±»ã€‚</p></li><li><p>MethodHandle å’Œ VarHandle å¯ä»¥çœ‹ä½œæ˜¯è½»é‡çº§çš„åå°„è°ƒç”¨æœºåˆ¶, è€Œè¦æƒ³ä½¿ç”¨è¿™ 2 ä¸ªè°ƒç”¨, å°±å¿…é¡»å…ˆä½¿ç”¨ findStaticVarHandle æ¥åˆå§‹åŒ–è¦è°ƒç”¨çš„ç±»ã€‚</p></li><li><p>å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº† JDK8 æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•(è¢« default å…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•)æ—¶, å¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–, é‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</p></li></ol><h2 id="è¡¥å……-å¸è½½" tabindex="-1"><a class="header-anchor" href="#è¡¥å……-å¸è½½" aria-hidden="true">#</a> è¡¥å……ï¼šå¸è½½</h2><p>å¸è½½ç±»å³è¯¥ç±»çš„ Class å¯¹è±¡è¢« GCã€‚</p><p>å¸è½½ç±»éœ€è¦æ»¡è¶³ 3 ä¸ªè¦æ±‚:</p><ol><li>è¯¥ç±»çš„æ‰€æœ‰çš„å®ä¾‹å¯¹è±¡éƒ½å·²è¢« GC, ä¹Ÿå°±æ˜¯è¯´å †ä¸å­˜åœ¨è¯¥ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</li><li>è¯¥ç±»æ²¡æœ‰åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨</li><li>è¯¥ç±»çš„ç±»åŠ è½½å™¨çš„å®ä¾‹å·²è¢« GC</li></ol><p>æ‰€ä»¥, åœ¨ JVM ç”Ÿå‘½å‘¨æœŸå†…, ç”± jvm è‡ªå¸¦çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯ä¸ä¼šè¢«å¸è½½çš„ã€‚ä½†æ˜¯ç”±æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯èƒ½è¢«å¸è½½çš„ã€‚</p><p>åªè¦æƒ³é€šä¸€ç‚¹å°±å¥½äº†, jdk è‡ªå¸¦çš„ <code>BootstrapClassLoader</code>, <code>ExtClassLoader</code>, <code>AppClassLoader</code> è´Ÿè´£åŠ è½½ jdk æä¾›çš„ç±», æ‰€ä»¥å®ƒä»¬(ç±»åŠ è½½å™¨çš„å®ä¾‹)è‚¯å®šä¸ä¼šè¢«å›æ”¶ã€‚è€Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨çš„å®ä¾‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„, æ‰€ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯ä»¥è¢«å¸è½½æ‰çš„ã€‚</p><h1 id="ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹" aria-hidden="true">#</a> ç±»åŠ è½½å™¨å’ŒåŒäº²å§”æ´¾æ¨¡å‹</h1><p>æ‰€æœ‰çš„ç±»éƒ½ç”±ç±»åŠ è½½å™¨åŠ è½½, åŠ è½½çš„ä½œç”¨å°±æ˜¯å°† .classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ã€‚</p><blockquote><p>Javaè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿæœ‰æ„æŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„&quot;é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ&quot;è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°, ä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç è¢«ç§°ä¸º&quot;ç±»åŠ è½½å™¨&quot;(Class Loader)ã€‚</p></blockquote><p>æ¯ä¸€ä¸ªç±»åŠ è½½å™¨, éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦&quot;ç›¸ç­‰&quot;ã€‚åªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰, å¦åˆ™, å³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶, è¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½, åªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒ, é‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚</p><p>è¿™é‡Œæ‰€æŒ‡çš„&quot;ç›¸ç­‰&quot;, åŒ…æ‹¬ä»£è¡¨ç±»çš„Classå¯¹è±¡çš„<code>equals()</code>æ–¹æ³•ã€<code>isAssignableFrom()</code>æ–¹æ³•ã€<code>isInstance()</code>æ–¹æ³•çš„è¿”å›ç»“æœ, ä¹ŸåŒ…æ‹¬äº†ä½¿ç”¨<code>instanceof</code>å…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç­‰å„ç§æƒ…å†µã€‚å¦‚æœæ²¡æœ‰æ³¨æ„åˆ°ç±»åŠ è½½å™¨çš„å½±å“, åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šäº§ç”Ÿå…·æœ‰è¿·æƒ‘æ€§çš„ç»“æœ,</p><h2 id="ç±»åŠ è½½å™¨æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ç±»åŠ è½½å™¨æ€»ç»“" aria-hidden="true">#</a> ç±»åŠ è½½å™¨æ€»ç»“</h2><p>JVM ä¸­å†…ç½®äº†ä¸‰ä¸ªé‡è¦çš„ ClassLoader, é™¤äº† BootstrapClassLoader å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ª<code>java.lang.ClassLoader</code>ï¼š</p><ol><li><strong>BootstrapClassLoader(å¯åŠ¨ç±»åŠ è½½å™¨)</strong> ï¼šæœ€é¡¶å±‚çš„åŠ è½½ç±», ç”±C++å®ç°, è´Ÿè´£åŠ è½½ <code>%JAVA_HOME%/lib</code>ç›®å½•ä¸‹çš„jaråŒ…å’Œç±»æˆ–è€…æˆ–è¢« <code>-Xbootclasspath</code>å‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»ã€‚</li><li><strong>ExtensionClassLoader(æ‰©å±•ç±»åŠ è½½å™¨)</strong> ï¼šä¸»è¦è´Ÿè´£åŠ è½½ç›®å½• <code>%JRE_HOME%/lib/ext</code> ç›®å½•ä¸‹çš„jaråŒ…å’Œç±», æˆ–è¢« <code>java.ext.dirs</code> ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…ã€‚</li><li><strong>AppClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</strong> ï¼šé¢å‘æˆ‘ä»¬ç”¨æˆ·çš„åŠ è½½å™¨, è´Ÿè´£åŠ è½½å½“å‰åº”ç”¨classpathä¸‹çš„æ‰€æœ‰jaråŒ…å’Œç±»ã€‚</li></ol><h2 id="åŒäº²å§”æ´¾æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#åŒäº²å§”æ´¾æ¨¡å‹" aria-hidden="true">#</a> åŒäº²å§”æ´¾æ¨¡å‹</h2><p>åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–, å…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</p><h3 id="åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹" aria-hidden="true">#</a> <strong>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹</strong></h3><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚, å®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±», è€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆ, æ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤, å› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­, åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚(å®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»)æ—¶, å­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»å®ŒæˆåŠ è½½ã€‚</p><figure><img src="/assets/20210701154740-c6736678.png" alt="åŒäº²å§”æ´¾æ¨¡å‹" tabindex="0" loading="lazy"><figcaption>åŒäº²å§”æ´¾æ¨¡å‹</figcaption></figure><h3 id="å¥½å¤„" tabindex="-1"><a class="header-anchor" href="#å¥½å¤„" aria-hidden="true">#</a> å¥½å¤„</h3><p>ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ¥ç»„ç»‡ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³», ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„å°±æ˜¯Javaä¸­çš„ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹ä¿è¯äº†Javaç¨‹åºçš„ç¨³å®šè¿è¡Œ, å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½(JVM åŒºåˆ†ä¸åŒç±»çš„æ–¹å¼ä¸ä»…ä»…æ ¹æ®ç±»å, ç›¸åŒçš„ç±»æ–‡ä»¶è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½äº§ç”Ÿçš„æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»), ä¹Ÿä¿è¯äº† Java çš„æ ¸å¿ƒ API ä¸è¢«ç¯¡æ”¹ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹, è€Œæ˜¯æ¯ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡ªå·±çš„è¯å°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜, æ¯”å¦‚æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç§°ä¸º <code>java.lang.Object</code> ç±»çš„è¯, é‚£ä¹ˆç¨‹åºè¿è¡Œçš„æ—¶å€™, ç³»ç»Ÿå°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„ <code>Object</code> ç±»ã€‚</p><h3 id="å¦‚ä½•ç ´ååŒäº²å§”æ´¾æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç ´ååŒäº²å§”æ´¾æ¨¡å‹" aria-hidden="true">#</a> å¦‚ä½•ç ´ååŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</h3><p>è‡ªå®šä¹‰åŠ è½½å™¨çš„è¯, éœ€è¦ç»§æ‰¿ <code>ClassLoader</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹, å°±é‡å†™ <code>ClassLoader</code> ç±»ä¸­çš„ <code>findClass()</code> æ–¹æ³•å³å¯, æ— æ³•è¢«çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æœ€ç»ˆä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«åŠ è½½ã€‚ä½†æ˜¯, å¦‚æœæƒ³æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹åˆ™éœ€è¦é‡å†™ <code>loadClass()</code> æ–¹æ³•</p><h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" aria-hidden="true">#</a> è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3><p>é™¤äº† <code>BootstrapClassLoader</code> å…¶ä»–ç±»åŠ è½½å™¨å‡ç”± Java å®ç°ä¸”å…¨éƒ¨ç»§æ‰¿è‡ª<code>java.lang.ClassLoader</code>ã€‚å¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨, å¾ˆæ˜æ˜¾éœ€è¦ç»§æ‰¿ <code>ClassLoader</code>ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/en/javabase/advance/jvm.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright Â© 2023 Mr.IIIDelay</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-21433ee4.js" defer></script>
  </body>
</html>
